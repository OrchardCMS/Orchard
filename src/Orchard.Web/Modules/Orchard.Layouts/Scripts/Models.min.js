var LayoutEditor;!function(t){Array.prototype.move=function(t,i){this.splice(i,0,this.splice(t,1)[0])},t.childrenFrom=function(i){return _(i).map(function(i){return t.elementFrom(i)})};var i=t.registerFactory=function(i,n){var e=t.factories=t.factories||{};e[i]=n};i("Grid",function(i){return t.Grid.from(i)}),i("Row",function(i){return t.Row.from(i)}),i("Column",function(i){return t.Column.from(i)}),i("Content",function(i){return t.Content.from(i)}),t.elementFrom=function(i){var n=t.factories[i.type];if(!n)throw new Error('No element with type "'+i.type+'" was found.');var e=n(i);return e},t.setModel=function(t,i){$(t).scope().element=i},t.getModel=function(t){return $(t).scope().element}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Editor=function(i,n){this.config=i,this.canvas=t.Canvas.from(n),this.initialState=JSON.stringify(this.canvas.toObject()),this.activeElement=null,this.focusedElement=null,this.dropTargetElement=null,this.isDragging=!1,this.isResizing=!1,this.resetToolboxElements=function(){this.toolboxElements=[t.Row.from({children:[]})]},this.isDirty=function(){var t=JSON.stringify(this.canvas.toObject());return this.initialState!=t},this.resetToolboxElements(),this.canvas.setEditor(this)}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Element=function(t,i,n,e,h,o){if(!t)throw new Error("Parameter 'type' is required.");this.type=t,this.data=i,this.htmlId=n,this.htmlClass=e,this.htmlStyle=h,this.isTemplated=o,this.editor=null,this.parent=null,this.setIsFocusedEventHandlers=[],this.setEditor=function(t){this.editor=t,this.children&&_.isArray(this.children)&&_(this.children).each(function(i){i.setEditor(t)})},this.setParent=function(t){this.parent=t,this.parent.onChildAdded(this);for(var i=t;i;)i.onDescendantAdded(this,t),i=i.parent},this.setIsTemplated=function(t){this.isTemplated=t,this.children&&_.isArray(this.children)&&_(this.children).each(function(i){i.setIsTemplated(t)})},this.applyElementEditorModel=function(){},this.getIsActive=function(){return this.editor?this.editor.activeElement===this&&!this.getIsFocused():!1},this.setIsActive=function(t){this.editor&&(this.editor.isDragging||this.editor.isResizing||(t?this.editor.activeElement=this:this.editor.activeElement=this.parent))},this.getIsFocused=function(){return this.editor?this.editor.focusedElement===this:!1},this.setIsFocused=function(){this.editor&&(this.isTemplated||this.editor.isDragging||this.editor.isResizing||(this.editor.focusedElement=this,_(this.setIsFocusedEventHandlers).each(function(t){try{t()}catch(i){}})))},this.getIsSelected=function(){return this.getIsFocused()?!0:this.children&&_.isArray(this.children)?_(this.children).any(function(t){return t.getIsSelected()}):!1},this.getIsDropTarget=function(){return this.editor?this.editor.dropTargetElement===this:!1},this.setIsDropTarget=function(t){this.editor&&(t?this.editor.dropTargetElement=this:this.editor.dropTargetElement=null)},this["delete"]=function(){this.parent&&this.parent.deleteChild(this)},this.canMoveUp=function(){return this.parent?this.parent.canMoveChildUp(this):!1},this.moveUp=function(){this.parent&&this.parent.moveChildUp(this)},this.canMoveDown=function(){return this.parent?this.parent.canMoveChildDown(this):!1},this.moveDown=function(){this.parent&&this.parent.moveChildDown(this)},this.elementToObject=function(){return{type:this.type,data:this.data,htmlId:this.htmlId,htmlClass:this.htmlClass,htmlStyle:this.htmlStyle,isTemplated:this.isTemplated}},this.getEditorObject=function(){return{}},this.copy=function(t){var i=this.getInnerText();t.setData("text/plain",i);var n=this.toObject(),e=JSON.stringify(n,null,"	");t.setData("text/json",e)},this.cut=function(t){this.copy(t),this["delete"]()},this.paste=function(t){this.parent&&this.parent.paste(t)}}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Container=function(i,n){this.allowedChildTypes=i,this.children=n,this.isContainer=!0;var e=this;this.onChildAdded=function(t){},this.onDescendantAdded=function(t,i){},this.setChildren=function(t){this.children=t,_(this.children).each(function(t){t.setParent(e)})},this.setChildren(n),this.getIsSealed=function(){return _(this.children).any(function(t){return t.isTemplated})},this.addChild=function(t){_(this.children).contains(t)||!_(this.allowedChildTypes).contains(t.type)&&!t.isContainable||this.children.push(t),t.setEditor(this.editor),t.setIsTemplated(!1),t.setParent(this)},this.deleteChild=function(t){var i=_(this.children).indexOf(t);i>=0&&(this.children.splice(i,1),t.getIsActive()&&(this.editor.activeElement=null),t.getIsFocused()&&(this.children.length>i?this.children[i].setIsFocused():i>0?this.children[i-1].setIsFocused():this.setIsFocused()))},this.moveFocusPrevChild=function(t){if(!(this.children.length<2)){var i=_(this.children).indexOf(t);i>0&&this.children[i-1].setIsFocused()}},this.moveFocusNextChild=function(t){if(!(this.children.length<2)){var i=_(this.children).indexOf(t);i<this.children.length-1&&this.children[i+1].setIsFocused()}},this.insertChild=function(t,i){if(!_(this.children).contains(t)){var n=Math.max(_(this.children).indexOf(i),0);this.children.splice(n+1,0,t),t.setEditor(this.editor),t.parent=this}},this.moveChildUp=function(t){if(this.canMoveChildUp(t)){var i=_(this.children).indexOf(t);this.children.move(i,i-1)}},this.moveChildDown=function(t){if(this.canMoveChildDown(t)){var i=_(this.children).indexOf(t);this.children.move(i,i+1)}},this.canMoveChildUp=function(t){var i=_(this.children).indexOf(t);return i>0},this.canMoveChildDown=function(t){var i=_(this.children).indexOf(t);return i<this.children.length-1},this.childrenToObject=function(){return _(this.children).map(function(t){return t.toObject()})},this.getInnerText=function(){return _(this.children).reduce(function(t,i){return t+"\n"+i.getInnerText()},"")},this.paste=function(i){var n=i.getData("text/json");if(n){var e=JSON.parse(n),h=t.elementFrom(e);this.pasteChild(h)}},this.pasteChild=function(t){_(this.allowedChildTypes).contains(t.type)||t.isContainable?(this.addChild(t),t.setIsFocused()):this.parent&&this.parent.pasteChild(t)}}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Canvas=function(i,n,e,h,o,s){t.Element.call(this,"Canvas",i,n,e,h,o),t.Container.call(this,["Grid","Content"],s),this.toObject=function(){var t=this.elementToObject();return t.children=this.childrenToObject(),t}},t.Canvas.from=function(i){return new t.Canvas(i.data,i.htmlId,i.htmlClass,i.htmlStyle,i.isTemplated,t.childrenFrom(i.children))}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Grid=function(i,n,e,h,o,s){t.Element.call(this,"Grid",i,n,e,h,o),t.Container.call(this,["Row"],s),this.toObject=function(){var t=this.elementToObject();return t.children=this.childrenToObject(),t}},t.Grid.from=function(i){var n=new t.Grid(i.data,i.htmlId,i.htmlClass,i.htmlStyle,i.isTemplated,t.childrenFrom(i.children));return n.toolboxIcon=i.toolboxIcon,n.toolboxLabel=i.toolboxLabel,n.toolboxDescription=i.toolboxDescription,n}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Row=function(n,e,h,o,s,r){function l(){return _(a.children).reduce(function(t,i){return t+i.offset+i.width},0)}function c(t){function n(t){return e>0?t.width<12:0>e?t.width>1:!1}if(0==t)return!0;var e=t;if(0>e){var h=12-l();e+=h,e>0&&(e=0)}for(;0>e&&_(a.children).any(function(t){return t.offset>0});)for(i=0;i<a.children.length&&0>e;i++){var o=a.children[i];o.offset>0&&(o.offset--,e++)}for(;0!=e&&_(a.children).any(n);)for(i=0;i<a.children.length&&0!=e;i++){var o=a.children[i%a.children.length];if(n(o)){var s=e/Math.abs(e);o.width+=s,e-=s}}return 0==e}t.Element.call(this,"Row",n,e,h,o,s),t.Container.call(this,["Column"],r);var a=this,d=!1;this.canAddColumn=function(){return this.children.length<12},this.beginAddColumn=function(t){if(d)throw new Error("Column add operation is already in progress.");return _(this.children).each(function(t){t.beginChange()}),c(-t)?(d=!0,!0):(_(this.children).each(function(t){t.rollbackChange()}),!1)},this.commitAddColumn=function(){if(!d)throw new Error("No column add operation in progress.");_(this.children).each(function(t){t.commitChange()}),d=!1},this.rollbackAddColumn=function(){if(!d)throw new Error("No column add operation in progress.");_(this.children).each(function(t){t.rollbackChange()}),d=!1};var u=this.deleteChild;this.deleteChild=function(t){var i=t.width;u.call(this,t),c(i)},this.canContractColumnRight=function(t,i){var n=_(this.children).indexOf(t);return n>=0?t.width>1:!1},this.contractColumnRight=function(t,i){if(this.canContractColumnRight(t,i)){var n=_(this.children).indexOf(t);if(n>=0&&t.width>1&&(t.width--,this.children.length>n+1)){var e=this.children[n+1];i&&0==e.offset?e.width++:e.offset++}}},this.canExpandColumnRight=function(t,i){var n=_(this.children).indexOf(t);if(n>=0){if(t.width>=12)return!1;if(this.children.length>n+1){var e=this.children[n+1];return i&&0==e.offset?e.width>1:e.offset>0}return l()<12}return!1},this.expandColumnRight=function(t,i){if(this.canExpandColumnRight(t,i)){var n=_(this.children).indexOf(t);if(n>=0){if(this.children.length>n+1){var e=this.children[n+1];i&&0==e.offset?e.width--:e.offset--}t.width++}}},this.canExpandColumnLeft=function(t,i){var n=_(this.children).indexOf(t);if(n>=0){if(t.width>=12)return!1;if(n>0){var e=this.children[n-1];if(i&&0==t.offset)return e.width>1}return t.offset>0}return!1},this.expandColumnLeft=function(t,i){if(this.canExpandColumnLeft(t,i)){var n=_(this.children).indexOf(t);if(n>=0){if(n>0){var e=this.children[n-1];i&&0==t.offset?e.width--:t.offset--}else t.offset--;t.width++}}},this.canContractColumnLeft=function(t,i){var n=_(this.children).indexOf(t);return n>=0?t.width>1:!1},this.contractColumnLeft=function(t,i){if(this.canContractColumnLeft(t,i)){var n=_(this.children).indexOf(t);if(n>=0){if(n>0){var e=this.children[n-1];i&&0==t.offset?e.width++:t.offset++}else t.offset++;t.width--}}},this.evenColumns=function(){if(0!=this.children.length){var t=Math.floor(12/this.children.length);_(this.children).each(function(i){i.width=t,i.offset=0});var i=12%this.children.length;i>0&&c(i)}};var f=this.pasteChild;this.pasteChild=function(t){"Column"==t.type?this.beginAddColumn(t.width)&&(this.commitAddColumn(),f.call(this,t)):this.parent&&this.parent.pasteChild(t)},this.toObject=function(){var t=this.elementToObject();return t.children=this.childrenToObject(),t}},t.Row.from=function(i){var n=new t.Row(i.data,i.htmlId,i.htmlClass,i.htmlStyle,i.isTemplated,t.childrenFrom(i.children));return n.toolboxIcon=i.toolboxIcon,n.toolboxLabel=i.toolboxLabel,n.toolboxDescription=i.toolboxDescription,n}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Column=function(i,n,e,h,o,s,r,l){t.Element.call(this,"Column",i,n,e,h,o),t.Container.call(this,["Grid","Content"],l),this.width=s,this.offset=r;var c=!1,a=0,d=0;this.beginChange=function(){if(c)throw new Error("Column already has a pending change.");c=!0,a=this.width,d=this.offset},this.commitChange=function(){if(!c)throw new Error("Column has no pending change.");a=0,d=0,c=!1},this.rollbackChange=function(){if(!c)throw new Error("Column has no pending change.");this.width=a,this.offset=d,a=0,d=0,c=!1},this.canSplit=function(){return this.width>1},this.split=function(){if(this.canSplit()){var i=Math.floor(this.width/2),n=t.Column.from({data:null,htmlId:null,htmlClass:null,htmlStyle:null,width:i,offset:0,children:[]});this.width=this.width-i,this.parent.insertChild(n,this),n.setIsFocused()}},this.canContractRight=function(t){return this.parent.canContractColumnRight(this,t)},this.contractRight=function(t){this.parent.contractColumnRight(this,t)},this.canExpandRight=function(t){return this.parent.canExpandColumnRight(this,t)},this.expandRight=function(t){this.parent.expandColumnRight(this,t)},this.canExpandLeft=function(t){return this.parent.canExpandColumnLeft(this,t)},this.expandLeft=function(t){this.parent.expandColumnLeft(this,t)},this.canContractLeft=function(t){return this.parent.canContractColumnLeft(this,t)},this.contractLeft=function(t){this.parent.contractColumnLeft(this,t)},this.toObject=function(){var t=this.elementToObject();return t.width=this.width,t.offset=this.offset,t.children=this.childrenToObject(),t}},t.Column.from=function(i){var n=new t.Column(i.data,i.htmlId,i.htmlClass,i.htmlStyle,i.isTemplated,i.width,i.offset,t.childrenFrom(i.children));return n.toolboxIcon=i.toolboxIcon,n.toolboxLabel=i.toolboxLabel,n.toolboxDescription=i.toolboxDescription,n},t.Column.times=function(i){return _.times(i,function(n){return t.Column.from({data:null,htmlId:null,htmlClass:null,isTemplated:!1,width:12/i,offset:0,children:[]})})}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t){t.Content=function(i,n,e,h,o,s,r,l,c,a){t.Element.call(this,"Content",i,n,e,h,o),this.contentType=s,this.contentTypeLabel=r,this.contentTypeClass=l,this.html=c,this.hasEditor=a,this.getInnerText=function(){return $($.parseHTML("<div>"+this.html+"</div>")).text()},this.setHtml=function(t){this.html=t,this.htmlUnsafe=t},this.toObject=function(){return{type:"Content"}},this.toObject=function(){var t=this.elementToObject();return t.contentType=this.contentType,t.contentTypeLabel=this.contentTypeLabel,t.contentTypeClass=this.contentTypeClass,t.html=this.html,t.hasEditor=a,t},this.setHtml(c)},t.Content.from=function(i){var n=new t.Content(i.data,i.htmlId,i.htmlClass,i.htmlStyle,i.isTemplated,i.contentType,i.contentTypeLabel,i.contentTypeClass,i.html,i.hasEditor);return n}}(LayoutEditor||(LayoutEditor={}));var LayoutEditor;!function(t,i){i.Html=function(n,e,h,o,s,r,l,c,a,d){i.Element.call(this,"Html",n,e,h,o,s),this.contentType=r,this.contentTypeLabel=l,this.contentTypeClass=c,this.html=a,this.hasEditor=d,this.isContainable=!0,this.getInnerText=function(){return t(t.parseHTML("<div>"+this.html+"</div>")).text()},this.setHtml=function(t){this.html=t,this.htmlUnsafe=t},this.toObject=function(){return{type:"Html"}},this.toObject=function(){var t=this.elementToObject();return t.contentType=this.contentType,t.contentTypeLabel=this.contentTypeLabel,t.contentTypeClass=this.contentTypeClass,t.html=this.html,t.hasEditor=d,t};var u=this.getEditorObject;this.getEditorObject=function(){var i=u();return t.extend(i,{Content:this.html})},this.setHtml(a)},i.Html.from=function(t){var n=new i.Html(t.data,t.htmlId,t.htmlClass,t.htmlStyle,t.isTemplated,t.contentType,t.contentTypeLabel,t.contentTypeClass,t.html,t.hasEditor);return n},i.registerFactory("Html",function(t){return i.Html.from(t)})}(jQuery,LayoutEditor||(LayoutEditor={}));