var Orchard;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,n){var o=$(e).closest(".async-upload"),i=n.errorThrown&&n.errorThrown.length>0?n.errorThrown:n.textStatus;switch(o.find(".progress-bar").hide(),o.find(".progress-text").hide(),o.find(".progress-details").hide(),o.find(".status.preparing").hide(),o.find(".status.uploading").hide(),i){case"error":return a(o,n),void alert("The upload of the selected file failed. You may try again after the cleanup has finished.");case"abort":return void a(o,n)}var r=o.find("input[name$='.FileName']").val(),d=o.find(".status.uploaded").show();d.text(d.data("text-template").replace("{filename}",r)),o.data("upload-isactive",!1),o.data("upload-iscompleted",!0),o.data("upload-start-time",null)}function a(e,t){var a=e.find("input[name$='.WamsAssetId']"),n=e.find("input[name$='.FileName']"),o=$.trim(a.val()),i=t.fileInput.closest(".file-upload-wrapper");if(o.length>0){var r=e.data("delete-asset-url"),d=e.closest("form").find("[name='__RequestVerificationToken']").val(),s=e.find(".status.cleanup");a.val(""),n.val(""),s.show(),$.ajax({url:r,type:"DELETE",data:{id:o,__RequestVerificationToken:d}}).done(function(){e.data("upload-isactive",!1),e.data("upload-start-time",null),e.find(".file-upload-wrapper").show(),s.hide()}).fail(function(){alert("An error occurred on the server while trying to clean up.")})}i.show()}function n(e,t){for(var a=e.toString();a.length<t;)a="0"+a;return a}function o(e){var t="block-";return btoa(t+n(e,6))}function i(e,t){var a=$.Deferred(),n=e.data("block-ids");if(0==n.length)a.resolve();else{for(var o=e.data("sas-locator")+"&comp=blocklist",i='<?xml version="1.0" encoding="utf-8"?><BlockList>',r=0;r<n.length;r++)i+="<Latest>"+n[r]+"</Latest>";i+="</BlockList>",$.ajax({url:o,type:"PUT",data:i,contentType:"text/plain; charset=UTF-8",crossDomain:!0,cache:!1,beforeSend:function(e){e.setRequestHeader("x-ms-date",(new Date).toUTCString()),e.setRequestHeader("x-ms-blob-content-type",t.files[0].type),e.setRequestHeader("x-ms-version","2012-02-12"),e.setRequestHeader("Content-Length",i.length.toString())},success:function(){a.resolve(t)},error:function(e,n,o){t.textStatus=n,t.errorThrown=o,a.fail(t)}})}return a.promise()}function r(){var e=$(".upload-direct"),t=!1;return e.find(".async-upload").each(function(){return 1==$(this).data("upload-isactive")?(t=!0,!1):void 0}),t}function d(){var e=$(".upload-direct"),t=!1;return e.find(".async-upload").each(function(){return 1==$(this).data("upload-iscompleted")?(t=!0,!1):void 0}),t}function s(){var e=$(".upload-direct");return 1==e.data("is-submitting")}function l(e){var a=e.closest(".async-upload"),n=a.find(".file-upload-wrapper"),r=new RegExp(a.data("upload-accept-file-types")),d=a.closest("form").find("[name='__RequestVerificationToken']").val(),s=a.find(".selected-file-wrapper"),l=a.find(".filename-input"),u=(a.find(".reset-button"),a.find(".upload-button"),a.find(".filename-text")),c=a.find(".validation-text"),f=a.find(".status.preparing"),p=a.find(".status.uploading"),h=a.find(".progress-bar"),m=a.find(".progress-text"),v=a.find(".progress-details"),w=a.find(".cancel-link");e.fileupload({autoUpload:!1,acceptFileTypes:r,type:"PUT",maxChunkSize:4194304,beforeSend:function(e,t){e.setRequestHeader("x-ms-date",(new Date).toUTCString()),e.setRequestHeader("x-ms-blob-type","BlockBlob"),e.setRequestHeader("content-length",t.data.size.toString())},chunksend:function(e,t){var n=a.data("block-index"),i=a.data("block-ids"),r=o(n),d=a.data("sas-locator")+"&comp=block&blockid="+r;t.url=d,i.push(r),a.data("block-index",n+1)},progressall:function(e,t){var n=Math.floor(t.loaded/t.total*100),o=new Date(a.data("upload-start-time")),i=new Date(Date.now()).getTime()-o.getTime(),r=moment.duration(i,"ms"),d=moment.duration(i/Math.max(t.loaded,1)*(t.total-t.loaded),"ms"),s=Math.floor(t.bitrate/8/1e3),l=Math.floor(t.loaded/1e3),u=Math.floor(t.total/1e3);h.show().find(".progress").css("width",n+"%"),m.text(m.data("text-template").replace("{percentage}",n)).show(),v.text(v.data("text-template").replace("{uploaded}",l).replace("{total}",u).replace("{kbps}",s).replace("{elapsed}",r.humanize()).replace("{remaining}",d.humanize())).show()},done:function(e,n){var o=this;i(a,n).always(function(){t(o,e,n)})},fail:function(e,a){t(this,e,a)},processdone:function(e,t){var o=t.files[0].name;a.data("selected-filename",o),window.setTimeout(function(){n.hide(),c.hide(),s.show(),u.text(u.data("text-template").replace("{filename}",o))},10),a[0].doReset=function(){n.show(),l.val(""),u.text(""),s.hide(),c.hide()},a[0].doUpload=function(){var e=l.val()||o;if(!r.test(e))return void c.show();a.data("upload-isactive",!0),a.data("upload-start-time",Date.now());var i=a.data("generate-asset-url");a.data("block-index",0),a.data("block-ids",new Array),f.show(),s.hide(),c.hide(),$.ajax({url:i,data:{filename:e,__RequestVerificationToken:d},type:"POST"}).done(function(n){t.url=n.sasLocator,t.multipart=!1,a.data("sas-locator",n.sasLocator),a.find("input[name$='.FileName']").val(e),a.find("input[name$='.WamsAssetId']").val(n.assetId),f.hide(),m.text(m.data("text-template").replace("{percentage}",0)).show(),p.show();var o=t.submit();a.data("xhr",o)}).fail(function(e,t,o){n.show(),s.show(),f.hide(),p.hide(),a.data("upload-isactive",!1),a.data("upload-start-time",null),alert("An error occurred. Error: "+o)})}},processfail:function(e,t){c.show(),l.val(""),u.text(""),s.hide()},change:function(t,a){var n=e.data("prompt");n&&n.length>0&&(confirm(n)||t.preventDefault())}}),w.on("click",function(e){if(e.preventDefault(),confirm($(this).data("cancel-prompt"))){var t=a.data("xhr");t.abort()}})}function u(){var e=$(".upload-direct").show();e.find(".reset-button").on("click",function(e){var t=$(this).closest(".async-upload")[0].doReset;t&&t()}),e.find(".upload-button").on("click",function(e){var t=$(this).closest(".async-upload")[0].doUpload;t&&t()}),c=e.find(".required-upload"),e.find(".async-upload-file-input").each(function(){l($(this))}),e.closest("form").on("submit",function(t){return r()?(alert(e.data("block-submit-prompt")),t.preventDefault(),!1):void e.data("is-submitting",!0)}),$(window).on("beforeunload",function(t){if((r()||d())&&!s()){var a=e.data("navigate-away-prompt");return t.result=a,a}})}var c;e.initializeUploadDirect=u}(t=e.CloudVideoEdit||(e.CloudVideoEdit={}))}(t=e.MediaServices||(e.MediaServices={}))}(t=e.Azure||(e.Azure={}))}(Orchard||(Orchard={}));
