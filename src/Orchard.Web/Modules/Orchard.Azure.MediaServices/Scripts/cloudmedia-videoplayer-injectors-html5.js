/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/underscore.d.ts" />
/// <reference path="Typings/URIjs.d.ts" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var VideoPlayer;
            (function (VideoPlayer) {
                var Injectors;
                (function (Injectors) {
                    var Html5Injector = (function (_super) {
                        __extends(Html5Injector, _super);
                        function Html5Injector() {
                            return _super !== null && _super.apply(this, arguments) || this;
                        }
                        Html5Injector.prototype.isSupported = function () {
                            var videoElement = document.createElement("video");
                            var result = videoElement && !!videoElement.canPlayType;
                            this.debug("Browser supports HTML5 video: {0}", result);
                            this.debug("isSupported() returns {0}.", result);
                            return result;
                        };
                        Html5Injector.prototype.inject = function () {
                            var _this = this;
                            var firstThumbnailAsset = _(this.filteredAssets().ThumbnailAssets).first();
                            this.debug("Injecting player into element '{0}'.", this.container.id);
                            var videoElement = $("<video controls>").attr("width", this.playerWidth).attr("height", this.playerHeight);
                            if (firstThumbnailAsset)
                                videoElement.attr("poster", firstThumbnailAsset.MainFileUrl);
                            if (this.autoPlay)
                                videoElement.attr("autoplay", "");
                            var sourceElements = [];
                            // Adaptive streaming URLs from dynamic assets.
                            _(this.assetData.DynamicVideoAssets).forEach(function (asset) {
                                var smoothStreamingSourceElement = $("<source>").attr("src", asset.SmoothStreamingUrl).attr("type", "application/vnd.ms-sstr+xml");
                                var hlsSourceElement = $("<source>").attr("src", asset.HlsUrl).attr("type", "application/x-mpegURL");
                                var mpegDashSourceElement = $("<source>").attr("src", asset.MpegDashUrl).attr("type", "application/dash+xml");
                                if (_this.applyMediaQueries && asset.MediaQuery)
                                    $([smoothStreamingSourceElement, hlsSourceElement, mpegDashSourceElement]).attr("media", asset.MediaQuery);
                                sourceElements.push(smoothStreamingSourceElement, hlsSourceElement, mpegDashSourceElement);
                            });
                            // "Raw" asset video file URLs from dynamic assets (in decending bitrate order).
                            _(this.assetData.DynamicVideoAssets).forEach(function (asset) {
                                _((asset.EncoderMetadata && asset.EncoderMetadata.AssetFiles) || [])
                                    .filter(function (assetFile) { return _(assetFile.VideoTracks).any(); })
                                    .sort(function (assetFile) { return assetFile.Bitrate; }).reverse()
                                    .forEach(function (assetFile) {
                                    var url = new URI(asset.MainFileUrl).filename(assetFile.Name);
                                    var sourceElement = $("<source>").attr("src", url.toString()).attr("type", assetFile.MimeType);
                                    if (_this.applyMediaQueries && asset.MediaQuery)
                                        sourceElement.attr("media", asset.MediaQuery);
                                    sourceElements.push(sourceElement);
                                });
                            });
                            // Asset file URLs from non-dynamic assets.
                            _(this.assetData.VideoAssets).forEach(function (asset) {
                                var sourceElement = $("<source>").attr("src", asset.MainFileUrl).attr("type", asset.MimeType);
                                if (_this.applyMediaQueries && asset.MediaQuery)
                                    sourceElement.attr("media", asset.MediaQuery);
                                sourceElements.push(sourceElement);
                            });
                            _(this.filteredAssets().SubtitleAssets).forEach(function (asset) {
                                var sourceElement = $("<track kind=\"captions\">").attr("label", asset.Name).attr("src", asset.MainFileUrl).attr("srclang", asset.Language);
                                sourceElements.push(sourceElement);
                            });
                            if (!_(sourceElements).any()) {
                                this.debug("No sources available; cleaning up container and faulting this injector.");
                                this.fault();
                                return;
                            }
                            $(sourceElements).each(function (index, elem) { $(elem).appendTo(videoElement); });
                            videoElement.appendTo(this.container);
                            var lastSource = _(sourceElements).last()[0];
                            var errorHandler = function (e) {
                                _this.debug("Error detected; cleaning up container and faulting this injector.");
                                // TODO: Be a little more selective here, don't fail on any error.
                                _this.fault();
                            };
                            lastSource.addEventListener("error", errorHandler, false);
                            videoElement.on("error", errorHandler);
                        };
                        Html5Injector.prototype.debug = function (message) {
                            var args = [];
                            for (var _i = 1; _i < arguments.length; _i++) {
                                args[_i - 1] = arguments[_i];
                            }
                            _super.prototype.debug.call(this, "Html5Injector: " + message, args);
                        };
                        return Html5Injector;
                    }(Injectors.Injector));
                    Injectors.Html5Injector = Html5Injector;
                })(Injectors = VideoPlayer.Injectors || (VideoPlayer.Injectors = {}));
            })(VideoPlayer = MediaServices.VideoPlayer || (MediaServices.VideoPlayer = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtdmlkZW9wbGF5ZXItaW5qZWN0b3JzLWh0bWw1LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNENBQTRDO0FBQzVDLGdEQUFnRDtBQUNoRCwyQ0FBMkM7Ozs7OztBQUUzQyxJQUFPLE9BQU8sQ0EwRmI7QUExRkQsV0FBTyxPQUFPO0lBQUMsSUFBQSxLQUFLLENBMEZuQjtJQTFGYyxXQUFBLEtBQUs7UUFBQyxJQUFBLGFBQWEsQ0EwRmpDO1FBMUZvQixXQUFBLGFBQWE7WUFBQyxJQUFBLFdBQVcsQ0EwRjdDO1lBMUZrQyxXQUFBLFdBQVc7Z0JBQUMsSUFBQSxTQUFTLENBMEZ2RDtnQkExRjhDLFdBQUEsU0FBUztvQkFJcEQ7d0JBQW1DLGlDQUFRO3dCQUEzQzs7d0JBcUZBLENBQUM7d0JBbkZVLG1DQUFXLEdBQWxCOzRCQUNJLElBQUksWUFBWSxHQUFxQixRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzRCQUNyRSxJQUFJLE1BQU0sR0FBRyxZQUFZLElBQUksQ0FBQyxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7NEJBQ3hELElBQUksQ0FBQyxLQUFLLENBQUMsbUNBQW1DLEVBQUUsTUFBTSxDQUFDLENBQUM7NEJBQ3hELElBQUksQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsTUFBTSxDQUFDLENBQUM7NEJBRWpELE1BQU0sQ0FBQyxNQUFNLENBQUM7d0JBQ2xCLENBQUM7d0JBRU0sOEJBQU0sR0FBYjs0QkFBQSxpQkFxRUM7NEJBcEVHLElBQUksbUJBQW1CLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQzs0QkFFM0UsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUV0RSxJQUFJLFlBQVksR0FBRyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FB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QVMsR0FBVCxxQkFBUyxLQUFULHFCQUFTLFFBMEZ2RDtZQUFELENBQUMsRUExRmtDLFdBQVcsR0FBWCx5QkFBVyxLQUFYLHlCQUFXLFFBMEY3QztRQUFELENBQUMsRUExRm9CLGFBQWEsR0FBYixtQkFBYSxLQUFiLG1CQUFhLFFBMEZqQztJQUFELENBQUMsRUExRmMsS0FBSyxHQUFMLGFBQUssS0FBTCxhQUFLLFFBMEZuQjtBQUFELENBQUMsRUExRk0sT0FBTyxLQUFQLE9BQU8sUUEwRmIiLCJmaWxlIjoiY2xvdWRtZWRpYS12aWRlb3BsYXllci1pbmplY3RvcnMtaHRtbDUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiVHlwaW5ncy9qcXVlcnkuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL3VuZGVyc2NvcmUuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL1VSSWpzLmQudHNcIiAvPlxyXG5cclxubW9kdWxlIE9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMge1xyXG5cclxuICAgIGltcG9ydCBEYXRhID0gT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkRhdGE7XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEh0bWw1SW5qZWN0b3IgZXh0ZW5kcyBJbmplY3RvciB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpc1N1cHBvcnRlZCgpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgdmFyIHZpZGVvRWxlbWVudDogSFRNTFZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ2aWRlb1wiKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZpZGVvRWxlbWVudCAmJiAhIXZpZGVvRWxlbWVudC5jYW5QbGF5VHlwZTtcclxuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIkJyb3dzZXIgc3VwcG9ydHMgSFRNTDUgdmlkZW86IHswfVwiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmRlYnVnKFwiaXNTdXBwb3J0ZWQoKSByZXR1cm5zIHswfS5cIiwgcmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW5qZWN0KCk6IHZvaWQge1xyXG4gICAgICAgICAgICB2YXIgZmlyc3RUaHVtYm5haWxBc3NldCA9IF8odGhpcy5maWx0ZXJlZEFzc2V0cygpLlRodW1ibmFpbEFzc2V0cykuZmlyc3QoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGVidWcoXCJJbmplY3RpbmcgcGxheWVyIGludG8gZWxlbWVudCAnezB9Jy5cIiwgdGhpcy5jb250YWluZXIuaWQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHZpZGVvRWxlbWVudCA9ICQoXCI8dmlkZW8gY29udHJvbHM+XCIpLmF0dHIoXCJ3aWR0aFwiLCB0aGlzLnBsYXllcldpZHRoKS5hdHRyKFwiaGVpZ2h0XCIsIHRoaXMucGxheWVySGVpZ2h0KTtcclxuICAgICAgICAgICAgaWYgKGZpcnN0VGh1bWJuYWlsQXNzZXQpXHJcbiAgICAgICAgICAgICAgICB2aWRlb0VsZW1lbnQuYXR0cihcInBvc3RlclwiLCBmaXJzdFRodW1ibmFpbEFzc2V0Lk1haW5GaWxlVXJsKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkpXHJcbiAgICAgICAgICAgICAgICB2aWRlb0VsZW1lbnQuYXR0cihcImF1dG9wbGF5XCIsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNvdXJjZUVsZW1lbnRzOiBKUXVlcnlbXSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRhcHRpdmUgc3RyZWFtaW5nIFVSTHMgZnJvbSBkeW5hbWljIGFzc2V0cy5cclxuICAgICAgICAgICAgXyh0aGlzLmFzc2V0RGF0YS5EeW5hbWljVmlkZW9Bc3NldHMpLmZvckVhY2goYXNzZXQgPT4geyAvLyBSZWFkIGZyb20gYXNzZXREYXRhIGJlY2F1c2UgYnJvd3NlciB3aWxsIGRvIG1lZGlhIHF1ZXJ5IGZpbHRlcmluZy5cclxuICAgICAgICAgICAgICAgIHZhciBzbW9vdGhTdHJlYW1pbmdTb3VyY2VFbGVtZW50ID0gJChcIjxzb3VyY2U+XCIpLmF0dHIoXCJzcmNcIiwgYXNzZXQuU21vb3RoU3RyZWFtaW5nVXJsKS5hdHRyKFwidHlwZVwiLCBcImFwcGxpY2F0aW9uL3ZuZC5tcy1zc3RyK3htbFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBobHNTb3VyY2VFbGVtZW50ID0gJChcIjxzb3VyY2U+XCIpLmF0dHIoXCJzcmNcIiwgYXNzZXQuSGxzVXJsKS5hdHRyKFwidHlwZVwiLCBcImFwcGxpY2F0aW9uL3gtbXBlZ1VSTFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBtcGVnRGFzaFNvdXJjZUVsZW1lbnQgPSAkKFwiPHNvdXJjZT5cIikuYXR0cihcInNyY1wiLCBhc3NldC5NcGVnRGFzaFVybCkuYXR0cihcInR5cGVcIiwgXCJhcHBsaWNhdGlvbi9kYXNoK3htbFwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcGx5TWVkaWFRdWVyaWVzICYmIGFzc2V0Lk1lZGlhUXVlcnkpXHJcbiAgICAgICAgICAgICAgICAgICAgJChbc21vb3RoU3RyZWFtaW5nU291cmNlRWxlbWVudCwgaGxzU291cmNlRWxlbWVudCwgbXBlZ0Rhc2hTb3VyY2VFbGVtZW50XSkuYXR0cihcIm1lZGlhXCIsIGFzc2V0Lk1lZGlhUXVlcnkpO1xyXG4gICAgICAgICAgICAgICAgc291cmNlRWxlbWVudHMucHVzaChzbW9vdGhTdHJlYW1pbmdTb3VyY2VFbGVtZW50LCBobHNTb3VyY2VFbGVtZW50LCBtcGVnRGFzaFNvdXJjZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFwiUmF3XCIgYXNzZXQgdmlkZW8gZmlsZSBVUkxzIGZyb20gZHluYW1pYyBhc3NldHMgKGluIGRlY2VuZGluZyBiaXRyYXRlIG9yZGVyKS5cclxuICAgICAgICAgICAgXyh0aGlzLmFzc2V0RGF0YS5EeW5hbWljVmlkZW9Bc3NldHMpLmZvckVhY2goYXNzZXQgPT4geyAvLyBSZWFkIGZyb20gYXNzZXREYXRhIGJlY2F1c2UgYnJvd3NlciB3aWxsIGRvIG1lZGlhIHF1ZXJ5IGZpbHRlcmluZy5cclxuICAgICAgICAgICAgICAgIF8oKGFzc2V0LkVuY29kZXJNZXRhZGF0YSAmJiBhc3NldC5FbmNvZGVyTWV0YWRhdGEuQXNzZXRGaWxlcykgfHwgW10pXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihhc3NldEZpbGUgPT4gXyhhc3NldEZpbGUuVmlkZW9UcmFja3MpLmFueSgpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zb3J0KGFzc2V0RmlsZSA9PiBhc3NldEZpbGUuQml0cmF0ZSkucmV2ZXJzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goYXNzZXRGaWxlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IG5ldyBVUkkoYXNzZXQuTWFpbkZpbGVVcmwpLmZpbGVuYW1lKGFzc2V0RmlsZS5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVsZW1lbnQgPSAkKFwiPHNvdXJjZT5cIikuYXR0cihcInNyY1wiLCB1cmwudG9TdHJpbmcoKSkuYXR0cihcInR5cGVcIiwgYXNzZXRGaWxlLk1pbWVUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwbHlNZWRpYVF1ZXJpZXMgJiYgYXNzZXQuTWVkaWFRdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnQuYXR0cihcIm1lZGlhXCIsIGFzc2V0Lk1lZGlhUXVlcnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VFbGVtZW50cy5wdXNoKHNvdXJjZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFzc2V0IGZpbGUgVVJMcyBmcm9tIG5vbi1keW5hbWljIGFzc2V0cy5cclxuICAgICAgICAgICAgXyh0aGlzLmFzc2V0RGF0YS5WaWRlb0Fzc2V0cykuZm9yRWFjaChhc3NldCA9PiB7IC8vIFJlYWQgZnJvbSBhc3NldERhdGEgYmVjYXVzZSBicm93c2VyIHdpbGwgZG8gbWVkaWEgcXVlcnkgZmlsdGVyaW5nLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVsZW1lbnQgPSAkKFwiPHNvdXJjZT5cIikuYXR0cihcInNyY1wiLCBhc3NldC5NYWluRmlsZVVybCkuYXR0cihcInR5cGVcIiwgYXNzZXQuTWltZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwbHlNZWRpYVF1ZXJpZXMgJiYgYXNzZXQuTWVkaWFRdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VFbGVtZW50LmF0dHIoXCJtZWRpYVwiLCBhc3NldC5NZWRpYVF1ZXJ5KTtcclxuICAgICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnRzLnB1c2goc291cmNlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgXyh0aGlzLmZpbHRlcmVkQXNzZXRzKCkuU3VidGl0bGVBc3NldHMpLmZvckVhY2goYXNzZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVsZW1lbnQgPSAkKFwiPHRyYWNrIGtpbmQ9XFxcImNhcHRpb25zXFxcIj5cIikuYXR0cihcImxhYmVsXCIsIGFzc2V0Lk5hbWUpLmF0dHIoXCJzcmNcIiwgYXNzZXQuTWFpbkZpbGVVcmwpLmF0dHIoXCJzcmNsYW5nXCIsIGFzc2V0Lkxhbmd1YWdlKTtcclxuICAgICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnRzLnB1c2goc291cmNlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFfKHNvdXJjZUVsZW1lbnRzKS5hbnkoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIk5vIHNvdXJjZXMgYXZhaWxhYmxlOyBjbGVhbmluZyB1cCBjb250YWluZXIgYW5kIGZhdWx0aW5nIHRoaXMgaW5qZWN0b3IuXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkKHNvdXJjZUVsZW1lbnRzKS5lYWNoKChpbmRleCwgZWxlbSkgPT4geyAkKGVsZW0pLmFwcGVuZFRvKHZpZGVvRWxlbWVudCk7IH0pO1xyXG4gICAgICAgICAgICB2aWRlb0VsZW1lbnQuYXBwZW5kVG8odGhpcy5jb250YWluZXIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGxhc3RTb3VyY2UgPSA8SFRNTFNvdXJjZUVsZW1lbnQ+Xyhzb3VyY2VFbGVtZW50cykubGFzdCgpWzBdO1xyXG5cclxuICAgICAgICAgICAgdmFyIGVycm9ySGFuZGxlciA9IChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWcoXCJFcnJvciBkZXRlY3RlZDsgY2xlYW5pbmcgdXAgY29udGFpbmVyIGFuZCBmYXVsdGluZyB0aGlzIGluamVjdG9yLlwiKTtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE86IEJlIGEgbGl0dGxlIG1vcmUgc2VsZWN0aXZlIGhlcmUsIGRvbid0IGZhaWwgb24gYW55IGVycm9yLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5mYXVsdCgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbGFzdFNvdXJjZS5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgZXJyb3JIYW5kbGVyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHZpZGVvRWxlbWVudC5vbihcImVycm9yXCIsIGVycm9ySGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xyXG4gICAgICAgICAgICBzdXBlci5kZWJ1ZyhcIkh0bWw1SW5qZWN0b3I6IFwiICsgbWVzc2FnZSwgYXJncyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59ICJdfQ==
