/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/underscore.d.ts" />
/// <reference path="Typings/URIjs.d.ts" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var VideoPlayer;
            (function (VideoPlayer) {
                var Injectors;
                (function (Injectors) {
                    var Html5Injector = (function (_super) {
                        __extends(Html5Injector, _super);
                        function Html5Injector() {
                            _super.apply(this, arguments);
                        }
                        Html5Injector.prototype.isSupported = function () {
                            var videoElement = document.createElement("video");
                            var result = videoElement && !!videoElement.canPlayType;
                            this.debug("Browser supports HTML5 video: {0}", result);
                            this.debug("isSupported() returns {0}.", result);
                            return result;
                        };
                        Html5Injector.prototype.inject = function () {
                            var _this = this;
                            var firstThumbnailAsset = _(this.filteredAssets().ThumbnailAssets).first();
                            this.debug("Injecting player into element '{0}'.", this.container.id);
                            var videoElement = $("<video controls>").attr("width", this.playerWidth).attr("height", this.playerHeight);
                            if (firstThumbnailAsset)
                                videoElement.attr("poster", firstThumbnailAsset.MainFileUrl);
                            if (this.autoPlay)
                                videoElement.attr("autoplay", "");
                            var sourceElements = [];
                            // Adaptive streaming URLs from dynamic assets.
                            _(this.assetData.DynamicVideoAssets).forEach(function (asset) {
                                var smoothStreamingSourceElement = $("<source>").attr("src", asset.SmoothStreamingUrl).attr("type", "application/vnd.ms-sstr+xml");
                                var hlsSourceElement = $("<source>").attr("src", asset.HlsUrl).attr("type", "application/x-mpegURL");
                                var mpegDashSourceElement = $("<source>").attr("src", asset.MpegDashUrl).attr("type", "application/dash+xml");
                                if (_this.applyMediaQueries && asset.MediaQuery)
                                    $([smoothStreamingSourceElement, hlsSourceElement, mpegDashSourceElement]).attr("media", asset.MediaQuery);
                                sourceElements.push(smoothStreamingSourceElement, hlsSourceElement, mpegDashSourceElement);
                            });
                            // "Raw" asset video file URLs from dynamic assets (in decending bitrate order).
                            _(this.assetData.DynamicVideoAssets).forEach(function (asset) {
                                _((asset.EncoderMetadata && asset.EncoderMetadata.AssetFiles) || [])
                                    .filter(function (assetFile) { return _(assetFile.VideoTracks).any(); })
                                    .sort(function (assetFile) { return assetFile.Bitrate; }).reverse()
                                    .forEach(function (assetFile) {
                                    var url = new URI(asset.MainFileUrl).filename(assetFile.Name);
                                    var sourceElement = $("<source>").attr("src", url.toString()).attr("type", assetFile.MimeType);
                                    if (_this.applyMediaQueries && asset.MediaQuery)
                                        sourceElement.attr("media", asset.MediaQuery);
                                    sourceElements.push(sourceElement);
                                });
                            });
                            // Asset file URLs from non-dynamic assets.
                            _(this.assetData.VideoAssets).forEach(function (asset) {
                                var sourceElement = $("<source>").attr("src", asset.MainFileUrl).attr("type", asset.MimeType);
                                if (_this.applyMediaQueries && asset.MediaQuery)
                                    sourceElement.attr("media", asset.MediaQuery);
                                sourceElements.push(sourceElement);
                            });
                            _(this.filteredAssets().SubtitleAssets).forEach(function (asset) {
                                var sourceElement = $("<track kind=\"captions\">").attr("label", asset.Name).attr("src", asset.MainFileUrl).attr("srclang", asset.Language);
                                sourceElements.push(sourceElement);
                            });
                            if (!_(sourceElements).any()) {
                                this.debug("No sources available; cleaning up container and faulting this injector.");
                                this.fault();
                                return;
                            }
                            $(sourceElements).each(function (index, elem) { $(elem).appendTo(videoElement); });
                            videoElement.appendTo(this.container);
                            var lastSource = _(sourceElements).last()[0];
                            var errorHandler = function (e) {
                                _this.debug("Error detected; cleaning up container and faulting this injector.");
                                // TODO: Be a little more selective here, don't fail on any error.
                                _this.fault();
                            };
                            lastSource.addEventListener("error", errorHandler, false);
                            videoElement.on("error", errorHandler);
                        };
                        Html5Injector.prototype.debug = function (message) {
                            var args = [];
                            for (var _i = 1; _i < arguments.length; _i++) {
                                args[_i - 1] = arguments[_i];
                            }
                            _super.prototype.debug.call(this, "Html5Injector: " + message, args);
                        };
                        return Html5Injector;
                    })(Injectors.Injector);
                    Injectors.Html5Injector = Html5Injector;
                })(Injectors = VideoPlayer.Injectors || (VideoPlayer.Injectors = {}));
            })(VideoPlayer = MediaServices.VideoPlayer || (MediaServices.VideoPlayer = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtdmlkZW9wbGF5ZXItaW5qZWN0b3JzLWh0bWw1LmpzIiwiY2xvdWRtZWRpYS12aWRlb3BsYXllci1pbmplY3RvcnMtaHRtbDUudHMiXSwibmFtZXMiOlsiT3JjaGFyZCIsIk9yY2hhcmQuQXp1cmUiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIuSW5qZWN0b3JzIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5IdG1sNUluamVjdG9yIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5IdG1sNUluamVjdG9yLmNvbnN0cnVjdG9yIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5IdG1sNUluamVjdG9yLmlzU3VwcG9ydGVkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5IdG1sNUluamVjdG9yLmluamVjdCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMuSHRtbDVJbmplY3Rvci5kZWJ1ZyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEFDTEEsNENBQTRDO0FBQzVDLGdEQUFnRDtBQUNoRCwyQ0FBMkM7Ozs7OztBQUUzQyxJQUFPLE9BQU8sQ0EwRmI7QUExRkQsV0FBTyxPQUFPO0lBQUNBLElBQUFBLEtBQUtBLENBMEZuQkE7SUExRmNBLFdBQUFBLEtBQUtBO1FBQUNDLElBQUFBLGFBQWFBLENBMEZqQ0E7UUExRm9CQSxXQUFBQSxhQUFhQTtZQUFDQyxJQUFBQSxXQUFXQSxDQTBGN0NBO1lBMUZrQ0EsV0FBQUEsV0FBV0E7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O2dDQUNoRkEsa0VBQWtFQTtnQ0FDbEVBLEtBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBOzRCQUNqQkEsQ0FBQ0EsQ0FBQ0E7NEJBRUZBLFVBQVVBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsT0FBT0EsRUFBRUEsWUFBWUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7NEJBQzFEQSxZQUFZQSxDQUFDQSxFQUFFQSxDQUFDQSxPQUFPQSxFQUFFQSxZQUFZQSxDQUFDQSxDQUFDQTt3QkFDM0NBLENBQUNBO3dCQUVNSCw2QkFBS0EsR0FBWkEsVUFBYUEsT0FBZUE7NEJBQUVJLGNBQWNBO2lDQUFkQSxXQUFjQSxDQUFkQSxzQkFBY0EsQ0FBZEEsSUFBY0E7Z0NBQWRBLDZCQUFjQTs7NEJBQ3hDQSxnQkFBS0EsQ0FBQ0EsS0FBS0EsWUFBQ0EsaUJBQWlCQSxHQUFHQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTt3QkFDbkRBLENBQUNBO3dCQUNMSixvQkFBQ0E7b0JBQURBLENBckZBRCxBQXFGQ0MsRUFyRmtDRCxrQkFBUUEsRUFxRjFDQTtvQkFyRllBLHVCQUFhQSxnQkFxRnpCQSxDQUFBQTtnQkFDTEEsQ0FBQ0EsRUExRjhDRCxTQUFTQSxHQUFUQSxxQkFBU0EsS0FBVEEscUJBQVNBLFFBMEZ2REE7WUFBREEsQ0FBQ0EsRUExRmtDRCxXQUFXQSxHQUFYQSx5QkFBV0EsS0FBWEEseUJBQVdBLFFBMEY3Q0E7UUFBREEsQ0FBQ0EsRUExRm9CRCxhQUFhQSxHQUFiQSxtQkFBYUEsS0FBYkEsbUJBQWFBLFFBMEZqQ0E7SUFBREEsQ0FBQ0EsRUExRmNELEtBQUtBLEdBQUxBLGFBQUtBLEtBQUxBLGFBQUtBLFFBMEZuQkE7QUFBREEsQ0FBQ0EsRUExRk0sT0FBTyxLQUFQLE9BQU8sUUEwRmIiLCJmaWxlIjoiY2xvdWRtZWRpYS12aWRlb3BsYXllci1pbmplY3RvcnMtaHRtbDUuanMiLCJzb3VyY2VzQ29udGVudCI6W251bGwsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvdW5kZXJzY29yZS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvVVJJanMuZC50c1wiIC8+XHJcblxyXG5tb2R1bGUgT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycyB7XHJcblxyXG4gICAgaW1wb3J0IERhdGEgPSBPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIuRGF0YTtcclxuXHJcbiAgICBleHBvcnQgY2xhc3MgSHRtbDVJbmplY3RvciBleHRlbmRzIEluamVjdG9yIHtcclxuXHJcbiAgICAgICAgcHVibGljIGlzU3VwcG9ydGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICB2YXIgdmlkZW9FbGVtZW50OiBIVE1MVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdmlkZW9FbGVtZW50ICYmICEhdmlkZW9FbGVtZW50LmNhblBsYXlUeXBlO1xyXG4gICAgICAgICAgICB0aGlzLmRlYnVnKFwiQnJvd3NlciBzdXBwb3J0cyBIVE1MNSB2aWRlbzogezB9XCIsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGVidWcoXCJpc1N1cHBvcnRlZCgpIHJldHVybnMgezB9LlwiLCByZXN1bHQpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbmplY3QoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHZhciBmaXJzdFRodW1ibmFpbEFzc2V0ID0gXyh0aGlzLmZpbHRlcmVkQXNzZXRzKCkuVGh1bWJuYWlsQXNzZXRzKS5maXJzdCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIkluamVjdGluZyBwbGF5ZXIgaW50byBlbGVtZW50ICd7MH0nLlwiLCB0aGlzLmNvbnRhaW5lci5pZCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmlkZW9FbGVtZW50ID0gJChcIjx2aWRlbyBjb250cm9scz5cIikuYXR0cihcIndpZHRoXCIsIHRoaXMucGxheWVyV2lkdGgpLmF0dHIoXCJoZWlnaHRcIiwgdGhpcy5wbGF5ZXJIZWlnaHQpO1xyXG4gICAgICAgICAgICBpZiAoZmlyc3RUaHVtYm5haWxBc3NldClcclxuICAgICAgICAgICAgICAgIHZpZGVvRWxlbWVudC5hdHRyKFwicG9zdGVyXCIsIGZpcnN0VGh1bWJuYWlsQXNzZXQuTWFpbkZpbGVVcmwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hdXRvUGxheSlcclxuICAgICAgICAgICAgICAgIHZpZGVvRWxlbWVudC5hdHRyKFwiYXV0b3BsYXlcIiwgXCJcIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgc291cmNlRWxlbWVudHM6IEpRdWVyeVtdID0gW107XHJcblxyXG4gICAgICAgICAgICAvLyBBZGFwdGl2ZSBzdHJlYW1pbmcgVVJMcyBmcm9tIGR5bmFtaWMgYXNzZXRzLlxyXG4gICAgICAgICAgICBfKHRoaXMuYXNzZXREYXRhLkR5bmFtaWNWaWRlb0Fzc2V0cykuZm9yRWFjaChhc3NldCA9PiB7IC8vIFJlYWQgZnJvbSBhc3NldERhdGEgYmVjYXVzZSBicm93c2VyIHdpbGwgZG8gbWVkaWEgcXVlcnkgZmlsdGVyaW5nLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNtb290aFN0cmVhbWluZ1NvdXJjZUVsZW1lbnQgPSAkKFwiPHNvdXJjZT5cIikuYXR0cihcInNyY1wiLCBhc3NldC5TbW9vdGhTdHJlYW1pbmdVcmwpLmF0dHIoXCJ0eXBlXCIsIFwiYXBwbGljYXRpb24vdm5kLm1zLXNzdHIreG1sXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhsc1NvdXJjZUVsZW1lbnQgPSAkKFwiPHNvdXJjZT5cIikuYXR0cihcInNyY1wiLCBhc3NldC5IbHNVcmwpLmF0dHIoXCJ0eXBlXCIsIFwiYXBwbGljYXRpb24veC1tcGVnVVJMXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1wZWdEYXNoU291cmNlRWxlbWVudCA9ICQoXCI8c291cmNlPlwiKS5hdHRyKFwic3JjXCIsIGFzc2V0Lk1wZWdEYXNoVXJsKS5hdHRyKFwidHlwZVwiLCBcImFwcGxpY2F0aW9uL2Rhc2greG1sXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwbHlNZWRpYVF1ZXJpZXMgJiYgYXNzZXQuTWVkaWFRdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICAkKFtzbW9vdGhTdHJlYW1pbmdTb3VyY2VFbGVtZW50LCBobHNTb3VyY2VFbGVtZW50LCBtcGVnRGFzaFNvdXJjZUVsZW1lbnRdKS5hdHRyKFwibWVkaWFcIiwgYXNzZXQuTWVkaWFRdWVyeSk7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VFbGVtZW50cy5wdXNoKHNtb290aFN0cmVhbWluZ1NvdXJjZUVsZW1lbnQsIGhsc1NvdXJjZUVsZW1lbnQsIG1wZWdEYXNoU291cmNlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gXCJSYXdcIiBhc3NldCB2aWRlbyBmaWxlIFVSTHMgZnJvbSBkeW5hbWljIGFzc2V0cyAoaW4gZGVjZW5kaW5nIGJpdHJhdGUgb3JkZXIpLlxyXG4gICAgICAgICAgICBfKHRoaXMuYXNzZXREYXRhLkR5bmFtaWNWaWRlb0Fzc2V0cykuZm9yRWFjaChhc3NldCA9PiB7IC8vIFJlYWQgZnJvbSBhc3NldERhdGEgYmVjYXVzZSBicm93c2VyIHdpbGwgZG8gbWVkaWEgcXVlcnkgZmlsdGVyaW5nLlxyXG4gICAgICAgICAgICAgICAgXygoYXNzZXQuRW5jb2Rlck1ldGFkYXRhICYmIGFzc2V0LkVuY29kZXJNZXRhZGF0YS5Bc3NldEZpbGVzKSB8fCBbXSlcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGFzc2V0RmlsZSA9PiBfKGFzc2V0RmlsZS5WaWRlb1RyYWNrcykuYW55KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoYXNzZXRGaWxlID0+IGFzc2V0RmlsZS5CaXRyYXRlKS5yZXZlcnNlKClcclxuICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChhc3NldEZpbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSSShhc3NldC5NYWluRmlsZVVybCkuZmlsZW5hbWUoYXNzZXRGaWxlLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlRWxlbWVudCA9ICQoXCI8c291cmNlPlwiKS5hdHRyKFwic3JjXCIsIHVybC50b1N0cmluZygpKS5hdHRyKFwidHlwZVwiLCBhc3NldEZpbGUuTWltZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHBseU1lZGlhUXVlcmllcyAmJiBhc3NldC5NZWRpYVF1ZXJ5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlRWxlbWVudC5hdHRyKFwibWVkaWFcIiwgYXNzZXQuTWVkaWFRdWVyeSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnRzLnB1c2goc291cmNlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQXNzZXQgZmlsZSBVUkxzIGZyb20gbm9uLWR5bmFtaWMgYXNzZXRzLlxyXG4gICAgICAgICAgICBfKHRoaXMuYXNzZXREYXRhLlZpZGVvQXNzZXRzKS5mb3JFYWNoKGFzc2V0ID0+IHsgLy8gUmVhZCBmcm9tIGFzc2V0RGF0YSBiZWNhdXNlIGJyb3dzZXIgd2lsbCBkbyBtZWRpYSBxdWVyeSBmaWx0ZXJpbmcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRWxlbWVudCA9ICQoXCI8c291cmNlPlwiKS5hdHRyKFwic3JjXCIsIGFzc2V0Lk1haW5GaWxlVXJsKS5hdHRyKFwidHlwZVwiLCBhc3NldC5NaW1lVHlwZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHBseU1lZGlhUXVlcmllcyAmJiBhc3NldC5NZWRpYVF1ZXJ5KVxyXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUVsZW1lbnQuYXR0cihcIm1lZGlhXCIsIGFzc2V0Lk1lZGlhUXVlcnkpO1xyXG4gICAgICAgICAgICAgICAgc291cmNlRWxlbWVudHMucHVzaChzb3VyY2VFbGVtZW50KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBfKHRoaXMuZmlsdGVyZWRBc3NldHMoKS5TdWJ0aXRsZUFzc2V0cykuZm9yRWFjaChhc3NldCA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRWxlbWVudCA9ICQoXCI8dHJhY2sga2luZD1cXFwiY2FwdGlvbnNcXFwiPlwiKS5hdHRyKFwibGFiZWxcIiwgYXNzZXQuTmFtZSkuYXR0cihcInNyY1wiLCBhc3NldC5NYWluRmlsZVVybCkuYXR0cihcInNyY2xhbmdcIiwgYXNzZXQuTGFuZ3VhZ2UpO1xyXG4gICAgICAgICAgICAgICAgc291cmNlRWxlbWVudHMucHVzaChzb3VyY2VFbGVtZW50KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIV8oc291cmNlRWxlbWVudHMpLmFueSgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnKFwiTm8gc291cmNlcyBhdmFpbGFibGU7IGNsZWFuaW5nIHVwIGNvbnRhaW5lciBhbmQgZmF1bHRpbmcgdGhpcyBpbmplY3Rvci5cIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICQoc291cmNlRWxlbWVudHMpLmVhY2goKGluZGV4LCBlbGVtKSA9PiB7ICQoZWxlbSkuYXBwZW5kVG8odmlkZW9FbGVtZW50KTsgfSk7XHJcbiAgICAgICAgICAgIHZpZGVvRWxlbWVudC5hcHBlbmRUbyh0aGlzLmNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgICAgICB2YXIgbGFzdFNvdXJjZSA9IDxIVE1MU291cmNlRWxlbWVudD5fKHNvdXJjZUVsZW1lbnRzKS5sYXN0KClbMF07XHJcblxyXG4gICAgICAgICAgICB2YXIgZXJyb3JIYW5kbGVyID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIkVycm9yIGRldGVjdGVkOyBjbGVhbmluZyB1cCBjb250YWluZXIgYW5kIGZhdWx0aW5nIHRoaXMgaW5qZWN0b3IuXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogQmUgYSBsaXR0bGUgbW9yZSBzZWxlY3RpdmUgaGVyZSwgZG9uJ3QgZmFpbCBvbiBhbnkgZXJyb3IuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZhdWx0KCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBsYXN0U291cmNlLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCBlcnJvckhhbmRsZXIsIGZhbHNlKTtcclxuICAgICAgICAgICAgdmlkZW9FbGVtZW50Lm9uKFwiZXJyb3JcIiwgZXJyb3JIYW5kbGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHN1cGVyLmRlYnVnKFwiSHRtbDVJbmplY3RvcjogXCIgKyBtZXNzYWdlLCBhcmdzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0gIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
