/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/jqueryui.d.ts" />
/// <reference path="Typings/moment.d.ts" />
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var CloudVideoEdit;
            (function (CloudVideoEdit) {
                var requiredUploads;
                function uploadCompleted(sender, e, data) {
                    var scope = $(sender).closest(".async-upload");
                    var status = data.errorThrown && data.errorThrown.length > 0 ? data.errorThrown : data.textStatus;
                    scope.find(".progress-bar").hide();
                    scope.find(".progress-text").hide();
                    scope.find(".progress-details").hide();
                    scope.find(".status.preparing").hide();
                    scope.find(".status.uploading").hide();
                    switch (status) {
                        case "error":
                            cleanup(scope, data);
                            alert("The upload of the selected file failed. You may try again after the cleanup has finished.");
                            return;
                        case "abort":
                            cleanup(scope, data);
                            return;
                    }
                    var editedFileName = scope.find("input[name$='.FileName']").val();
                    var statusUploaded = scope.find(".status.uploaded").show();
                    statusUploaded.text(statusUploaded.data("text-template").replace("{filename}", editedFileName));
                    scope.data("upload-isactive", false);
                    scope.data("upload-iscompleted", true);
                    scope.data("upload-start-time", null);
                }
                function cleanup(scope, data) {
                    var wamsAssetInput = scope.find("input[name$='.WamsAssetId']");
                    var fileNameInput = scope.find("input[name$='.FileName']");
                    var assetId = $.trim(wamsAssetInput.val());
                    var fileUploadWrapper = data.fileInput.closest(".file-upload-wrapper");
                    if (assetId.length > 0) {
                        var url = scope.data("delete-asset-url");
                        var antiForgeryToken = scope.closest("form").find("[name='__RequestVerificationToken']").val();
                        var cleanupMessage = scope.find(".status.cleanup");
                        wamsAssetInput.val("");
                        fileNameInput.val("");
                        cleanupMessage.show();
                        $.ajax({
                            url: url,
                            type: "DELETE",
                            data: {
                                id: assetId,
                                __RequestVerificationToken: antiForgeryToken
                            }
                        }).done(function () {
                            scope.data("upload-isactive", false);
                            scope.data("upload-start-time", null);
                            scope.find(".file-upload-wrapper").show();
                            cleanupMessage.hide();
                        }).fail(function () {
                            alert("An error occurred on the server while trying to clean up.");
                        });
                    }
                    fileUploadWrapper.show();
                }
                function pad(value, length) {
                    var str = value.toString();
                    while (str.length < length) {
                        str = "0" + str;
                    }
                    return str;
                }
                function createBlockId(blockIndex) {
                    var blockIdPrefix = "block-";
                    return btoa(blockIdPrefix + pad(blockIndex, 6));
                }
                function commitBlockList(scope, data) {
                    var deferred = $.Deferred();
                    var blockIds = scope.data("block-ids");
                    if (blockIds.length == 0) {
                        // The file was uploaded as a whole, so no manifest to submit.
                        deferred.resolve();
                    }
                    else {
                        // The file was uploaded in chunks.
                        var url = scope.data("sas-locator") + "&comp=blocklist";
                        var requestData = '<?xml version="1.0" encoding="utf-8"?><BlockList>';
                        for (var i = 0; i < blockIds.length; i++) {
                            requestData += '<Latest>' + blockIds[i] + '</Latest>';
                        }
                        requestData += '</BlockList>';
                        $.ajax({
                            url: url,
                            type: "PUT",
                            data: requestData,
                            contentType: "text/plain; charset=UTF-8",
                            crossDomain: true,
                            cache: false,
                            beforeSend: function (xhr) {
                                xhr.setRequestHeader('x-ms-date', new Date().toUTCString());
                                xhr.setRequestHeader('x-ms-blob-content-type', data.files[0].type);
                                xhr.setRequestHeader('x-ms-version', "2012-02-12");
                                xhr.setRequestHeader('Content-Length', requestData.length.toString());
                            },
                            success: function () {
                                deferred.resolve(data);
                            },
                            error: function (xhr, status, error) {
                                data.textStatus = status;
                                data.errorThrown = error;
                                deferred.fail(data);
                            }
                        });
                    }
                    return deferred.promise();
                }
                function hasActiveUploads() {
                    var scope = $(".upload-direct");
                    var flag = false;
                    scope.find(".async-upload").each(function () {
                        if ($(this).data("upload-isactive") == true) {
                            flag = true;
                            return false;
                        }
                    });
                    return flag;
                }
                function hasCompletedUploads() {
                    var scope = $(".upload-direct");
                    var flag = false;
                    scope.find(".async-upload").each(function () {
                        if ($(this).data("upload-iscompleted") == true) {
                            flag = true;
                            return false;
                        }
                    });
                    return flag;
                }
                function isSubmitting() {
                    var scope = $(".upload-direct");
                    return scope.data("is-submitting") == true;
                }
                ;
                function initializeUpload(fileInput) {
                    var scope = fileInput.closest(".async-upload");
                    var fileUploadWrapper = scope.find(".file-upload-wrapper");
                    var acceptFileTypesRegex = new RegExp(scope.data("upload-accept-file-types"));
                    var antiForgeryToken = scope.closest("form").find("[name='__RequestVerificationToken']").val();
                    var selectedFileWrapper = scope.find(".selected-file-wrapper");
                    var filenameInput = scope.find(".filename-input");
                    var resetButton = scope.find(".reset-button");
                    var uploadButton = scope.find(".upload-button");
                    var filenameText = scope.find(".filename-text");
                    var validationText = scope.find(".validation-text");
                    var preparingText = scope.find(".status.preparing");
                    var uploadingContainer = scope.find(".status.uploading");
                    var progressBar = scope.find(".progress-bar");
                    var progressText = scope.find(".progress-text");
                    var progressDetails = scope.find(".progress-details");
                    var cancelLink = scope.find(".cancel-link");
                    fileInput.fileupload({
                        autoUpload: false,
                        acceptFileTypes: acceptFileTypesRegex,
                        type: "PUT",
                        maxChunkSize: 4 * 1024 * 1024,
                        beforeSend: function (xhr, data) {
                            xhr.setRequestHeader("x-ms-date", new Date().toUTCString());
                            xhr.setRequestHeader("x-ms-blob-type", "BlockBlob");
                            xhr.setRequestHeader("content-length", data.data.size.toString());
                        },
                        chunksend: function (e, data) {
                            var blockIndex = scope.data("block-index");
                            var blockIds = scope.data("block-ids");
                            var blockId = createBlockId(blockIndex);
                            var url = scope.data("sas-locator") + "&comp=block&blockid=" + blockId;
                            data.url = url;
                            blockIds.push(blockId);
                            scope.data("block-index", blockIndex + 1);
                        },
                        progressall: function (e, data) {
                            var percentComplete = Math.floor((data.loaded / data.total) * 100);
                            var startTime = new Date(scope.data("upload-start-time"));
                            var elapsedMilliseconds = new Date(Date.now()).getTime() - startTime.getTime();
                            var elapsed = moment.duration(elapsedMilliseconds, "ms");
                            var remaining = moment.duration(elapsedMilliseconds / Math.max(data.loaded, 1) * (data.total - data.loaded), "ms");
                            var kbps = Math.floor(data.bitrate / 8 / 1000);
                            var uploaded = Math.floor(data.loaded / 1000);
                            var total = Math.floor(data.total / 1000);
                            progressBar.show().find(".progress").css("width", percentComplete + "%");
                            progressText.text(progressText.data("text-template").replace("{percentage}", percentComplete)).show();
                            progressDetails.text(progressDetails.data("text-template").replace("{uploaded}", uploaded).replace("{total}", total).replace("{kbps}", kbps).replace("{elapsed}", elapsed.humanize()).replace("{remaining}", remaining.humanize())).show();
                        },
                        done: function (e, data) {
                            var self = this;
                            commitBlockList(scope, data).always(function () {
                                uploadCompleted(self, e, data);
                            });
                        },
                        fail: function (e, data) {
                            uploadCompleted(this, e, data);
                        },
                        processdone: function (e, data) {
                            var selectedFilename = data.files[0].name;
                            scope.data("selected-filename", selectedFilename);
                            window.setTimeout(function () {
                                fileUploadWrapper.hide();
                                validationText.hide();
                                selectedFileWrapper.show();
                                filenameText.text(filenameText.data("text-template").replace("{filename}", selectedFilename));
                            }, 10);
                            scope[0].doReset = function () {
                                fileUploadWrapper.show();
                                filenameInput.val("");
                                filenameText.text("");
                                selectedFileWrapper.hide();
                                validationText.hide();
                            };
                            scope[0].doUpload = function () {
                                var editedFilename = filenameInput.val() || selectedFilename;
                                if (!acceptFileTypesRegex.test(editedFilename)) {
                                    validationText.show();
                                    return;
                                }
                                scope.data("upload-isactive", true);
                                scope.data("upload-start-time", Date.now());
                                var generateAssetUrl = scope.data("generate-asset-url");
                                scope.data("block-index", 0);
                                scope.data("block-ids", new Array());
                                preparingText.show();
                                selectedFileWrapper.hide();
                                validationText.hide();
                                $.ajax({
                                    url: generateAssetUrl,
                                    data: {
                                        filename: editedFilename,
                                        __RequestVerificationToken: antiForgeryToken
                                    },
                                    type: "POST"
                                }).done(function (asset) {
                                    data.url = asset.sasLocator;
                                    data.multipart = false;
                                    scope.data("sas-locator", asset.sasLocator);
                                    scope.find("input[name$='.FileName']").val(editedFilename);
                                    scope.find("input[name$='.WamsAssetId']").val(asset.assetId);
                                    preparingText.hide();
                                    progressText.text(progressText.data("text-template").replace("{percentage}", 0)).show();
                                    uploadingContainer.show();
                                    var xhr = data.submit();
                                    scope.data("xhr", xhr);
                                }).fail(function (xhr, status, error) {
                                    fileUploadWrapper.show();
                                    selectedFileWrapper.show();
                                    preparingText.hide();
                                    uploadingContainer.hide();
                                    scope.data("upload-isactive", false);
                                    scope.data("upload-start-time", null);
                                    alert("An error occurred. Error: " + error);
                                });
                            };
                        },
                        processfail: function (e, data) {
                            validationText.show();
                            filenameInput.val("");
                            filenameText.text("");
                            selectedFileWrapper.hide();
                        },
                        change: function (e, data) {
                            var prompt = fileInput.data("prompt");
                            if (prompt && prompt.length > 0) {
                                if (!confirm(prompt)) {
                                    e.preventDefault();
                                }
                            }
                        }
                    });
                    cancelLink.on("click", function (e) {
                        e.preventDefault();
                        if (confirm($(this).data("cancel-prompt"))) {
                            var xhr = scope.data("xhr");
                            xhr.abort();
                        }
                    });
                }
                function initializeUploadDirect() {
                    var scope = $(".upload-direct").show();
                    scope.find(".reset-button").on("click", function (e) {
                        var doReset = $(this).closest(".async-upload")[0].doReset;
                        if (!!doReset)
                            doReset();
                    });
                    scope.find(".upload-button").on("click", function (e) {
                        var doUpload = $(this).closest(".async-upload")[0].doUpload;
                        if (!!doUpload)
                            doUpload();
                    });
                    requiredUploads = scope.find(".required-upload");
                    scope.find(".async-upload-file-input").each(function () {
                        initializeUpload($(this));
                    });
                    scope.closest("form").on("submit", function (e) {
                        if (hasActiveUploads()) {
                            alert(scope.data("block-submit-prompt"));
                            e.preventDefault();
                            return false;
                        }
                        scope.data("is-submitting", true);
                    });
                    $(window).on("beforeunload", function (e) {
                        if ((hasActiveUploads() || hasCompletedUploads()) && !isSubmitting()) {
                            var message = scope.data("navigate-away-prompt");
                            e.result = message;
                            return message;
                        }
                    });
                }
                CloudVideoEdit.initializeUploadDirect = initializeUploadDirect;
            })(CloudVideoEdit = MediaServices.CloudVideoEdit || (MediaServices.CloudVideoEdit = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1kaXJlY3QuanMiLCJjbG91ZG1lZGlhLWVkaXQtY2xvdWR2aWRlb3BhcnQtZGlyZWN0LnRzIl0sIm5hbWVzIjpbIk9yY2hhcmQiLCJPcmNoYXJkLkF6dXJlIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0IiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LnVwbG9hZENvbXBsZXRlZCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5jbGVhbnVwIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LnBhZCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5jcmVhdGVCbG9ja0lkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmNvbW1pdEJsb2NrTGlzdCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5oYXNBY3RpdmVVcGxvYWRzIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0Lmhhc0NvbXBsZXRlZFVwbG9hZHMiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQuaXNTdWJtaXR0aW5nIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmluaXRpYWxpemVVcGxvYWQiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQuaW5pdGlhbGl6ZVVwbG9hZERpcmVjdCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEFDTEEsNENBQTRDO0FBQzVDLDhDQUE4QztBQUM5Qyw0Q0FBNEM7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c0JBQXNCLENBQUMsQ0FBQzs0QkFDakQsQ0FBQyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUM7NEJBQ25CLE1BQU0sQ0FBQyxPQUFPLENBQUM7d0JBQ25CLENBQUM7b0JBQ0wsQ0FBQyxDQUFDQSxDQUFDQTtnQkFDUEEsQ0FBQ0E7Z0JBdkNlVixxQ0FBc0JBLHlCQXVDckNBLENBQUFBO1lBQ0xBLENBQUNBLEVBaldrQ0QsY0FBY0EsR0FBZEEsNEJBQWNBLEtBQWRBLDRCQUFjQSxRQWlXaERBO1FBQURBLENBQUNBLEVBaldvQkQsYUFBYUEsR0FBYkEsbUJBQWFBLEtBQWJBLG1CQUFhQSxRQWlXakNBO0lBQURBLENBQUNBLEVBaldjRCxLQUFLQSxHQUFMQSxhQUFLQSxLQUFMQSxhQUFLQSxRQWlXbkJBO0FBQURBLENBQUNBLEVBaldNLE9BQU8sS0FBUCxPQUFPLFFBaVdiIiwiZmlsZSI6ImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1kaXJlY3QuanMiLCJzb3VyY2VzQ29udGVudCI6W251bGwsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvanF1ZXJ5dWkuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL21vbWVudC5kLnRzXCIgLz5cclxuXHJcbm1vZHVsZSBPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQge1xyXG4gICAgdmFyIHJlcXVpcmVkVXBsb2FkczogSlF1ZXJ5O1xyXG5cclxuICAgIGZ1bmN0aW9uIHVwbG9hZENvbXBsZXRlZChzZW5kZXI6IGFueSwgZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICB2YXIgc2NvcGUgPSAkKHNlbmRlcikuY2xvc2VzdChcIi5hc3luYy11cGxvYWRcIik7XHJcbiAgICAgICAgdmFyIHN0YXR1cyA9IGRhdGEuZXJyb3JUaHJvd24gJiYgZGF0YS5lcnJvclRocm93bi5sZW5ndGggPiAwID8gZGF0YS5lcnJvclRocm93biA6IGRhdGEudGV4dFN0YXR1cztcclxuICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLWJhclwiKS5oaWRlKCk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5wcm9ncmVzcy10ZXh0XCIpLmhpZGUoKTtcclxuICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLWRldGFpbHNcIikuaGlkZSgpO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIuc3RhdHVzLnByZXBhcmluZ1wiKS5oaWRlKCk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5zdGF0dXMudXBsb2FkaW5nXCIpLmhpZGUoKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgY2FzZSBcImVycm9yXCI6XHJcbiAgICAgICAgICAgICAgICBjbGVhbnVwKHNjb3BlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhlIHVwbG9hZCBvZiB0aGUgc2VsZWN0ZWQgZmlsZSBmYWlsZWQuIFlvdSBtYXkgdHJ5IGFnYWluIGFmdGVyIHRoZSBjbGVhbnVwIGhhcyBmaW5pc2hlZC5cIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgXCJhYm9ydFwiOlxyXG4gICAgICAgICAgICAgICAgY2xlYW51cChzY29wZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZWRpdGVkRmlsZU5hbWUgPSBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5GaWxlTmFtZSddXCIpLnZhbCgpO1xyXG4gICAgICAgIHZhciBzdGF0dXNVcGxvYWRlZCA9IHNjb3BlLmZpbmQoXCIuc3RhdHVzLnVwbG9hZGVkXCIpLnNob3coKTtcclxuXHJcbiAgICAgICAgc3RhdHVzVXBsb2FkZWQudGV4dChzdGF0dXNVcGxvYWRlZC5kYXRhKFwidGV4dC10ZW1wbGF0ZVwiKS5yZXBsYWNlKFwie2ZpbGVuYW1lfVwiLCBlZGl0ZWRGaWxlTmFtZSkpO1xyXG4gICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtaXNhY3RpdmVcIiwgZmFsc2UpO1xyXG4gICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtaXNjb21wbGV0ZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1zdGFydC10aW1lXCIsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNsZWFudXAoc2NvcGU6IEpRdWVyeSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgdmFyIHdhbXNBc3NldElucHV0ID0gc2NvcGUuZmluZChcImlucHV0W25hbWUkPScuV2Ftc0Fzc2V0SWQnXVwiKTtcclxuICAgICAgICB2YXIgZmlsZU5hbWVJbnB1dCA9IHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLkZpbGVOYW1lJ11cIik7XHJcbiAgICAgICAgdmFyIGFzc2V0SWQgPSAkLnRyaW0od2Ftc0Fzc2V0SW5wdXQudmFsKCkpO1xyXG4gICAgICAgIHZhciBmaWxlVXBsb2FkV3JhcHBlciA9IGRhdGEuZmlsZUlucHV0LmNsb3Nlc3QoXCIuZmlsZS11cGxvYWQtd3JhcHBlclwiKTtcclxuXHJcbiAgICAgICAgaWYgKGFzc2V0SWQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gc2NvcGUuZGF0YShcImRlbGV0ZS1hc3NldC11cmxcIik7XHJcbiAgICAgICAgICAgIHZhciBhbnRpRm9yZ2VyeVRva2VuID0gc2NvcGUuY2xvc2VzdChcImZvcm1cIikuZmluZChcIltuYW1lPSdfX1JlcXVlc3RWZXJpZmljYXRpb25Ub2tlbiddXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICB2YXIgY2xlYW51cE1lc3NhZ2UgPSBzY29wZS5maW5kKFwiLnN0YXR1cy5jbGVhbnVwXCIpO1xyXG5cclxuICAgICAgICAgICAgd2Ftc0Fzc2V0SW5wdXQudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICBmaWxlTmFtZUlucHV0LnZhbChcIlwiKTtcclxuXHJcbiAgICAgICAgICAgIGNsZWFudXBNZXNzYWdlLnNob3coKTtcclxuXHJcbiAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGFzc2V0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgX19SZXF1ZXN0VmVyaWZpY2F0aW9uVG9rZW46IGFudGlGb3JnZXJ5VG9rZW5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLWlzYWN0aXZlXCIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtc3RhcnQtdGltZVwiLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmZpbmQoXCIuZmlsZS11cGxvYWQtd3JhcHBlclwiKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICBjbGVhbnVwTWVzc2FnZS5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCJBbiBlcnJvciBvY2N1cnJlZCBvbiB0aGUgc2VydmVyIHdoaWxlIHRyeWluZyB0byBjbGVhbiB1cC5cIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmlsZVVwbG9hZFdyYXBwZXIuc2hvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBhZCh2YWx1ZTogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xyXG4gICAgICAgIHZhciBzdHIgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHN0ciA9IFwiMFwiICsgc3RyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUJsb2NrSWQoYmxvY2tJbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdmFyIGJsb2NrSWRQcmVmaXggPSBcImJsb2NrLVwiO1xyXG4gICAgICAgIHJldHVybiBidG9hKGJsb2NrSWRQcmVmaXggKyBwYWQoYmxvY2tJbmRleCwgNikpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNvbW1pdEJsb2NrTGlzdChzY29wZTogSlF1ZXJ5LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XHJcbiAgICAgICAgdmFyIGJsb2NrSWRzID0gc2NvcGUuZGF0YShcImJsb2NrLWlkc1wiKTtcclxuXHJcbiAgICAgICAgaWYgKGJsb2NrSWRzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIFRoZSBmaWxlIHdhcyB1cGxvYWRlZCBhcyBhIHdob2xlLCBzbyBubyBtYW5pZmVzdCB0byBzdWJtaXQuXHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBUaGUgZmlsZSB3YXMgdXBsb2FkZWQgaW4gY2h1bmtzLlxyXG4gICAgICAgICAgICB2YXIgdXJsID0gc2NvcGUuZGF0YShcInNhcy1sb2NhdG9yXCIpICsgXCImY29tcD1ibG9ja2xpc3RcIjtcclxuICAgICAgICAgICAgdmFyIHJlcXVlc3REYXRhID0gJzw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/PjxCbG9ja0xpc3Q+JztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja0lkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdERhdGEgKz0gJzxMYXRlc3Q+JyArIGJsb2NrSWRzW2ldICsgJzwvTGF0ZXN0Pic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVxdWVzdERhdGEgKz0gJzwvQmxvY2tMaXN0Pic7XHJcblxyXG4gICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBVVFwiLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogcmVxdWVzdERhdGEsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogXCJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04XCIsXHJcbiAgICAgICAgICAgICAgICBjcm9zc0RvbWFpbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uICh4aHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigneC1tcy1kYXRlJywgbmV3IERhdGUoKS50b1VUQ1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigneC1tcy1ibG9iLWNvbnRlbnQtdHlwZScsIGRhdGEuZmlsZXNbMF0udHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ3gtbXMtdmVyc2lvbicsIFwiMjAxMi0wMi0xMlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1MZW5ndGgnLCByZXF1ZXN0RGF0YS5sZW5ndGgudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIHN0YXR1cywgZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRleHRTdGF0dXMgPSBzdGF0dXM7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvclRocm93biA9IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLmZhaWwoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBoYXNBY3RpdmVVcGxvYWRzKCkge1xyXG4gICAgICAgIHZhciBzY29wZSA9ICQoXCIudXBsb2FkLWRpcmVjdFwiKTtcclxuICAgICAgICB2YXIgZmxhZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiLmFzeW5jLXVwbG9hZFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiKSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxhZztcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBoYXNDb21wbGV0ZWRVcGxvYWRzKCkge1xyXG4gICAgICAgIHZhciBzY29wZSA9ICQoXCIudXBsb2FkLWRpcmVjdFwiKTtcclxuICAgICAgICB2YXIgZmxhZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiLmFzeW5jLXVwbG9hZFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YShcInVwbG9hZC1pc2NvbXBsZXRlZFwiKSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxhZztcclxuICAgIH0gXHJcblxyXG4gICAgZnVuY3Rpb24gaXNTdWJtaXR0aW5nKCkge1xyXG4gICAgICAgIHZhciBzY29wZSA9ICQoXCIudXBsb2FkLWRpcmVjdFwiKTtcclxuICAgICAgICByZXR1cm4gc2NvcGUuZGF0YShcImlzLXN1Ym1pdHRpbmdcIikgPT0gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVVwbG9hZChmaWxlSW5wdXQ6IEpRdWVyeSkge1xyXG4gICAgICAgIHZhciBzY29wZSA9IGZpbGVJbnB1dC5jbG9zZXN0KFwiLmFzeW5jLXVwbG9hZFwiKTtcclxuICAgICAgICB2YXIgZmlsZVVwbG9hZFdyYXBwZXIgPSBzY29wZS5maW5kKFwiLmZpbGUtdXBsb2FkLXdyYXBwZXJcIik7XHJcbiAgICAgICAgdmFyIGFjY2VwdEZpbGVUeXBlc1JlZ2V4ID0gbmV3IFJlZ0V4cChzY29wZS5kYXRhKFwidXBsb2FkLWFjY2VwdC1maWxlLXR5cGVzXCIpKTtcclxuICAgICAgICB2YXIgYW50aUZvcmdlcnlUb2tlbjogc3RyaW5nID0gc2NvcGUuY2xvc2VzdChcImZvcm1cIikuZmluZChcIltuYW1lPSdfX1JlcXVlc3RWZXJpZmljYXRpb25Ub2tlbiddXCIpLnZhbCgpO1xyXG5cclxuICAgICAgICB2YXIgc2VsZWN0ZWRGaWxlV3JhcHBlciA9IHNjb3BlLmZpbmQoXCIuc2VsZWN0ZWQtZmlsZS13cmFwcGVyXCIpO1xyXG4gICAgICAgIHZhciBmaWxlbmFtZUlucHV0ID0gc2NvcGUuZmluZChcIi5maWxlbmFtZS1pbnB1dFwiKTtcclxuICAgICAgICB2YXIgcmVzZXRCdXR0b24gPSBzY29wZS5maW5kKFwiLnJlc2V0LWJ1dHRvblwiKTtcclxuICAgICAgICB2YXIgdXBsb2FkQnV0dG9uID0gc2NvcGUuZmluZChcIi51cGxvYWQtYnV0dG9uXCIpO1xyXG4gICAgICAgIHZhciBmaWxlbmFtZVRleHQgPSBzY29wZS5maW5kKFwiLmZpbGVuYW1lLXRleHRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZGF0aW9uVGV4dCA9IHNjb3BlLmZpbmQoXCIudmFsaWRhdGlvbi10ZXh0XCIpO1xyXG4gICAgICAgIHZhciBwcmVwYXJpbmdUZXh0ID0gc2NvcGUuZmluZChcIi5zdGF0dXMucHJlcGFyaW5nXCIpO1xyXG4gICAgICAgIHZhciB1cGxvYWRpbmdDb250YWluZXIgPSBzY29wZS5maW5kKFwiLnN0YXR1cy51cGxvYWRpbmdcIik7XHJcbiAgICAgICAgdmFyIHByb2dyZXNzQmFyID0gc2NvcGUuZmluZChcIi5wcm9ncmVzcy1iYXJcIik7XHJcbiAgICAgICAgdmFyIHByb2dyZXNzVGV4dCA9IHNjb3BlLmZpbmQoXCIucHJvZ3Jlc3MtdGV4dFwiKTtcclxuICAgICAgICB2YXIgcHJvZ3Jlc3NEZXRhaWxzID0gc2NvcGUuZmluZChcIi5wcm9ncmVzcy1kZXRhaWxzXCIpO1xyXG4gICAgICAgIHZhciBjYW5jZWxMaW5rID0gc2NvcGUuZmluZChcIi5jYW5jZWwtbGlua1wiKTsgXHJcblxyXG4gICAgICAgICg8YW55PmZpbGVJbnB1dCkuZmlsZXVwbG9hZCh7XHJcbiAgICAgICAgICAgIGF1dG9VcGxvYWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBhY2NlcHRGaWxlVHlwZXM6IGFjY2VwdEZpbGVUeXBlc1JlZ2V4LFxyXG4gICAgICAgICAgICB0eXBlOiBcIlBVVFwiLFxyXG4gICAgICAgICAgICBtYXhDaHVua1NpemU6IDQgKiAxMDI0ICogMTAyNCwgLy8gNCBNQlxyXG4gICAgICAgICAgICBiZWZvcmVTZW5kOiAoeGhyOiBKUXVlcnlYSFIsIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJ4LW1zLWRhdGVcIiwgbmV3IERhdGUoKS50b1VUQ1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwieC1tcy1ibG9iLXR5cGVcIiwgXCJCbG9ja0Jsb2JcIik7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcImNvbnRlbnQtbGVuZ3RoXCIsIGRhdGEuZGF0YS5zaXplLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjaHVua3NlbmQ6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2NrSW5kZXggPSBzY29wZS5kYXRhKFwiYmxvY2staW5kZXhcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvY2tJZHMgPSBzY29wZS5kYXRhKFwiYmxvY2staWRzXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2NrSWQgPSBjcmVhdGVCbG9ja0lkKGJsb2NrSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjb3BlLmRhdGEoXCJzYXMtbG9jYXRvclwiKSArIFwiJmNvbXA9YmxvY2smYmxvY2tpZD1cIiArIGJsb2NrSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZGF0YS51cmwgPSB1cmw7XHJcbiAgICAgICAgICAgICAgICBibG9ja0lkcy5wdXNoKGJsb2NrSWQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcImJsb2NrLWluZGV4XCIsIGJsb2NrSW5kZXggKyAxKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvZ3Jlc3NhbGw6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBlcmNlbnRDb21wbGV0ZSA9IE1hdGguZmxvb3IoKGRhdGEubG9hZGVkIC8gZGF0YS50b3RhbCkgKiAxMDApO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IG5ldyBEYXRlKHNjb3BlLmRhdGEoXCJ1cGxvYWQtc3RhcnQtdGltZVwiKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxhcHNlZE1pbGxpc2Vjb25kcyA9IG5ldyBEYXRlKERhdGUubm93KCkpLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxhcHNlZCA9IG1vbWVudC5kdXJhdGlvbihlbGFwc2VkTWlsbGlzZWNvbmRzLCBcIm1zXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbWFpbmluZyA9IG1vbWVudC5kdXJhdGlvbihlbGFwc2VkTWlsbGlzZWNvbmRzIC8gTWF0aC5tYXgoZGF0YS5sb2FkZWQsIDEpICogKGRhdGEudG90YWwgLSBkYXRhLmxvYWRlZCksIFwibXNcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIga2JwcyA9IE1hdGguZmxvb3IoZGF0YS5iaXRyYXRlIC8gOCAvIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVwbG9hZGVkID0gTWF0aC5mbG9vcihkYXRhLmxvYWRlZCAvIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gTWF0aC5mbG9vcihkYXRhLnRvdGFsIC8gMTAwMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXIuc2hvdygpLmZpbmQoXCIucHJvZ3Jlc3NcIikuY3NzKFwid2lkdGhcIiwgcGVyY2VudENvbXBsZXRlICsgXCIlXCIpO1xyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NUZXh0LnRleHQocHJvZ3Jlc3NUZXh0LmRhdGEoXCJ0ZXh0LXRlbXBsYXRlXCIpLnJlcGxhY2UoXCJ7cGVyY2VudGFnZX1cIiwgcGVyY2VudENvbXBsZXRlKSkuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NEZXRhaWxzLnRleHQocHJvZ3Jlc3NEZXRhaWxzLmRhdGEoXCJ0ZXh0LXRlbXBsYXRlXCIpLnJlcGxhY2UoXCJ7dXBsb2FkZWR9XCIsIHVwbG9hZGVkKS5yZXBsYWNlKFwie3RvdGFsfVwiLCB0b3RhbCkucmVwbGFjZShcIntrYnBzfVwiLCBrYnBzKS5yZXBsYWNlKFwie2VsYXBzZWR9XCIsIGVsYXBzZWQuaHVtYW5pemUoKSkucmVwbGFjZShcIntyZW1haW5pbmd9XCIsIHJlbWFpbmluZy5odW1hbml6ZSgpKSkuc2hvdygpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkb25lOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgICAgIGNvbW1pdEJsb2NrTGlzdChzY29wZSwgZGF0YSkuYWx3YXlzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRDb21wbGV0ZWQoc2VsZiwgZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24gKGU6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRDb21wbGV0ZWQodGhpcywgZSwgZGF0YSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHByb2Nlc3Nkb25lOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZEZpbGVuYW1lID0gZGF0YS5maWxlc1swXS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInNlbGVjdGVkLWZpbGVuYW1lXCIsIHNlbGVjdGVkRmlsZW5hbWUpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVVcGxvYWRXcmFwcGVyLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uVGV4dC5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWxlV3JhcHBlci5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWVUZXh0LnRleHQoZmlsZW5hbWVUZXh0LmRhdGEoXCJ0ZXh0LXRlbXBsYXRlXCIpLnJlcGxhY2UoXCJ7ZmlsZW5hbWV9XCIsIHNlbGVjdGVkRmlsZW5hbWUpKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwKTsgXHJcblxyXG4gICAgICAgICAgICAgICAgKDxhbnk+c2NvcGVbMF0pLmRvUmVzZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVVwbG9hZFdyYXBwZXIuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lSW5wdXQudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lVGV4dC50ZXh0KFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmlsZVdyYXBwZXIuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25UZXh0LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgKDxhbnk+c2NvcGVbMF0pLmRvVXBsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlZGl0ZWRGaWxlbmFtZSA9IGZpbGVuYW1lSW5wdXQudmFsKCkgfHwgc2VsZWN0ZWRGaWxlbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWFjY2VwdEZpbGVUeXBlc1JlZ2V4LnRlc3QoZWRpdGVkRmlsZW5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25UZXh0LnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLXN0YXJ0LXRpbWVcIiwgRGF0ZS5ub3coKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdlbmVyYXRlQXNzZXRVcmwgPSBzY29wZS5kYXRhKFwiZ2VuZXJhdGUtYXNzZXQtdXJsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJibG9jay1pbmRleFwiLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwiYmxvY2staWRzXCIsIG5ldyBBcnJheSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcHJlcGFyaW5nVGV4dC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWxlV3JhcHBlci5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblRleHQuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGdlbmVyYXRlQXNzZXRVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBlZGl0ZWRGaWxlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUmVxdWVzdFZlcmlmaWNhdGlvblRva2VuOiBhbnRpRm9yZ2VyeVRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoYXNzZXQ6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS51cmwgPSBhc3NldC5zYXNMb2NhdG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5tdWx0aXBhcnQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwic2FzLWxvY2F0b3JcIiwgYXNzZXQuc2FzTG9jYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5GaWxlTmFtZSddXCIpLnZhbChlZGl0ZWRGaWxlbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5XYW1zQXNzZXRJZCddXCIpLnZhbChhc3NldC5hc3NldElkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVwYXJpbmdUZXh0LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzVGV4dC50ZXh0KHByb2dyZXNzVGV4dC5kYXRhKFwidGV4dC10ZW1wbGF0ZVwiKS5yZXBsYWNlKFwie3BlcmNlbnRhZ2V9XCIsIDApKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRpbmdDb250YWluZXIuc2hvdygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBkYXRhLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInhoclwiLCB4aHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICh4aHI6IGFueSwgc3RhdHVzOiBhbnksIGVycm9yOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVVcGxvYWRXcmFwcGVyLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmlsZVdyYXBwZXIuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlcGFyaW5nVGV4dC5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRpbmdDb250YWluZXIuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtaXNhY3RpdmVcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1zdGFydC10aW1lXCIsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJBbiBlcnJvciBvY2N1cnJlZC4gRXJyb3I6IFwiICsgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHByb2Nlc3NmYWlsOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRpb25UZXh0LnNob3coKTtcclxuICAgICAgICAgICAgICAgIGZpbGVuYW1lSW5wdXQudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgZmlsZW5hbWVUZXh0LnRleHQoXCJcIik7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpbGVXcmFwcGVyLmhpZGUoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9tcHQgPSBmaWxlSW5wdXQuZGF0YShcInByb21wdFwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9tcHQgJiYgcHJvbXB0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0ocHJvbXB0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNhbmNlbExpbmsub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoY29uZmlybSgkKHRoaXMpLmRhdGEoXCJjYW5jZWwtcHJvbXB0XCIpKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHhociA9IHNjb3BlLmRhdGEoXCJ4aHJcIik7XHJcbiAgICAgICAgICAgICAgICB4aHIuYWJvcnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplVXBsb2FkRGlyZWN0KCkge1xyXG5cclxuICAgICAgICB2YXIgc2NvcGUgPSAkKFwiLnVwbG9hZC1kaXJlY3RcIikuc2hvdygpO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiLnJlc2V0LWJ1dHRvblwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBkb1Jlc2V0ID0gKDxhbnk+JCh0aGlzKS5jbG9zZXN0KFwiLmFzeW5jLXVwbG9hZFwiKVswXSkuZG9SZXNldDtcclxuICAgICAgICAgICAgaWYgKCEhZG9SZXNldClcclxuICAgICAgICAgICAgICAgIGRvUmVzZXQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2NvcGUuZmluZChcIi51cGxvYWQtYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGRvVXBsb2FkID0gKDxhbnk+JCh0aGlzKS5jbG9zZXN0KFwiLmFzeW5jLXVwbG9hZFwiKVswXSkuZG9VcGxvYWQ7XHJcbiAgICAgICAgICAgIGlmICghIWRvVXBsb2FkKVxyXG4gICAgICAgICAgICAgICAgZG9VcGxvYWQoKTtcclxuICAgICAgICB9KTsgXHJcbiAgICAgICAgICBcclxuICAgICAgICByZXF1aXJlZFVwbG9hZHMgPSBzY29wZS5maW5kKFwiLnJlcXVpcmVkLXVwbG9hZFwiKTtcclxuXHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5hc3luYy11cGxvYWQtZmlsZS1pbnB1dFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaW5pdGlhbGl6ZVVwbG9hZCgkKHRoaXMpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2NvcGUuY2xvc2VzdChcImZvcm1cIikub24oXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGhhc0FjdGl2ZVVwbG9hZHMoKSkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoc2NvcGUuZGF0YShcImJsb2NrLXN1Ym1pdC1wcm9tcHRcIikpO1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzY29wZS5kYXRhKFwiaXMtc3VibWl0dGluZ1wiLCB0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAgXHJcbiAgICAgICAgJCh3aW5kb3cpLm9uKFwiYmVmb3JldW5sb2FkXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICgoaGFzQWN0aXZlVXBsb2FkcygpIHx8IGhhc0NvbXBsZXRlZFVwbG9hZHMoKSkgJiYgIWlzU3VibWl0dGluZygpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNjb3BlLmRhdGEoXCJuYXZpZ2F0ZS1hd2F5LXByb21wdFwiKTtcclxuICAgICAgICAgICAgICAgIGUucmVzdWx0ID0gbWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
