/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/jqueryui.d.ts" />
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var CloudVideoEdit;
            (function (CloudVideoEdit) {
                var requiredUploads;
                var blocked;
                var hasRequiredUploadsp;
                function getAllFilesCompleted() {
                    var allFilesCompleted = true;
                    requiredUploads.find("input[name$='.OriginalFileName'], input.sync-upload-input").each(function () {
                        if ($(this).val() == "") {
                            allFilesCompleted = false;
                            return false;
                        }
                    });
                    return allFilesCompleted;
                }
                ;
                function unblockIfComplete() {
                    if (getAllFilesCompleted())
                        blocked.unblock();
                }
                function uploadCompleted(sender, data) {
                    var scope = $(sender).closest("[data-upload-accept-file-types]");
                    var status = data.errorThrown && data.errorThrown.length > 0 ? data.errorThrown : data.textStatus;
                    scope.find(".progress-bar").hide();
                    scope.find(".progress-text").hide();
                    scope.find(".cancel-upload").hide();
                    scope.data("upload-isactive", false);
                    switch (status) {
                        case "error":
                            alert("The upload of the selected file failed. One possible cause is that the file size exceeds the configured maxRequestLength setting (see: http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.maxrequestlength(v=vs.110).aspx). Also make sure the executionTimeOut is set to allow for enough time for the request to execute when debug=\"false\".");
                            return;
                        case "abort":
                            return;
                    }
                    var temporaryFileName = data.result.temporaryFileName;
                    var originalFileName = data.result.originalFileName;
                    var fileSize = data.result.fileSize;
                    scope.find("input[name$='.OriginalFileName']").val(originalFileName);
                    scope.find("input[name$='.TemporaryFileName']").val(temporaryFileName);
                    scope.find("input[name$='.FileSize']").val(fileSize);
                    unblockIfComplete();
                    $(sender).replaceWith("<span>Successfully uploaded video file '" + originalFileName + "'.</span>");
                }
                function initializeUpload(fileInput) {
                    var scope = $(fileInput).closest("[data-upload-accept-file-types]");
                    var acceptFileTypes = scope.data("upload-accept-file-types");
                    var antiForgeryToken = requiredUploads.closest("form").find("[name='__RequestVerificationToken']").val();
                    var cancelUpload = scope.find(".cancel-upload");
                    fileInput.fileupload({
                        autoUpload: false,
                        acceptFileTypes: new RegExp(acceptFileTypes, "i"),
                        type: "POST",
                        url: scope.data("upload-fallback-url"),
                        formData: {
                            __RequestVerificationToken: antiForgeryToken
                        },
                        progressall: function (e, data) {
                            var percentComplete = Math.floor((data.loaded / data.total) * 100);
                            scope.find(".progress-bar").show().find('.progress').css('width', percentComplete + '%');
                            scope.find(".progress-text").show().text("Uploading (" + percentComplete + "%)...");
                        },
                        done: function (e, data) {
                            uploadCompleted(this, data);
                        },
                        fail: function (e, data) {
                            uploadCompleted(this, data);
                        },
                        processdone: function (e, data) {
                            scope.find(".validation-text").hide();
                            scope.data("upload-isactive", true);
                            cancelUpload.show();
                            var xhr = data.submit();
                            scope.data("xhr", xhr);
                        },
                        processfail: function (e, data) {
                            scope.find(".validation-text").show();
                        }
                    });
                    cancelUpload.on("click", function (e) {
                        e.preventDefault();
                        if (confirm("Are you sure you want to cancel this upload?")) {
                            var xhr = scope.data("xhr");
                            xhr.abort();
                        }
                    });
                }
                function initializeUploadProxied() {
                    var scopeProxied = $(".upload-proxied").show();
                    requiredUploads = scopeProxied.find(".required-uploads-group");
                    blocked = scopeProxied.find(".edit-item-sidebar");
                    hasRequiredUploadsp = requiredUploads.length > 0;
                    if (hasRequiredUploadsp) {
                        blocked.block({
                            message: requiredUploads.data("block-description"),
                            overlayCSS: {
                                backgroundColor: "#fff",
                                cursor: "default"
                            },
                            css: {
                                cursor: "default",
                                border: null,
                                width: null,
                                left: 0,
                                margin: "30px 0 0 0",
                                backgroundColor: null
                            }
                        });
                        scopeProxied.find(".async-upload-file-input").each(function () {
                            initializeUpload($(this));
                        });
                        window.onbeforeunload = function (e) {
                            var hasActiveUploads = false;
                            scopeProxied.find("[data-upload-accept-file-types]").each(function () {
                                if ($(this).data("upload-isactive") == true) {
                                    hasActiveUploads = true;
                                    return false;
                                }
                            });
                            if (hasActiveUploads)
                                e.returnValue = "There are uploads in progress. These will be aborted if you navigate away.";
                        };
                        scopeProxied.find(".sync-upload-input").on("change", function (e) {
                            unblockIfComplete();
                        });
                        unblockIfComplete();
                    }
                    scopeProxied.find("[data-prompt]").on("change", function (e) {
                        var sender = $(e.currentTarget);
                        if (!confirm(sender.data("prompt"))) {
                            sender.val("");
                        }
                    });
                }
                CloudVideoEdit.initializeUploadProxied = initializeUploadProxied;
            })(CloudVideoEdit = MediaServices.CloudVideoEdit || (MediaServices.CloudVideoEdit = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1wcm94aWVkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNENBQTRDO0FBQzVDLDhDQUE4QztBQUU5QyxJQUFPLE9BQU8sQ0EySmI7QUEzSkQsV0FBTyxPQUFPO0lBQUMsSUFBQSxLQUFLLENBMkpuQjtJQTNKYyxXQUFBLEtBQUs7UUFBQyxJQUFBLGFBQWEsQ0EySmpDO1FBM0pvQixXQUFBLGFBQWE7WUFBQyxJQUFBLGNBQWMsQ0EySmhEO1lBM0prQyxXQUFBLGNBQWM7Z0JBRTdDLElBQUksZUFBdUIsQ0FBQztnQkFDNUIsSUFBSSxPQUFlLENBQUM7Z0JBQ3BCLElBQUksbUJBQTRCLENBQUM7Z0JBRWpDO29CQUNJLElBQUksaUJBQWlCLEdBQVksSUFBSSxDQUFDO29CQUV0QyxlQUFlLENBQUMsSUFBSSxDQUFDLDJEQUEyRCxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUNuRixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQzs0QkFDdEIsaUJBQWlCLEdBQUcsS0FBSyxDQUFDOzRCQUMxQixNQUFNLENBQUMsS0FBSyxDQUFDO3dCQUNqQixDQUFDO29CQUNMLENBQUMsQ0FBQyxDQUFDO29CQUVILE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQztnQkFDN0IsQ0FBQztnQkFBQSxDQUFDO2dCQUVGO29CQUNJLEVBQUUsQ0FBQyxDQUFDLG9CQUFvQixFQUFFLENBQUM7d0JBQ2pCLE9BQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDakMsQ0FBQztnQkFFRCx5QkFBeUIsTUFBVyxFQUFFLElBQVM7b0JBQzNDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsaUNBQWlDLENBQUMsQ0FBQztvQkFDakUsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENB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ZSI6ImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1wcm94aWVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvanF1ZXJ5LmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVHlwaW5ncy9qcXVlcnl1aS5kLnRzXCIgLz5cclxuXHJcbm1vZHVsZSBPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQge1xyXG5cclxuICAgIHZhciByZXF1aXJlZFVwbG9hZHM6IEpRdWVyeTtcclxuICAgIHZhciBibG9ja2VkOiBKUXVlcnk7XHJcbiAgICB2YXIgaGFzUmVxdWlyZWRVcGxvYWRzcDogYm9vbGVhbjtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRBbGxGaWxlc0NvbXBsZXRlZCgpOiBib29sZWFuIHtcclxuICAgICAgICB2YXIgYWxsRmlsZXNDb21wbGV0ZWQ6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgICAgICByZXF1aXJlZFVwbG9hZHMuZmluZChcImlucHV0W25hbWUkPScuT3JpZ2luYWxGaWxlTmFtZSddLCBpbnB1dC5zeW5jLXVwbG9hZC1pbnB1dFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgYWxsRmlsZXNDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gYWxsRmlsZXNDb21wbGV0ZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHVuYmxvY2tJZkNvbXBsZXRlKCkge1xyXG4gICAgICAgIGlmIChnZXRBbGxGaWxlc0NvbXBsZXRlZCgpKVxyXG4gICAgICAgICAgICAoPGFueT5ibG9ja2VkKS51bmJsb2NrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdXBsb2FkQ29tcGxldGVkKHNlbmRlcjogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICB2YXIgc2NvcGUgPSAkKHNlbmRlcikuY2xvc2VzdChcIltkYXRhLXVwbG9hZC1hY2NlcHQtZmlsZS10eXBlc11cIik7XHJcbiAgICAgICAgdmFyIHN0YXR1cyA9IGRhdGEuZXJyb3JUaHJvd24gJiYgZGF0YS5lcnJvclRocm93bi5sZW5ndGggPiAwID8gZGF0YS5lcnJvclRocm93biA6IGRhdGEudGV4dFN0YXR1cztcclxuICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLWJhclwiKS5oaWRlKCk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5wcm9ncmVzcy10ZXh0XCIpLmhpZGUoKTtcclxuICAgICAgICBzY29wZS5maW5kKFwiLmNhbmNlbC11cGxvYWRcIikuaGlkZSgpO1xyXG4gICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtaXNhY3RpdmVcIiwgZmFsc2UpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIFwiZXJyb3JcIjpcclxuICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhlIHVwbG9hZCBvZiB0aGUgc2VsZWN0ZWQgZmlsZSBmYWlsZWQuIE9uZSBwb3NzaWJsZSBjYXVzZSBpcyB0aGF0IHRoZSBmaWxlIHNpemUgZXhjZWVkcyB0aGUgY29uZmlndXJlZCBtYXhSZXF1ZXN0TGVuZ3RoIHNldHRpbmcgKHNlZTogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L3N5c3RlbS53ZWIuY29uZmlndXJhdGlvbi5odHRwcnVudGltZXNlY3Rpb24ubWF4cmVxdWVzdGxlbmd0aCh2PXZzLjExMCkuYXNweCkuIEFsc28gbWFrZSBzdXJlIHRoZSBleGVjdXRpb25UaW1lT3V0IGlzIHNldCB0byBhbGxvdyBmb3IgZW5vdWdoIHRpbWUgZm9yIHRoZSByZXF1ZXN0IHRvIGV4ZWN1dGUgd2hlbiBkZWJ1Zz1cXFwiZmFsc2VcXFwiLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgY2FzZSBcImFib3J0XCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdGVtcG9yYXJ5RmlsZU5hbWUgPSBkYXRhLnJlc3VsdC50ZW1wb3JhcnlGaWxlTmFtZTtcclxuICAgICAgICB2YXIgb3JpZ2luYWxGaWxlTmFtZSA9IGRhdGEucmVzdWx0Lm9yaWdpbmFsRmlsZU5hbWU7XHJcbiAgICAgICAgdmFyIGZpbGVTaXplID0gZGF0YS5yZXN1bHQuZmlsZVNpemU7XHJcblxyXG4gICAgICAgIHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLk9yaWdpbmFsRmlsZU5hbWUnXVwiKS52YWwob3JpZ2luYWxGaWxlTmFtZSk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcImlucHV0W25hbWUkPScuVGVtcG9yYXJ5RmlsZU5hbWUnXVwiKS52YWwodGVtcG9yYXJ5RmlsZU5hbWUpO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLkZpbGVTaXplJ11cIikudmFsKGZpbGVTaXplKTtcclxuXHJcbiAgICAgICAgdW5ibG9ja0lmQ29tcGxldGUoKTtcclxuICAgICAgICAkKHNlbmRlcikucmVwbGFjZVdpdGgoXCI8c3Bhbj5TdWNjZXNzZnVsbHkgdXBsb2FkZWQgdmlkZW8gZmlsZSAnXCIgKyBvcmlnaW5hbEZpbGVOYW1lICsgXCInLjwvc3Bhbj5cIik7XHJcbiAgICB9XHJcbiAgICAgXHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplVXBsb2FkKGZpbGVJbnB1dDogYW55KSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gJChmaWxlSW5wdXQpLmNsb3Nlc3QoXCJbZGF0YS11cGxvYWQtYWNjZXB0LWZpbGUtdHlwZXNdXCIpO1xyXG4gICAgICAgIHZhciBhY2NlcHRGaWxlVHlwZXM6IHN0cmluZyA9IHNjb3BlLmRhdGEoXCJ1cGxvYWQtYWNjZXB0LWZpbGUtdHlwZXNcIik7XHJcbiAgICAgICAgdmFyIGFudGlGb3JnZXJ5VG9rZW4gPSByZXF1aXJlZFVwbG9hZHMuY2xvc2VzdChcImZvcm1cIikuZmluZChcIltuYW1lPSdfX1JlcXVlc3RWZXJpZmljYXRpb25Ub2tlbiddXCIpLnZhbCgpO1xyXG4gICAgICAgIHZhciBjYW5jZWxVcGxvYWQgPSBzY29wZS5maW5kKFwiLmNhbmNlbC11cGxvYWRcIik7XHJcblxyXG4gICAgICAgIGZpbGVJbnB1dC5maWxldXBsb2FkKHtcclxuICAgICAgICAgICAgYXV0b1VwbG9hZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGFjY2VwdEZpbGVUeXBlczogbmV3IFJlZ0V4cChhY2NlcHRGaWxlVHlwZXMsIFwiaVwiKSxcclxuICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIHVybDogc2NvcGUuZGF0YShcInVwbG9hZC1mYWxsYmFjay11cmxcIiksXHJcbiAgICAgICAgICAgIGZvcm1EYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBfX1JlcXVlc3RWZXJpZmljYXRpb25Ub2tlbjogYW50aUZvcmdlcnlUb2tlblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwcm9ncmVzc2FsbDogKGU6IGFueSwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGVyY2VudENvbXBsZXRlID0gTWF0aC5mbG9vcigoZGF0YS5sb2FkZWQgLyBkYXRhLnRvdGFsKSAqIDEwMCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLWJhclwiKS5zaG93KCkuZmluZCgnLnByb2dyZXNzJykuY3NzKCd3aWR0aCcsIHBlcmNlbnRDb21wbGV0ZSArICclJyk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLXRleHRcIikuc2hvdygpLnRleHQoXCJVcGxvYWRpbmcgKFwiICsgcGVyY2VudENvbXBsZXRlICsgXCIlKS4uLlwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZG9uZTogZnVuY3Rpb24gKGU6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRDb21wbGV0ZWQodGhpcywgZGF0YSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ29tcGxldGVkKHRoaXMsIGRhdGEpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwcm9jZXNzZG9uZTogKGU6IGFueSwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiLnZhbGlkYXRpb24tdGV4dFwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLWlzYWN0aXZlXCIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgY2FuY2VsVXBsb2FkLnNob3coKTtcclxuICAgICAgICAgICAgICAgIHZhciB4aHIgPSBkYXRhLnN1Ym1pdCgpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInhoclwiLCB4aHIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwcm9jZXNzZmFpbDogKGU6IGFueSwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5maW5kKFwiLnZhbGlkYXRpb24tdGV4dFwiKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY2FuY2VsVXBsb2FkLm9uKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNhbmNlbCB0aGlzIHVwbG9hZD9cIikpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4aHIgPSBzY29wZS5kYXRhKFwieGhyXCIpO1xyXG4gICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZVVwbG9hZFByb3hpZWQoKSB7XHJcbiAgICAgICAgdmFyIHNjb3BlUHJveGllZCA9ICQoXCIudXBsb2FkLXByb3hpZWRcIikuc2hvdygpO1xyXG4gICAgICAgIHJlcXVpcmVkVXBsb2FkcyA9IHNjb3BlUHJveGllZC5maW5kKFwiLnJlcXVpcmVkLXVwbG9hZHMtZ3JvdXBcIik7XHJcbiAgICAgICAgYmxvY2tlZCA9IHNjb3BlUHJveGllZC5maW5kKFwiLmVkaXQtaXRlbS1zaWRlYmFyXCIpO1xyXG4gICAgICAgIGhhc1JlcXVpcmVkVXBsb2Fkc3AgPSByZXF1aXJlZFVwbG9hZHMubGVuZ3RoID4gMDtcclxuXHJcbiAgICAgICAgaWYgKGhhc1JlcXVpcmVkVXBsb2Fkc3ApIHtcclxuICAgICAgICAgICAgKDxhbnk+YmxvY2tlZCkuYmxvY2soe1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogcmVxdWlyZWRVcGxvYWRzLmRhdGEoXCJibG9jay1kZXNjcmlwdGlvblwiKSxcclxuICAgICAgICAgICAgICAgIG92ZXJsYXlDU1M6IHtcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcjogXCJkZWZhdWx0XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjc3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IFwiZGVmYXVsdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogXCIzMHB4IDAgMCAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGVQcm94aWVkLmZpbmQoXCIuYXN5bmMtdXBsb2FkLWZpbGUtaW5wdXRcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplVXBsb2FkKCQodGhpcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9IGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhhc0FjdGl2ZVVwbG9hZHMgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZVByb3hpZWQuZmluZChcIltkYXRhLXVwbG9hZC1hY2NlcHQtZmlsZS10eXBlc11cIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiKSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0FjdGl2ZVVwbG9hZHMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGhhc0FjdGl2ZVVwbG9hZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IFwiVGhlcmUgYXJlIHVwbG9hZHMgaW4gcHJvZ3Jlc3MuIFRoZXNlIHdpbGwgYmUgYWJvcnRlZCBpZiB5b3UgbmF2aWdhdGUgYXdheS5cIjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlUHJveGllZC5maW5kKFwiLnN5bmMtdXBsb2FkLWlucHV0XCIpLm9uKFwiY2hhbmdlXCIsIGU9PiB7XHJcbiAgICAgICAgICAgICAgICB1bmJsb2NrSWZDb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHVuYmxvY2tJZkNvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzY29wZVByb3hpZWQuZmluZChcIltkYXRhLXByb21wdF1cIikub24oXCJjaGFuZ2VcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBzZW5kZXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIWNvbmZpcm0oc2VuZGVyLmRhdGEoXCJwcm9tcHRcIikpKSB7XHJcbiAgICAgICAgICAgICAgICBzZW5kZXIudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iXX0=
