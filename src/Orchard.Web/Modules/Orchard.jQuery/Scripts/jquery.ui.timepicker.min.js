(function ($) { function Timepicker() { this.regional = []; this.regional[""] = { currentText: "Now", closeText: "Done", ampm: false, amNames: ["AM", "A"], pmNames: ["PM", "P"], timeFormat: "hh:mm tt", timeSuffix: "", timeOnlyTitle: "Choose Time", timeText: "Time", hourText: "Hour", minuteText: "Minute", secondText: "Second", millisecText: "Millisecond", timezoneText: "Time Zone" }; this._defaults = { showButtonPanel: true, timeOnly: false, showHour: true, showMinute: true, showSecond: false, showMillisec: false, showTimezone: false, showTime: true, stepHour: 1, stepMinute: 1, stepSecond: 1, stepMillisec: 1, hour: 0, minute: 0, second: 0, millisec: 0, timezone: null, useLocalTimezone: false, defaultTimezone: "+0000", hourMin: 0, minuteMin: 0, secondMin: 0, millisecMin: 0, hourMax: 23, minuteMax: 59, secondMax: 59, millisecMax: 999, minDateTime: null, maxDateTime: null, onSelect: null, hourGrid: 0, minuteGrid: 0, secondGrid: 0, millisecGrid: 0, alwaysSetTime: true, separator: " ", altFieldTimeOnly: true, showTimepicker: true, timezoneIso8601: false, timezoneList: null, addSliderAccess: false, sliderAccessArgs: null }; $.extend(this._defaults, this.regional[""]) } function extendRemove(a, b) { $.extend(a, b); for (var c in b) { if (b[c] === null || b[c] === undefined) { a[c] = b[c] } } return a } $.ui.timepicker = $.ui.timepicker || {}; if ($.ui.timepicker.version) { return } $.extend($.ui, { timepicker: { version: "1.0.1" } }); $.extend(Timepicker.prototype, { $input: null, $altInput: null, $timeObj: null, inst: null, hour_slider: null, minute_slider: null, second_slider: null, millisec_slider: null, timezone_select: null, hour: 0, minute: 0, second: 0, millisec: 0, timezone: null, defaultTimezone: "+0000", hourMinOriginal: null, minuteMinOriginal: null, secondMinOriginal: null, millisecMinOriginal: null, hourMaxOriginal: null, minuteMaxOriginal: null, secondMaxOriginal: null, millisecMaxOriginal: null, ampm: "", formattedDate: "", formattedTime: "", formattedDateTime: "", timezoneList: null, setDefaults: function (a) { extendRemove(this._defaults, a || {}); return this }, _newInst: function ($input, o) { var tp_inst = new Timepicker, inlineSettings = {}; for (var attrName in this._defaults) { var attrValue = $input.attr("time:" + attrName); if (attrValue) { try { inlineSettings[attrName] = eval(attrValue) } catch (err) { inlineSettings[attrName] = attrValue } } } tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, o, { beforeShow: function (a, b) { if ($.isFunction(o.beforeShow)) { return o.beforeShow(a, b, tp_inst) } }, onChangeMonthYear: function (a, b, c) { tp_inst._updateDateTime(c); if ($.isFunction(o.onChangeMonthYear)) { o.onChangeMonthYear.call($input[0], a, b, c, tp_inst) } }, onClose: function (a, b) { if (tp_inst.timeDefined === true && $input.val() !== "") { tp_inst._updateDateTime(b) } if ($.isFunction(o.onClose)) { o.onClose.call($input[0], a, b, tp_inst) } }, timepicker: tp_inst }); tp_inst.amNames = $.map(tp_inst._defaults.amNames, function (a) { return a.toUpperCase() }); tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function (a) { return a.toUpperCase() }); if (tp_inst._defaults.timezoneList === null) { var timezoneList = []; for (var i = -11; i <= 12; i++) { timezoneList.push((i >= 0 ? "+" : "-") + ("0" + Math.abs(i).toString()).slice(-2) + "00") } if (tp_inst._defaults.timezoneIso8601) { timezoneList = $.map(timezoneList, function (a) { return a == "+0000" ? "Z" : a.substring(0, 3) + ":" + a.substring(3) }) } tp_inst._defaults.timezoneList = timezoneList } tp_inst.timezone = tp_inst._defaults.timezone; tp_inst.hour = tp_inst._defaults.hour; tp_inst.minute = tp_inst._defaults.minute; tp_inst.second = tp_inst._defaults.second; tp_inst.millisec = tp_inst._defaults.millisec; tp_inst.ampm = ""; tp_inst.$input = $input; if (o.altField) { tp_inst.$altInput = $(o.altField).css({ cursor: "pointer" }).focus(function () { $input.trigger("focus") }) } if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) { tp_inst._defaults.minDate = new Date } if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) { tp_inst._defaults.maxDate = new Date } if (tp_inst._defaults.minDate !== undefined && tp_inst._defaults.minDate instanceof Date) { tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime()) } if (tp_inst._defaults.minDateTime !== undefined && tp_inst._defaults.minDateTime instanceof Date) { tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime()) } if (tp_inst._defaults.maxDate !== undefined && tp_inst._defaults.maxDate instanceof Date) { tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime()) } if (tp_inst._defaults.maxDateTime !== undefined && tp_inst._defaults.maxDateTime instanceof Date) { tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime()) } return tp_inst }, _addTimePicker: function (a) { var b = this.$altInput && this._defaults.altFieldTimeOnly ? this.$input.val() + " " + this.$altInput.val() : this.$input.val(); this.timeDefined = this._parseTime(b); this._limitMinMaxDateTime(a, false); this._injectTimePicker() }, _parseTime: function (a, b) { if (!this.inst) { this.inst = $.datepicker._getInst(this.$input[0]) } if (b || !this._defaults.timeOnly) { var c = $.datepicker._get(this.inst, "dateFormat"); try { var d = parseDateTimeInternal(c, this._defaults.timeFormat, a, $.datepicker._getFormatConfig(this.inst), this._defaults); if (!d.timeObj) { return false } $.extend(this, d.timeObj) } catch (e) { return false } return true } else { var f = $.datepicker.parseTime(this._defaults.timeFormat, a, this._defaults); if (!f) { return false } $.extend(this, f); return true } }, _injectTimePicker: function () { var a = this.inst.dpDiv, b = this._defaults, c = this, d = parseInt(b.hourMax - (b.hourMax - b.hourMin) % b.stepHour, 10), e = parseInt(b.minuteMax - (b.minuteMax - b.minuteMin) % b.stepMinute, 10), f = parseInt(b.secondMax - (b.secondMax - b.secondMin) % b.stepSecond, 10), g = parseInt(b.millisecMax - (b.millisecMax - b.millisecMin) % b.stepMillisec, 10), h = this.inst.id.toString().replace(/([^A-Za-z0-9_])/g, ""); if (a.find("div#ui-timepicker-div-" + h).length === 0 && b.showTimepicker) { var i = ' style="display:none;"', j = '<div class="ui-timepicker-div" id="ui-timepicker-div-' + h + '"><dl>' + '<dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_' + h + '"' + (b.showTime ? "" : i) + ">" + b.timeText + "</dt>" + '<dd class="ui_tpicker_time" id="ui_tpicker_time_' + h + '"' + (b.showTime ? "" : i) + "></dd>" + '<dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_' + h + '"' + (b.showHour ? "" : i) + ">" + b.hourText + "</dt>", k = 0, l = 0, m = 0, n = 0, o = null; j += '<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_' + h + '"' + (b.showHour ? "" : i) + "></div>"; if (b.showHour && b.hourGrid > 0) { j += '<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>'; for (var p = b.hourMin; p <= d; p += parseInt(b.hourGrid, 10)) { k++; var q = b.ampm && p > 12 ? p - 12 : p; if (q < 10) { q = "0" + q } if (b.ampm) { if (p === 0) { q = 12 + "a" } else { if (p < 12) { q += "a" } else { q += "p" } } } j += "<td>" + q + "</td>" } j += "</tr></table></div>" } j += "</dd>"; j += '<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_' + h + '"' + (b.showMinute ? "" : i) + ">" + b.minuteText + "</dt>" + '<dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_' + h + '"' + (b.showMinute ? "" : i) + "></div>"; if (b.showMinute && b.minuteGrid > 0) { j += '<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>'; for (var r = b.minuteMin; r <= e; r += parseInt(b.minuteGrid, 10)) { l++; j += "<td>" + (r < 10 ? "0" : "") + r + "</td>" } j += "</tr></table></div>" } j += "</dd>"; j += '<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_' + h + '"' + (b.showSecond ? "" : i) + ">" + b.secondText + "</dt>" + '<dd class="ui_tpicker_second"><div id="ui_tpicker_second_' + h + '"' + (b.showSecond ? "" : i) + "></div>"; if (b.showSecond && b.secondGrid > 0) { j += '<div style="padding-left: 1px"><table><tr>'; for (var s = b.secondMin; s <= f; s += parseInt(b.secondGrid, 10)) { m++; j += "<td>" + (s < 10 ? "0" : "") + s + "</td>" } j += "</tr></table></div>" } j += "</dd>"; j += '<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_' + h + '"' + (b.showMillisec ? "" : i) + ">" + b.millisecText + "</dt>" + '<dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_' + h + '"' + (b.showMillisec ? "" : i) + "></div>"; if (b.showMillisec && b.millisecGrid > 0) { j += '<div style="padding-left: 1px"><table><tr>'; for (var t = b.millisecMin; t <= g; t += parseInt(b.millisecGrid, 10)) { n++; j += "<td>" + (t < 10 ? "0" : "") + t + "</td>" } j += "</tr></table></div>" } j += "</dd>"; j += '<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_' + h + '"' + (b.showTimezone ? "" : i) + ">" + b.timezoneText + "</dt>"; j += '<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_' + h + '"' + (b.showTimezone ? "" : i) + "></dd>"; j += "</dl></div>"; var u = $(j); if (b.timeOnly === true) { u.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">' + '<div class="ui-datepicker-title">' + b.timeOnlyTitle + "</div>" + "</div>"); a.find(".ui-datepicker-header, .ui-datepicker-calendar").hide() } this.hour_slider = u.find("#ui_tpicker_hour_" + h).slider({ orientation: "horizontal", value: this.hour, min: b.hourMin, max: d, step: b.stepHour, slide: function (a, b) { c.hour_slider.slider("option", "value", b.value); c._onTimeChange() } }); this.minute_slider = u.find("#ui_tpicker_minute_" + h).slider({ orientation: "horizontal", value: this.minute, min: b.minuteMin, max: e, step: b.stepMinute, slide: function (a, b) { c.minute_slider.slider("option", "value", b.value); c._onTimeChange() } }); this.second_slider = u.find("#ui_tpicker_second_" + h).slider({ orientation: "horizontal", value: this.second, min: b.secondMin, max: f, step: b.stepSecond, slide: function (a, b) { c.second_slider.slider("option", "value", b.value); c._onTimeChange() } }); this.millisec_slider = u.find("#ui_tpicker_millisec_" + h).slider({ orientation: "horizontal", value: this.millisec, min: b.millisecMin, max: g, step: b.stepMillisec, slide: function (a, b) { c.millisec_slider.slider("option", "value", b.value); c._onTimeChange() } }); this.timezone_select = u.find("#ui_tpicker_timezone_" + h).append("<select></select>").find("select"); $.fn.append.apply(this.timezone_select, $.map(b.timezoneList, function (a, b) { return $("<option />").val(typeof a == "object" ? a.value : a).text(typeof a == "object" ? a.label : a) })); if (typeof this.timezone != "undefined" && this.timezone !== null && this.timezone !== "") { var v = new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12); var w = timeZoneString(v); if (w == this.timezone) { selectLocalTimeZone(c) } else { this.timezone_select.val(this.timezone) } } else { if (typeof this.hour != "undefined" && this.hour !== null && this.hour !== "") { this.timezone_select.val(b.defaultTimezone) } else { selectLocalTimeZone(c) } } this.timezone_select.change(function () { c._defaults.useLocalTimezone = false; c._onTimeChange() }); if (b.showHour && b.hourGrid > 0) { o = 100 * k * b.hourGrid / (d - b.hourMin); u.find(".ui_tpicker_hour table").css({ width: o + "%", marginLeft: o / (-2 * k) + "%", borderCollapse: "collapse" }).find("td").each(function (a) { $(this).click(function () { var a = $(this).html(); if (b.ampm) { var d = a.substring(2).toLowerCase(), e = parseInt(a.substring(0, 2), 10); if (d == "a") { if (e == 12) { a = 0 } else { a = e } } else if (e == 12) { a = 12 } else { a = e + 12 } } c.hour_slider.slider("option", "value", a); c._onTimeChange(); c._onSelectHandler() }).css({ cursor: "pointer", width: 100 / k + "%", textAlign: "center", overflow: "hidden" }) }) } if (b.showMinute && b.minuteGrid > 0) { o = 100 * l * b.minuteGrid / (e - b.minuteMin); u.find(".ui_tpicker_minute table").css({ width: o + "%", marginLeft: o / (-2 * l) + "%", borderCollapse: "collapse" }).find("td").each(function (a) { $(this).click(function () { c.minute_slider.slider("option", "value", $(this).html()); c._onTimeChange(); c._onSelectHandler() }).css({ cursor: "pointer", width: 100 / l + "%", textAlign: "center", overflow: "hidden" }) }) } if (b.showSecond && b.secondGrid > 0) { u.find(".ui_tpicker_second table").css({ width: o + "%", marginLeft: o / (-2 * m) + "%", borderCollapse: "collapse" }).find("td").each(function (a) { $(this).click(function () { c.second_slider.slider("option", "value", $(this).html()); c._onTimeChange(); c._onSelectHandler() }).css({ cursor: "pointer", width: 100 / m + "%", textAlign: "center", overflow: "hidden" }) }) } if (b.showMillisec && b.millisecGrid > 0) { u.find(".ui_tpicker_millisec table").css({ width: o + "%", marginLeft: o / (-2 * n) + "%", borderCollapse: "collapse" }).find("td").each(function (a) { $(this).click(function () { c.millisec_slider.slider("option", "value", $(this).html()); c._onTimeChange(); c._onSelectHandler() }).css({ cursor: "pointer", width: 100 / n + "%", textAlign: "center", overflow: "hidden" }) }) } var x = a.find(".ui-datepicker-buttonpane"); if (x.length) { x.before(u) } else { a.append(u) } this.$timeObj = u.find("#ui_tpicker_time_" + h); if (this.inst !== null) { var y = this.timeDefined; this._onTimeChange(); this.timeDefined = y } var z = function () { c._onSelectHandler() }; this.hour_slider.bind("slidestop", z); this.minute_slider.bind("slidestop", z); this.second_slider.bind("slidestop", z); this.millisec_slider.bind("slidestop", z); if (this._defaults.addSliderAccess) { var A = this._defaults.sliderAccessArgs; setTimeout(function () { if (u.find(".ui-slider-access").length === 0) { u.find(".ui-slider:visible").sliderAccess(A); var a = u.find(".ui-slider-access:eq(0)").outerWidth(true); if (a) { u.find("table:visible").each(function () { var b = $(this), c = b.outerWidth(), d = b.css("marginLeft").toString().replace("%", ""), e = c - a, f = d * e / c + "%"; b.css({ width: e, marginLeft: f }) }) } } }, 0) } } }, _limitMinMaxDateTime: function (a, b) { var c = this._defaults, d = new Date(a.selectedYear, a.selectedMonth, a.selectedDay); if (!this._defaults.showTimepicker) { return } if ($.datepicker._get(a, "minDateTime") !== null && $.datepicker._get(a, "minDateTime") !== undefined && d) { var e = $.datepicker._get(a, "minDateTime"), f = new Date(e.getFullYear(), e.getMonth(), e.getDate(), 0, 0, 0, 0); if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null) { this.hourMinOriginal = c.hourMin; this.minuteMinOriginal = c.minuteMin; this.secondMinOriginal = c.secondMin; this.millisecMinOriginal = c.millisecMin } if (a.settings.timeOnly || f.getTime() == d.getTime()) { this._defaults.hourMin = e.getHours(); if (this.hour <= this._defaults.hourMin) { this.hour = this._defaults.hourMin; this._defaults.minuteMin = e.getMinutes(); if (this.minute <= this._defaults.minuteMin) { this.minute = this._defaults.minuteMin; this._defaults.secondMin = e.getSeconds() } else if (this.second <= this._defaults.secondMin) { this.second = this._defaults.secondMin; this._defaults.millisecMin = e.getMilliseconds() } else { if (this.millisec < this._defaults.millisecMin) { this.millisec = this._defaults.millisecMin } this._defaults.millisecMin = this.millisecMinOriginal } } else { this._defaults.minuteMin = this.minuteMinOriginal; this._defaults.secondMin = this.secondMinOriginal; this._defaults.millisecMin = this.millisecMinOriginal } } else { this._defaults.hourMin = this.hourMinOriginal; this._defaults.minuteMin = this.minuteMinOriginal; this._defaults.secondMin = this.secondMinOriginal; this._defaults.millisecMin = this.millisecMinOriginal } } if ($.datepicker._get(a, "maxDateTime") !== null && $.datepicker._get(a, "maxDateTime") !== undefined && d) { var g = $.datepicker._get(a, "maxDateTime"), h = new Date(g.getFullYear(), g.getMonth(), g.getDate(), 0, 0, 0, 0); if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null) { this.hourMaxOriginal = c.hourMax; this.minuteMaxOriginal = c.minuteMax; this.secondMaxOriginal = c.secondMax; this.millisecMaxOriginal = c.millisecMax } if (a.settings.timeOnly || h.getTime() == d.getTime()) { this._defaults.hourMax = g.getHours(); if (this.hour >= this._defaults.hourMax) { this.hour = this._defaults.hourMax; this._defaults.minuteMax = g.getMinutes(); if (this.minute >= this._defaults.minuteMax) { this.minute = this._defaults.minuteMax; this._defaults.secondMax = g.getSeconds() } else if (this.second >= this._defaults.secondMax) { this.second = this._defaults.secondMax; this._defaults.millisecMax = g.getMilliseconds() } else { if (this.millisec > this._defaults.millisecMax) { this.millisec = this._defaults.millisecMax } this._defaults.millisecMax = this.millisecMaxOriginal } } else { this._defaults.minuteMax = this.minuteMaxOriginal; this._defaults.secondMax = this.secondMaxOriginal; this._defaults.millisecMax = this.millisecMaxOriginal } } else { this._defaults.hourMax = this.hourMaxOriginal; this._defaults.minuteMax = this.minuteMaxOriginal; this._defaults.secondMax = this.secondMaxOriginal; this._defaults.millisecMax = this.millisecMaxOriginal } } if (b !== undefined && b === true) { var i = parseInt(this._defaults.hourMax - (this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour, 10), j = parseInt(this._defaults.minuteMax - (this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute, 10), k = parseInt(this._defaults.secondMax - (this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond, 10), l = parseInt(this._defaults.millisecMax - (this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec, 10); if (this.hour_slider) { this.hour_slider.slider("option", { min: this._defaults.hourMin, max: i }).slider("value", this.hour) } if (this.minute_slider) { this.minute_slider.slider("option", { min: this._defaults.minuteMin, max: j }).slider("value", this.minute) } if (this.second_slider) { this.second_slider.slider("option", { min: this._defaults.secondMin, max: k }).slider("value", this.second) } if (this.millisec_slider) { this.millisec_slider.slider("option", { min: this._defaults.millisecMin, max: l }).slider("value", this.millisec) } } }, _onTimeChange: function () { var a = this.hour_slider ? this.hour_slider.slider("value") : false, b = this.minute_slider ? this.minute_slider.slider("value") : false, c = this.second_slider ? this.second_slider.slider("value") : false, d = this.millisec_slider ? this.millisec_slider.slider("value") : false, e = this.timezone_select ? this.timezone_select.val() : false, f = this._defaults; if (typeof a == "object") { a = false } if (typeof b == "object") { b = false } if (typeof c == "object") { c = false } if (typeof d == "object") { d = false } if (typeof e == "object") { e = false } if (a !== false) { a = parseInt(a, 10) } if (b !== false) { b = parseInt(b, 10) } if (c !== false) { c = parseInt(c, 10) } if (d !== false) { d = parseInt(d, 10) } var g = f[a < 12 ? "amNames" : "pmNames"][0]; var h = a != this.hour || b != this.minute || c != this.second || d != this.millisec || this.ampm.length > 0 && a < 12 != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1) || e != this.timezone; if (h) { if (a !== false) { this.hour = a } if (b !== false) { this.minute = b } if (c !== false) { this.second = c } if (d !== false) { this.millisec = d } if (e !== false) { this.timezone = e } if (!this.inst) { this.inst = $.datepicker._getInst(this.$input[0]) } this._limitMinMaxDateTime(this.inst, true) } if (f.ampm) { this.ampm = g } this.formattedTime = $.datepicker.formatTime(this._defaults.timeFormat, this, this._defaults); if (this.$timeObj) { this.$timeObj.text(this.formattedTime + f.timeSuffix) } this.timeDefined = true; if (h) { this._updateDateTime() } }, _onSelectHandler: function () { var a = this._defaults.onSelect; var b = this.$input ? this.$input[0] : null; if (a && b) { a.apply(b, [this.formattedDateTime, this]) } }, _formatTime: function (a, b) { a = a || { hour: this.hour, minute: this.minute, second: this.second, millisec: this.millisec, ampm: this.ampm, timezone: this.timezone }; var c = (b || this._defaults.timeFormat).toString(); c = $.datepicker.formatTime(c, a, this._defaults); if (arguments.length) { return c } else { this.formattedTime = c } }, _updateDateTime: function (a) { a = this.inst || a; var b = $.datepicker._daylightSavingAdjust(new Date(a.selectedYear, a.selectedMonth, a.selectedDay)), c = $.datepicker._get(a, "dateFormat"), d = $.datepicker._getFormatConfig(a), e = b !== null && this.timeDefined; this.formattedDate = $.datepicker.formatDate(c, b === null ? new Date : b, d); var f = this.formattedDate; if (this._defaults.timeOnly === true) { f = this.formattedTime } else if (this._defaults.timeOnly !== true && (this._defaults.alwaysSetTime || e)) { f += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix } this.formattedDateTime = f; if (!this._defaults.showTimepicker) { this.$input.val(this.formattedDate) } else if (this.$altInput && this._defaults.altFieldTimeOnly === true) { this.$altInput.val(this.formattedTime); this.$input.val(this.formattedDate) } else if (this.$altInput) { this.$altInput.val(f); this.$input.val(f) } else { this.$input.val(f) } this.$input.trigger("change") } }); $.fn.extend({ timepicker: function (a) { a = a || {}; var b = arguments; if (typeof a == "object") { b[0] = $.extend(a, { timeOnly: true }) } return $(this).each(function () { $.fn.datetimepicker.apply($(this), b) }) }, datetimepicker: function (a) { a = a || {}; var b = arguments; if (typeof a == "string") { if (a == "getDate") { return $.fn.datepicker.apply($(this[0]), b) } else { return this.each(function () { var a = $(this); a.datepicker.apply(a, b) }) } } else { return this.each(function () { var b = $(this); b.datepicker($.timepicker._newInst(b, a)._defaults) }) } } }); $.datepicker.parseDateTime = function (a, b, c, d, e) { var f = parseDateTimeInternal(a, b, c, d, e); if (f.timeObj) { var g = f.timeObj; f.date.setHours(g.hour, g.minute, g.second, g.millisec) } return f.date }; $.datepicker.parseTime = function (a, b, c) { var d = function (a, b) { var c = []; if (a) { $.merge(c, a) } if (b) { $.merge(c, b) } c = $.map(c, function (a) { return a.replace(/[.*+?|()\[\]{}\\]/g, "\\$&") }); return "(" + c.join("|") + ")?" }; var e = function (a) { var b = a.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g), c = { h: -1, m: -1, s: -1, l: -1, t: -1, z: -1 }; if (b) { for (var d = 0; d < b.length; d++) { if (c[b[d].toString().charAt(0)] == -1) { c[b[d].toString().charAt(0)] = d + 1 } } } return c }; var f = extendRemove(extendRemove({}, $.timepicker._defaults), c || {}); var g = "^" + a.toString().replace(/h{1,2}/ig, "(\\d?\\d)").replace(/m{1,2}/ig, "(\\d?\\d)").replace(/s{1,2}/ig, "(\\d?\\d)").replace(/l{1}/ig, "(\\d?\\d?\\d)").replace(/t{1,2}/ig, d(f.amNames, f.pmNames)).replace(/z{1}/ig, "(z|[-+]\\d\\d:?\\d\\d)?").replace(/\s/g, "\\s?") + f.timeSuffix + "$", h = e(a), i = "", j; j = b.match(new RegExp(g, "i")); var k = { hour: 0, minute: 0, second: 0, millisec: 0 }; if (j) { if (h.t !== -1) { if (j[h.t] === undefined || j[h.t].length === 0) { i = ""; k.ampm = "" } else { i = $.inArray(j[h.t], f.amNames) !== -1 ? "AM" : "PM"; k.ampm = f[i == "AM" ? "amNames" : "pmNames"][0] } } if (h.h !== -1) { if (i == "AM" && j[h.h] == "12") { k.hour = 0 } else { if (i == "PM" && j[h.h] != "12") { k.hour = parseInt(j[h.h], 10) + 12 } else { k.hour = Number(j[h.h]) } } } if (h.m !== -1) { k.minute = Number(j[h.m]) } if (h.s !== -1) { k.second = Number(j[h.s]) } if (h.l !== -1) { k.millisec = Number(j[h.l]) } if (h.z !== -1 && j[h.z] !== undefined) { var l = j[h.z].toUpperCase(); switch (l.length) { case 1: l = f.timezoneIso8601 ? "Z" : "+0000"; break; case 5: if (f.timezoneIso8601) { l = l.substring(1) == "0000" ? "Z" : l.substring(0, 3) + ":" + l.substring(3) } break; case 6: if (!f.timezoneIso8601) { l = l == "Z" || l.substring(1) == "00:00" ? "+0000" : l.replace(/:/, "") } else { if (l.substring(1) == "00:00") { l = "Z" } } break } k.timezone = l } return k } return false }; $.datepicker.formatTime = function (a, b, c) { c = c || {}; c = $.extend($.timepicker._defaults, c); b = $.extend({ hour: 0, minute: 0, second: 0, millisec: 0, timezone: "+0000" }, b); var d = a; var e = c.amNames[0]; var f = parseInt(b.hour, 10); if (c.ampm) { if (f > 11) { e = c.pmNames[0]; if (f > 12) { f = f % 12 } } if (f === 0) { f = 12 } } d = d.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz])/g, function (a) { switch (a.toLowerCase()) { case "hh": return ("0" + f).slice(-2); case "h": return f; case "mm": return ("0" + b.minute).slice(-2); case "m": return b.minute; case "ss": return ("0" + b.second).slice(-2); case "s": return b.second; case "l": return ("00" + b.millisec).slice(-3); case "z": return b.timezone; case "t": case "tt": if (c.ampm) { if (a.length == 1) { e = e.charAt(0) } return a.charAt(0) == "T" ? e.toUpperCase() : e.toLowerCase() } return "" } }); d = $.trim(d); return d }; $.datepicker._base_selectDate = $.datepicker._selectDate; $.datepicker._selectDate = function (a, b) { var c = this._getInst($(a)[0]), d = this._get(c, "timepicker"); if (d) { d._limitMinMaxDateTime(c, true); c.inline = c.stay_open = true; this._base_selectDate(a, b); c.inline = c.stay_open = false; this._notifyChange(c); this._updateDatepicker(c) } else { this._base_selectDate(a, b) } }; $.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker; $.datepicker._updateDatepicker = function (a) { var b = a.input[0]; if ($.datepicker._curInst && $.datepicker._curInst != a && $.datepicker._datepickerShowing && $.datepicker._lastInput != b) { return } if (typeof a.stay_open !== "boolean" || a.stay_open === false) { this._base_updateDatepicker(a); var c = this._get(a, "timepicker"); if (c) { c._addTimePicker(a); if (c._defaults.useLocalTimezone) { var d = new Date(a.selectedYear, a.selectedMonth, a.selectedDay, 12); selectLocalTimeZone(c, d); c._onTimeChange() } } } }; $.datepicker._base_doKeyPress = $.datepicker._doKeyPress; $.datepicker._doKeyPress = function (a) { var b = $.datepicker._getInst(a.target), c = $.datepicker._get(b, "timepicker"); if (c) { if ($.datepicker._get(b, "constrainInput")) { var d = c._defaults.ampm, e = $.datepicker._possibleChars($.datepicker._get(b, "dateFormat")), f = c._defaults.timeFormat.toString().replace(/[hms]/g, "").replace(/TT/g, d ? "APM" : "").replace(/Tt/g, d ? "AaPpMm" : "").replace(/tT/g, d ? "AaPpMm" : "").replace(/T/g, d ? "AP" : "").replace(/tt/g, d ? "apm" : "").replace(/t/g, d ? "ap" : "") + " " + c._defaults.separator + c._defaults.timeSuffix + (c._defaults.showTimezone ? c._defaults.timezoneList.join("") : "") + c._defaults.amNames.join("") + c._defaults.pmNames.join("") + e, g = String.fromCharCode(a.charCode === undefined ? a.keyCode : a.charCode); return a.ctrlKey || g < " " || !e || f.indexOf(g) > -1 } } return $.datepicker._base_doKeyPress(a) }; $.datepicker._base_doKeyUp = $.datepicker._doKeyUp; $.datepicker._doKeyUp = function (a) { var b = $.datepicker._getInst(a.target), c = $.datepicker._get(b, "timepicker"); if (c) { if (c._defaults.timeOnly && b.input.val() != b.lastVal) { try { $.datepicker._updateDatepicker(b) } catch (d) { $.datepicker.log(d) } } } return $.datepicker._base_doKeyUp(a) }; $.datepicker._base_gotoToday = $.datepicker._gotoToday; $.datepicker._gotoToday = function (a) { var b = this._getInst($(a)[0]), c = b.dpDiv; this._base_gotoToday(a); var d = this._get(b, "timepicker"); selectLocalTimeZone(d); var e = new Date; this._setTime(b, e); $(".ui-datepicker-today", c).click() }; $.datepicker._disableTimepickerDatepicker = function (a) { var b = this._getInst(a); if (!b) { return } var c = this._get(b, "timepicker"); $(a).datepicker("getDate"); if (c) { c._defaults.showTimepicker = false; c._updateDateTime(b) } }; $.datepicker._enableTimepickerDatepicker = function (a) { var b = this._getInst(a); if (!b) { return } var c = this._get(b, "timepicker"); $(a).datepicker("getDate"); if (c) { c._defaults.showTimepicker = true; c._addTimePicker(b); c._updateDateTime(b) } }; $.datepicker._setTime = function (a, b) { var c = this._get(a, "timepicker"); if (c) { var d = c._defaults, e = b ? b.getHours() : d.hour, f = b ? b.getMinutes() : d.minute, g = b ? b.getSeconds() : d.second, h = b ? b.getMilliseconds() : d.millisec; var i = e === d.hourMin, j = f === d.minuteMin, k = g === d.secondMin; var l = false; if (e < d.hourMin || e > d.hourMax) l = true; else if ((f < d.minuteMin || f > d.minuteMax) && i) l = true; else if ((g < d.secondMin || g > d.secondMax) && i && j) l = true; else if ((h < d.millisecMin || h > d.millisecMax) && i && j && k) l = true; if (l) { e = d.hourMin; f = d.minuteMin; g = d.secondMin; h = d.millisecMin } c.hour = e; c.minute = f; c.second = g; c.millisec = h; if (c.hour_slider) c.hour_slider.slider("value", e); if (c.minute_slider) c.minute_slider.slider("value", f); if (c.second_slider) c.second_slider.slider("value", g); if (c.millisec_slider) c.millisec_slider.slider("value", h); c._onTimeChange(); c._updateDateTime(a) } }; $.datepicker._setTimeDatepicker = function (a, b, c) { var d = this._getInst(a); if (!d) { return } var e = this._get(d, "timepicker"); if (e) { this._setDateFromField(d); var f; if (b) { if (typeof b == "string") { e._parseTime(b, c); f = new Date; f.setHours(e.hour, e.minute, e.second, e.millisec) } else { f = new Date(b.getTime()) } if (f.toString() == "Invalid Date") { f = undefined } this._setTime(d, f) } } }; $.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker; $.datepicker._setDateDatepicker = function (a, b) { var c = this._getInst(a); if (!c) { return } var d = b instanceof Date ? new Date(b.getTime()) : b; this._updateDatepicker(c); this._base_setDateDatepicker.apply(this, arguments); this._setTimeDatepicker(a, d, true) }; $.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker; $.datepicker._getDateDatepicker = function (a, b) { var c = this._getInst(a); if (!c) { return } var d = this._get(c, "timepicker"); if (d) { this._setDateFromField(c, b); var e = this._getDate(c); if (e && d._parseTime($(a).val(), d.timeOnly)) { e.setHours(d.hour, d.minute, d.second, d.millisec) } return e } return this._base_getDateDatepicker(a, b) }; $.datepicker._base_parseDate = $.datepicker.parseDate; $.datepicker.parseDate = function (a, b, c) { var d = splitDateTime(a, b, c); return $.datepicker._base_parseDate(a, d[0], c) }; $.datepicker._base_formatDate = $.datepicker._formatDate; $.datepicker._formatDate = function (a, b, c, d) { var e = this._get(a, "timepicker"); if (e) { e._updateDateTime(a); return e.$input.val() } return this._base_formatDate(a) }; $.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker; $.datepicker._optionDatepicker = function (a, b, c) { var d = this._getInst(a); if (!d) { return null } var e = this._get(d, "timepicker"); if (e) { var f = null, g = null, h = null; if (typeof b == "string") { if (b === "minDate" || b === "minDateTime") { f = c } else { if (b === "maxDate" || b === "maxDateTime") { g = c } else { if (b === "onSelect") { h = c } } } } else { if (typeof b == "object") { if (b.minDate) { f = b.minDate } else { if (b.minDateTime) { f = b.minDateTime } else { if (b.maxDate) { g = b.maxDate } else { if (b.maxDateTime) { g = b.maxDateTime } } } } } } if (f) { if (f === 0) { f = new Date } else { f = new Date(f) } e._defaults.minDate = f; e._defaults.minDateTime = f } else if (g) { if (g === 0) { g = new Date } else { g = new Date(g) } e._defaults.maxDate = g; e._defaults.maxDateTime = g } else if (h) { e._defaults.onSelect = h } } if (c === undefined) { return this._base_optionDatepicker(a, b) } return this._base_optionDatepicker(a, b, c) }; var splitDateTime = function (a, b, c) { try { var d = $.datepicker._base_parseDate(a, b, c) } catch (e) { if (e.indexOf(":") >= 0) { var f = b.length - (e.length - e.indexOf(":") - 2); var g = b.substring(f); return [b.substring(0, f), b.substring(f)] } else { throw e } } return [b, ""] }; var parseDateTimeInternal = function (a, b, c, d, e) { var f; var g = splitDateTime(a, c, d); f = $.datepicker._base_parseDate(a, g[0], d); if (g[1] !== "") { var h = g[1]; var i = e && e.separator ? e.separator : $.timepicker._defaults.separator; if (h.indexOf(i) !== 0) { throw "Missing time separator" } h = h.substring(i.length); var j = $.datepicker.parseTime(b, h, e); if (j === null) { throw "Wrong time format" } return { date: f, timeObj: j } } else { return { date: f } } }; var selectLocalTimeZone = function (a, b) { if (a && a.timezone_select) { a._defaults.useLocalTimezone = true; var c = typeof b !== "undefined" ? b : new Date; var d = timeZoneString(c); if (a._defaults.timezoneIso8601) { d = d.substring(0, 3) + ":" + d.substring(3) } a.timezone_select.val(d) } }; var timeZoneString = function (a) { var b = a.getTimezoneOffset() * -10100 / 60; var c = (b >= 0 ? "+" : "-") + Math.abs(b).toString().substr(1); return c }; $.timepicker = new Timepicker; $.timepicker.version = "1.0.1" })(jQuery)