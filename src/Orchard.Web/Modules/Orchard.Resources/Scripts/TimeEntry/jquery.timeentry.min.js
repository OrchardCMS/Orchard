!function(e){var t="timeEntry";e.JQPlugin.createPlugin({name:t,defaultOptions:{appendText:"",showSeconds:!1,unlimitedHours:!1,timeSteps:[1,1,1],initialField:null,noSeparatorEntry:!1,tabToExit:!1,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},regionalOptions:{"":{show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]}},_getters:["getOffset","getTime","isDisabled"],_appendClass:t+"-append",_controlClass:t+"-control",_expandClass:t+"-expand",_disabledInputs:[],_instSettings:function(e,t){return{_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0}},_postAttach:function(e,t){e.on("focus."+t.name,this._doFocus).on("blur."+t.name,this._doBlur).on("click."+t.name,this._doClick).on("keydown."+t.name,this._doKeyDown).on("keypress."+t.name,this._doKeyPress).on("paste."+t.name,function(e){setTimeout(function(){n._parseTime(t)},1)})},_optionsChanged:function(t,n,i){var s=this._extractTime(n);e.extend(n.options,i),n.options.show24Hours=n.options.show24Hours||n.options.unlimitedHours,n._field=0,s&&this._setTime(n,new Date(0,0,0,s[0],s[1],s[2])),t.next("span."+this._appendClass).remove(),t.parent().find("span."+this._controlClass).remove(),e.fn.mousewheel&&t.unmousewheel();var o=n.options.spinnerImage?e('<span class="'+this._controlClass+'" style="display: inline-block; background: url(\''+n.options.spinnerImage+"') 0 0 no-repeat; width: "+n.options.spinnerSize[0]+"px; height: "+n.options.spinnerSize[1]+'px;"></span>'):null;t.after(n.options.appendText?'<span class="'+this._appendClass+'">'+n.options.appendText+"</span>":"").after(o||""),n.options.useMouseWheel&&e.fn.mousewheel&&t.mousewheel(this._doMouseWheel),o&&o.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)},enable:function(e){this._enableDisable(e,!1)},disable:function(e){this._enableDisable(e,!0)},_enableDisable:function(t,n){var i=this._getInst(t);i&&(t.disabled=n,t.nextSibling&&"span"===t.nextSibling.nodeName.toLowerCase()&&this._changeSpinner(i,t.nextSibling,n?5:-1),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),n&&this._disabledInputs.push(t))},isDisabled:function(t){return e.inArray(t,this._disabledInputs)>-1},_preDestroy:function(n,i){n=e(n).off("."+t),e.fn.mousewheel&&n.unmousewheel(),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===n[0]?null:e}),n.siblings("."+this._appendClass+",."+this._controlClass).remove()},setTime:function(t,n){var i=this._getInst(t);i&&(null===n||""===n?e(t).val(""):this._setTime(i,n?e.isArray(n)?n:"object"==typeof n?new Date(n.getTime()):n:null))},getTime:function(e){var t=this._getInst(e),n=t?this._extractTime(t):null;return n?new Date(0,0,0,n[0],n[1],n[2]):null},getOffset:function(e){var t=this._getInst(e),n=t?this._extractTime(t):null;return n?1e3*(3600*n[0]+60*n[1]+n[2]):0},_doFocus:function(t){var i=t.nodeName&&"input"===t.nodeName.toLowerCase()?t:this;if(n._lastInput===i||n.isDisabled(i))return void(n._focussed=!1);var s=n._getInst(i);n._focussed=!0,n._lastInput=i,n._blurredInput=null,e.extend(s.options,e.isFunction(s.options.beforeShow)?s.options.beforeShow.apply(i,[i]):{}),n._parseTime(s,t.nodeName?null:t),setTimeout(function(){n._showField(s)},10)},_doBlur:function(e){n._blurredInput=n._lastInput,n._lastInput=null},_doClick:function(e){var t=e.target,i=n._getInst(t),s=i._field;n._focussed||(i._field=n._getSelection(i,t,e)),s!==i._field&&(i._lastChr=""),n._showField(i),n._focussed=!1},_getSelection:function(t,n,i){var s=0,o=[t.elem.val().split(t.options.separator)[0].length,2,2];if(null!==n.selectionStart)for(var a=0,r=0;r<=Math.max(1,t._secondField,t._ampmField)&&(a+=r!==t._ampmField?o[r]+t.options.separator.length:t.options.ampmPrefix.length+t.options.ampmNames[0].length,s=r,!(n.selectionStart<a));r++);else if(n.createTextRange&&null!=i)for(var l=e(i.srcElement),p=n.createTextRange(),u=function(e){return{thin:2,medium:4,thick:6}[e]||e},d=i.clientX+document.documentElement.scrollLeft-(l.offset().left+parseInt(u(l.css("border-left-width")),10))-p.offsetLeft,r=0;r<=Math.max(1,t._secondField,t._ampmField);r++){var a=r!==t._ampmField?r*fieldSize+2:t._ampmField*fieldSize+t.options.ampmPrefix.length+t.options.ampmNames[0].length;if(p.collapse(),p.moveEnd("character",a),s=r,d<p.boundingWidth)break}return s},_doKeyDown:function(e){if(e.keyCode>=48)return!0;var t=n._getInst(e.target);switch(e.keyCode){case 9:return t.options.tabToExit?!0:e.shiftKey?n._changeField(t,-1,!0):n._changeField(t,1,!0);case 35:e.ctrlKey?n._setValue(t,""):(t._field=Math.max(1,t._secondField,t._ampmField),n._adjustField(t,0));break;case 36:e.ctrlKey?n._setTime(t):(t._field=0,n._adjustField(t,0));break;case 37:n._changeField(t,-1,!1);break;case 38:n._adjustField(t,1);break;case 39:n._changeField(t,1,!1);break;case 40:n._adjustField(t,-1);break;case 46:n._setValue(t,"");break;case 8:t._lastChr="";default:return!0}return!1},_doKeyPress:function(e){var t=String.fromCharCode(void 0===e.charCode?e.keyCode:e.charCode);if(" ">t)return!0;var i=n._getInst(e.target);return n._handleKeyPress(i,t),!1},_handleKeyPress:function(e,t){if(t===e.options.separator)this._changeField(e,1,!1);else if(t>="0"&&"9">=t){var n=parseInt(t,10),i=parseInt(e._lastChr+t,10),s=0!==e._field?e._selectedHour:e.options.unlimitedHours?i:e.options.show24Hours?24>i?i:n:(i>=1&&12>=i?i:n>0?n:e._selectedHour)%12+(e._selectedHour>=12?12:0),o=1!==e._field?e._selectedMinute:60>i?i:n,a=e._field!==e._secondField?e._selectedSecond:60>i?i:n,r=this._constrainTime(e,[s,o,a]);this._setTime(e,e.options.unlimitedHours?r:new Date(0,0,0,r[0],r[1],r[2])),e.options.noSeparatorEntry&&e._lastChr?this._changeField(e,1,!1):e._lastChr=e.options.unlimitedHours&&0===e._field?e._lastChr+t:t}else if(!e.options.show24Hours&&(t=t.toLowerCase(),t===e.options.ampmNames[0].substring(0,1).toLowerCase()&&e._selectedHour>=12||t===e.options.ampmNames[1].substring(0,1).toLowerCase()&&e._selectedHour<12)){var l=e._field;e._field=e._ampmField,this._adjustField(e,1),e._field=l,this._showField(e)}},_doMouseWheel:function(e,t){if(!n.isDisabled(e.target)){var i=n._getInst(e.target);i.elem.focus(),i.elem.val()||n._parseTime(i),n._adjustField(i,t),e.preventDefault()}},_expandSpinner:function(t){var i=n._getSpinnerTarget(t),s=n._getInst(n._getInput(i));if(!n.isDisabled(s.elem[0])&&s.options.spinnerBigImage){s._expanded=!0;var o=e(i).offset(),a=null;e(i).parents().each(function(){var t=e(this);return("relative"===t.css("position")||"absolute"===t.css("position"))&&(a=t.offset()),!a}),e('<div class="'+n._expandClass+'" style="position: absolute; left: '+(o.left-(s.options.spinnerBigSize[0]-s.options.spinnerSize[0])/2-(a?a.left:0))+"px; top: "+(o.top-(s.options.spinnerBigSize[1]-s.options.spinnerSize[1])/2-(a?a.top:0))+"px; width: "+s.options.spinnerBigSize[0]+"px; height: "+s.options.spinnerBigSize[1]+"px; background: transparent url("+s.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(n._handleSpinner).mouseup(n._endSpinner).mouseout(n._endExpand).mousemove(n._describeSpinner).insertAfter(i)}},_getInput:function(t){return e(t).siblings("."+this._getMarker())[0]},_describeSpinner:function(e){var t=n._getSpinnerTarget(e),i=n._getInst(n._getInput(t));t.title=i.options.spinnerTexts[n._getSpinnerRegion(i,e)]},_handleSpinner:function(t){var i=n._getSpinnerTarget(t),s=n._getInput(i);if(!n.isDisabled(s)){s===n._blurredInput&&(n._lastInput=s,n._blurredInput=null);var o=n._getInst(s);n._doFocus(s);var a=n._getSpinnerRegion(o,t);n._changeSpinner(o,i,a),n._actionSpinner(o,a),n._timer=null,n._handlingSpinner=!0,a>=3&&o.options.spinnerRepeat[0]&&(n._timer=setTimeout(function(){n._repeatSpinner(o,a)},o.options.spinnerRepeat[0]),e(i).one("mouseout",n._releaseSpinner).one("mouseup",n._releaseSpinner))}},_actionSpinner:function(e,t){switch(e.elem.val()||n._parseTime(e),t){case 0:this._setTime(e);break;case 1:this._changeField(e,-1,!1);break;case 2:this._changeField(e,1,!1);break;case 3:this._adjustField(e,1);break;case 4:this._adjustField(e,-1)}},_repeatSpinner:function(e,t){n._timer&&(n._lastInput=n._blurredInput,this._actionSpinner(e,t),this._timer=setTimeout(function(){n._repeatSpinner(e,t)},e.options.spinnerRepeat[1]))},_releaseSpinner:function(e){clearTimeout(n._timer),n._timer=null},_endExpand:function(t){n._timer=null;var i=n._getSpinnerTarget(t),s=n._getInput(i),o=n._getInst(s);e(i).remove(),o._expanded=!1},_endSpinner:function(e){n._timer=null;var t=n._getSpinnerTarget(e),i=n._getInput(t),s=n._getInst(i);n.isDisabled(i)||n._changeSpinner(s,t,-1),n._handlingSpinner&&(n._lastInput=n._blurredInput),n._lastInput&&n._handlingSpinner&&n._showField(s),n._handlingSpinner=!1},_getSpinnerTarget:function(e){return e.target||e.srcElement},_getSpinnerRegion:function(t,n){var i=this._getSpinnerTarget(n),s=e(i).offset(),o=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],a=t.options.spinnerIncDecOnly?99:n.clientX+o[0]-s.left,r=n.clientY+o[1]-s.top,l=t.options[t._expanded?"spinnerBigSize":"spinnerSize"],p=t.options.spinnerIncDecOnly?99:l[0]-1-a,u=l[1]-1-r;if(l[2]>0&&Math.abs(a-p)<=l[2]&&Math.abs(r-u)<=l[2])return 0;var d=Math.min(a,r,p,u);return d===a?1:d===p?2:d===r?3:4},_changeSpinner:function(t,n,i){e(n).css("background-position","-"+(i+1)*t.options[t._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(e,t){var i=this._extractTime(e);if(i)e._selectedHour=i[0],e._selectedMinute=i[1],e._selectedSecond=i[2];else{var s=this._constrainTime(e);e._selectedHour=s[0],e._selectedMinute=s[1],e._selectedSecond=e.options.showSeconds?s[2]:0}e._secondField=e.options.showSeconds?2:-1,e._ampmField=e.options.show24Hours?-1:e.options.showSeconds?3:2,e._lastChr="";var o=function(){""!==e.elem.val()&&n._showTime(e)};"number"==typeof e.options.initialField?(e._field=Math.max(0,Math.min(Math.max(1,e._secondField,e._ampmField),e.options.initialField)),o()):setTimeout(function(){e._field=n._getSelection(e,e.elem[0],t),o()},0)},_extractTime:function(e,t){t=t||e.elem.val();var n=t.split(e.options.separator);if(""===e.options.separator&&""!==t&&(n[0]=t.substring(0,2),n[1]=t.substring(2,4),n[2]=t.substring(4,6)),n.length>=2){var i=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[0])>-1,s=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[1])>-1,o=parseInt(n[0],10);o=isNaN(o)?0:o,o=((i||s)&&12===o?0:o)+(s?12:0);var a=parseInt(n[1],10);a=isNaN(a)?0:a;var r=n.length>=3?parseInt(n[2],10):0;return r=isNaN(r)||!e.options.showSeconds?0:r,this._constrainTime(e,[o,a,r])}return null},_constrainTime:function(e,t){var n=null!==t&&void 0!==t;if(!n){var i=this._determineTime(e.options.defaultTime,e)||new Date;t=[i.getHours(),i.getMinutes(),i.getSeconds()]}for(var s=!1,o=0;o<e.options.timeSteps.length;o++)s?t[o]=0:e.options.timeSteps[o]>1&&(t[o]=Math.round(t[o]/e.options.timeSteps[o])*e.options.timeSteps[o],s=!0);return t},_showTime:function(e){var t=(e.options.unlimitedHours?e._selectedHour:this._formatNumber(e.options.show24Hours?e._selectedHour:(e._selectedHour+11)%12+1))+e.options.separator+this._formatNumber(e._selectedMinute)+(e.options.showSeconds?e.options.separator+this._formatNumber(e._selectedSecond):"")+(e.options.show24Hours?"":e.options.ampmPrefix+e.options.ampmNames[e._selectedHour<12?0:1]);this._setValue(e,t),this._showField(e)},_showField:function(e){var t=e.elem[0];if(!e.elem.is(":hidden")&&n._lastInput===t){for(var i=[e.elem.val().split(e.options.separator)[0].length,2,2],s=0,o=0;o<e._field;)s+=i[o]+(o===Math.max(1,e._secondField)?0:e.options.separator.length),o++;var a=s+(e._field!==e._ampmField?i[o]:e.options.ampmPrefix.length+e.options.ampmNames[0].length);if(t.setSelectionRange)t.setSelectionRange(s,a);else if(t.createTextRange){var r=t.createTextRange();r.moveStart("character",s),r.moveEnd("character",a-e.elem.val().length),r.select()}t.disabled||t.focus()}},_formatNumber:function(e){return(10>e?"0":"")+e},_setValue:function(e,t){t!==e.elem.val()&&e.elem.val(t).trigger("change")},_changeField:function(e,t,n){var i=""===e.elem.val()||e._field===(-1===t?0:Math.max(1,e._secondField,e._ampmField));return i||(e._field+=t),this._showField(e),e._lastChr="",i&&n},_adjustField:function(e,t){""===e.elem.val()&&(t=0),e.options.unlimitedHours?this._setTime(e,[e._selectedHour+(0===e._field?t*e.options.timeSteps[0]:0),e._selectedMinute+(1===e._field?t*e.options.timeSteps[1]:0),e._selectedSecond+(e._field===e._secondField?t*e.options.timeSteps[2]:0)]):this._setTime(e,new Date(0,0,0,e._selectedHour+(0===e._field?t*e.options.timeSteps[0]:0)+(e._field===e._ampmField?12*t:0),e._selectedMinute+(1===e._field?t*e.options.timeSteps[1]:0),e._selectedSecond+(e._field===e._secondField?t*e.options.timeSteps[2]:0)))},_setTime:function(t,n){if(t.options.unlimitedHours&&e.isArray(n))var i=n;else{n=this._determineTime(n,t);var i=n?[n.getHours(),n.getMinutes(),n.getSeconds()]:null}i=this._constrainTime(t,i),n=new Date(0,0,0,i[0],i[1],i[2]);var n=this._normaliseTime(n),s=this._normaliseTime(this._determineTime(t.options.minTime,t)),o=this._normaliseTime(this._determineTime(t.options.maxTime,t));if(t.options.unlimitedHours){for(;i[2]<0;)i[2]+=60,i[1]--;for(;i[2]>59;)i[2]-=60,i[1]++;for(;i[1]<0;)i[1]+=60,i[0]--;for(;i[1]>59;)i[1]-=60,i[0]++;s=null!=t.options.minTime&&e.isArray(t.options.minTime)?t.options.minTime:[0,0,0],i[0]<s[0]?i=s.slice(0,3):i[0]===s[0]&&(i[1]<s[1]?(i[1]=s[1],i[2]=s[2]):i[1]===s[1]&&i[2]<s[2]&&(i[2]=s[2])),null!=t.options.maxTime&&e.isArray(t.options.maxTime)&&(i[0]>t.options.maxTime[0]?i=t.options.maxTime.slice(0,3):i[0]===t.options.maxTime[0]&&(i[1]>t.options.maxTime[1]?(i[1]=t.options.maxTime[1],i[2]=t.options.maxTime[2]):i[1]===t.options.maxTime[1]&&i[2]>t.options.maxTime[2]&&(i[2]=t.options.maxTime[2])))}else s&&o&&s>o?s>n&&n>o&&(n=Math.abs(n-s)<Math.abs(n-o)?s:o):n=s&&s>n?s:o&&n>o?o:n,i[0]=n.getHours(),i[1]=n.getMinutes(),i[2]=n.getSeconds();e.isFunction(t.options.beforeSetTime)&&(n=t.options.beforeSetTime.apply(t.elem[0],[this.getTime(t.elem[0]),n,s,o]),i[0]=n.getHours(),i[1]=n.getMinutes(),i[2]=n.getSeconds()),t._selectedHour=i[0],t._selectedMinute=i[1],t._selectedSecond=i[2],this._showTime(t)},_determineTime:function(t,i){var s=function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},o=function(e){var t=n._extractTime(i,e),s=new Date,o=t?t[0]:s.getHours(),a=t?t[1]:s.getMinutes(),r=t?t[2]:s.getSeconds();if(!t)for(var l=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,p=l.exec(e);p;){switch(p[2]||"s"){case"s":case"S":r+=parseInt(p[1],10);break;case"m":case"M":a+=parseInt(p[1],10);break;case"h":case"H":o+=parseInt(p[1],10)}p=l.exec(e)}return s=new Date(0,0,10,o,a,r,0),/^!/.test(e)&&(s.getDate()>10?s=new Date(0,0,10,23,59,59):s.getDate()<10&&(s=new Date(0,0,10,0,0,0))),s},a=function(e){return new Date(0,0,0,e[0],e[1]||0,e[2]||0,0)};return t?"string"==typeof t?o(t):"number"==typeof t?s(t):e.isArray(t)?a(t):t:null},_normaliseTime:function(e){return e?(e.setFullYear(1900),e.setMonth(0),e.setDate(0),e):null}});var n=e.timeEntry}(jQuery);