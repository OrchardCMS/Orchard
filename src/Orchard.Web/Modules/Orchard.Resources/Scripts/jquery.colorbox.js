/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/*!
	Colorbox 1.6.3
	license: MIT
	http://www.jacklmoore.com/colorbox
*/
(function ($, document, window) {
	var
	// Default settings object.
	// See http://jacklmoore.com/colorbox for details.
	defaults = {
		// data sources
		html: false,
		photo: false,
		iframe: false,
		inline: false,

		// behavior and appearance
		transition: "elastic",
		speed: 300,
		fadeOut: 300,
		width: false,
		initialWidth: "600",
		innerWidth: false,
		maxWidth: false,
		height: false,
		initialHeight: "450",
		innerHeight: false,
		maxHeight: false,
		scalePhotos: true,
		scrolling: true,
		opacity: 0.9,
		preloading: true,
		className: false,
		overlayClose: true,
		escKey: true,
		arrowKey: true,
		top: false,
		bottom: false,
		left: false,
		right: false,
		fixed: false,
		data: undefined,
		closeButton: true,
		fastIframe: true,
		open: false,
		reposition: true,
		loop: true,
		slideshow: false,
		slideshowAuto: true,
		slideshowSpeed: 2500,
		slideshowStart: "start slideshow",
		slideshowStop: "stop slideshow",
		photoRegex: /\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,

		// alternate image paths for high-res displays
		retinaImage: false,
		retinaUrl: false,
		retinaSuffix: '@2x.$1',

		// internationalization
		current: "image {current} of {total}",
		previous: "previous",
		next: "next",
		close: "close",
		xhrError: "This content failed to load.",
		imgError: "This image failed to load.",

		// accessbility
		returnFocus: true,
		trapFocus: true,

		// callbacks
		onOpen: false,
		onLoad: false,
		onComplete: false,
		onCleanup: false,
		onClosed: false,

		rel: function() {
			return this.rel;
		},
		href: function() {
			// using this.href would give the absolute url, when the href may have been inteded as a selector (e.g. '#container')
			return $(this).attr('href');
		},
		title: function() {
			return this.title;
		},
		createImg: function() {
			var img = new Image();
			var attrs = $(this).data('cbox-img-attrs');

			if (typeof attrs === 'object') {
				$.each(attrs, function(key, val){
					img[key] = val;
				});
			}

			return img;
		},
		createIframe: function() {
			var iframe = document.createElement('iframe');
			var attrs = $(this).data('cbox-iframe-attrs');

			if (typeof attrs === 'object') {
				$.each(attrs, function(key, val){
					iframe[key] = val;
				});
			}

			if ('frameBorder' in iframe) {
				iframe.frameBorder = 0;
			}
			if ('allowTransparency' in iframe) {
				iframe.allowTransparency = "true";
			}
			iframe.name = (new Date()).getTime(); // give the iframe a unique name to prevent caching
			iframe.allowFullscreen = true;

			return iframe;
		}
	},

	// Abstracting the HTML and event identifiers for easy rebranding
	colorbox = 'colorbox',
	prefix = 'cbox',
	boxElement = prefix + 'Element',

	// Events
	event_open = prefix + '_open',
	event_load = prefix + '_load',
	event_complete = prefix + '_complete',
	event_cleanup = prefix + '_cleanup',
	event_closed = prefix + '_closed',
	event_purge = prefix + '_purge',

	// Cached jQuery Object Variables
	$overlay,
	$box,
	$wrap,
	$content,
	$topBorder,
	$leftBorder,
	$rightBorder,
	$bottomBorder,
	$related,
	$window,
	$loaded,
	$loadingBay,
	$loadingOverlay,
	$title,
	$current,
	$slideshow,
	$next,
	$prev,
	$close,
	$groupControls,
	$events = $('<a/>'), // $({}) would be prefered, but there is an issue with jQuery 1.4.2

	// Variables for cached values or use across multiple functions
	settings,
	interfaceHeight,
	interfaceWidth,
	loadedHeight,
	loadedWidth,
	index,
	photo,
	open,
	active,
	closing,
	loadingTimer,
	publicMethod,
	div = "div",
	requests = 0,
	previousCSS = {},
	init;

	// ****************
	// HELPER FUNCTIONS
	// ****************

	// Convenience function for creating new jQuery objects
	function $tag(tag, id, css) {
		var element = document.createElement(tag);

		if (id) {
			element.id = prefix + id;
		}

		if (css) {
			element.style.cssText = css;
		}

		return $(element);
	}

	// Get the window height using innerHeight when available to avoid an issue with iOS
	// http://bugs.jquery.com/ticket/6724
	function winheight() {
		return window.innerHeight ? window.innerHeight : $(window).height();
	}

	function Settings(element, options) {
		if (options !== Object(options)) {
			options = {};
		}

		this.cache = {};
		this.el = element;

		this.value = function(key) {
			var dataAttr;

			if (this.cache[key] === undefined) {
				dataAttr = $(this.el).attr('data-cbox-'+key);

				if (dataAttr !== undefined) {
					this.cache[key] = dataAttr;
				} else if (options[key] !== undefined) {
					this.cache[key] = options[key];
				} else if (defaults[key] !== undefined) {
					this.cache[key] = defaults[key];
				}
			}

			return this.cache[key];
		};

		this.get = function(key) {
			var value = this.value(key);
			return $.isFunction(value) ? value.call(this.el, this) : value;
		};
	}

	// Determine the next and previous members in a group.
	function getIndex(increment) {
		var
		max = $related.length,
		newIndex = (index + increment) % max;

		return (newIndex < 0) ? max + newIndex : newIndex;
	}

	// Convert '%' and 'px' values to integers
	function setSize(size, dimension) {
		return Math.round((/%/.test(size) ? ((dimension === 'x' ? $window.width() : winheight()) / 100) : 1) * parseInt(size, 10));
	}

	// Checks an href to see if it is a photo.
	// There is a force photo option (photo: true) for hrefs that cannot be matched by the regex.
	function isImage(settings, url) {
		return settings.get('photo') || settings.get('photoRegex').test(url);
	}

	function retinaUrl(settings, url) {
		return settings.get('retinaUrl') && window.devicePixelRatio > 1 ? url.replace(settings.get('photoRegex'), settings.get('retinaSuffix')) : url;
	}

	function trapFocus(e) {
		if ('contains' in $box[0] && !$box[0].contains(e.target) && e.target !== $overlay[0]) {
			e.stopPropagation();
			$box.focus();
		}
	}

	function setClass(str) {
		if (setClass.str !== str) {
			$box.add($overlay).removeClass(setClass.str).addClass(str);
			setClass.str = str;
		}
	}

	function getRelated(rel) {
		index = 0;

		if (rel && rel !== false && rel !== 'nofollow') {
			$related = $('.' + boxElement).filter(function () {
				var options = $.data(this, colorbox);
				var settings = new Settings(this, options);
				return (settings.get('rel') === rel);
			});
			index = $related.index(settings.el);

			// Check direct calls to Colorbox.
			if (index === -1) {
				$related = $related.add(settings.el);
				index = $related.length - 1;
			}
		} else {
			$related = $(settings.el);
		}
	}

	function trigger(event) {
		// for external use
		$(document).trigger(event);
		// for internal use
		$events.triggerHandler(event);
	}

	var slideshow = (function(){
		var active,
			className = prefix + "Slideshow_",
			click = "click." + prefix,
			timeOut;

		function clear () {
			clearTimeout(timeOut);
		}

		function set() {
			if (settings.get('loop') || $related[index + 1]) {
				clear();
				timeOut = setTimeout(publicMethod.next, settings.get('slideshowSpeed'));
			}
		}

		function start() {
			$slideshow
				.html(settings.get('slideshowStop'))
				.unbind(click)
				.one(click, stop);

			$events
				.bind(event_complete, set)
				.bind(event_load, clear);

			$box.removeClass(className + "off").addClass(className + "on");
		}

		function stop() {
			clear();

			$events
				.unbind(event_complete, set)
				.unbind(event_load, clear);

			$slideshow
				.html(settings.get('slideshowStart'))
				.unbind(click)
				.one(click, function () {
					publicMethod.next();
					start();
				});

			$box.removeClass(className + "on").addClass(className + "off");
		}

		function reset() {
			active = false;
			$slideshow.hide();
			clear();
			$events
				.unbind(event_complete, set)
				.unbind(event_load, clear);
			$box.removeClass(className + "off " + className + "on");
		}

		return function(){
			if (active) {
				if (!settings.get('slideshow')) {
					$events.unbind(event_cleanup, reset);
					reset();
				}
			} else {
				if (settings.get('slideshow') && $related[1]) {
					active = true;
					$events.one(event_cleanup, reset);
					if (settings.get('slideshowAuto')) {
						start();
					} else {
						stop();
					}
					$slideshow.show();
				}
			}
		};

	}());


	function launch(element) {
		var options;

		if (!closing) {

			options = $(element).data(colorbox);

			settings = new Settings(element, options);

			getRelated(settings.get('rel'));

			if (!open) {
				open = active = true; // Prevents the page-change action from queuing up if the visitor holds down the left or right keys.

				setClass(settings.get('className'));

				// Show colorbox so the sizes can be calculated in older versions of jQuery
				$box.css({visibility:'hidden', display:'block', opacity:''});

				$loaded = $tag(div, 'LoadedContent', 'width:0; height:0; overflow:hidden; visibility:hidden');
				$content.css({width:'', height:''}).append($loaded);

				// Cache values needed for size calculations
				interfaceHeight = $topBorder.height() + $bottomBorder.height() + $content.outerHeight(true) - $content.height();
				interfaceWidth = $leftBorder.width() + $rightBorder.width() + $content.outerWidth(true) - $content.width();
				loadedHeight = $loaded.outerHeight(true);
				loadedWidth = $loaded.outerWidth(true);

				// Opens inital empty Colorbox prior to content being loaded.
				var initialWidth = setSize(settings.get('initialWidth'), 'x');
				var initialHeight = setSize(settings.get('initialHeight'), 'y');
				var maxWidth = settings.get('maxWidth');
				var maxHeight = settings.get('maxHeight');

				settings.w = Math.max((maxWidth !== false ? Math.min(initialWidth, setSize(maxWidth, 'x')) : initialWidth) - loadedWidth - interfaceWidth, 0);
				settings.h = Math.max((maxHeight !== false ? Math.min(initialHeight, setSize(maxHeight, 'y')) : initialHeight) - loadedHeight - interfaceHeight, 0);

				$loaded.css({width:'', height:settings.h});
				publicMethod.position();

				trigger(event_open);
				settings.get('onOpen');

				$groupControls.add($title).hide();

				$box.focus();

				if (settings.get('trapFocus')) {
					// Confine focus to the modal
					// Uses event capturing that is not supported in IE8-
					if (document.addEventListener) {

						document.addEventListener('focus', trapFocus, true);

						$events.one(event_closed, function () {
							document.removeEventListener('focus', trapFocus, true);
						});
					}
				}

				// Return focus on closing
				if (settings.get('returnFocus')) {
					$events.one(event_closed, function () {
						$(settings.el).focus();
					});
				}
			}

			var opacity = parseFloat(settings.get('opacity'));
			$overlay.css({
				opacity: opacity === opacity ? opacity : '',
				cursor: settings.get('overlayClose') ? 'pointer' : '',
				visibility: 'visible'
			}).show();

			if (settings.get('closeButton')) {
				$close.html(settings.get('close')).appendTo($content);
			} else {
				$close.appendTo('<div/>'); // replace with .detach() when dropping jQuery < 1.4
			}

			load();
		}
	}

	// Colorbox's markup needs to be added to the DOM prior to being called
	// so that the browser will go ahead and load the CSS background images.
	function appendHTML() {
		if (!$box) {
			init = false;
			$window = $(window);
			$box = $tag(div).attr({
				id: colorbox,
				'class': $.support.opacity === false ? prefix + 'IE' : '', // class for optional IE8 & lower targeted CSS.
				role: 'dialog',
				tabindex: '-1'
			}).hide();
			$overlay = $tag(div, "Overlay").hide();
			$loadingOverlay = $([$tag(div, "LoadingOverlay")[0],$tag(div, "LoadingGraphic")[0]]);
			$wrap = $tag(div, "Wrapper");
			$content = $tag(div, "Content").append(
				$title = $tag(div, "Title"),
				$current = $tag(div, "Current"),
				$prev = $('<button type="button"/>').attr({id:prefix+'Previous'}),
				$next = $('<button type="button"/>').attr({id:prefix+'Next'}),
				$slideshow = $tag('button', "Slideshow"),
				$loadingOverlay
			);

			$close = $('<button type="button"/>').attr({id:prefix+'Close'});

			$wrap.append( // The 3x3 Grid that makes up Colorbox
				$tag(div).append(
					$tag(div, "TopLeft"),
					$topBorder = $tag(div, "TopCenter"),
					$tag(div, "TopRight")
				),
				$tag(div, false, 'clear:left').append(
					$leftBorder = $tag(div, "MiddleLeft"),
					$content,
					$rightBorder = $tag(div, "MiddleRight")
				),
				$tag(div, false, 'clear:left').append(
					$tag(div, "BottomLeft"),
					$bottomBorder = $tag(div, "BottomCenter"),
					$tag(div, "BottomRight")
				)
			).find('div div').css({'float': 'left'});

			$loadingBay = $tag(div, false, 'position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;');

			$groupControls = $next.add($prev).add($current).add($slideshow);
		}
		if (document.body && !$box.parent().length) {
			$(document.body).append($overlay, $box.append($wrap, $loadingBay));
		}
	}

	// Add Colorbox's event bindings
	function addBindings() {
		function clickHandler(e) {
			// ignore non-left-mouse-clicks and clicks modified with ctrl / command, shift, or alt.
			// See: http://jacklmoore.com/notes/click-events/
			if (!(e.which > 1 || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey)) {
				e.preventDefault();
				launch(this);
			}
		}

		if ($box) {
			if (!init) {
				init = true;

				// Anonymous functions here keep the public method from being cached, thereby allowing them to be redefined on the fly.
				$next.click(function () {
					publicMethod.next();
				});
				$prev.click(function () {
					publicMethod.prev();
				});
				$close.click(function () {
					publicMethod.close();
				});
				$overlay.click(function () {
					if (settings.get('overlayClose')) {
						publicMethod.close();
					}
				});

				// Key Bindings
				$(document).bind('keydown.' + prefix, function (e) {
					var key = e.keyCode;
					if (open && settings.get('escKey') && key === 27) {
						e.preventDefault();
						publicMethod.close();
					}
					if (open && settings.get('arrowKey') && $related[1] && !e.altKey) {
						if (key === 37) {
							e.preventDefault();
							$prev.click();
						} else if (key === 39) {
							e.preventDefault();
							$next.click();
						}
					}
				});

				if ($.isFunction($.fn.on)) {
					// For jQuery 1.7+
					$(document).on('click.'+prefix, '.'+boxElement, clickHandler);
				} else {
					// For jQuery 1.3.x -> 1.6.x
					// This code is never reached in jQuery 1.9, so do not contact me about 'live' being removed.
					// This is not here for jQuery 1.9, it's here for legacy users.
					$('.'+boxElement).live('click.'+prefix, clickHandler);
				}
			}
			return true;
		}
		return false;
	}

	// Don't do anything if Colorbox already exists.
	if ($[colorbox]) {
		return;
	}

	// Append the HTML when the DOM loads
	$(appendHTML);


	// ****************
	// PUBLIC FUNCTIONS
	// Usage format: $.colorbox.close();
	// Usage from within an iframe: parent.jQuery.colorbox.close();
	// ****************

	publicMethod = $.fn[colorbox] = $[colorbox] = function (options, callback) {
		var settings;
		var $obj = this;

		options = options || {};

		if ($.isFunction($obj)) { // assume a call to $.colorbox
			$obj = $('<a/>');
			options.open = true;
		}

		if (!$obj[0]) { // colorbox being applied to empty collection
			return $obj;
		}

		appendHTML();

		if (addBindings()) {

			if (callback) {
				options.onComplete = callback;
			}

			$obj.each(function () {
				var old = $.data(this, colorbox) || {};
				$.data(this, colorbox, $.extend(old, options));
			}).addClass(boxElement);

			settings = new Settings($obj[0], options);

			if (settings.get('open')) {
				launch($obj[0]);
			}
		}

		return $obj;
	};

	publicMethod.position = function (speed, loadedCallback) {
		var
		css,
		top = 0,
		left = 0,
		offset = $box.offset(),
		scrollTop,
		scrollLeft;

		$window.unbind('resize.' + prefix);

		// remove the modal so that it doesn't influence the document width/height
		$box.css({top: -9e4, left: -9e4});

		scrollTop = $window.scrollTop();
		scrollLeft = $window.scrollLeft();

		if (settings.get('fixed')) {
			offset.top -= scrollTop;
			offset.left -= scrollLeft;
			$box.css({position: 'fixed'});
		} else {
			top = scrollTop;
			left = scrollLeft;
			$box.css({position: 'absolute'});
		}

		// keeps the top and left positions within the browser's viewport.
		if (settings.get('right') !== false) {
			left += Math.max($window.width() - settings.w - loadedWidth - interfaceWidth - setSize(settings.get('right'), 'x'), 0);
		} else if (settings.get('left') !== false) {
			left += setSize(settings.get('left'), 'x');
		} else {
			left += Math.round(Math.max($window.width() - settings.w - loadedWidth - interfaceWidth, 0) / 2);
		}

		if (settings.get('bottom') !== false) {
			top += Math.max(winheight() - settings.h - loadedHeight - interfaceHeight - setSize(settings.get('bottom'), 'y'), 0);
		} else if (settings.get('top') !== false) {
			top += setSize(settings.get('top'), 'y');
		} else {
			top += Math.round(Math.max(winheight() - settings.h - loadedHeight - interfaceHeight, 0) / 2);
		}

		$box.css({top: offset.top, left: offset.left, visibility:'visible'});

		// this gives the wrapper plenty of breathing room so it's floated contents can move around smoothly,
		// but it has to be shrank down around the size of div#colorbox when it's done.  If not,
		// it can invoke an obscure IE bug when using iframes.
		$wrap[0].style.width = $wrap[0].style.height = "9999px";

		function modalDimensions() {
			$topBorder[0].style.width = $bottomBorder[0].style.width = $content[0].style.width = (parseInt($box[0].style.width,10) - interfaceWidth)+'px';
			$content[0].style.height = $leftBorder[0].style.height = $rightBorder[0].style.height = (parseInt($box[0].style.height,10) - interfaceHeight)+'px';
		}

		css = {width: settings.w + loadedWidth + interfaceWidth, height: settings.h + loadedHeight + interfaceHeight, top: top, left: left};

		// setting the speed to 0 if the content hasn't changed size or position
		if (speed) {
			var tempSpeed = 0;
			$.each(css, function(i){
				if (css[i] !== previousCSS[i]) {
					tempSpeed = speed;
					return;
				}
			});
			speed = tempSpeed;
		}

		previousCSS = css;

		if (!speed) {
			$box.css(css);
		}

		$box.dequeue().animate(css, {
			duration: speed || 0,
			complete: function () {
				modalDimensions();

				active = false;

				// shrink the wrapper down to exactly the size of colorbox to avoid a bug in IE's iframe implementation.
				$wrap[0].style.width = (settings.w + loadedWidth + interfaceWidth) + "px";
				$wrap[0].style.height = (settings.h + loadedHeight + interfaceHeight) + "px";

				if (settings.get('reposition')) {
					setTimeout(function () {  // small delay before binding onresize due to an IE8 bug.
						$window.bind('resize.' + prefix, publicMethod.position);
					}, 1);
				}

				if ($.isFunction(loadedCallback)) {
					loadedCallback();
				}
			},
			step: modalDimensions
		});
	};

	publicMethod.resize = function (options) {
		var scrolltop;

		if (open) {
			options = options || {};

			if (options.width) {
				settings.w = setSize(options.width, 'x') - loadedWidth - interfaceWidth;
			}

			if (options.innerWidth) {
				settings.w = setSize(options.innerWidth, 'x');
			}

			$loaded.css({width: settings.w});

			if (options.height) {
				settings.h = setSize(options.height, 'y') - loadedHeight - interfaceHeight;
			}

			if (options.innerHeight) {
				settings.h = setSize(options.innerHeight, 'y');
			}

			if (!options.innerHeight && !options.height) {
				scrolltop = $loaded.scrollTop();
				$loaded.css({height: "auto"});
				settings.h = $loaded.height();
			}

			$loaded.css({height: settings.h});

			if(scrolltop) {
				$loaded.scrollTop(scrolltop);
			}

			publicMethod.position(settings.get('transition') === "none" ? 0 : settings.get('speed'));
		}
	};

	publicMethod.prep = function (object) {
		if (!open) {
			return;
		}

		var callback, speed = settings.get('transition') === "none" ? 0 : settings.get('speed');

		$loaded.remove();

		$loaded = $tag(div, 'LoadedContent').append(object);

		function getWidth() {
			settings.w = settings.w || $loaded.width();
			settings.w = settings.mw && settings.mw < settings.w ? settings.mw : settings.w;
			return settings.w;
		}
		function getHeight() {
			settings.h = settings.h || $loaded.height();
			settings.h = settings.mh && settings.mh < settings.h ? settings.mh : settings.h;
			return settings.h;
		}

		$loaded.hide()
		.appendTo($loadingBay.show())// content has to be appended to the DOM for accurate size calculations.
		.css({width: getWidth(), overflow: settings.get('scrolling') ? 'auto' : 'hidden'})
		.css({height: getHeight()})// sets the height independently from the width in case the new width influences the value of height.
		.prependTo($content);

		$loadingBay.hide();

		// floating the IMG removes the bottom line-height and fixed a problem where IE miscalculates the width of the parent element as 100% of the document width.

		$(photo).css({'float': 'none'});

		setClass(settings.get('className'));

		callback = function () {
			var total = $related.length,
				iframe,
				complete;

			if (!open) {
				return;
			}

			function removeFilter() { // Needed for IE8 in versions of jQuery prior to 1.7.2
				if ($.support.opacity === false) {
					$box[0].style.removeAttribute('filter');
				}
			}

			complete = function () {
				clearTimeout(loadingTimer);
				$loadingOverlay.hide();
				trigger(event_complete);
				settings.get('onComplete');
			};


			$title.html(settings.get('title')).show();
			$loaded.show();

			if (total > 1) { // handle grouping
				if (typeof settings.get('current') === "string") {
					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total)).show();
				}

				$next[(settings.get('loop') || index < total - 1) ? "show" : "hide"]().html(settings.get('next'));
				$prev[(settings.get('loop') || index) ? "show" : "hide"]().html(settings.get('previous'));

				slideshow();

				// Preloads images within a rel group
				if (settings.get('preloading')) {
					$.each([getIndex(-1), getIndex(1)], function(){
						var img,
							i = $related[this],
							settings = new Settings(i, $.data(i, colorbox)),
							src = settings.get('href');

						if (src && isImage(settings, src)) {
							src = retinaUrl(settings, src);
							img = document.createElement('img');
							img.src = src;
						}
					});
				}
			} else {
				$groupControls.hide();
			}

			if (settings.get('iframe')) {

				iframe = settings.get('createIframe');

				if (!settings.get('scrolling')) {
					iframe.scrolling = "no";
				}

				$(iframe)
					.attr({
						src: settings.get('href'),
						'class': prefix + 'Iframe'
					})
					.one('load', complete)
					.appendTo($loaded);

				$events.one(event_purge, function () {
					iframe.src = "//about:blank";
				});

				if (settings.get('fastIframe')) {
					$(iframe).trigger('load');
				}
			} else {
				complete();
			}

			if (settings.get('transition') === 'fade') {
				$box.fadeTo(speed, 1, removeFilter);
			} else {
				removeFilter();
			}
		};

		if (settings.get('transition') === 'fade') {
			$box.fadeTo(speed, 0, function () {
				publicMethod.position(0, callback);
			});
		} else {
			publicMethod.position(speed, callback);
		}
	};

	function load () {
		var href, setResize, prep = publicMethod.prep, $inline, request = ++requests;

		active = true;

		photo = false;

		trigger(event_purge);
		trigger(event_load);
		settings.get('onLoad');

		settings.h = settings.get('height') ?
				setSize(settings.get('height'), 'y') - loadedHeight - interfaceHeight :
				settings.get('innerHeight') && setSize(settings.get('innerHeight'), 'y');

		settings.w = settings.get('width') ?
				setSize(settings.get('width'), 'x') - loadedWidth - interfaceWidth :
				settings.get('innerWidth') && setSize(settings.get('innerWidth'), 'x');

		// Sets the minimum dimensions for use in image scaling
		settings.mw = settings.w;
		settings.mh = settings.h;

		// Re-evaluate the minimum width and height based on maxWidth and maxHeight values.
		// If the width or height exceed the maxWidth or maxHeight, use the maximum values instead.
		if (settings.get('maxWidth')) {
			settings.mw = setSize(settings.get('maxWidth'), 'x') - loadedWidth - interfaceWidth;
			settings.mw = settings.w && settings.w < settings.mw ? settings.w : settings.mw;
		}
		if (settings.get('maxHeight')) {
			settings.mh = setSize(settings.get('maxHeight'), 'y') - loadedHeight - interfaceHeight;
			settings.mh = settings.h && settings.h < settings.mh ? settings.h : settings.mh;
		}

		href = settings.get('href');

		loadingTimer = setTimeout(function () {
			$loadingOverlay.show();
		}, 100);

		if (settings.get('inline')) {
			var $target = $(href);
			// Inserts an empty placeholder where inline content is being pulled from.
			// An event is bound to put inline content back when Colorbox closes or loads new content.
			$inline = $('<div>').hide().insertBefore($target);

			$events.one(event_purge, function () {
				$inline.replaceWith($target);
			});

			prep($target);
		} else if (settings.get('iframe')) {
			// IFrame element won't be added to the DOM until it is ready to be displayed,
			// to avoid problems with DOM-ready JS that might be trying to run in that iframe.
			prep(" ");
		} else if (settings.get('html')) {
			prep(settings.get('html'));
		} else if (isImage(settings, href)) {

			href = retinaUrl(settings, href);

			photo = settings.get('createImg');

			$(photo)
			.addClass(prefix + 'Photo')
			.bind('error.'+prefix,function () {
				prep($tag(div, 'Error').html(settings.get('imgError')));
			})
			.one('load', function () {
				if (request !== requests) {
					return;
				}

				// A small pause because some browsers will occassionaly report a
				// img.width and img.height of zero immediately after the img.onload fires
				setTimeout(function(){
					var percent;

					if (settings.get('retinaImage') && window.devicePixelRatio > 1) {
						photo.height = photo.height / window.devicePixelRatio;
						photo.width = photo.width / window.devicePixelRatio;
					}

					if (settings.get('scalePhotos')) {
						setResize = function () {
							photo.height -= photo.height * percent;
							photo.width -= photo.width * percent;
						};
						if (settings.mw && photo.width > settings.mw) {
							percent = (photo.width - settings.mw) / photo.width;
							setResize();
						}
						if (settings.mh && photo.height > settings.mh) {
							percent = (photo.height - settings.mh) / photo.height;
							setResize();
						}
					}

					if (settings.h) {
						photo.style.marginTop = Math.max(settings.mh - photo.height, 0) / 2 + 'px';
					}

					if ($related[1] && (settings.get('loop') || $related[index + 1])) {
						photo.style.cursor = 'pointer';

						$(photo).bind('click.'+prefix, function () {
							publicMethod.next();
						});
					}

					photo.style.width = photo.width + 'px';
					photo.style.height = photo.height + 'px';
					prep(photo);
				}, 1);
			});

			photo.src = href;

		} else if (href) {
			$loadingBay.load(href, settings.get('data'), function (data, status) {
				if (request === requests) {
					prep(status === 'error' ? $tag(div, 'Error').html(settings.get('xhrError')) : $(this).contents());
				}
			});
		}
	}

	// Navigates to the next page/image in a set.
	publicMethod.next = function () {
		if (!active && $related[1] && (settings.get('loop') || $related[index + 1])) {
			index = getIndex(1);
			launch($related[index]);
		}
	};

	publicMethod.prev = function () {
		if (!active && $related[1] && (settings.get('loop') || index)) {
			index = getIndex(-1);
			launch($related[index]);
		}
	};

	// Note: to use this within an iframe use the following format: parent.jQuery.colorbox.close();
	publicMethod.close = function () {
		if (open && !closing) {

			closing = true;
			open = false;
			trigger(event_cleanup);
			settings.get('onCleanup');
			$window.unbind('.' + prefix);
			$overlay.fadeTo(settings.get('fadeOut') || 0, 0);

			$box.stop().fadeTo(settings.get('fadeOut') || 0, 0, function () {
				$box.hide();
				$overlay.hide();
				trigger(event_purge);
				$loaded.remove();

				setTimeout(function () {
					closing = false;
					trigger(event_closed);
					settings.get('onClosed');
				}, 1);
			});
		}
	};

	// Removes changes Colorbox made to the document, but does not remove the plugin.
	publicMethod.remove = function () {
		if (!$box) { return; }

		$box.stop();
		$[colorbox].close();
		$box.stop(false, true).remove();
		$overlay.remove();
		closing = false;
		$box = null;
		$('.' + boxElement)
			.removeData(colorbox)
			.removeClass(boxElement);

		$(document).unbind('click.'+prefix).unbind('keydown.'+prefix);
	};

	// A method for fetching the current element Colorbox is referencing.
	// returns a jQuery object.
	publicMethod.element = function () {
		return $(settings.el);
	};

	publicMethod.settings = defaults;

}(jQuery, document, window));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5jb2xvcmJveC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQUFMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImpxdWVyeS5jb2xvcmJveC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxyXG5cdENvbG9yYm94IDEuNi4zXHJcblx0bGljZW5zZTogTUlUXHJcblx0aHR0cDovL3d3dy5qYWNrbG1vb3JlLmNvbS9jb2xvcmJveFxyXG4qL1xyXG4oZnVuY3Rpb24gKCQsIGRvY3VtZW50LCB3aW5kb3cpIHtcclxuXHR2YXJcclxuXHQvLyBEZWZhdWx0IHNldHRpbmdzIG9iamVjdC5cclxuXHQvLyBTZWUgaHR0cDovL2phY2tsbW9vcmUuY29tL2NvbG9yYm94IGZvciBkZXRhaWxzLlxyXG5cdGRlZmF1bHRzID0ge1xyXG5cdFx0Ly8gZGF0YSBzb3VyY2VzXHJcblx0XHRodG1sOiBmYWxzZSxcclxuXHRcdHBob3RvOiBmYWxzZSxcclxuXHRcdGlmcmFtZTogZmFsc2UsXHJcblx0XHRpbmxpbmU6IGZhbHNlLFxyXG5cclxuXHRcdC8vIGJlaGF2aW9yIGFuZCBhcHBlYXJhbmNlXHJcblx0XHR0cmFuc2l0aW9uOiBcImVsYXN0aWNcIixcclxuXHRcdHNwZWVkOiAzMDAsXHJcblx0XHRmYWRlT3V0OiAzMDAsXHJcblx0XHR3aWR0aDogZmFsc2UsXHJcblx0XHRpbml0aWFsV2lkdGg6IFwiNjAwXCIsXHJcblx0XHRpbm5lcldpZHRoOiBmYWxzZSxcclxuXHRcdG1heFdpZHRoOiBmYWxzZSxcclxuXHRcdGhlaWdodDogZmFsc2UsXHJcblx0XHRpbml0aWFsSGVpZ2h0OiBcIjQ1MFwiLFxyXG5cdFx0aW5uZXJIZWlnaHQ6IGZhbHNlLFxyXG5cdFx0bWF4SGVpZ2h0OiBmYWxzZSxcclxuXHRcdHNjYWxlUGhvdG9zOiB0cnVlLFxyXG5cdFx0c2Nyb2xsaW5nOiB0cnVlLFxyXG5cdFx0b3BhY2l0eTogMC45LFxyXG5cdFx0cHJlbG9hZGluZzogdHJ1ZSxcclxuXHRcdGNsYXNzTmFtZTogZmFsc2UsXHJcblx0XHRvdmVybGF5Q2xvc2U6IHRydWUsXHJcblx0XHRlc2NLZXk6IHRydWUsXHJcblx0XHRhcnJvd0tleTogdHJ1ZSxcclxuXHRcdHRvcDogZmFsc2UsXHJcblx0XHRib3R0b206IGZhbHNlLFxyXG5cdFx0bGVmdDogZmFsc2UsXHJcblx0XHRyaWdodDogZmFsc2UsXHJcblx0XHRmaXhlZDogZmFsc2UsXHJcblx0XHRkYXRhOiB1bmRlZmluZWQsXHJcblx0XHRjbG9zZUJ1dHRvbjogdHJ1ZSxcclxuXHRcdGZhc3RJZnJhbWU6IHRydWUsXHJcblx0XHRvcGVuOiBmYWxzZSxcclxuXHRcdHJlcG9zaXRpb246IHRydWUsXHJcblx0XHRsb29wOiB0cnVlLFxyXG5cdFx0c2xpZGVzaG93OiBmYWxzZSxcclxuXHRcdHNsaWRlc2hvd0F1dG86IHRydWUsXHJcblx0XHRzbGlkZXNob3dTcGVlZDogMjUwMCxcclxuXHRcdHNsaWRlc2hvd1N0YXJ0OiBcInN0YXJ0IHNsaWRlc2hvd1wiLFxyXG5cdFx0c2xpZGVzaG93U3RvcDogXCJzdG9wIHNsaWRlc2hvd1wiLFxyXG5cdFx0cGhvdG9SZWdleDogL1xcLihnaWZ8cG5nfGpwKGV8Z3xlZyl8Ym1wfGljb3x3ZWJwfGp4cnxzdmcpKCgjfFxcPykuKik/JC9pLFxyXG5cclxuXHRcdC8vIGFsdGVybmF0ZSBpbWFnZSBwYXRocyBmb3IgaGlnaC1yZXMgZGlzcGxheXNcclxuXHRcdHJldGluYUltYWdlOiBmYWxzZSxcclxuXHRcdHJldGluYVVybDogZmFsc2UsXHJcblx0XHRyZXRpbmFTdWZmaXg6ICdAMnguJDEnLFxyXG5cclxuXHRcdC8vIGludGVybmF0aW9uYWxpemF0aW9uXHJcblx0XHRjdXJyZW50OiBcImltYWdlIHtjdXJyZW50fSBvZiB7dG90YWx9XCIsXHJcblx0XHRwcmV2aW91czogXCJwcmV2aW91c1wiLFxyXG5cdFx0bmV4dDogXCJuZXh0XCIsXHJcblx0XHRjbG9zZTogXCJjbG9zZVwiLFxyXG5cdFx0eGhyRXJyb3I6IFwiVGhpcyBjb250ZW50IGZhaWxlZCB0byBsb2FkLlwiLFxyXG5cdFx0aW1nRXJyb3I6IFwiVGhpcyBpbWFnZSBmYWlsZWQgdG8gbG9hZC5cIixcclxuXHJcblx0XHQvLyBhY2Nlc3NiaWxpdHlcclxuXHRcdHJldHVybkZvY3VzOiB0cnVlLFxyXG5cdFx0dHJhcEZvY3VzOiB0cnVlLFxyXG5cclxuXHRcdC8vIGNhbGxiYWNrc1xyXG5cdFx0b25PcGVuOiBmYWxzZSxcclxuXHRcdG9uTG9hZDogZmFsc2UsXHJcblx0XHRvbkNvbXBsZXRlOiBmYWxzZSxcclxuXHRcdG9uQ2xlYW51cDogZmFsc2UsXHJcblx0XHRvbkNsb3NlZDogZmFsc2UsXHJcblxyXG5cdFx0cmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMucmVsO1xyXG5cdFx0fSxcclxuXHRcdGhyZWY6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHQvLyB1c2luZyB0aGlzLmhyZWYgd291bGQgZ2l2ZSB0aGUgYWJzb2x1dGUgdXJsLCB3aGVuIHRoZSBocmVmIG1heSBoYXZlIGJlZW4gaW50ZWRlZCBhcyBhIHNlbGVjdG9yIChlLmcuICcjY29udGFpbmVyJylcclxuXHRcdFx0cmV0dXJuICQodGhpcykuYXR0cignaHJlZicpO1xyXG5cdFx0fSxcclxuXHRcdHRpdGxlOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudGl0bGU7XHJcblx0XHR9LFxyXG5cdFx0Y3JlYXRlSW1nOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdFx0XHR2YXIgYXR0cnMgPSAkKHRoaXMpLmRhdGEoJ2Nib3gtaW1nLWF0dHJzJyk7XHJcblxyXG5cdFx0XHRpZiAodHlwZW9mIGF0dHJzID09PSAnb2JqZWN0Jykge1xyXG5cdFx0XHRcdCQuZWFjaChhdHRycywgZnVuY3Rpb24oa2V5LCB2YWwpe1xyXG5cdFx0XHRcdFx0aW1nW2tleV0gPSB2YWw7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBpbWc7XHJcblx0XHR9LFxyXG5cdFx0Y3JlYXRlSWZyYW1lOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xyXG5cdFx0XHR2YXIgYXR0cnMgPSAkKHRoaXMpLmRhdGEoJ2Nib3gtaWZyYW1lLWF0dHJzJyk7XHJcblxyXG5cdFx0XHRpZiAodHlwZW9mIGF0dHJzID09PSAnb2JqZWN0Jykge1xyXG5cdFx0XHRcdCQuZWFjaChhdHRycywgZnVuY3Rpb24oa2V5LCB2YWwpe1xyXG5cdFx0XHRcdFx0aWZyYW1lW2tleV0gPSB2YWw7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICgnZnJhbWVCb3JkZXInIGluIGlmcmFtZSkge1xyXG5cdFx0XHRcdGlmcmFtZS5mcmFtZUJvcmRlciA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCdhbGxvd1RyYW5zcGFyZW5jeScgaW4gaWZyYW1lKSB7XHJcblx0XHRcdFx0aWZyYW1lLmFsbG93VHJhbnNwYXJlbmN5ID0gXCJ0cnVlXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0aWZyYW1lLm5hbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOyAvLyBnaXZlIHRoZSBpZnJhbWUgYSB1bmlxdWUgbmFtZSB0byBwcmV2ZW50IGNhY2hpbmdcclxuXHRcdFx0aWZyYW1lLmFsbG93RnVsbHNjcmVlbiA9IHRydWU7XHJcblxyXG5cdFx0XHRyZXR1cm4gaWZyYW1lO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdC8vIEFic3RyYWN0aW5nIHRoZSBIVE1MIGFuZCBldmVudCBpZGVudGlmaWVycyBmb3IgZWFzeSByZWJyYW5kaW5nXHJcblx0Y29sb3Jib3ggPSAnY29sb3Jib3gnLFxyXG5cdHByZWZpeCA9ICdjYm94JyxcclxuXHRib3hFbGVtZW50ID0gcHJlZml4ICsgJ0VsZW1lbnQnLFxyXG5cclxuXHQvLyBFdmVudHNcclxuXHRldmVudF9vcGVuID0gcHJlZml4ICsgJ19vcGVuJyxcclxuXHRldmVudF9sb2FkID0gcHJlZml4ICsgJ19sb2FkJyxcclxuXHRldmVudF9jb21wbGV0ZSA9IHByZWZpeCArICdfY29tcGxldGUnLFxyXG5cdGV2ZW50X2NsZWFudXAgPSBwcmVmaXggKyAnX2NsZWFudXAnLFxyXG5cdGV2ZW50X2Nsb3NlZCA9IHByZWZpeCArICdfY2xvc2VkJyxcclxuXHRldmVudF9wdXJnZSA9IHByZWZpeCArICdfcHVyZ2UnLFxyXG5cclxuXHQvLyBDYWNoZWQgalF1ZXJ5IE9iamVjdCBWYXJpYWJsZXNcclxuXHQkb3ZlcmxheSxcclxuXHQkYm94LFxyXG5cdCR3cmFwLFxyXG5cdCRjb250ZW50LFxyXG5cdCR0b3BCb3JkZXIsXHJcblx0JGxlZnRCb3JkZXIsXHJcblx0JHJpZ2h0Qm9yZGVyLFxyXG5cdCRib3R0b21Cb3JkZXIsXHJcblx0JHJlbGF0ZWQsXHJcblx0JHdpbmRvdyxcclxuXHQkbG9hZGVkLFxyXG5cdCRsb2FkaW5nQmF5LFxyXG5cdCRsb2FkaW5nT3ZlcmxheSxcclxuXHQkdGl0bGUsXHJcblx0JGN1cnJlbnQsXHJcblx0JHNsaWRlc2hvdyxcclxuXHQkbmV4dCxcclxuXHQkcHJldixcclxuXHQkY2xvc2UsXHJcblx0JGdyb3VwQ29udHJvbHMsXHJcblx0JGV2ZW50cyA9ICQoJzxhLz4nKSwgLy8gJCh7fSkgd291bGQgYmUgcHJlZmVyZWQsIGJ1dCB0aGVyZSBpcyBhbiBpc3N1ZSB3aXRoIGpRdWVyeSAxLjQuMlxyXG5cclxuXHQvLyBWYXJpYWJsZXMgZm9yIGNhY2hlZCB2YWx1ZXMgb3IgdXNlIGFjcm9zcyBtdWx0aXBsZSBmdW5jdGlvbnNcclxuXHRzZXR0aW5ncyxcclxuXHRpbnRlcmZhY2VIZWlnaHQsXHJcblx0aW50ZXJmYWNlV2lkdGgsXHJcblx0bG9hZGVkSGVpZ2h0LFxyXG5cdGxvYWRlZFdpZHRoLFxyXG5cdGluZGV4LFxyXG5cdHBob3RvLFxyXG5cdG9wZW4sXHJcblx0YWN0aXZlLFxyXG5cdGNsb3NpbmcsXHJcblx0bG9hZGluZ1RpbWVyLFxyXG5cdHB1YmxpY01ldGhvZCxcclxuXHRkaXYgPSBcImRpdlwiLFxyXG5cdHJlcXVlc3RzID0gMCxcclxuXHRwcmV2aW91c0NTUyA9IHt9LFxyXG5cdGluaXQ7XHJcblxyXG5cdC8vICoqKioqKioqKioqKioqKipcclxuXHQvLyBIRUxQRVIgRlVOQ1RJT05TXHJcblx0Ly8gKioqKioqKioqKioqKioqKlxyXG5cclxuXHQvLyBDb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgbmV3IGpRdWVyeSBvYmplY3RzXHJcblx0ZnVuY3Rpb24gJHRhZyh0YWcsIGlkLCBjc3MpIHtcclxuXHRcdHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xyXG5cclxuXHRcdGlmIChpZCkge1xyXG5cdFx0XHRlbGVtZW50LmlkID0gcHJlZml4ICsgaWQ7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGNzcykge1xyXG5cdFx0XHRlbGVtZW50LnN0eWxlLmNzc1RleHQgPSBjc3M7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuICQoZWxlbWVudCk7XHJcblx0fVxyXG5cclxuXHQvLyBHZXQgdGhlIHdpbmRvdyBoZWlnaHQgdXNpbmcgaW5uZXJIZWlnaHQgd2hlbiBhdmFpbGFibGUgdG8gYXZvaWQgYW4gaXNzdWUgd2l0aCBpT1NcclxuXHQvLyBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC82NzI0XHJcblx0ZnVuY3Rpb24gd2luaGVpZ2h0KCkge1xyXG5cdFx0cmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodCA/IHdpbmRvdy5pbm5lckhlaWdodCA6ICQod2luZG93KS5oZWlnaHQoKTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIFNldHRpbmdzKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuXHRcdGlmIChvcHRpb25zICE9PSBPYmplY3Qob3B0aW9ucykpIHtcclxuXHRcdFx0b3B0aW9ucyA9IHt9O1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY2FjaGUgPSB7fTtcclxuXHRcdHRoaXMuZWwgPSBlbGVtZW50O1xyXG5cclxuXHRcdHRoaXMudmFsdWUgPSBmdW5jdGlvbihrZXkpIHtcclxuXHRcdFx0dmFyIGRhdGFBdHRyO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuY2FjaGVba2V5XSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0ZGF0YUF0dHIgPSAkKHRoaXMuZWwpLmF0dHIoJ2RhdGEtY2JveC0nK2tleSk7XHJcblxyXG5cdFx0XHRcdGlmIChkYXRhQXR0ciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHR0aGlzLmNhY2hlW2tleV0gPSBkYXRhQXR0cjtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKG9wdGlvbnNba2V5XSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHR0aGlzLmNhY2hlW2tleV0gPSBvcHRpb25zW2tleV07XHJcblx0XHRcdFx0fSBlbHNlIGlmIChkZWZhdWx0c1trZXldICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHRoaXMuY2FjaGVba2V5XSA9IGRlZmF1bHRzW2tleV07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5jYWNoZVtrZXldO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHR2YXIgdmFsdWUgPSB0aGlzLnZhbHVlKGtleSk7XHJcblx0XHRcdHJldHVybiAkLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbCh0aGlzLmVsLCB0aGlzKSA6IHZhbHVlO1xyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdC8vIERldGVybWluZSB0aGUgbmV4dCBhbmQgcHJldmlvdXMgbWVtYmVycyBpbiBhIGdyb3VwLlxyXG5cdGZ1bmN0aW9uIGdldEluZGV4KGluY3JlbWVudCkge1xyXG5cdFx0dmFyXHJcblx0XHRtYXggPSAkcmVsYXRlZC5sZW5ndGgsXHJcblx0XHRuZXdJbmRleCA9IChpbmRleCArIGluY3JlbWVudCkgJSBtYXg7XHJcblxyXG5cdFx0cmV0dXJuIChuZXdJbmRleCA8IDApID8gbWF4ICsgbmV3SW5kZXggOiBuZXdJbmRleDtcclxuXHR9XHJcblxyXG5cdC8vIENvbnZlcnQgJyUnIGFuZCAncHgnIHZhbHVlcyB0byBpbnRlZ2Vyc1xyXG5cdGZ1bmN0aW9uIHNldFNpemUoc2l6ZSwgZGltZW5zaW9uKSB7XHJcblx0XHRyZXR1cm4gTWF0aC5yb3VuZCgoLyUvLnRlc3Qoc2l6ZSkgPyAoKGRpbWVuc2lvbiA9PT0gJ3gnID8gJHdpbmRvdy53aWR0aCgpIDogd2luaGVpZ2h0KCkpIC8gMTAwKSA6IDEpICogcGFyc2VJbnQoc2l6ZSwgMTApKTtcclxuXHR9XHJcblxyXG5cdC8vIENoZWNrcyBhbiBocmVmIHRvIHNlZSBpZiBpdCBpcyBhIHBob3RvLlxyXG5cdC8vIFRoZXJlIGlzIGEgZm9yY2UgcGhvdG8gb3B0aW9uIChwaG90bzogdHJ1ZSkgZm9yIGhyZWZzIHRoYXQgY2Fubm90IGJlIG1hdGNoZWQgYnkgdGhlIHJlZ2V4LlxyXG5cdGZ1bmN0aW9uIGlzSW1hZ2Uoc2V0dGluZ3MsIHVybCkge1xyXG5cdFx0cmV0dXJuIHNldHRpbmdzLmdldCgncGhvdG8nKSB8fCBzZXR0aW5ncy5nZXQoJ3Bob3RvUmVnZXgnKS50ZXN0KHVybCk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiByZXRpbmFVcmwoc2V0dGluZ3MsIHVybCkge1xyXG5cdFx0cmV0dXJuIHNldHRpbmdzLmdldCgncmV0aW5hVXJsJykgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxID8gdXJsLnJlcGxhY2Uoc2V0dGluZ3MuZ2V0KCdwaG90b1JlZ2V4JyksIHNldHRpbmdzLmdldCgncmV0aW5hU3VmZml4JykpIDogdXJsO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gdHJhcEZvY3VzKGUpIHtcclxuXHRcdGlmICgnY29udGFpbnMnIGluICRib3hbMF0gJiYgISRib3hbMF0uY29udGFpbnMoZS50YXJnZXQpICYmIGUudGFyZ2V0ICE9PSAkb3ZlcmxheVswXSkge1xyXG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cdFx0XHQkYm94LmZvY3VzKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXRDbGFzcyhzdHIpIHtcclxuXHRcdGlmIChzZXRDbGFzcy5zdHIgIT09IHN0cikge1xyXG5cdFx0XHQkYm94LmFkZCgkb3ZlcmxheSkucmVtb3ZlQ2xhc3Moc2V0Q2xhc3Muc3RyKS5hZGRDbGFzcyhzdHIpO1xyXG5cdFx0XHRzZXRDbGFzcy5zdHIgPSBzdHI7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBnZXRSZWxhdGVkKHJlbCkge1xyXG5cdFx0aW5kZXggPSAwO1xyXG5cclxuXHRcdGlmIChyZWwgJiYgcmVsICE9PSBmYWxzZSAmJiByZWwgIT09ICdub2ZvbGxvdycpIHtcclxuXHRcdFx0JHJlbGF0ZWQgPSAkKCcuJyArIGJveEVsZW1lbnQpLmZpbHRlcihmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFyIG9wdGlvbnMgPSAkLmRhdGEodGhpcywgY29sb3Jib3gpO1xyXG5cdFx0XHRcdHZhciBzZXR0aW5ncyA9IG5ldyBTZXR0aW5ncyh0aGlzLCBvcHRpb25zKTtcclxuXHRcdFx0XHRyZXR1cm4gKHNldHRpbmdzLmdldCgncmVsJykgPT09IHJlbCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRpbmRleCA9ICRyZWxhdGVkLmluZGV4KHNldHRpbmdzLmVsKTtcclxuXHJcblx0XHRcdC8vIENoZWNrIGRpcmVjdCBjYWxscyB0byBDb2xvcmJveC5cclxuXHRcdFx0aWYgKGluZGV4ID09PSAtMSkge1xyXG5cdFx0XHRcdCRyZWxhdGVkID0gJHJlbGF0ZWQuYWRkKHNldHRpbmdzLmVsKTtcclxuXHRcdFx0XHRpbmRleCA9ICRyZWxhdGVkLmxlbmd0aCAtIDE7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdCRyZWxhdGVkID0gJChzZXR0aW5ncy5lbCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiB0cmlnZ2VyKGV2ZW50KSB7XHJcblx0XHQvLyBmb3IgZXh0ZXJuYWwgdXNlXHJcblx0XHQkKGRvY3VtZW50KS50cmlnZ2VyKGV2ZW50KTtcclxuXHRcdC8vIGZvciBpbnRlcm5hbCB1c2VcclxuXHRcdCRldmVudHMudHJpZ2dlckhhbmRsZXIoZXZlbnQpO1xyXG5cdH1cclxuXHJcblx0dmFyIHNsaWRlc2hvdyA9IChmdW5jdGlvbigpe1xyXG5cdFx0dmFyIGFjdGl2ZSxcclxuXHRcdFx0Y2xhc3NOYW1lID0gcHJlZml4ICsgXCJTbGlkZXNob3dfXCIsXHJcblx0XHRcdGNsaWNrID0gXCJjbGljay5cIiArIHByZWZpeCxcclxuXHRcdFx0dGltZU91dDtcclxuXHJcblx0XHRmdW5jdGlvbiBjbGVhciAoKSB7XHJcblx0XHRcdGNsZWFyVGltZW91dCh0aW1lT3V0KTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBzZXQoKSB7XHJcblx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCAkcmVsYXRlZFtpbmRleCArIDFdKSB7XHJcblx0XHRcdFx0Y2xlYXIoKTtcclxuXHRcdFx0XHR0aW1lT3V0ID0gc2V0VGltZW91dChwdWJsaWNNZXRob2QubmV4dCwgc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3dTcGVlZCcpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIHN0YXJ0KCkge1xyXG5cdFx0XHQkc2xpZGVzaG93XHJcblx0XHRcdFx0Lmh0bWwoc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3dTdG9wJykpXHJcblx0XHRcdFx0LnVuYmluZChjbGljaylcclxuXHRcdFx0XHQub25lKGNsaWNrLCBzdG9wKTtcclxuXHJcblx0XHRcdCRldmVudHNcclxuXHRcdFx0XHQuYmluZChldmVudF9jb21wbGV0ZSwgc2V0KVxyXG5cdFx0XHRcdC5iaW5kKGV2ZW50X2xvYWQsIGNsZWFyKTtcclxuXHJcblx0XHRcdCRib3gucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lICsgXCJvZmZcIikuYWRkQ2xhc3MoY2xhc3NOYW1lICsgXCJvblwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBzdG9wKCkge1xyXG5cdFx0XHRjbGVhcigpO1xyXG5cclxuXHRcdFx0JGV2ZW50c1xyXG5cdFx0XHRcdC51bmJpbmQoZXZlbnRfY29tcGxldGUsIHNldClcclxuXHRcdFx0XHQudW5iaW5kKGV2ZW50X2xvYWQsIGNsZWFyKTtcclxuXHJcblx0XHRcdCRzbGlkZXNob3dcclxuXHRcdFx0XHQuaHRtbChzZXR0aW5ncy5nZXQoJ3NsaWRlc2hvd1N0YXJ0JykpXHJcblx0XHRcdFx0LnVuYmluZChjbGljaylcclxuXHRcdFx0XHQub25lKGNsaWNrLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRwdWJsaWNNZXRob2QubmV4dCgpO1xyXG5cdFx0XHRcdFx0c3RhcnQoKTtcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdCRib3gucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lICsgXCJvblwiKS5hZGRDbGFzcyhjbGFzc05hbWUgKyBcIm9mZlwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiByZXNldCgpIHtcclxuXHRcdFx0YWN0aXZlID0gZmFsc2U7XHJcblx0XHRcdCRzbGlkZXNob3cuaGlkZSgpO1xyXG5cdFx0XHRjbGVhcigpO1xyXG5cdFx0XHQkZXZlbnRzXHJcblx0XHRcdFx0LnVuYmluZChldmVudF9jb21wbGV0ZSwgc2V0KVxyXG5cdFx0XHRcdC51bmJpbmQoZXZlbnRfbG9hZCwgY2xlYXIpO1xyXG5cdFx0XHQkYm94LnJlbW92ZUNsYXNzKGNsYXNzTmFtZSArIFwib2ZmIFwiICsgY2xhc3NOYW1lICsgXCJvblwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oKXtcclxuXHRcdFx0aWYgKGFjdGl2ZSkge1xyXG5cdFx0XHRcdGlmICghc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3cnKSkge1xyXG5cdFx0XHRcdFx0JGV2ZW50cy51bmJpbmQoZXZlbnRfY2xlYW51cCwgcmVzZXQpO1xyXG5cdFx0XHRcdFx0cmVzZXQoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgnc2xpZGVzaG93JykgJiYgJHJlbGF0ZWRbMV0pIHtcclxuXHRcdFx0XHRcdGFjdGl2ZSA9IHRydWU7XHJcblx0XHRcdFx0XHQkZXZlbnRzLm9uZShldmVudF9jbGVhbnVwLCByZXNldCk7XHJcblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3dBdXRvJykpIHtcclxuXHRcdFx0XHRcdFx0c3RhcnQoKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHN0b3AoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdCRzbGlkZXNob3cuc2hvdygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0fSgpKTtcclxuXHJcblxyXG5cdGZ1bmN0aW9uIGxhdW5jaChlbGVtZW50KSB7XHJcblx0XHR2YXIgb3B0aW9ucztcclxuXHJcblx0XHRpZiAoIWNsb3NpbmcpIHtcclxuXHJcblx0XHRcdG9wdGlvbnMgPSAkKGVsZW1lbnQpLmRhdGEoY29sb3Jib3gpO1xyXG5cclxuXHRcdFx0c2V0dGluZ3MgPSBuZXcgU2V0dGluZ3MoZWxlbWVudCwgb3B0aW9ucyk7XHJcblxyXG5cdFx0XHRnZXRSZWxhdGVkKHNldHRpbmdzLmdldCgncmVsJykpO1xyXG5cclxuXHRcdFx0aWYgKCFvcGVuKSB7XHJcblx0XHRcdFx0b3BlbiA9IGFjdGl2ZSA9IHRydWU7IC8vIFByZXZlbnRzIHRoZSBwYWdlLWNoYW5nZSBhY3Rpb24gZnJvbSBxdWV1aW5nIHVwIGlmIHRoZSB2aXNpdG9yIGhvbGRzIGRvd24gdGhlIGxlZnQgb3IgcmlnaHQga2V5cy5cclxuXHJcblx0XHRcdFx0c2V0Q2xhc3Moc2V0dGluZ3MuZ2V0KCdjbGFzc05hbWUnKSk7XHJcblxyXG5cdFx0XHRcdC8vIFNob3cgY29sb3Jib3ggc28gdGhlIHNpemVzIGNhbiBiZSBjYWxjdWxhdGVkIGluIG9sZGVyIHZlcnNpb25zIG9mIGpRdWVyeVxyXG5cdFx0XHRcdCRib3guY3NzKHt2aXNpYmlsaXR5OidoaWRkZW4nLCBkaXNwbGF5OidibG9jaycsIG9wYWNpdHk6Jyd9KTtcclxuXHJcblx0XHRcdFx0JGxvYWRlZCA9ICR0YWcoZGl2LCAnTG9hZGVkQ29udGVudCcsICd3aWR0aDowOyBoZWlnaHQ6MDsgb3ZlcmZsb3c6aGlkZGVuOyB2aXNpYmlsaXR5OmhpZGRlbicpO1xyXG5cdFx0XHRcdCRjb250ZW50LmNzcyh7d2lkdGg6JycsIGhlaWdodDonJ30pLmFwcGVuZCgkbG9hZGVkKTtcclxuXHJcblx0XHRcdFx0Ly8gQ2FjaGUgdmFsdWVzIG5lZWRlZCBmb3Igc2l6ZSBjYWxjdWxhdGlvbnNcclxuXHRcdFx0XHRpbnRlcmZhY2VIZWlnaHQgPSAkdG9wQm9yZGVyLmhlaWdodCgpICsgJGJvdHRvbUJvcmRlci5oZWlnaHQoKSArICRjb250ZW50Lm91dGVySGVpZ2h0KHRydWUpIC0gJGNvbnRlbnQuaGVpZ2h0KCk7XHJcblx0XHRcdFx0aW50ZXJmYWNlV2lkdGggPSAkbGVmdEJvcmRlci53aWR0aCgpICsgJHJpZ2h0Qm9yZGVyLndpZHRoKCkgKyAkY29udGVudC5vdXRlcldpZHRoKHRydWUpIC0gJGNvbnRlbnQud2lkdGgoKTtcclxuXHRcdFx0XHRsb2FkZWRIZWlnaHQgPSAkbG9hZGVkLm91dGVySGVpZ2h0KHRydWUpO1xyXG5cdFx0XHRcdGxvYWRlZFdpZHRoID0gJGxvYWRlZC5vdXRlcldpZHRoKHRydWUpO1xyXG5cclxuXHRcdFx0XHQvLyBPcGVucyBpbml0YWwgZW1wdHkgQ29sb3Jib3ggcHJpb3IgdG8gY29udGVudCBiZWluZyBsb2FkZWQuXHJcblx0XHRcdFx0dmFyIGluaXRpYWxXaWR0aCA9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdpbml0aWFsV2lkdGgnKSwgJ3gnKTtcclxuXHRcdFx0XHR2YXIgaW5pdGlhbEhlaWdodCA9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdpbml0aWFsSGVpZ2h0JyksICd5Jyk7XHJcblx0XHRcdFx0dmFyIG1heFdpZHRoID0gc2V0dGluZ3MuZ2V0KCdtYXhXaWR0aCcpO1xyXG5cdFx0XHRcdHZhciBtYXhIZWlnaHQgPSBzZXR0aW5ncy5nZXQoJ21heEhlaWdodCcpO1xyXG5cclxuXHRcdFx0XHRzZXR0aW5ncy53ID0gTWF0aC5tYXgoKG1heFdpZHRoICE9PSBmYWxzZSA/IE1hdGgubWluKGluaXRpYWxXaWR0aCwgc2V0U2l6ZShtYXhXaWR0aCwgJ3gnKSkgOiBpbml0aWFsV2lkdGgpIC0gbG9hZGVkV2lkdGggLSBpbnRlcmZhY2VXaWR0aCwgMCk7XHJcblx0XHRcdFx0c2V0dGluZ3MuaCA9IE1hdGgubWF4KChtYXhIZWlnaHQgIT09IGZhbHNlID8gTWF0aC5taW4oaW5pdGlhbEhlaWdodCwgc2V0U2l6ZShtYXhIZWlnaHQsICd5JykpIDogaW5pdGlhbEhlaWdodCkgLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQsIDApO1xyXG5cclxuXHRcdFx0XHQkbG9hZGVkLmNzcyh7d2lkdGg6JycsIGhlaWdodDpzZXR0aW5ncy5ofSk7XHJcblx0XHRcdFx0cHVibGljTWV0aG9kLnBvc2l0aW9uKCk7XHJcblxyXG5cdFx0XHRcdHRyaWdnZXIoZXZlbnRfb3Blbik7XHJcblx0XHRcdFx0c2V0dGluZ3MuZ2V0KCdvbk9wZW4nKTtcclxuXHJcblx0XHRcdFx0JGdyb3VwQ29udHJvbHMuYWRkKCR0aXRsZSkuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHQkYm94LmZvY3VzKCk7XHJcblxyXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3RyYXBGb2N1cycpKSB7XHJcblx0XHRcdFx0XHQvLyBDb25maW5lIGZvY3VzIHRvIHRoZSBtb2RhbFxyXG5cdFx0XHRcdFx0Ly8gVXNlcyBldmVudCBjYXB0dXJpbmcgdGhhdCBpcyBub3Qgc3VwcG9ydGVkIGluIElFOC1cclxuXHRcdFx0XHRcdGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRyYXBGb2N1cywgdHJ1ZSk7XHJcblxyXG5cdFx0XHRcdFx0XHQkZXZlbnRzLm9uZShldmVudF9jbG9zZWQsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRyYXBGb2N1cywgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gUmV0dXJuIGZvY3VzIG9uIGNsb3NpbmdcclxuXHRcdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdyZXR1cm5Gb2N1cycpKSB7XHJcblx0XHRcdFx0XHQkZXZlbnRzLm9uZShldmVudF9jbG9zZWQsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0JChzZXR0aW5ncy5lbCkuZm9jdXMoKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIG9wYWNpdHkgPSBwYXJzZUZsb2F0KHNldHRpbmdzLmdldCgnb3BhY2l0eScpKTtcclxuXHRcdFx0JG92ZXJsYXkuY3NzKHtcclxuXHRcdFx0XHRvcGFjaXR5OiBvcGFjaXR5ID09PSBvcGFjaXR5ID8gb3BhY2l0eSA6ICcnLFxyXG5cdFx0XHRcdGN1cnNvcjogc2V0dGluZ3MuZ2V0KCdvdmVybGF5Q2xvc2UnKSA/ICdwb2ludGVyJyA6ICcnLFxyXG5cdFx0XHRcdHZpc2liaWxpdHk6ICd2aXNpYmxlJ1xyXG5cdFx0XHR9KS5zaG93KCk7XHJcblxyXG5cdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdjbG9zZUJ1dHRvbicpKSB7XHJcblx0XHRcdFx0JGNsb3NlLmh0bWwoc2V0dGluZ3MuZ2V0KCdjbG9zZScpKS5hcHBlbmRUbygkY29udGVudCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0JGNsb3NlLmFwcGVuZFRvKCc8ZGl2Lz4nKTsgLy8gcmVwbGFjZSB3aXRoIC5kZXRhY2goKSB3aGVuIGRyb3BwaW5nIGpRdWVyeSA8IDEuNFxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRsb2FkKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBDb2xvcmJveCdzIG1hcmt1cCBuZWVkcyB0byBiZSBhZGRlZCB0byB0aGUgRE9NIHByaW9yIHRvIGJlaW5nIGNhbGxlZFxyXG5cdC8vIHNvIHRoYXQgdGhlIGJyb3dzZXIgd2lsbCBnbyBhaGVhZCBhbmQgbG9hZCB0aGUgQ1NTIGJhY2tncm91bmQgaW1hZ2VzLlxyXG5cdGZ1bmN0aW9uIGFwcGVuZEhUTUwoKSB7XHJcblx0XHRpZiAoISRib3gpIHtcclxuXHRcdFx0aW5pdCA9IGZhbHNlO1xyXG5cdFx0XHQkd2luZG93ID0gJCh3aW5kb3cpO1xyXG5cdFx0XHQkYm94ID0gJHRhZyhkaXYpLmF0dHIoe1xyXG5cdFx0XHRcdGlkOiBjb2xvcmJveCxcclxuXHRcdFx0XHQnY2xhc3MnOiAkLnN1cHBvcnQub3BhY2l0eSA9PT0gZmFsc2UgPyBwcmVmaXggKyAnSUUnIDogJycsIC8vIGNsYXNzIGZvciBvcHRpb25hbCBJRTggJiBsb3dlciB0YXJnZXRlZCBDU1MuXHJcblx0XHRcdFx0cm9sZTogJ2RpYWxvZycsXHJcblx0XHRcdFx0dGFiaW5kZXg6ICctMSdcclxuXHRcdFx0fSkuaGlkZSgpO1xyXG5cdFx0XHQkb3ZlcmxheSA9ICR0YWcoZGl2LCBcIk92ZXJsYXlcIikuaGlkZSgpO1xyXG5cdFx0XHQkbG9hZGluZ092ZXJsYXkgPSAkKFskdGFnKGRpdiwgXCJMb2FkaW5nT3ZlcmxheVwiKVswXSwkdGFnKGRpdiwgXCJMb2FkaW5nR3JhcGhpY1wiKVswXV0pO1xyXG5cdFx0XHQkd3JhcCA9ICR0YWcoZGl2LCBcIldyYXBwZXJcIik7XHJcblx0XHRcdCRjb250ZW50ID0gJHRhZyhkaXYsIFwiQ29udGVudFwiKS5hcHBlbmQoXHJcblx0XHRcdFx0JHRpdGxlID0gJHRhZyhkaXYsIFwiVGl0bGVcIiksXHJcblx0XHRcdFx0JGN1cnJlbnQgPSAkdGFnKGRpdiwgXCJDdXJyZW50XCIpLFxyXG5cdFx0XHRcdCRwcmV2ID0gJCgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIvPicpLmF0dHIoe2lkOnByZWZpeCsnUHJldmlvdXMnfSksXHJcblx0XHRcdFx0JG5leHQgPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIi8+JykuYXR0cih7aWQ6cHJlZml4KydOZXh0J30pLFxyXG5cdFx0XHRcdCRzbGlkZXNob3cgPSAkdGFnKCdidXR0b24nLCBcIlNsaWRlc2hvd1wiKSxcclxuXHRcdFx0XHQkbG9hZGluZ092ZXJsYXlcclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdCRjbG9zZSA9ICQoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiLz4nKS5hdHRyKHtpZDpwcmVmaXgrJ0Nsb3NlJ30pO1xyXG5cclxuXHRcdFx0JHdyYXAuYXBwZW5kKCAvLyBUaGUgM3gzIEdyaWQgdGhhdCBtYWtlcyB1cCBDb2xvcmJveFxyXG5cdFx0XHRcdCR0YWcoZGl2KS5hcHBlbmQoXHJcblx0XHRcdFx0XHQkdGFnKGRpdiwgXCJUb3BMZWZ0XCIpLFxyXG5cdFx0XHRcdFx0JHRvcEJvcmRlciA9ICR0YWcoZGl2LCBcIlRvcENlbnRlclwiKSxcclxuXHRcdFx0XHRcdCR0YWcoZGl2LCBcIlRvcFJpZ2h0XCIpXHJcblx0XHRcdFx0KSxcclxuXHRcdFx0XHQkdGFnKGRpdiwgZmFsc2UsICdjbGVhcjpsZWZ0JykuYXBwZW5kKFxyXG5cdFx0XHRcdFx0JGxlZnRCb3JkZXIgPSAkdGFnKGRpdiwgXCJNaWRkbGVMZWZ0XCIpLFxyXG5cdFx0XHRcdFx0JGNvbnRlbnQsXHJcblx0XHRcdFx0XHQkcmlnaHRCb3JkZXIgPSAkdGFnKGRpdiwgXCJNaWRkbGVSaWdodFwiKVxyXG5cdFx0XHRcdCksXHJcblx0XHRcdFx0JHRhZyhkaXYsIGZhbHNlLCAnY2xlYXI6bGVmdCcpLmFwcGVuZChcclxuXHRcdFx0XHRcdCR0YWcoZGl2LCBcIkJvdHRvbUxlZnRcIiksXHJcblx0XHRcdFx0XHQkYm90dG9tQm9yZGVyID0gJHRhZyhkaXYsIFwiQm90dG9tQ2VudGVyXCIpLFxyXG5cdFx0XHRcdFx0JHRhZyhkaXYsIFwiQm90dG9tUmlnaHRcIilcclxuXHRcdFx0XHQpXHJcblx0XHRcdCkuZmluZCgnZGl2IGRpdicpLmNzcyh7J2Zsb2F0JzogJ2xlZnQnfSk7XHJcblxyXG5cdFx0XHQkbG9hZGluZ0JheSA9ICR0YWcoZGl2LCBmYWxzZSwgJ3Bvc2l0aW9uOmFic29sdXRlOyB3aWR0aDo5OTk5cHg7IHZpc2liaWxpdHk6aGlkZGVuOyBkaXNwbGF5Om5vbmU7IG1heC13aWR0aDpub25lOycpO1xyXG5cclxuXHRcdFx0JGdyb3VwQ29udHJvbHMgPSAkbmV4dC5hZGQoJHByZXYpLmFkZCgkY3VycmVudCkuYWRkKCRzbGlkZXNob3cpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKGRvY3VtZW50LmJvZHkgJiYgISRib3gucGFyZW50KCkubGVuZ3RoKSB7XHJcblx0XHRcdCQoZG9jdW1lbnQuYm9keSkuYXBwZW5kKCRvdmVybGF5LCAkYm94LmFwcGVuZCgkd3JhcCwgJGxvYWRpbmdCYXkpKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8vIEFkZCBDb2xvcmJveCdzIGV2ZW50IGJpbmRpbmdzXHJcblx0ZnVuY3Rpb24gYWRkQmluZGluZ3MoKSB7XHJcblx0XHRmdW5jdGlvbiBjbGlja0hhbmRsZXIoZSkge1xyXG5cdFx0XHQvLyBpZ25vcmUgbm9uLWxlZnQtbW91c2UtY2xpY2tzIGFuZCBjbGlja3MgbW9kaWZpZWQgd2l0aCBjdHJsIC8gY29tbWFuZCwgc2hpZnQsIG9yIGFsdC5cclxuXHRcdFx0Ly8gU2VlOiBodHRwOi8vamFja2xtb29yZS5jb20vbm90ZXMvY2xpY2stZXZlbnRzL1xyXG5cdFx0XHRpZiAoIShlLndoaWNoID4gMSB8fCBlLnNoaWZ0S2V5IHx8IGUuYWx0S2V5IHx8IGUubWV0YUtleSB8fCBlLmN0cmxLZXkpKSB7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdGxhdW5jaCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICgkYm94KSB7XHJcblx0XHRcdGlmICghaW5pdCkge1xyXG5cdFx0XHRcdGluaXQgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHQvLyBBbm9ueW1vdXMgZnVuY3Rpb25zIGhlcmUga2VlcCB0aGUgcHVibGljIG1ldGhvZCBmcm9tIGJlaW5nIGNhY2hlZCwgdGhlcmVieSBhbGxvd2luZyB0aGVtIHRvIGJlIHJlZGVmaW5lZCBvbiB0aGUgZmx5LlxyXG5cdFx0XHRcdCRuZXh0LmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHB1YmxpY01ldGhvZC5uZXh0KCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0JHByZXYuY2xpY2soZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0cHVibGljTWV0aG9kLnByZXYoKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHQkY2xvc2UuY2xpY2soZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0cHVibGljTWV0aG9kLmNsb3NlKCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0JG92ZXJsYXkuY2xpY2soZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgnb3ZlcmxheUNsb3NlJykpIHtcclxuXHRcdFx0XHRcdFx0cHVibGljTWV0aG9kLmNsb3NlKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdC8vIEtleSBCaW5kaW5nc1xyXG5cdFx0XHRcdCQoZG9jdW1lbnQpLmJpbmQoJ2tleWRvd24uJyArIHByZWZpeCwgZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0XHRcdHZhciBrZXkgPSBlLmtleUNvZGU7XHJcblx0XHRcdFx0XHRpZiAob3BlbiAmJiBzZXR0aW5ncy5nZXQoJ2VzY0tleScpICYmIGtleSA9PT0gMjcpIHtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRwdWJsaWNNZXRob2QuY2xvc2UoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChvcGVuICYmIHNldHRpbmdzLmdldCgnYXJyb3dLZXknKSAmJiAkcmVsYXRlZFsxXSAmJiAhZS5hbHRLZXkpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGtleSA9PT0gMzcpIHtcclxuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRcdFx0JHByZXYuY2xpY2soKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChrZXkgPT09IDM5KSB7XHJcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRcdCRuZXh0LmNsaWNrKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0aWYgKCQuaXNGdW5jdGlvbigkLmZuLm9uKSkge1xyXG5cdFx0XHRcdFx0Ly8gRm9yIGpRdWVyeSAxLjcrXHJcblx0XHRcdFx0XHQkKGRvY3VtZW50KS5vbignY2xpY2suJytwcmVmaXgsICcuJytib3hFbGVtZW50LCBjbGlja0hhbmRsZXIpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHQvLyBGb3IgalF1ZXJ5IDEuMy54IC0+IDEuNi54XHJcblx0XHRcdFx0XHQvLyBUaGlzIGNvZGUgaXMgbmV2ZXIgcmVhY2hlZCBpbiBqUXVlcnkgMS45LCBzbyBkbyBub3QgY29udGFjdCBtZSBhYm91dCAnbGl2ZScgYmVpbmcgcmVtb3ZlZC5cclxuXHRcdFx0XHRcdC8vIFRoaXMgaXMgbm90IGhlcmUgZm9yIGpRdWVyeSAxLjksIGl0J3MgaGVyZSBmb3IgbGVnYWN5IHVzZXJzLlxyXG5cdFx0XHRcdFx0JCgnLicrYm94RWxlbWVudCkubGl2ZSgnY2xpY2suJytwcmVmaXgsIGNsaWNrSGFuZGxlcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHJcblx0Ly8gRG9uJ3QgZG8gYW55dGhpbmcgaWYgQ29sb3Jib3ggYWxyZWFkeSBleGlzdHMuXHJcblx0aWYgKCRbY29sb3Jib3hdKSB7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cclxuXHQvLyBBcHBlbmQgdGhlIEhUTUwgd2hlbiB0aGUgRE9NIGxvYWRzXHJcblx0JChhcHBlbmRIVE1MKTtcclxuXHJcblxyXG5cdC8vICoqKioqKioqKioqKioqKipcclxuXHQvLyBQVUJMSUMgRlVOQ1RJT05TXHJcblx0Ly8gVXNhZ2UgZm9ybWF0OiAkLmNvbG9yYm94LmNsb3NlKCk7XHJcblx0Ly8gVXNhZ2UgZnJvbSB3aXRoaW4gYW4gaWZyYW1lOiBwYXJlbnQualF1ZXJ5LmNvbG9yYm94LmNsb3NlKCk7XHJcblx0Ly8gKioqKioqKioqKioqKioqKlxyXG5cclxuXHRwdWJsaWNNZXRob2QgPSAkLmZuW2NvbG9yYm94XSA9ICRbY29sb3Jib3hdID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgc2V0dGluZ3M7XHJcblx0XHR2YXIgJG9iaiA9IHRoaXM7XHJcblxyXG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG5cdFx0aWYgKCQuaXNGdW5jdGlvbigkb2JqKSkgeyAvLyBhc3N1bWUgYSBjYWxsIHRvICQuY29sb3Jib3hcclxuXHRcdFx0JG9iaiA9ICQoJzxhLz4nKTtcclxuXHRcdFx0b3B0aW9ucy5vcGVuID0gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoISRvYmpbMF0pIHsgLy8gY29sb3Jib3ggYmVpbmcgYXBwbGllZCB0byBlbXB0eSBjb2xsZWN0aW9uXHJcblx0XHRcdHJldHVybiAkb2JqO1xyXG5cdFx0fVxyXG5cclxuXHRcdGFwcGVuZEhUTUwoKTtcclxuXHJcblx0XHRpZiAoYWRkQmluZGluZ3MoKSkge1xyXG5cclxuXHRcdFx0aWYgKGNhbGxiYWNrKSB7XHJcblx0XHRcdFx0b3B0aW9ucy5vbkNvbXBsZXRlID0gY2FsbGJhY2s7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdCRvYmouZWFjaChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFyIG9sZCA9ICQuZGF0YSh0aGlzLCBjb2xvcmJveCkgfHwge307XHJcblx0XHRcdFx0JC5kYXRhKHRoaXMsIGNvbG9yYm94LCAkLmV4dGVuZChvbGQsIG9wdGlvbnMpKTtcclxuXHRcdFx0fSkuYWRkQ2xhc3MoYm94RWxlbWVudCk7XHJcblxyXG5cdFx0XHRzZXR0aW5ncyA9IG5ldyBTZXR0aW5ncygkb2JqWzBdLCBvcHRpb25zKTtcclxuXHJcblx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ29wZW4nKSkge1xyXG5cdFx0XHRcdGxhdW5jaCgkb2JqWzBdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiAkb2JqO1xyXG5cdH07XHJcblxyXG5cdHB1YmxpY01ldGhvZC5wb3NpdGlvbiA9IGZ1bmN0aW9uIChzcGVlZCwgbG9hZGVkQ2FsbGJhY2spIHtcclxuXHRcdHZhclxyXG5cdFx0Y3NzLFxyXG5cdFx0dG9wID0gMCxcclxuXHRcdGxlZnQgPSAwLFxyXG5cdFx0b2Zmc2V0ID0gJGJveC5vZmZzZXQoKSxcclxuXHRcdHNjcm9sbFRvcCxcclxuXHRcdHNjcm9sbExlZnQ7XHJcblxyXG5cdFx0JHdpbmRvdy51bmJpbmQoJ3Jlc2l6ZS4nICsgcHJlZml4KTtcclxuXHJcblx0XHQvLyByZW1vdmUgdGhlIG1vZGFsIHNvIHRoYXQgaXQgZG9lc24ndCBpbmZsdWVuY2UgdGhlIGRvY3VtZW50IHdpZHRoL2hlaWdodFxyXG5cdFx0JGJveC5jc3Moe3RvcDogLTllNCwgbGVmdDogLTllNH0pO1xyXG5cclxuXHRcdHNjcm9sbFRvcCA9ICR3aW5kb3cuc2Nyb2xsVG9wKCk7XHJcblx0XHRzY3JvbGxMZWZ0ID0gJHdpbmRvdy5zY3JvbGxMZWZ0KCk7XHJcblxyXG5cdFx0aWYgKHNldHRpbmdzLmdldCgnZml4ZWQnKSkge1xyXG5cdFx0XHRvZmZzZXQudG9wIC09IHNjcm9sbFRvcDtcclxuXHRcdFx0b2Zmc2V0LmxlZnQgLT0gc2Nyb2xsTGVmdDtcclxuXHRcdFx0JGJveC5jc3Moe3Bvc2l0aW9uOiAnZml4ZWQnfSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0b3AgPSBzY3JvbGxUb3A7XHJcblx0XHRcdGxlZnQgPSBzY3JvbGxMZWZ0O1xyXG5cdFx0XHQkYm94LmNzcyh7cG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBrZWVwcyB0aGUgdG9wIGFuZCBsZWZ0IHBvc2l0aW9ucyB3aXRoaW4gdGhlIGJyb3dzZXIncyB2aWV3cG9ydC5cclxuXHRcdGlmIChzZXR0aW5ncy5nZXQoJ3JpZ2h0JykgIT09IGZhbHNlKSB7XHJcblx0XHRcdGxlZnQgKz0gTWF0aC5tYXgoJHdpbmRvdy53aWR0aCgpIC0gc2V0dGluZ3MudyAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGggLSBzZXRTaXplKHNldHRpbmdzLmdldCgncmlnaHQnKSwgJ3gnKSwgMCk7XHJcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgnbGVmdCcpICE9PSBmYWxzZSkge1xyXG5cdFx0XHRsZWZ0ICs9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdsZWZ0JyksICd4Jyk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRsZWZ0ICs9IE1hdGgucm91bmQoTWF0aC5tYXgoJHdpbmRvdy53aWR0aCgpIC0gc2V0dGluZ3MudyAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGgsIDApIC8gMik7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHNldHRpbmdzLmdldCgnYm90dG9tJykgIT09IGZhbHNlKSB7XHJcblx0XHRcdHRvcCArPSBNYXRoLm1heCh3aW5oZWlnaHQoKSAtIHNldHRpbmdzLmggLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQgLSBzZXRTaXplKHNldHRpbmdzLmdldCgnYm90dG9tJyksICd5JyksIDApO1xyXG5cdFx0fSBlbHNlIGlmIChzZXR0aW5ncy5nZXQoJ3RvcCcpICE9PSBmYWxzZSkge1xyXG5cdFx0XHR0b3AgKz0gc2V0U2l6ZShzZXR0aW5ncy5nZXQoJ3RvcCcpLCAneScpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dG9wICs9IE1hdGgucm91bmQoTWF0aC5tYXgod2luaGVpZ2h0KCkgLSBzZXR0aW5ncy5oIC0gbG9hZGVkSGVpZ2h0IC0gaW50ZXJmYWNlSGVpZ2h0LCAwKSAvIDIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdCRib3guY3NzKHt0b3A6IG9mZnNldC50b3AsIGxlZnQ6IG9mZnNldC5sZWZ0LCB2aXNpYmlsaXR5Oid2aXNpYmxlJ30pO1xyXG5cclxuXHRcdC8vIHRoaXMgZ2l2ZXMgdGhlIHdyYXBwZXIgcGxlbnR5IG9mIGJyZWF0aGluZyByb29tIHNvIGl0J3MgZmxvYXRlZCBjb250ZW50cyBjYW4gbW92ZSBhcm91bmQgc21vb3RobHksXHJcblx0XHQvLyBidXQgaXQgaGFzIHRvIGJlIHNocmFuayBkb3duIGFyb3VuZCB0aGUgc2l6ZSBvZiBkaXYjY29sb3Jib3ggd2hlbiBpdCdzIGRvbmUuICBJZiBub3QsXHJcblx0XHQvLyBpdCBjYW4gaW52b2tlIGFuIG9ic2N1cmUgSUUgYnVnIHdoZW4gdXNpbmcgaWZyYW1lcy5cclxuXHRcdCR3cmFwWzBdLnN0eWxlLndpZHRoID0gJHdyYXBbMF0uc3R5bGUuaGVpZ2h0ID0gXCI5OTk5cHhcIjtcclxuXHJcblx0XHRmdW5jdGlvbiBtb2RhbERpbWVuc2lvbnMoKSB7XHJcblx0XHRcdCR0b3BCb3JkZXJbMF0uc3R5bGUud2lkdGggPSAkYm90dG9tQm9yZGVyWzBdLnN0eWxlLndpZHRoID0gJGNvbnRlbnRbMF0uc3R5bGUud2lkdGggPSAocGFyc2VJbnQoJGJveFswXS5zdHlsZS53aWR0aCwxMCkgLSBpbnRlcmZhY2VXaWR0aCkrJ3B4JztcclxuXHRcdFx0JGNvbnRlbnRbMF0uc3R5bGUuaGVpZ2h0ID0gJGxlZnRCb3JkZXJbMF0uc3R5bGUuaGVpZ2h0ID0gJHJpZ2h0Qm9yZGVyWzBdLnN0eWxlLmhlaWdodCA9IChwYXJzZUludCgkYm94WzBdLnN0eWxlLmhlaWdodCwxMCkgLSBpbnRlcmZhY2VIZWlnaHQpKydweCc7XHJcblx0XHR9XHJcblxyXG5cdFx0Y3NzID0ge3dpZHRoOiBzZXR0aW5ncy53ICsgbG9hZGVkV2lkdGggKyBpbnRlcmZhY2VXaWR0aCwgaGVpZ2h0OiBzZXR0aW5ncy5oICsgbG9hZGVkSGVpZ2h0ICsgaW50ZXJmYWNlSGVpZ2h0LCB0b3A6IHRvcCwgbGVmdDogbGVmdH07XHJcblxyXG5cdFx0Ly8gc2V0dGluZyB0aGUgc3BlZWQgdG8gMCBpZiB0aGUgY29udGVudCBoYXNuJ3QgY2hhbmdlZCBzaXplIG9yIHBvc2l0aW9uXHJcblx0XHRpZiAoc3BlZWQpIHtcclxuXHRcdFx0dmFyIHRlbXBTcGVlZCA9IDA7XHJcblx0XHRcdCQuZWFjaChjc3MsIGZ1bmN0aW9uKGkpe1xyXG5cdFx0XHRcdGlmIChjc3NbaV0gIT09IHByZXZpb3VzQ1NTW2ldKSB7XHJcblx0XHRcdFx0XHR0ZW1wU3BlZWQgPSBzcGVlZDtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRzcGVlZCA9IHRlbXBTcGVlZDtcclxuXHRcdH1cclxuXHJcblx0XHRwcmV2aW91c0NTUyA9IGNzcztcclxuXHJcblx0XHRpZiAoIXNwZWVkKSB7XHJcblx0XHRcdCRib3guY3NzKGNzcyk7XHJcblx0XHR9XHJcblxyXG5cdFx0JGJveC5kZXF1ZXVlKCkuYW5pbWF0ZShjc3MsIHtcclxuXHRcdFx0ZHVyYXRpb246IHNwZWVkIHx8IDAsXHJcblx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0bW9kYWxEaW1lbnNpb25zKCk7XHJcblxyXG5cdFx0XHRcdGFjdGl2ZSA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHQvLyBzaHJpbmsgdGhlIHdyYXBwZXIgZG93biB0byBleGFjdGx5IHRoZSBzaXplIG9mIGNvbG9yYm94IHRvIGF2b2lkIGEgYnVnIGluIElFJ3MgaWZyYW1lIGltcGxlbWVudGF0aW9uLlxyXG5cdFx0XHRcdCR3cmFwWzBdLnN0eWxlLndpZHRoID0gKHNldHRpbmdzLncgKyBsb2FkZWRXaWR0aCArIGludGVyZmFjZVdpZHRoKSArIFwicHhcIjtcclxuXHRcdFx0XHQkd3JhcFswXS5zdHlsZS5oZWlnaHQgPSAoc2V0dGluZ3MuaCArIGxvYWRlZEhlaWdodCArIGludGVyZmFjZUhlaWdodCkgKyBcInB4XCI7XHJcblxyXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3JlcG9zaXRpb24nKSkge1xyXG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7ICAvLyBzbWFsbCBkZWxheSBiZWZvcmUgYmluZGluZyBvbnJlc2l6ZSBkdWUgdG8gYW4gSUU4IGJ1Zy5cclxuXHRcdFx0XHRcdFx0JHdpbmRvdy5iaW5kKCdyZXNpemUuJyArIHByZWZpeCwgcHVibGljTWV0aG9kLnBvc2l0aW9uKTtcclxuXHRcdFx0XHRcdH0sIDEpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKCQuaXNGdW5jdGlvbihsb2FkZWRDYWxsYmFjaykpIHtcclxuXHRcdFx0XHRcdGxvYWRlZENhbGxiYWNrKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LFxyXG5cdFx0XHRzdGVwOiBtb2RhbERpbWVuc2lvbnNcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdHB1YmxpY01ldGhvZC5yZXNpemUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cdFx0dmFyIHNjcm9sbHRvcDtcclxuXHJcblx0XHRpZiAob3Blbikge1xyXG5cdFx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcblx0XHRcdGlmIChvcHRpb25zLndpZHRoKSB7XHJcblx0XHRcdFx0c2V0dGluZ3MudyA9IHNldFNpemUob3B0aW9ucy53aWR0aCwgJ3gnKSAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGg7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChvcHRpb25zLmlubmVyV2lkdGgpIHtcclxuXHRcdFx0XHRzZXR0aW5ncy53ID0gc2V0U2l6ZShvcHRpb25zLmlubmVyV2lkdGgsICd4Jyk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdCRsb2FkZWQuY3NzKHt3aWR0aDogc2V0dGluZ3Mud30pO1xyXG5cclxuXHRcdFx0aWYgKG9wdGlvbnMuaGVpZ2h0KSB7XHJcblx0XHRcdFx0c2V0dGluZ3MuaCA9IHNldFNpemUob3B0aW9ucy5oZWlnaHQsICd5JykgLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChvcHRpb25zLmlubmVySGVpZ2h0KSB7XHJcblx0XHRcdFx0c2V0dGluZ3MuaCA9IHNldFNpemUob3B0aW9ucy5pbm5lckhlaWdodCwgJ3knKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFvcHRpb25zLmlubmVySGVpZ2h0ICYmICFvcHRpb25zLmhlaWdodCkge1xyXG5cdFx0XHRcdHNjcm9sbHRvcCA9ICRsb2FkZWQuc2Nyb2xsVG9wKCk7XHJcblx0XHRcdFx0JGxvYWRlZC5jc3Moe2hlaWdodDogXCJhdXRvXCJ9KTtcclxuXHRcdFx0XHRzZXR0aW5ncy5oID0gJGxvYWRlZC5oZWlnaHQoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0JGxvYWRlZC5jc3Moe2hlaWdodDogc2V0dGluZ3MuaH0pO1xyXG5cclxuXHRcdFx0aWYoc2Nyb2xsdG9wKSB7XHJcblx0XHRcdFx0JGxvYWRlZC5zY3JvbGxUb3Aoc2Nyb2xsdG9wKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cHVibGljTWV0aG9kLnBvc2l0aW9uKHNldHRpbmdzLmdldCgndHJhbnNpdGlvbicpID09PSBcIm5vbmVcIiA/IDAgOiBzZXR0aW5ncy5nZXQoJ3NwZWVkJykpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdHB1YmxpY01ldGhvZC5wcmVwID0gZnVuY3Rpb24gKG9iamVjdCkge1xyXG5cdFx0aWYgKCFvcGVuKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgY2FsbGJhY2ssIHNwZWVkID0gc2V0dGluZ3MuZ2V0KCd0cmFuc2l0aW9uJykgPT09IFwibm9uZVwiID8gMCA6IHNldHRpbmdzLmdldCgnc3BlZWQnKTtcclxuXHJcblx0XHQkbG9hZGVkLnJlbW92ZSgpO1xyXG5cclxuXHRcdCRsb2FkZWQgPSAkdGFnKGRpdiwgJ0xvYWRlZENvbnRlbnQnKS5hcHBlbmQob2JqZWN0KTtcclxuXHJcblx0XHRmdW5jdGlvbiBnZXRXaWR0aCgpIHtcclxuXHRcdFx0c2V0dGluZ3MudyA9IHNldHRpbmdzLncgfHwgJGxvYWRlZC53aWR0aCgpO1xyXG5cdFx0XHRzZXR0aW5ncy53ID0gc2V0dGluZ3MubXcgJiYgc2V0dGluZ3MubXcgPCBzZXR0aW5ncy53ID8gc2V0dGluZ3MubXcgOiBzZXR0aW5ncy53O1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3MudztcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIGdldEhlaWdodCgpIHtcclxuXHRcdFx0c2V0dGluZ3MuaCA9IHNldHRpbmdzLmggfHwgJGxvYWRlZC5oZWlnaHQoKTtcclxuXHRcdFx0c2V0dGluZ3MuaCA9IHNldHRpbmdzLm1oICYmIHNldHRpbmdzLm1oIDwgc2V0dGluZ3MuaCA/IHNldHRpbmdzLm1oIDogc2V0dGluZ3MuaDtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmg7XHJcblx0XHR9XHJcblxyXG5cdFx0JGxvYWRlZC5oaWRlKClcclxuXHRcdC5hcHBlbmRUbygkbG9hZGluZ0JheS5zaG93KCkpLy8gY29udGVudCBoYXMgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIERPTSBmb3IgYWNjdXJhdGUgc2l6ZSBjYWxjdWxhdGlvbnMuXHJcblx0XHQuY3NzKHt3aWR0aDogZ2V0V2lkdGgoKSwgb3ZlcmZsb3c6IHNldHRpbmdzLmdldCgnc2Nyb2xsaW5nJykgPyAnYXV0bycgOiAnaGlkZGVuJ30pXHJcblx0XHQuY3NzKHtoZWlnaHQ6IGdldEhlaWdodCgpfSkvLyBzZXRzIHRoZSBoZWlnaHQgaW5kZXBlbmRlbnRseSBmcm9tIHRoZSB3aWR0aCBpbiBjYXNlIHRoZSBuZXcgd2lkdGggaW5mbHVlbmNlcyB0aGUgdmFsdWUgb2YgaGVpZ2h0LlxyXG5cdFx0LnByZXBlbmRUbygkY29udGVudCk7XHJcblxyXG5cdFx0JGxvYWRpbmdCYXkuaGlkZSgpO1xyXG5cclxuXHRcdC8vIGZsb2F0aW5nIHRoZSBJTUcgcmVtb3ZlcyB0aGUgYm90dG9tIGxpbmUtaGVpZ2h0IGFuZCBmaXhlZCBhIHByb2JsZW0gd2hlcmUgSUUgbWlzY2FsY3VsYXRlcyB0aGUgd2lkdGggb2YgdGhlIHBhcmVudCBlbGVtZW50IGFzIDEwMCUgb2YgdGhlIGRvY3VtZW50IHdpZHRoLlxyXG5cclxuXHRcdCQocGhvdG8pLmNzcyh7J2Zsb2F0JzogJ25vbmUnfSk7XHJcblxyXG5cdFx0c2V0Q2xhc3Moc2V0dGluZ3MuZ2V0KCdjbGFzc05hbWUnKSk7XHJcblxyXG5cdFx0Y2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciB0b3RhbCA9ICRyZWxhdGVkLmxlbmd0aCxcclxuXHRcdFx0XHRpZnJhbWUsXHJcblx0XHRcdFx0Y29tcGxldGU7XHJcblxyXG5cdFx0XHRpZiAoIW9wZW4pIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZ1bmN0aW9uIHJlbW92ZUZpbHRlcigpIHsgLy8gTmVlZGVkIGZvciBJRTggaW4gdmVyc2lvbnMgb2YgalF1ZXJ5IHByaW9yIHRvIDEuNy4yXHJcblx0XHRcdFx0aWYgKCQuc3VwcG9ydC5vcGFjaXR5ID09PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0JGJveFswXS5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoJ2ZpbHRlcicpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KGxvYWRpbmdUaW1lcik7XHJcblx0XHRcdFx0JGxvYWRpbmdPdmVybGF5LmhpZGUoKTtcclxuXHRcdFx0XHR0cmlnZ2VyKGV2ZW50X2NvbXBsZXRlKTtcclxuXHRcdFx0XHRzZXR0aW5ncy5nZXQoJ29uQ29tcGxldGUnKTtcclxuXHRcdFx0fTtcclxuXHJcblxyXG5cdFx0XHQkdGl0bGUuaHRtbChzZXR0aW5ncy5nZXQoJ3RpdGxlJykpLnNob3coKTtcclxuXHRcdFx0JGxvYWRlZC5zaG93KCk7XHJcblxyXG5cdFx0XHRpZiAodG90YWwgPiAxKSB7IC8vIGhhbmRsZSBncm91cGluZ1xyXG5cdFx0XHRcdGlmICh0eXBlb2Ygc2V0dGluZ3MuZ2V0KCdjdXJyZW50JykgPT09IFwic3RyaW5nXCIpIHtcclxuXHRcdFx0XHRcdCRjdXJyZW50Lmh0bWwoc2V0dGluZ3MuZ2V0KCdjdXJyZW50JykucmVwbGFjZSgne2N1cnJlbnR9JywgaW5kZXggKyAxKS5yZXBsYWNlKCd7dG90YWx9JywgdG90YWwpKS5zaG93KCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQkbmV4dFsoc2V0dGluZ3MuZ2V0KCdsb29wJykgfHwgaW5kZXggPCB0b3RhbCAtIDEpID8gXCJzaG93XCIgOiBcImhpZGVcIl0oKS5odG1sKHNldHRpbmdzLmdldCgnbmV4dCcpKTtcclxuXHRcdFx0XHQkcHJldlsoc2V0dGluZ3MuZ2V0KCdsb29wJykgfHwgaW5kZXgpID8gXCJzaG93XCIgOiBcImhpZGVcIl0oKS5odG1sKHNldHRpbmdzLmdldCgncHJldmlvdXMnKSk7XHJcblxyXG5cdFx0XHRcdHNsaWRlc2hvdygpO1xyXG5cclxuXHRcdFx0XHQvLyBQcmVsb2FkcyBpbWFnZXMgd2l0aGluIGEgcmVsIGdyb3VwXHJcblx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgncHJlbG9hZGluZycpKSB7XHJcblx0XHRcdFx0XHQkLmVhY2goW2dldEluZGV4KC0xKSwgZ2V0SW5kZXgoMSldLCBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdFx0XHR2YXIgaW1nLFxyXG5cdFx0XHRcdFx0XHRcdGkgPSAkcmVsYXRlZFt0aGlzXSxcclxuXHRcdFx0XHRcdFx0XHRzZXR0aW5ncyA9IG5ldyBTZXR0aW5ncyhpLCAkLmRhdGEoaSwgY29sb3Jib3gpKSxcclxuXHRcdFx0XHRcdFx0XHRzcmMgPSBzZXR0aW5ncy5nZXQoJ2hyZWYnKTtcclxuXHJcblx0XHRcdFx0XHRcdGlmIChzcmMgJiYgaXNJbWFnZShzZXR0aW5ncywgc3JjKSkge1xyXG5cdFx0XHRcdFx0XHRcdHNyYyA9IHJldGluYVVybChzZXR0aW5ncywgc3JjKTtcclxuXHRcdFx0XHRcdFx0XHRpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuXHRcdFx0XHRcdFx0XHRpbWcuc3JjID0gc3JjO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0JGdyb3VwQ29udHJvbHMuaGlkZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdpZnJhbWUnKSkge1xyXG5cclxuXHRcdFx0XHRpZnJhbWUgPSBzZXR0aW5ncy5nZXQoJ2NyZWF0ZUlmcmFtZScpO1xyXG5cclxuXHRcdFx0XHRpZiAoIXNldHRpbmdzLmdldCgnc2Nyb2xsaW5nJykpIHtcclxuXHRcdFx0XHRcdGlmcmFtZS5zY3JvbGxpbmcgPSBcIm5vXCI7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQkKGlmcmFtZSlcclxuXHRcdFx0XHRcdC5hdHRyKHtcclxuXHRcdFx0XHRcdFx0c3JjOiBzZXR0aW5ncy5nZXQoJ2hyZWYnKSxcclxuXHRcdFx0XHRcdFx0J2NsYXNzJzogcHJlZml4ICsgJ0lmcmFtZSdcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQub25lKCdsb2FkJywgY29tcGxldGUpXHJcblx0XHRcdFx0XHQuYXBwZW5kVG8oJGxvYWRlZCk7XHJcblxyXG5cdFx0XHRcdCRldmVudHMub25lKGV2ZW50X3B1cmdlLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRpZnJhbWUuc3JjID0gXCIvL2Fib3V0OmJsYW5rXCI7XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ2Zhc3RJZnJhbWUnKSkge1xyXG5cdFx0XHRcdFx0JChpZnJhbWUpLnRyaWdnZXIoJ2xvYWQnKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Y29tcGxldGUoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHNldHRpbmdzLmdldCgndHJhbnNpdGlvbicpID09PSAnZmFkZScpIHtcclxuXHRcdFx0XHQkYm94LmZhZGVUbyhzcGVlZCwgMSwgcmVtb3ZlRmlsdGVyKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRyZW1vdmVGaWx0ZXIoKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCd0cmFuc2l0aW9uJykgPT09ICdmYWRlJykge1xyXG5cdFx0XHQkYm94LmZhZGVUbyhzcGVlZCwgMCwgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHB1YmxpY01ldGhvZC5wb3NpdGlvbigwLCBjYWxsYmFjayk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cHVibGljTWV0aG9kLnBvc2l0aW9uKHNwZWVkLCBjYWxsYmFjayk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0ZnVuY3Rpb24gbG9hZCAoKSB7XHJcblx0XHR2YXIgaHJlZiwgc2V0UmVzaXplLCBwcmVwID0gcHVibGljTWV0aG9kLnByZXAsICRpbmxpbmUsIHJlcXVlc3QgPSArK3JlcXVlc3RzO1xyXG5cclxuXHRcdGFjdGl2ZSA9IHRydWU7XHJcblxyXG5cdFx0cGhvdG8gPSBmYWxzZTtcclxuXHJcblx0XHR0cmlnZ2VyKGV2ZW50X3B1cmdlKTtcclxuXHRcdHRyaWdnZXIoZXZlbnRfbG9hZCk7XHJcblx0XHRzZXR0aW5ncy5nZXQoJ29uTG9hZCcpO1xyXG5cclxuXHRcdHNldHRpbmdzLmggPSBzZXR0aW5ncy5nZXQoJ2hlaWdodCcpID9cclxuXHRcdFx0XHRzZXRTaXplKHNldHRpbmdzLmdldCgnaGVpZ2h0JyksICd5JykgLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQgOlxyXG5cdFx0XHRcdHNldHRpbmdzLmdldCgnaW5uZXJIZWlnaHQnKSAmJiBzZXRTaXplKHNldHRpbmdzLmdldCgnaW5uZXJIZWlnaHQnKSwgJ3knKTtcclxuXHJcblx0XHRzZXR0aW5ncy53ID0gc2V0dGluZ3MuZ2V0KCd3aWR0aCcpID9cclxuXHRcdFx0XHRzZXRTaXplKHNldHRpbmdzLmdldCgnd2lkdGgnKSwgJ3gnKSAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGggOlxyXG5cdFx0XHRcdHNldHRpbmdzLmdldCgnaW5uZXJXaWR0aCcpICYmIHNldFNpemUoc2V0dGluZ3MuZ2V0KCdpbm5lcldpZHRoJyksICd4Jyk7XHJcblxyXG5cdFx0Ly8gU2V0cyB0aGUgbWluaW11bSBkaW1lbnNpb25zIGZvciB1c2UgaW4gaW1hZ2Ugc2NhbGluZ1xyXG5cdFx0c2V0dGluZ3MubXcgPSBzZXR0aW5ncy53O1xyXG5cdFx0c2V0dGluZ3MubWggPSBzZXR0aW5ncy5oO1xyXG5cclxuXHRcdC8vIFJlLWV2YWx1YXRlIHRoZSBtaW5pbXVtIHdpZHRoIGFuZCBoZWlnaHQgYmFzZWQgb24gbWF4V2lkdGggYW5kIG1heEhlaWdodCB2YWx1ZXMuXHJcblx0XHQvLyBJZiB0aGUgd2lkdGggb3IgaGVpZ2h0IGV4Y2VlZCB0aGUgbWF4V2lkdGggb3IgbWF4SGVpZ2h0LCB1c2UgdGhlIG1heGltdW0gdmFsdWVzIGluc3RlYWQuXHJcblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdtYXhXaWR0aCcpKSB7XHJcblx0XHRcdHNldHRpbmdzLm13ID0gc2V0U2l6ZShzZXR0aW5ncy5nZXQoJ21heFdpZHRoJyksICd4JykgLSBsb2FkZWRXaWR0aCAtIGludGVyZmFjZVdpZHRoO1xyXG5cdFx0XHRzZXR0aW5ncy5tdyA9IHNldHRpbmdzLncgJiYgc2V0dGluZ3MudyA8IHNldHRpbmdzLm13ID8gc2V0dGluZ3MudyA6IHNldHRpbmdzLm13O1xyXG5cdFx0fVxyXG5cdFx0aWYgKHNldHRpbmdzLmdldCgnbWF4SGVpZ2h0JykpIHtcclxuXHRcdFx0c2V0dGluZ3MubWggPSBzZXRTaXplKHNldHRpbmdzLmdldCgnbWF4SGVpZ2h0JyksICd5JykgLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQ7XHJcblx0XHRcdHNldHRpbmdzLm1oID0gc2V0dGluZ3MuaCAmJiBzZXR0aW5ncy5oIDwgc2V0dGluZ3MubWggPyBzZXR0aW5ncy5oIDogc2V0dGluZ3MubWg7XHJcblx0XHR9XHJcblxyXG5cdFx0aHJlZiA9IHNldHRpbmdzLmdldCgnaHJlZicpO1xyXG5cclxuXHRcdGxvYWRpbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHQkbG9hZGluZ092ZXJsYXkuc2hvdygpO1xyXG5cdFx0fSwgMTAwKTtcclxuXHJcblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdpbmxpbmUnKSkge1xyXG5cdFx0XHR2YXIgJHRhcmdldCA9ICQoaHJlZik7XHJcblx0XHRcdC8vIEluc2VydHMgYW4gZW1wdHkgcGxhY2Vob2xkZXIgd2hlcmUgaW5saW5lIGNvbnRlbnQgaXMgYmVpbmcgcHVsbGVkIGZyb20uXHJcblx0XHRcdC8vIEFuIGV2ZW50IGlzIGJvdW5kIHRvIHB1dCBpbmxpbmUgY29udGVudCBiYWNrIHdoZW4gQ29sb3Jib3ggY2xvc2VzIG9yIGxvYWRzIG5ldyBjb250ZW50LlxyXG5cdFx0XHQkaW5saW5lID0gJCgnPGRpdj4nKS5oaWRlKCkuaW5zZXJ0QmVmb3JlKCR0YXJnZXQpO1xyXG5cclxuXHRcdFx0JGV2ZW50cy5vbmUoZXZlbnRfcHVyZ2UsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHQkaW5saW5lLnJlcGxhY2VXaXRoKCR0YXJnZXQpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHByZXAoJHRhcmdldCk7XHJcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgnaWZyYW1lJykpIHtcclxuXHRcdFx0Ly8gSUZyYW1lIGVsZW1lbnQgd29uJ3QgYmUgYWRkZWQgdG8gdGhlIERPTSB1bnRpbCBpdCBpcyByZWFkeSB0byBiZSBkaXNwbGF5ZWQsXHJcblx0XHRcdC8vIHRvIGF2b2lkIHByb2JsZW1zIHdpdGggRE9NLXJlYWR5IEpTIHRoYXQgbWlnaHQgYmUgdHJ5aW5nIHRvIHJ1biBpbiB0aGF0IGlmcmFtZS5cclxuXHRcdFx0cHJlcChcIiBcIik7XHJcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgnaHRtbCcpKSB7XHJcblx0XHRcdHByZXAoc2V0dGluZ3MuZ2V0KCdodG1sJykpO1xyXG5cdFx0fSBlbHNlIGlmIChpc0ltYWdlKHNldHRpbmdzLCBocmVmKSkge1xyXG5cclxuXHRcdFx0aHJlZiA9IHJldGluYVVybChzZXR0aW5ncywgaHJlZik7XHJcblxyXG5cdFx0XHRwaG90byA9IHNldHRpbmdzLmdldCgnY3JlYXRlSW1nJyk7XHJcblxyXG5cdFx0XHQkKHBob3RvKVxyXG5cdFx0XHQuYWRkQ2xhc3MocHJlZml4ICsgJ1Bob3RvJylcclxuXHRcdFx0LmJpbmQoJ2Vycm9yLicrcHJlZml4LGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRwcmVwKCR0YWcoZGl2LCAnRXJyb3InKS5odG1sKHNldHRpbmdzLmdldCgnaW1nRXJyb3InKSkpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQub25lKCdsb2FkJywgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGlmIChyZXF1ZXN0ICE9PSByZXF1ZXN0cykge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gQSBzbWFsbCBwYXVzZSBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgd2lsbCBvY2Nhc3Npb25hbHkgcmVwb3J0IGFcclxuXHRcdFx0XHQvLyBpbWcud2lkdGggYW5kIGltZy5oZWlnaHQgb2YgemVybyBpbW1lZGlhdGVseSBhZnRlciB0aGUgaW1nLm9ubG9hZCBmaXJlc1xyXG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRcdHZhciBwZXJjZW50O1xyXG5cclxuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3JldGluYUltYWdlJykgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxKSB7XHJcblx0XHRcdFx0XHRcdHBob3RvLmhlaWdodCA9IHBob3RvLmhlaWdodCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xyXG5cdFx0XHRcdFx0XHRwaG90by53aWR0aCA9IHBob3RvLndpZHRoIC8gd2luZG93LmRldmljZVBpeGVsUmF0aW87XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgnc2NhbGVQaG90b3MnKSkge1xyXG5cdFx0XHRcdFx0XHRzZXRSZXNpemUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0cGhvdG8uaGVpZ2h0IC09IHBob3RvLmhlaWdodCAqIHBlcmNlbnQ7XHJcblx0XHRcdFx0XHRcdFx0cGhvdG8ud2lkdGggLT0gcGhvdG8ud2lkdGggKiBwZXJjZW50O1xyXG5cdFx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0XHRpZiAoc2V0dGluZ3MubXcgJiYgcGhvdG8ud2lkdGggPiBzZXR0aW5ncy5tdykge1xyXG5cdFx0XHRcdFx0XHRcdHBlcmNlbnQgPSAocGhvdG8ud2lkdGggLSBzZXR0aW5ncy5tdykgLyBwaG90by53aWR0aDtcclxuXHRcdFx0XHRcdFx0XHRzZXRSZXNpemUoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAoc2V0dGluZ3MubWggJiYgcGhvdG8uaGVpZ2h0ID4gc2V0dGluZ3MubWgpIHtcclxuXHRcdFx0XHRcdFx0XHRwZXJjZW50ID0gKHBob3RvLmhlaWdodCAtIHNldHRpbmdzLm1oKSAvIHBob3RvLmhlaWdodDtcclxuXHRcdFx0XHRcdFx0XHRzZXRSZXNpemUoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5oKSB7XHJcblx0XHRcdFx0XHRcdHBob3RvLnN0eWxlLm1hcmdpblRvcCA9IE1hdGgubWF4KHNldHRpbmdzLm1oIC0gcGhvdG8uaGVpZ2h0LCAwKSAvIDIgKyAncHgnO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICgkcmVsYXRlZFsxXSAmJiAoc2V0dGluZ3MuZ2V0KCdsb29wJykgfHwgJHJlbGF0ZWRbaW5kZXggKyAxXSkpIHtcclxuXHRcdFx0XHRcdFx0cGhvdG8uc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInO1xyXG5cclxuXHRcdFx0XHRcdFx0JChwaG90bykuYmluZCgnY2xpY2suJytwcmVmaXgsIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRwdWJsaWNNZXRob2QubmV4dCgpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRwaG90by5zdHlsZS53aWR0aCA9IHBob3RvLndpZHRoICsgJ3B4JztcclxuXHRcdFx0XHRcdHBob3RvLnN0eWxlLmhlaWdodCA9IHBob3RvLmhlaWdodCArICdweCc7XHJcblx0XHRcdFx0XHRwcmVwKHBob3RvKTtcclxuXHRcdFx0XHR9LCAxKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRwaG90by5zcmMgPSBocmVmO1xyXG5cclxuXHRcdH0gZWxzZSBpZiAoaHJlZikge1xyXG5cdFx0XHQkbG9hZGluZ0JheS5sb2FkKGhyZWYsIHNldHRpbmdzLmdldCgnZGF0YScpLCBmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XHJcblx0XHRcdFx0aWYgKHJlcXVlc3QgPT09IHJlcXVlc3RzKSB7XHJcblx0XHRcdFx0XHRwcmVwKHN0YXR1cyA9PT0gJ2Vycm9yJyA/ICR0YWcoZGl2LCAnRXJyb3InKS5odG1sKHNldHRpbmdzLmdldCgneGhyRXJyb3InKSkgOiAkKHRoaXMpLmNvbnRlbnRzKCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBOYXZpZ2F0ZXMgdG8gdGhlIG5leHQgcGFnZS9pbWFnZSBpbiBhIHNldC5cclxuXHRwdWJsaWNNZXRob2QubmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdGlmICghYWN0aXZlICYmICRyZWxhdGVkWzFdICYmIChzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCAkcmVsYXRlZFtpbmRleCArIDFdKSkge1xyXG5cdFx0XHRpbmRleCA9IGdldEluZGV4KDEpO1xyXG5cdFx0XHRsYXVuY2goJHJlbGF0ZWRbaW5kZXhdKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRwdWJsaWNNZXRob2QucHJldiA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdGlmICghYWN0aXZlICYmICRyZWxhdGVkWzFdICYmIChzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCBpbmRleCkpIHtcclxuXHRcdFx0aW5kZXggPSBnZXRJbmRleCgtMSk7XHJcblx0XHRcdGxhdW5jaCgkcmVsYXRlZFtpbmRleF0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdC8vIE5vdGU6IHRvIHVzZSB0aGlzIHdpdGhpbiBhbiBpZnJhbWUgdXNlIHRoZSBmb2xsb3dpbmcgZm9ybWF0OiBwYXJlbnQualF1ZXJ5LmNvbG9yYm94LmNsb3NlKCk7XHJcblx0cHVibGljTWV0aG9kLmNsb3NlID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0aWYgKG9wZW4gJiYgIWNsb3NpbmcpIHtcclxuXHJcblx0XHRcdGNsb3NpbmcgPSB0cnVlO1xyXG5cdFx0XHRvcGVuID0gZmFsc2U7XHJcblx0XHRcdHRyaWdnZXIoZXZlbnRfY2xlYW51cCk7XHJcblx0XHRcdHNldHRpbmdzLmdldCgnb25DbGVhbnVwJyk7XHJcblx0XHRcdCR3aW5kb3cudW5iaW5kKCcuJyArIHByZWZpeCk7XHJcblx0XHRcdCRvdmVybGF5LmZhZGVUbyhzZXR0aW5ncy5nZXQoJ2ZhZGVPdXQnKSB8fCAwLCAwKTtcclxuXHJcblx0XHRcdCRib3guc3RvcCgpLmZhZGVUbyhzZXR0aW5ncy5nZXQoJ2ZhZGVPdXQnKSB8fCAwLCAwLCBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0JGJveC5oaWRlKCk7XHJcblx0XHRcdFx0JG92ZXJsYXkuaGlkZSgpO1xyXG5cdFx0XHRcdHRyaWdnZXIoZXZlbnRfcHVyZ2UpO1xyXG5cdFx0XHRcdCRsb2FkZWQucmVtb3ZlKCk7XHJcblxyXG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0Y2xvc2luZyA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0dHJpZ2dlcihldmVudF9jbG9zZWQpO1xyXG5cdFx0XHRcdFx0c2V0dGluZ3MuZ2V0KCdvbkNsb3NlZCcpO1xyXG5cdFx0XHRcdH0sIDEpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHQvLyBSZW1vdmVzIGNoYW5nZXMgQ29sb3Jib3ggbWFkZSB0byB0aGUgZG9jdW1lbnQsIGJ1dCBkb2VzIG5vdCByZW1vdmUgdGhlIHBsdWdpbi5cclxuXHRwdWJsaWNNZXRob2QucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0aWYgKCEkYm94KSB7IHJldHVybjsgfVxyXG5cclxuXHRcdCRib3guc3RvcCgpO1xyXG5cdFx0JFtjb2xvcmJveF0uY2xvc2UoKTtcclxuXHRcdCRib3guc3RvcChmYWxzZSwgdHJ1ZSkucmVtb3ZlKCk7XHJcblx0XHQkb3ZlcmxheS5yZW1vdmUoKTtcclxuXHRcdGNsb3NpbmcgPSBmYWxzZTtcclxuXHRcdCRib3ggPSBudWxsO1xyXG5cdFx0JCgnLicgKyBib3hFbGVtZW50KVxyXG5cdFx0XHQucmVtb3ZlRGF0YShjb2xvcmJveClcclxuXHRcdFx0LnJlbW92ZUNsYXNzKGJveEVsZW1lbnQpO1xyXG5cclxuXHRcdCQoZG9jdW1lbnQpLnVuYmluZCgnY2xpY2suJytwcmVmaXgpLnVuYmluZCgna2V5ZG93bi4nK3ByZWZpeCk7XHJcblx0fTtcclxuXHJcblx0Ly8gQSBtZXRob2QgZm9yIGZldGNoaW5nIHRoZSBjdXJyZW50IGVsZW1lbnQgQ29sb3Jib3ggaXMgcmVmZXJlbmNpbmcuXHJcblx0Ly8gcmV0dXJucyBhIGpRdWVyeSBvYmplY3QuXHJcblx0cHVibGljTWV0aG9kLmVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRyZXR1cm4gJChzZXR0aW5ncy5lbCk7XHJcblx0fTtcclxuXHJcblx0cHVibGljTWV0aG9kLnNldHRpbmdzID0gZGVmYXVsdHM7XHJcblxyXG59KGpRdWVyeSwgZG9jdW1lbnQsIHdpbmRvdykpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
