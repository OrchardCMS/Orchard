/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/*!
	Colorbox 1.6.3
	license: MIT
	http://www.jacklmoore.com/colorbox
*/
(function ($, document, window) {
	var
	// Default settings object.
	// See http://jacklmoore.com/colorbox for details.
	defaults = {
		// data sources
		html: false,
		photo: false,
		iframe: false,
		inline: false,

		// behavior and appearance
		transition: "elastic",
		speed: 300,
		fadeOut: 300,
		width: false,
		initialWidth: "600",
		innerWidth: false,
		maxWidth: false,
		height: false,
		initialHeight: "450",
		innerHeight: false,
		maxHeight: false,
		scalePhotos: true,
		scrolling: true,
		opacity: 0.9,
		preloading: true,
		className: false,
		overlayClose: true,
		escKey: true,
		arrowKey: true,
		top: false,
		bottom: false,
		left: false,
		right: false,
		fixed: false,
		data: undefined,
		closeButton: true,
		fastIframe: true,
		open: false,
		reposition: true,
		loop: true,
		slideshow: false,
		slideshowAuto: true,
		slideshowSpeed: 2500,
		slideshowStart: "start slideshow",
		slideshowStop: "stop slideshow",
		photoRegex: /\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,

		// alternate image paths for high-res displays
		retinaImage: false,
		retinaUrl: false,
		retinaSuffix: '@2x.$1',

		// internationalization
		current: "image {current} of {total}",
		previous: "previous",
		next: "next",
		close: "close",
		xhrError: "This content failed to load.",
		imgError: "This image failed to load.",

		// accessbility
		returnFocus: true,
		trapFocus: true,

		// callbacks
		onOpen: false,
		onLoad: false,
		onComplete: false,
		onCleanup: false,
		onClosed: false,

		rel: function() {
			return this.rel;
		},
		href: function() {
			// using this.href would give the absolute url, when the href may have been inteded as a selector (e.g. '#container')
			return $(this).attr('href');
		},
		title: function() {
			return this.title;
		},
		createImg: function() {
			var img = new Image();
			var attrs = $(this).data('cbox-img-attrs');

			if (typeof attrs === 'object') {
				$.each(attrs, function(key, val){
					img[key] = val;
				});
			}

			return img;
		},
		createIframe: function() {
			var iframe = document.createElement('iframe');
			var attrs = $(this).data('cbox-iframe-attrs');

			if (typeof attrs === 'object') {
				$.each(attrs, function(key, val){
					iframe[key] = val;
				});
			}

			if ('frameBorder' in iframe) {
				iframe.frameBorder = 0;
			}
			if ('allowTransparency' in iframe) {
				iframe.allowTransparency = "true";
			}
			iframe.name = (new Date()).getTime(); // give the iframe a unique name to prevent caching
			iframe.allowFullscreen = true;

			return iframe;
		}
	},

	// Abstracting the HTML and event identifiers for easy rebranding
	colorbox = 'colorbox',
	prefix = 'cbox',
	boxElement = prefix + 'Element',

	// Events
	event_open = prefix + '_open',
	event_load = prefix + '_load',
	event_complete = prefix + '_complete',
	event_cleanup = prefix + '_cleanup',
	event_closed = prefix + '_closed',
	event_purge = prefix + '_purge',

	// Cached jQuery Object Variables
	$overlay,
	$box,
	$wrap,
	$content,
	$topBorder,
	$leftBorder,
	$rightBorder,
	$bottomBorder,
	$related,
	$window,
	$loaded,
	$loadingBay,
	$loadingOverlay,
	$title,
	$current,
	$slideshow,
	$next,
	$prev,
	$close,
	$groupControls,
	$events = $('<a/>'), // $({}) would be prefered, but there is an issue with jQuery 1.4.2

	// Variables for cached values or use across multiple functions
	settings,
	interfaceHeight,
	interfaceWidth,
	loadedHeight,
	loadedWidth,
	index,
	photo,
	open,
	active,
	closing,
	loadingTimer,
	publicMethod,
	div = "div",
	requests = 0,
	previousCSS = {},
	init;

	// ****************
	// HELPER FUNCTIONS
	// ****************

	// Convenience function for creating new jQuery objects
	function $tag(tag, id, css) {
		var element = document.createElement(tag);

		if (id) {
			element.id = prefix + id;
		}

		if (css) {
			element.style.cssText = css;
		}

		return $(element);
	}

	// Get the window height using innerHeight when available to avoid an issue with iOS
	// http://bugs.jquery.com/ticket/6724
	function winheight() {
		return window.innerHeight ? window.innerHeight : $(window).height();
	}

	function Settings(element, options) {
		if (options !== Object(options)) {
			options = {};
		}

		this.cache = {};
		this.el = element;

		this.value = function(key) {
			var dataAttr;

			if (this.cache[key] === undefined) {
				dataAttr = $(this.el).attr('data-cbox-'+key);

				if (dataAttr !== undefined) {
					this.cache[key] = dataAttr;
				} else if (options[key] !== undefined) {
					this.cache[key] = options[key];
				} else if (defaults[key] !== undefined) {
					this.cache[key] = defaults[key];
				}
			}

			return this.cache[key];
		};

		this.get = function(key) {
			var value = this.value(key);
			return $.isFunction(value) ? value.call(this.el, this) : value;
		};
	}

	// Determine the next and previous members in a group.
	function getIndex(increment) {
		var
		max = $related.length,
		newIndex = (index + increment) % max;

		return (newIndex < 0) ? max + newIndex : newIndex;
	}

	// Convert '%' and 'px' values to integers
	function setSize(size, dimension) {
		return Math.round((/%/.test(size) ? ((dimension === 'x' ? $window.width() : winheight()) / 100) : 1) * parseInt(size, 10));
	}

	// Checks an href to see if it is a photo.
	// There is a force photo option (photo: true) for hrefs that cannot be matched by the regex.
	function isImage(settings, url) {
		return settings.get('photo') || settings.get('photoRegex').test(url);
	}

	function retinaUrl(settings, url) {
		return settings.get('retinaUrl') && window.devicePixelRatio > 1 ? url.replace(settings.get('photoRegex'), settings.get('retinaSuffix')) : url;
	}

	function trapFocus(e) {
		if ('contains' in $box[0] && !$box[0].contains(e.target) && e.target !== $overlay[0]) {
			e.stopPropagation();
			$box.focus();
		}
	}

	function setClass(str) {
		if (setClass.str !== str) {
			$box.add($overlay).removeClass(setClass.str).addClass(str);
			setClass.str = str;
		}
	}

	function getRelated(rel) {
		index = 0;

		if (rel && rel !== false && rel !== 'nofollow') {
			$related = $('.' + boxElement).filter(function () {
				var options = $.data(this, colorbox);
				var settings = new Settings(this, options);
				return (settings.get('rel') === rel);
			});
			index = $related.index(settings.el);

			// Check direct calls to Colorbox.
			if (index === -1) {
				$related = $related.add(settings.el);
				index = $related.length - 1;
			}
		} else {
			$related = $(settings.el);
		}
	}

	function trigger(event) {
		// for external use
		$(document).trigger(event);
		// for internal use
		$events.triggerHandler(event);
	}

	var slideshow = (function(){
		var active,
			className = prefix + "Slideshow_",
			click = "click." + prefix,
			timeOut;

		function clear () {
			clearTimeout(timeOut);
		}

		function set() {
			if (settings.get('loop') || $related[index + 1]) {
				clear();
				timeOut = setTimeout(publicMethod.next, settings.get('slideshowSpeed'));
			}
		}

		function start() {
			$slideshow
				.html(settings.get('slideshowStop'))
				.unbind(click)
				.one(click, stop);

			$events
				.bind(event_complete, set)
				.bind(event_load, clear);

			$box.removeClass(className + "off").addClass(className + "on");
		}

		function stop() {
			clear();

			$events
				.unbind(event_complete, set)
				.unbind(event_load, clear);

			$slideshow
				.html(settings.get('slideshowStart'))
				.unbind(click)
				.one(click, function () {
					publicMethod.next();
					start();
				});

			$box.removeClass(className + "on").addClass(className + "off");
		}

		function reset() {
			active = false;
			$slideshow.hide();
			clear();
			$events
				.unbind(event_complete, set)
				.unbind(event_load, clear);
			$box.removeClass(className + "off " + className + "on");
		}

		return function(){
			if (active) {
				if (!settings.get('slideshow')) {
					$events.unbind(event_cleanup, reset);
					reset();
				}
			} else {
				if (settings.get('slideshow') && $related[1]) {
					active = true;
					$events.one(event_cleanup, reset);
					if (settings.get('slideshowAuto')) {
						start();
					} else {
						stop();
					}
					$slideshow.show();
				}
			}
		};

	}());


	function launch(element) {
		var options;

		if (!closing) {

			options = $(element).data(colorbox);

			settings = new Settings(element, options);

			getRelated(settings.get('rel'));

			if (!open) {
				open = active = true; // Prevents the page-change action from queuing up if the visitor holds down the left or right keys.

				setClass(settings.get('className'));

				// Show colorbox so the sizes can be calculated in older versions of jQuery
				$box.css({visibility:'hidden', display:'block', opacity:''});

				$loaded = $tag(div, 'LoadedContent', 'width:0; height:0; overflow:hidden; visibility:hidden');
				$content.css({width:'', height:''}).append($loaded);

				// Cache values needed for size calculations
				interfaceHeight = $topBorder.height() + $bottomBorder.height() + $content.outerHeight(true) - $content.height();
				interfaceWidth = $leftBorder.width() + $rightBorder.width() + $content.outerWidth(true) - $content.width();
				loadedHeight = $loaded.outerHeight(true);
				loadedWidth = $loaded.outerWidth(true);

				// Opens inital empty Colorbox prior to content being loaded.
				var initialWidth = setSize(settings.get('initialWidth'), 'x');
				var initialHeight = setSize(settings.get('initialHeight'), 'y');
				var maxWidth = settings.get('maxWidth');
				var maxHeight = settings.get('maxHeight');

				settings.w = Math.max((maxWidth !== false ? Math.min(initialWidth, setSize(maxWidth, 'x')) : initialWidth) - loadedWidth - interfaceWidth, 0);
				settings.h = Math.max((maxHeight !== false ? Math.min(initialHeight, setSize(maxHeight, 'y')) : initialHeight) - loadedHeight - interfaceHeight, 0);

				$loaded.css({width:'', height:settings.h});
				publicMethod.position();

				trigger(event_open);
				settings.get('onOpen');

				$groupControls.add($title).hide();

				$box.focus();

				if (settings.get('trapFocus')) {
					// Confine focus to the modal
					// Uses event capturing that is not supported in IE8-
					if (document.addEventListener) {

						document.addEventListener('focus', trapFocus, true);

						$events.one(event_closed, function () {
							document.removeEventListener('focus', trapFocus, true);
						});
					}
				}

				// Return focus on closing
				if (settings.get('returnFocus')) {
					$events.one(event_closed, function () {
						$(settings.el).focus();
					});
				}
			}

			var opacity = parseFloat(settings.get('opacity'));
			$overlay.css({
				opacity: opacity === opacity ? opacity : '',
				cursor: settings.get('overlayClose') ? 'pointer' : '',
				visibility: 'visible'
			}).show();

			if (settings.get('closeButton')) {
				$close.html(settings.get('close')).appendTo($content);
			} else {
				$close.appendTo('<div/>'); // replace with .detach() when dropping jQuery < 1.4
			}

			load();
		}
	}

	// Colorbox's markup needs to be added to the DOM prior to being called
	// so that the browser will go ahead and load the CSS background images.
	function appendHTML() {
		if (!$box) {
			init = false;
			$window = $(window);
			$box = $tag(div).attr({
				id: colorbox,
				'class': $.support.opacity === false ? prefix + 'IE' : '', // class for optional IE8 & lower targeted CSS.
				role: 'dialog',
				tabindex: '-1'
			}).hide();
			$overlay = $tag(div, "Overlay").hide();
			$loadingOverlay = $([$tag(div, "LoadingOverlay")[0],$tag(div, "LoadingGraphic")[0]]);
			$wrap = $tag(div, "Wrapper");
			$content = $tag(div, "Content").append(
				$title = $tag(div, "Title"),
				$current = $tag(div, "Current"),
				$prev = $('<button type="button"/>').attr({id:prefix+'Previous'}),
				$next = $('<button type="button"/>').attr({id:prefix+'Next'}),
				$slideshow = $tag('button', "Slideshow"),
				$loadingOverlay
			);

			$close = $('<button type="button"/>').attr({id:prefix+'Close'});

			$wrap.append( // The 3x3 Grid that makes up Colorbox
				$tag(div).append(
					$tag(div, "TopLeft"),
					$topBorder = $tag(div, "TopCenter"),
					$tag(div, "TopRight")
				),
				$tag(div, false, 'clear:left').append(
					$leftBorder = $tag(div, "MiddleLeft"),
					$content,
					$rightBorder = $tag(div, "MiddleRight")
				),
				$tag(div, false, 'clear:left').append(
					$tag(div, "BottomLeft"),
					$bottomBorder = $tag(div, "BottomCenter"),
					$tag(div, "BottomRight")
				)
			).find('div div').css({'float': 'left'});

			$loadingBay = $tag(div, false, 'position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;');

			$groupControls = $next.add($prev).add($current).add($slideshow);
		}
		if (document.body && !$box.parent().length) {
			$(document.body).append($overlay, $box.append($wrap, $loadingBay));
		}
	}

	// Add Colorbox's event bindings
	function addBindings() {
		function clickHandler(e) {
			// ignore non-left-mouse-clicks and clicks modified with ctrl / command, shift, or alt.
			// See: http://jacklmoore.com/notes/click-events/
			if (!(e.which > 1 || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey)) {
				e.preventDefault();
				launch(this);
			}
		}

		if ($box) {
			if (!init) {
				init = true;

				// Anonymous functions here keep the public method from being cached, thereby allowing them to be redefined on the fly.
				$next.click(function () {
					publicMethod.next();
				});
				$prev.click(function () {
					publicMethod.prev();
				});
				$close.click(function () {
					publicMethod.close();
				});
				$overlay.click(function () {
					if (settings.get('overlayClose')) {
						publicMethod.close();
					}
				});

				// Key Bindings
				$(document).bind('keydown.' + prefix, function (e) {
					var key = e.keyCode;
					if (open && settings.get('escKey') && key === 27) {
						e.preventDefault();
						publicMethod.close();
					}
					if (open && settings.get('arrowKey') && $related[1] && !e.altKey) {
						if (key === 37) {
							e.preventDefault();
							$prev.click();
						} else if (key === 39) {
							e.preventDefault();
							$next.click();
						}
					}
				});

				if ($.isFunction($.fn.on)) {
					// For jQuery 1.7+
					$(document).on('click.'+prefix, '.'+boxElement, clickHandler);
				} else {
					// For jQuery 1.3.x -> 1.6.x
					// This code is never reached in jQuery 1.9, so do not contact me about 'live' being removed.
					// This is not here for jQuery 1.9, it's here for legacy users.
					$('.'+boxElement).live('click.'+prefix, clickHandler);
				}
			}
			return true;
		}
		return false;
	}

	// Don't do anything if Colorbox already exists.
	if ($[colorbox]) {
		return;
	}

	// Append the HTML when the DOM loads
	$(appendHTML);


	// ****************
	// PUBLIC FUNCTIONS
	// Usage format: $.colorbox.close();
	// Usage from within an iframe: parent.jQuery.colorbox.close();
	// ****************

	publicMethod = $.fn[colorbox] = $[colorbox] = function (options, callback) {
		var settings;
		var $obj = this;

		options = options || {};

		if ($.isFunction($obj)) { // assume a call to $.colorbox
			$obj = $('<a/>');
			options.open = true;
		}

		if (!$obj[0]) { // colorbox being applied to empty collection
			return $obj;
		}

		appendHTML();

		if (addBindings()) {

			if (callback) {
				options.onComplete = callback;
			}

			$obj.each(function () {
				var old = $.data(this, colorbox) || {};
				$.data(this, colorbox, $.extend(old, options));
			}).addClass(boxElement);

			settings = new Settings($obj[0], options);

			if (settings.get('open')) {
				launch($obj[0]);
			}
		}

		return $obj;
	};

	publicMethod.position = function (speed, loadedCallback) {
		var
		css,
		top = 0,
		left = 0,
		offset = $box.offset(),
		scrollTop,
		scrollLeft;

		$window.unbind('resize.' + prefix);

		// remove the modal so that it doesn't influence the document width/height
		$box.css({top: -9e4, left: -9e4});

		scrollTop = $window.scrollTop();
		scrollLeft = $window.scrollLeft();

		if (settings.get('fixed')) {
			offset.top -= scrollTop;
			offset.left -= scrollLeft;
			$box.css({position: 'fixed'});
		} else {
			top = scrollTop;
			left = scrollLeft;
			$box.css({position: 'absolute'});
		}

		// keeps the top and left positions within the browser's viewport.
		if (settings.get('right') !== false) {
			left += Math.max($window.width() - settings.w - loadedWidth - interfaceWidth - setSize(settings.get('right'), 'x'), 0);
		} else if (settings.get('left') !== false) {
			left += setSize(settings.get('left'), 'x');
		} else {
			left += Math.round(Math.max($window.width() - settings.w - loadedWidth - interfaceWidth, 0) / 2);
		}

		if (settings.get('bottom') !== false) {
			top += Math.max(winheight() - settings.h - loadedHeight - interfaceHeight - setSize(settings.get('bottom'), 'y'), 0);
		} else if (settings.get('top') !== false) {
			top += setSize(settings.get('top'), 'y');
		} else {
			top += Math.round(Math.max(winheight() - settings.h - loadedHeight - interfaceHeight, 0) / 2);
		}

		$box.css({top: offset.top, left: offset.left, visibility:'visible'});

		// this gives the wrapper plenty of breathing room so it's floated contents can move around smoothly,
		// but it has to be shrank down around the size of div#colorbox when it's done.  If not,
		// it can invoke an obscure IE bug when using iframes.
		$wrap[0].style.width = $wrap[0].style.height = "9999px";

		function modalDimensions() {
			$topBorder[0].style.width = $bottomBorder[0].style.width = $content[0].style.width = (parseInt($box[0].style.width,10) - interfaceWidth)+'px';
			$content[0].style.height = $leftBorder[0].style.height = $rightBorder[0].style.height = (parseInt($box[0].style.height,10) - interfaceHeight)+'px';
		}

		css = {width: settings.w + loadedWidth + interfaceWidth, height: settings.h + loadedHeight + interfaceHeight, top: top, left: left};

		// setting the speed to 0 if the content hasn't changed size or position
		if (speed) {
			var tempSpeed = 0;
			$.each(css, function(i){
				if (css[i] !== previousCSS[i]) {
					tempSpeed = speed;
					return;
				}
			});
			speed = tempSpeed;
		}

		previousCSS = css;

		if (!speed) {
			$box.css(css);
		}

		$box.dequeue().animate(css, {
			duration: speed || 0,
			complete: function () {
				modalDimensions();

				active = false;

				// shrink the wrapper down to exactly the size of colorbox to avoid a bug in IE's iframe implementation.
				$wrap[0].style.width = (settings.w + loadedWidth + interfaceWidth) + "px";
				$wrap[0].style.height = (settings.h + loadedHeight + interfaceHeight) + "px";

				if (settings.get('reposition')) {
					setTimeout(function () {  // small delay before binding onresize due to an IE8 bug.
						$window.bind('resize.' + prefix, publicMethod.position);
					}, 1);
				}

				if ($.isFunction(loadedCallback)) {
					loadedCallback();
				}
			},
			step: modalDimensions
		});
	};

	publicMethod.resize = function (options) {
		var scrolltop;

		if (open) {
			options = options || {};

			if (options.width) {
				settings.w = setSize(options.width, 'x') - loadedWidth - interfaceWidth;
			}

			if (options.innerWidth) {
				settings.w = setSize(options.innerWidth, 'x');
			}

			$loaded.css({width: settings.w});

			if (options.height) {
				settings.h = setSize(options.height, 'y') - loadedHeight - interfaceHeight;
			}

			if (options.innerHeight) {
				settings.h = setSize(options.innerHeight, 'y');
			}

			if (!options.innerHeight && !options.height) {
				scrolltop = $loaded.scrollTop();
				$loaded.css({height: "auto"});
				settings.h = $loaded.height();
			}

			$loaded.css({height: settings.h});

			if(scrolltop) {
				$loaded.scrollTop(scrolltop);
			}

			publicMethod.position(settings.get('transition') === "none" ? 0 : settings.get('speed'));
		}
	};

	publicMethod.prep = function (object) {
		if (!open) {
			return;
		}

		var callback, speed = settings.get('transition') === "none" ? 0 : settings.get('speed');

		$loaded.remove();

		$loaded = $tag(div, 'LoadedContent').append(object);

		function getWidth() {
			settings.w = settings.w || $loaded.width();
			settings.w = settings.mw && settings.mw < settings.w ? settings.mw : settings.w;
			return settings.w;
		}
		function getHeight() {
			settings.h = settings.h || $loaded.height();
			settings.h = settings.mh && settings.mh < settings.h ? settings.mh : settings.h;
			return settings.h;
		}

		$loaded.hide()
		.appendTo($loadingBay.show())// content has to be appended to the DOM for accurate size calculations.
		.css({width: getWidth(), overflow: settings.get('scrolling') ? 'auto' : 'hidden'})
		.css({height: getHeight()})// sets the height independently from the width in case the new width influences the value of height.
		.prependTo($content);

		$loadingBay.hide();

		// floating the IMG removes the bottom line-height and fixed a problem where IE miscalculates the width of the parent element as 100% of the document width.

		$(photo).css({'float': 'none'});

		setClass(settings.get('className'));

		callback = function () {
			var total = $related.length,
				iframe,
				complete;

			if (!open) {
				return;
			}

			function removeFilter() { // Needed for IE8 in versions of jQuery prior to 1.7.2
				if ($.support.opacity === false) {
					$box[0].style.removeAttribute('filter');
				}
			}

			complete = function () {
				clearTimeout(loadingTimer);
				$loadingOverlay.hide();
				trigger(event_complete);
				settings.get('onComplete');
			};


			$title.html(settings.get('title')).show();
			$loaded.show();

			if (total > 1) { // handle grouping
				if (typeof settings.get('current') === "string") {
					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total)).show();
				}

				$next[(settings.get('loop') || index < total - 1) ? "show" : "hide"]().html(settings.get('next'));
				$prev[(settings.get('loop') || index) ? "show" : "hide"]().html(settings.get('previous'));

				slideshow();

				// Preloads images within a rel group
				if (settings.get('preloading')) {
					$.each([getIndex(-1), getIndex(1)], function(){
						var img,
							i = $related[this],
							settings = new Settings(i, $.data(i, colorbox)),
							src = settings.get('href');

						if (src && isImage(settings, src)) {
							src = retinaUrl(settings, src);
							img = document.createElement('img');
							img.src = src;
						}
					});
				}
			} else {
				$groupControls.hide();
			}

			if (settings.get('iframe')) {

				iframe = settings.get('createIframe');

				if (!settings.get('scrolling')) {
					iframe.scrolling = "no";
				}

				$(iframe)
					.attr({
						src: settings.get('href'),
						'class': prefix + 'Iframe'
					})
					.one('load', complete)
					.appendTo($loaded);

				$events.one(event_purge, function () {
					iframe.src = "//about:blank";
				});

				if (settings.get('fastIframe')) {
					$(iframe).trigger('load');
				}
			} else {
				complete();
			}

			if (settings.get('transition') === 'fade') {
				$box.fadeTo(speed, 1, removeFilter);
			} else {
				removeFilter();
			}
		};

		if (settings.get('transition') === 'fade') {
			$box.fadeTo(speed, 0, function () {
				publicMethod.position(0, callback);
			});
		} else {
			publicMethod.position(speed, callback);
		}
	};

	function load () {
		var href, setResize, prep = publicMethod.prep, $inline, request = ++requests;

		active = true;

		photo = false;

		trigger(event_purge);
		trigger(event_load);
		settings.get('onLoad');

		settings.h = settings.get('height') ?
				setSize(settings.get('height'), 'y') - loadedHeight - interfaceHeight :
				settings.get('innerHeight') && setSize(settings.get('innerHeight'), 'y');

		settings.w = settings.get('width') ?
				setSize(settings.get('width'), 'x') - loadedWidth - interfaceWidth :
				settings.get('innerWidth') && setSize(settings.get('innerWidth'), 'x');

		// Sets the minimum dimensions for use in image scaling
		settings.mw = settings.w;
		settings.mh = settings.h;

		// Re-evaluate the minimum width and height based on maxWidth and maxHeight values.
		// If the width or height exceed the maxWidth or maxHeight, use the maximum values instead.
		if (settings.get('maxWidth')) {
			settings.mw = setSize(settings.get('maxWidth'), 'x') - loadedWidth - interfaceWidth;
			settings.mw = settings.w && settings.w < settings.mw ? settings.w : settings.mw;
		}
		if (settings.get('maxHeight')) {
			settings.mh = setSize(settings.get('maxHeight'), 'y') - loadedHeight - interfaceHeight;
			settings.mh = settings.h && settings.h < settings.mh ? settings.h : settings.mh;
		}

		href = settings.get('href');

		loadingTimer = setTimeout(function () {
			$loadingOverlay.show();
		}, 100);

		if (settings.get('inline')) {
			var $target = $(href);
			// Inserts an empty placeholder where inline content is being pulled from.
			// An event is bound to put inline content back when Colorbox closes or loads new content.
			$inline = $('<div>').hide().insertBefore($target);

			$events.one(event_purge, function () {
				$inline.replaceWith($target);
			});

			prep($target);
		} else if (settings.get('iframe')) {
			// IFrame element won't be added to the DOM until it is ready to be displayed,
			// to avoid problems with DOM-ready JS that might be trying to run in that iframe.
			prep(" ");
		} else if (settings.get('html')) {
			prep(settings.get('html'));
		} else if (isImage(settings, href)) {

			href = retinaUrl(settings, href);

			photo = settings.get('createImg');

			$(photo)
			.addClass(prefix + 'Photo')
			.bind('error.'+prefix,function () {
				prep($tag(div, 'Error').html(settings.get('imgError')));
			})
			.one('load', function () {
				if (request !== requests) {
					return;
				}

				// A small pause because some browsers will occassionaly report a
				// img.width and img.height of zero immediately after the img.onload fires
				setTimeout(function(){
					var percent;

					if (settings.get('retinaImage') && window.devicePixelRatio > 1) {
						photo.height = photo.height / window.devicePixelRatio;
						photo.width = photo.width / window.devicePixelRatio;
					}

					if (settings.get('scalePhotos')) {
						setResize = function () {
							photo.height -= photo.height * percent;
							photo.width -= photo.width * percent;
						};
						if (settings.mw && photo.width > settings.mw) {
							percent = (photo.width - settings.mw) / photo.width;
							setResize();
						}
						if (settings.mh && photo.height > settings.mh) {
							percent = (photo.height - settings.mh) / photo.height;
							setResize();
						}
					}

					if (settings.h) {
						photo.style.marginTop = Math.max(settings.mh - photo.height, 0) / 2 + 'px';
					}

					if ($related[1] && (settings.get('loop') || $related[index + 1])) {
						photo.style.cursor = 'pointer';

						$(photo).bind('click.'+prefix, function () {
							publicMethod.next();
						});
					}

					photo.style.width = photo.width + 'px';
					photo.style.height = photo.height + 'px';
					prep(photo);
				}, 1);
			});

			photo.src = href;

		} else if (href) {
			$loadingBay.load(href, settings.get('data'), function (data, status) {
				if (request === requests) {
					prep(status === 'error' ? $tag(div, 'Error').html(settings.get('xhrError')) : $(this).contents());
				}
			});
		}
	}

	// Navigates to the next page/image in a set.
	publicMethod.next = function () {
		if (!active && $related[1] && (settings.get('loop') || $related[index + 1])) {
			index = getIndex(1);
			launch($related[index]);
		}
	};

	publicMethod.prev = function () {
		if (!active && $related[1] && (settings.get('loop') || index)) {
			index = getIndex(-1);
			launch($related[index]);
		}
	};

	// Note: to use this within an iframe use the following format: parent.jQuery.colorbox.close();
	publicMethod.close = function () {
		if (open && !closing) {

			closing = true;
			open = false;
			trigger(event_cleanup);
			settings.get('onCleanup');
			$window.unbind('.' + prefix);
			$overlay.fadeTo(settings.get('fadeOut') || 0, 0);

			$box.stop().fadeTo(settings.get('fadeOut') || 0, 0, function () {
				$box.hide();
				$overlay.hide();
				trigger(event_purge);
				$loaded.remove();

				setTimeout(function () {
					closing = false;
					trigger(event_closed);
					settings.get('onClosed');
				}, 1);
			});
		}
	};

	// Removes changes Colorbox made to the document, but does not remove the plugin.
	publicMethod.remove = function () {
		if (!$box) { return; }

		$box.stop();
		$[colorbox].close();
		$box.stop(false, true).remove();
		$overlay.remove();
		closing = false;
		$box = null;
		$('.' + boxElement)
			.removeData(colorbox)
			.removeClass(boxElement);

		$(document).unbind('click.'+prefix).unbind('keydown.'+prefix);
	};

	// A method for fetching the current element Colorbox is referencing.
	// returns a jQuery object.
	publicMethod.element = function () {
		return $(settings.el);
	};

	publicMethod.settings = defaults;

}(jQuery, document, window));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5jb2xvcmJveC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQUFMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImpxdWVyeS5jb2xvcmJveC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuXHRDb2xvcmJveCAxLjYuM1xuXHRsaWNlbnNlOiBNSVRcblx0aHR0cDovL3d3dy5qYWNrbG1vb3JlLmNvbS9jb2xvcmJveFxuKi9cbihmdW5jdGlvbiAoJCwgZG9jdW1lbnQsIHdpbmRvdykge1xuXHR2YXJcblx0Ly8gRGVmYXVsdCBzZXR0aW5ncyBvYmplY3QuXG5cdC8vIFNlZSBodHRwOi8vamFja2xtb29yZS5jb20vY29sb3Jib3ggZm9yIGRldGFpbHMuXG5cdGRlZmF1bHRzID0ge1xuXHRcdC8vIGRhdGEgc291cmNlc1xuXHRcdGh0bWw6IGZhbHNlLFxuXHRcdHBob3RvOiBmYWxzZSxcblx0XHRpZnJhbWU6IGZhbHNlLFxuXHRcdGlubGluZTogZmFsc2UsXG5cblx0XHQvLyBiZWhhdmlvciBhbmQgYXBwZWFyYW5jZVxuXHRcdHRyYW5zaXRpb246IFwiZWxhc3RpY1wiLFxuXHRcdHNwZWVkOiAzMDAsXG5cdFx0ZmFkZU91dDogMzAwLFxuXHRcdHdpZHRoOiBmYWxzZSxcblx0XHRpbml0aWFsV2lkdGg6IFwiNjAwXCIsXG5cdFx0aW5uZXJXaWR0aDogZmFsc2UsXG5cdFx0bWF4V2lkdGg6IGZhbHNlLFxuXHRcdGhlaWdodDogZmFsc2UsXG5cdFx0aW5pdGlhbEhlaWdodDogXCI0NTBcIixcblx0XHRpbm5lckhlaWdodDogZmFsc2UsXG5cdFx0bWF4SGVpZ2h0OiBmYWxzZSxcblx0XHRzY2FsZVBob3RvczogdHJ1ZSxcblx0XHRzY3JvbGxpbmc6IHRydWUsXG5cdFx0b3BhY2l0eTogMC45LFxuXHRcdHByZWxvYWRpbmc6IHRydWUsXG5cdFx0Y2xhc3NOYW1lOiBmYWxzZSxcblx0XHRvdmVybGF5Q2xvc2U6IHRydWUsXG5cdFx0ZXNjS2V5OiB0cnVlLFxuXHRcdGFycm93S2V5OiB0cnVlLFxuXHRcdHRvcDogZmFsc2UsXG5cdFx0Ym90dG9tOiBmYWxzZSxcblx0XHRsZWZ0OiBmYWxzZSxcblx0XHRyaWdodDogZmFsc2UsXG5cdFx0Zml4ZWQ6IGZhbHNlLFxuXHRcdGRhdGE6IHVuZGVmaW5lZCxcblx0XHRjbG9zZUJ1dHRvbjogdHJ1ZSxcblx0XHRmYXN0SWZyYW1lOiB0cnVlLFxuXHRcdG9wZW46IGZhbHNlLFxuXHRcdHJlcG9zaXRpb246IHRydWUsXG5cdFx0bG9vcDogdHJ1ZSxcblx0XHRzbGlkZXNob3c6IGZhbHNlLFxuXHRcdHNsaWRlc2hvd0F1dG86IHRydWUsXG5cdFx0c2xpZGVzaG93U3BlZWQ6IDI1MDAsXG5cdFx0c2xpZGVzaG93U3RhcnQ6IFwic3RhcnQgc2xpZGVzaG93XCIsXG5cdFx0c2xpZGVzaG93U3RvcDogXCJzdG9wIHNsaWRlc2hvd1wiLFxuXHRcdHBob3RvUmVnZXg6IC9cXC4oZ2lmfHBuZ3xqcChlfGd8ZWcpfGJtcHxpY298d2VicHxqeHJ8c3ZnKSgoI3xcXD8pLiopPyQvaSxcblxuXHRcdC8vIGFsdGVybmF0ZSBpbWFnZSBwYXRocyBmb3IgaGlnaC1yZXMgZGlzcGxheXNcblx0XHRyZXRpbmFJbWFnZTogZmFsc2UsXG5cdFx0cmV0aW5hVXJsOiBmYWxzZSxcblx0XHRyZXRpbmFTdWZmaXg6ICdAMnguJDEnLFxuXG5cdFx0Ly8gaW50ZXJuYXRpb25hbGl6YXRpb25cblx0XHRjdXJyZW50OiBcImltYWdlIHtjdXJyZW50fSBvZiB7dG90YWx9XCIsXG5cdFx0cHJldmlvdXM6IFwicHJldmlvdXNcIixcblx0XHRuZXh0OiBcIm5leHRcIixcblx0XHRjbG9zZTogXCJjbG9zZVwiLFxuXHRcdHhockVycm9yOiBcIlRoaXMgY29udGVudCBmYWlsZWQgdG8gbG9hZC5cIixcblx0XHRpbWdFcnJvcjogXCJUaGlzIGltYWdlIGZhaWxlZCB0byBsb2FkLlwiLFxuXG5cdFx0Ly8gYWNjZXNzYmlsaXR5XG5cdFx0cmV0dXJuRm9jdXM6IHRydWUsXG5cdFx0dHJhcEZvY3VzOiB0cnVlLFxuXG5cdFx0Ly8gY2FsbGJhY2tzXG5cdFx0b25PcGVuOiBmYWxzZSxcblx0XHRvbkxvYWQ6IGZhbHNlLFxuXHRcdG9uQ29tcGxldGU6IGZhbHNlLFxuXHRcdG9uQ2xlYW51cDogZmFsc2UsXG5cdFx0b25DbG9zZWQ6IGZhbHNlLFxuXG5cdFx0cmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLnJlbDtcblx0XHR9LFxuXHRcdGhyZWY6IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gdXNpbmcgdGhpcy5ocmVmIHdvdWxkIGdpdmUgdGhlIGFic29sdXRlIHVybCwgd2hlbiB0aGUgaHJlZiBtYXkgaGF2ZSBiZWVuIGludGVkZWQgYXMgYSBzZWxlY3RvciAoZS5nLiAnI2NvbnRhaW5lcicpXG5cdFx0XHRyZXR1cm4gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG5cdFx0fSxcblx0XHR0aXRsZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy50aXRsZTtcblx0XHR9LFxuXHRcdGNyZWF0ZUltZzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgaW1nID0gbmV3IEltYWdlKCk7XG5cdFx0XHR2YXIgYXR0cnMgPSAkKHRoaXMpLmRhdGEoJ2Nib3gtaW1nLWF0dHJzJyk7XG5cblx0XHRcdGlmICh0eXBlb2YgYXR0cnMgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdCQuZWFjaChhdHRycywgZnVuY3Rpb24oa2V5LCB2YWwpe1xuXHRcdFx0XHRcdGltZ1trZXldID0gdmFsO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGltZztcblx0XHR9LFxuXHRcdGNyZWF0ZUlmcmFtZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG5cdFx0XHR2YXIgYXR0cnMgPSAkKHRoaXMpLmRhdGEoJ2Nib3gtaWZyYW1lLWF0dHJzJyk7XG5cblx0XHRcdGlmICh0eXBlb2YgYXR0cnMgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdCQuZWFjaChhdHRycywgZnVuY3Rpb24oa2V5LCB2YWwpe1xuXHRcdFx0XHRcdGlmcmFtZVtrZXldID0gdmFsO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCdmcmFtZUJvcmRlcicgaW4gaWZyYW1lKSB7XG5cdFx0XHRcdGlmcmFtZS5mcmFtZUJvcmRlciA9IDA7XG5cdFx0XHR9XG5cdFx0XHRpZiAoJ2FsbG93VHJhbnNwYXJlbmN5JyBpbiBpZnJhbWUpIHtcblx0XHRcdFx0aWZyYW1lLmFsbG93VHJhbnNwYXJlbmN5ID0gXCJ0cnVlXCI7XG5cdFx0XHR9XG5cdFx0XHRpZnJhbWUubmFtZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7IC8vIGdpdmUgdGhlIGlmcmFtZSBhIHVuaXF1ZSBuYW1lIHRvIHByZXZlbnQgY2FjaGluZ1xuXHRcdFx0aWZyYW1lLmFsbG93RnVsbHNjcmVlbiA9IHRydWU7XG5cblx0XHRcdHJldHVybiBpZnJhbWU7XG5cdFx0fVxuXHR9LFxuXG5cdC8vIEFic3RyYWN0aW5nIHRoZSBIVE1MIGFuZCBldmVudCBpZGVudGlmaWVycyBmb3IgZWFzeSByZWJyYW5kaW5nXG5cdGNvbG9yYm94ID0gJ2NvbG9yYm94Jyxcblx0cHJlZml4ID0gJ2Nib3gnLFxuXHRib3hFbGVtZW50ID0gcHJlZml4ICsgJ0VsZW1lbnQnLFxuXG5cdC8vIEV2ZW50c1xuXHRldmVudF9vcGVuID0gcHJlZml4ICsgJ19vcGVuJyxcblx0ZXZlbnRfbG9hZCA9IHByZWZpeCArICdfbG9hZCcsXG5cdGV2ZW50X2NvbXBsZXRlID0gcHJlZml4ICsgJ19jb21wbGV0ZScsXG5cdGV2ZW50X2NsZWFudXAgPSBwcmVmaXggKyAnX2NsZWFudXAnLFxuXHRldmVudF9jbG9zZWQgPSBwcmVmaXggKyAnX2Nsb3NlZCcsXG5cdGV2ZW50X3B1cmdlID0gcHJlZml4ICsgJ19wdXJnZScsXG5cblx0Ly8gQ2FjaGVkIGpRdWVyeSBPYmplY3QgVmFyaWFibGVzXG5cdCRvdmVybGF5LFxuXHQkYm94LFxuXHQkd3JhcCxcblx0JGNvbnRlbnQsXG5cdCR0b3BCb3JkZXIsXG5cdCRsZWZ0Qm9yZGVyLFxuXHQkcmlnaHRCb3JkZXIsXG5cdCRib3R0b21Cb3JkZXIsXG5cdCRyZWxhdGVkLFxuXHQkd2luZG93LFxuXHQkbG9hZGVkLFxuXHQkbG9hZGluZ0JheSxcblx0JGxvYWRpbmdPdmVybGF5LFxuXHQkdGl0bGUsXG5cdCRjdXJyZW50LFxuXHQkc2xpZGVzaG93LFxuXHQkbmV4dCxcblx0JHByZXYsXG5cdCRjbG9zZSxcblx0JGdyb3VwQ29udHJvbHMsXG5cdCRldmVudHMgPSAkKCc8YS8+JyksIC8vICQoe30pIHdvdWxkIGJlIHByZWZlcmVkLCBidXQgdGhlcmUgaXMgYW4gaXNzdWUgd2l0aCBqUXVlcnkgMS40LjJcblxuXHQvLyBWYXJpYWJsZXMgZm9yIGNhY2hlZCB2YWx1ZXMgb3IgdXNlIGFjcm9zcyBtdWx0aXBsZSBmdW5jdGlvbnNcblx0c2V0dGluZ3MsXG5cdGludGVyZmFjZUhlaWdodCxcblx0aW50ZXJmYWNlV2lkdGgsXG5cdGxvYWRlZEhlaWdodCxcblx0bG9hZGVkV2lkdGgsXG5cdGluZGV4LFxuXHRwaG90byxcblx0b3Blbixcblx0YWN0aXZlLFxuXHRjbG9zaW5nLFxuXHRsb2FkaW5nVGltZXIsXG5cdHB1YmxpY01ldGhvZCxcblx0ZGl2ID0gXCJkaXZcIixcblx0cmVxdWVzdHMgPSAwLFxuXHRwcmV2aW91c0NTUyA9IHt9LFxuXHRpbml0O1xuXG5cdC8vICoqKioqKioqKioqKioqKipcblx0Ly8gSEVMUEVSIEZVTkNUSU9OU1xuXHQvLyAqKioqKioqKioqKioqKioqXG5cblx0Ly8gQ29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIG5ldyBqUXVlcnkgb2JqZWN0c1xuXHRmdW5jdGlvbiAkdGFnKHRhZywgaWQsIGNzcykge1xuXHRcdHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuXG5cdFx0aWYgKGlkKSB7XG5cdFx0XHRlbGVtZW50LmlkID0gcHJlZml4ICsgaWQ7XG5cdFx0fVxuXG5cdFx0aWYgKGNzcykge1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gY3NzO1xuXHRcdH1cblxuXHRcdHJldHVybiAkKGVsZW1lbnQpO1xuXHR9XG5cblx0Ly8gR2V0IHRoZSB3aW5kb3cgaGVpZ2h0IHVzaW5nIGlubmVySGVpZ2h0IHdoZW4gYXZhaWxhYmxlIHRvIGF2b2lkIGFuIGlzc3VlIHdpdGggaU9TXG5cdC8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzY3MjRcblx0ZnVuY3Rpb24gd2luaGVpZ2h0KCkge1xuXHRcdHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQgPyB3aW5kb3cuaW5uZXJIZWlnaHQgOiAkKHdpbmRvdykuaGVpZ2h0KCk7XG5cdH1cblxuXHRmdW5jdGlvbiBTZXR0aW5ncyhlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0aWYgKG9wdGlvbnMgIT09IE9iamVjdChvcHRpb25zKSkge1xuXHRcdFx0b3B0aW9ucyA9IHt9O1xuXHRcdH1cblxuXHRcdHRoaXMuY2FjaGUgPSB7fTtcblx0XHR0aGlzLmVsID0gZWxlbWVudDtcblxuXHRcdHRoaXMudmFsdWUgPSBmdW5jdGlvbihrZXkpIHtcblx0XHRcdHZhciBkYXRhQXR0cjtcblxuXHRcdFx0aWYgKHRoaXMuY2FjaGVba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGRhdGFBdHRyID0gJCh0aGlzLmVsKS5hdHRyKCdkYXRhLWNib3gtJytrZXkpO1xuXG5cdFx0XHRcdGlmIChkYXRhQXR0ciAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0dGhpcy5jYWNoZVtrZXldID0gZGF0YUF0dHI7XG5cdFx0XHRcdH0gZWxzZSBpZiAob3B0aW9uc1trZXldICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHR0aGlzLmNhY2hlW2tleV0gPSBvcHRpb25zW2tleV07XG5cdFx0XHRcdH0gZWxzZSBpZiAoZGVmYXVsdHNba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0dGhpcy5jYWNoZVtrZXldID0gZGVmYXVsdHNba2V5XTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5jYWNoZVtrZXldO1xuXHRcdH07XG5cblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uKGtleSkge1xuXHRcdFx0dmFyIHZhbHVlID0gdGhpcy52YWx1ZShrZXkpO1xuXHRcdFx0cmV0dXJuICQuaXNGdW5jdGlvbih2YWx1ZSkgPyB2YWx1ZS5jYWxsKHRoaXMuZWwsIHRoaXMpIDogdmFsdWU7XG5cdFx0fTtcblx0fVxuXG5cdC8vIERldGVybWluZSB0aGUgbmV4dCBhbmQgcHJldmlvdXMgbWVtYmVycyBpbiBhIGdyb3VwLlxuXHRmdW5jdGlvbiBnZXRJbmRleChpbmNyZW1lbnQpIHtcblx0XHR2YXJcblx0XHRtYXggPSAkcmVsYXRlZC5sZW5ndGgsXG5cdFx0bmV3SW5kZXggPSAoaW5kZXggKyBpbmNyZW1lbnQpICUgbWF4O1xuXG5cdFx0cmV0dXJuIChuZXdJbmRleCA8IDApID8gbWF4ICsgbmV3SW5kZXggOiBuZXdJbmRleDtcblx0fVxuXG5cdC8vIENvbnZlcnQgJyUnIGFuZCAncHgnIHZhbHVlcyB0byBpbnRlZ2Vyc1xuXHRmdW5jdGlvbiBzZXRTaXplKHNpemUsIGRpbWVuc2lvbikge1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKCgvJS8udGVzdChzaXplKSA/ICgoZGltZW5zaW9uID09PSAneCcgPyAkd2luZG93LndpZHRoKCkgOiB3aW5oZWlnaHQoKSkgLyAxMDApIDogMSkgKiBwYXJzZUludChzaXplLCAxMCkpO1xuXHR9XG5cblx0Ly8gQ2hlY2tzIGFuIGhyZWYgdG8gc2VlIGlmIGl0IGlzIGEgcGhvdG8uXG5cdC8vIFRoZXJlIGlzIGEgZm9yY2UgcGhvdG8gb3B0aW9uIChwaG90bzogdHJ1ZSkgZm9yIGhyZWZzIHRoYXQgY2Fubm90IGJlIG1hdGNoZWQgYnkgdGhlIHJlZ2V4LlxuXHRmdW5jdGlvbiBpc0ltYWdlKHNldHRpbmdzLCB1cmwpIHtcblx0XHRyZXR1cm4gc2V0dGluZ3MuZ2V0KCdwaG90bycpIHx8IHNldHRpbmdzLmdldCgncGhvdG9SZWdleCcpLnRlc3QodXJsKTtcblx0fVxuXG5cdGZ1bmN0aW9uIHJldGluYVVybChzZXR0aW5ncywgdXJsKSB7XG5cdFx0cmV0dXJuIHNldHRpbmdzLmdldCgncmV0aW5hVXJsJykgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxID8gdXJsLnJlcGxhY2Uoc2V0dGluZ3MuZ2V0KCdwaG90b1JlZ2V4JyksIHNldHRpbmdzLmdldCgncmV0aW5hU3VmZml4JykpIDogdXJsO1xuXHR9XG5cblx0ZnVuY3Rpb24gdHJhcEZvY3VzKGUpIHtcblx0XHRpZiAoJ2NvbnRhaW5zJyBpbiAkYm94WzBdICYmICEkYm94WzBdLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiBlLnRhcmdldCAhPT0gJG92ZXJsYXlbMF0pIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHQkYm94LmZvY3VzKCk7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gc2V0Q2xhc3Moc3RyKSB7XG5cdFx0aWYgKHNldENsYXNzLnN0ciAhPT0gc3RyKSB7XG5cdFx0XHQkYm94LmFkZCgkb3ZlcmxheSkucmVtb3ZlQ2xhc3Moc2V0Q2xhc3Muc3RyKS5hZGRDbGFzcyhzdHIpO1xuXHRcdFx0c2V0Q2xhc3Muc3RyID0gc3RyO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIGdldFJlbGF0ZWQocmVsKSB7XG5cdFx0aW5kZXggPSAwO1xuXG5cdFx0aWYgKHJlbCAmJiByZWwgIT09IGZhbHNlICYmIHJlbCAhPT0gJ25vZm9sbG93Jykge1xuXHRcdFx0JHJlbGF0ZWQgPSAkKCcuJyArIGJveEVsZW1lbnQpLmZpbHRlcihmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciBvcHRpb25zID0gJC5kYXRhKHRoaXMsIGNvbG9yYm94KTtcblx0XHRcdFx0dmFyIHNldHRpbmdzID0gbmV3IFNldHRpbmdzKHRoaXMsIG9wdGlvbnMpO1xuXHRcdFx0XHRyZXR1cm4gKHNldHRpbmdzLmdldCgncmVsJykgPT09IHJlbCk7XG5cdFx0XHR9KTtcblx0XHRcdGluZGV4ID0gJHJlbGF0ZWQuaW5kZXgoc2V0dGluZ3MuZWwpO1xuXG5cdFx0XHQvLyBDaGVjayBkaXJlY3QgY2FsbHMgdG8gQ29sb3Jib3guXG5cdFx0XHRpZiAoaW5kZXggPT09IC0xKSB7XG5cdFx0XHRcdCRyZWxhdGVkID0gJHJlbGF0ZWQuYWRkKHNldHRpbmdzLmVsKTtcblx0XHRcdFx0aW5kZXggPSAkcmVsYXRlZC5sZW5ndGggLSAxO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQkcmVsYXRlZCA9ICQoc2V0dGluZ3MuZWwpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnQpIHtcblx0XHQvLyBmb3IgZXh0ZXJuYWwgdXNlXG5cdFx0JChkb2N1bWVudCkudHJpZ2dlcihldmVudCk7XG5cdFx0Ly8gZm9yIGludGVybmFsIHVzZVxuXHRcdCRldmVudHMudHJpZ2dlckhhbmRsZXIoZXZlbnQpO1xuXHR9XG5cblx0dmFyIHNsaWRlc2hvdyA9IChmdW5jdGlvbigpe1xuXHRcdHZhciBhY3RpdmUsXG5cdFx0XHRjbGFzc05hbWUgPSBwcmVmaXggKyBcIlNsaWRlc2hvd19cIixcblx0XHRcdGNsaWNrID0gXCJjbGljay5cIiArIHByZWZpeCxcblx0XHRcdHRpbWVPdXQ7XG5cblx0XHRmdW5jdGlvbiBjbGVhciAoKSB7XG5cdFx0XHRjbGVhclRpbWVvdXQodGltZU91dCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0KCkge1xuXHRcdFx0aWYgKHNldHRpbmdzLmdldCgnbG9vcCcpIHx8ICRyZWxhdGVkW2luZGV4ICsgMV0pIHtcblx0XHRcdFx0Y2xlYXIoKTtcblx0XHRcdFx0dGltZU91dCA9IHNldFRpbWVvdXQocHVibGljTWV0aG9kLm5leHQsIHNldHRpbmdzLmdldCgnc2xpZGVzaG93U3BlZWQnKSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc3RhcnQoKSB7XG5cdFx0XHQkc2xpZGVzaG93XG5cdFx0XHRcdC5odG1sKHNldHRpbmdzLmdldCgnc2xpZGVzaG93U3RvcCcpKVxuXHRcdFx0XHQudW5iaW5kKGNsaWNrKVxuXHRcdFx0XHQub25lKGNsaWNrLCBzdG9wKTtcblxuXHRcdFx0JGV2ZW50c1xuXHRcdFx0XHQuYmluZChldmVudF9jb21wbGV0ZSwgc2V0KVxuXHRcdFx0XHQuYmluZChldmVudF9sb2FkLCBjbGVhcik7XG5cblx0XHRcdCRib3gucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lICsgXCJvZmZcIikuYWRkQ2xhc3MoY2xhc3NOYW1lICsgXCJvblwiKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzdG9wKCkge1xuXHRcdFx0Y2xlYXIoKTtcblxuXHRcdFx0JGV2ZW50c1xuXHRcdFx0XHQudW5iaW5kKGV2ZW50X2NvbXBsZXRlLCBzZXQpXG5cdFx0XHRcdC51bmJpbmQoZXZlbnRfbG9hZCwgY2xlYXIpO1xuXG5cdFx0XHQkc2xpZGVzaG93XG5cdFx0XHRcdC5odG1sKHNldHRpbmdzLmdldCgnc2xpZGVzaG93U3RhcnQnKSlcblx0XHRcdFx0LnVuYmluZChjbGljaylcblx0XHRcdFx0Lm9uZShjbGljaywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHB1YmxpY01ldGhvZC5uZXh0KCk7XG5cdFx0XHRcdFx0c3RhcnQoKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdCRib3gucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lICsgXCJvblwiKS5hZGRDbGFzcyhjbGFzc05hbWUgKyBcIm9mZlwiKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZXNldCgpIHtcblx0XHRcdGFjdGl2ZSA9IGZhbHNlO1xuXHRcdFx0JHNsaWRlc2hvdy5oaWRlKCk7XG5cdFx0XHRjbGVhcigpO1xuXHRcdFx0JGV2ZW50c1xuXHRcdFx0XHQudW5iaW5kKGV2ZW50X2NvbXBsZXRlLCBzZXQpXG5cdFx0XHRcdC51bmJpbmQoZXZlbnRfbG9hZCwgY2xlYXIpO1xuXHRcdFx0JGJveC5yZW1vdmVDbGFzcyhjbGFzc05hbWUgKyBcIm9mZiBcIiArIGNsYXNzTmFtZSArIFwib25cIik7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCl7XG5cdFx0XHRpZiAoYWN0aXZlKSB7XG5cdFx0XHRcdGlmICghc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3cnKSkge1xuXHRcdFx0XHRcdCRldmVudHMudW5iaW5kKGV2ZW50X2NsZWFudXAsIHJlc2V0KTtcblx0XHRcdFx0XHRyZXNldCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdzbGlkZXNob3cnKSAmJiAkcmVsYXRlZFsxXSkge1xuXHRcdFx0XHRcdGFjdGl2ZSA9IHRydWU7XG5cdFx0XHRcdFx0JGV2ZW50cy5vbmUoZXZlbnRfY2xlYW51cCwgcmVzZXQpO1xuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3NsaWRlc2hvd0F1dG8nKSkge1xuXHRcdFx0XHRcdFx0c3RhcnQoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c3RvcCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQkc2xpZGVzaG93LnNob3coKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0fSgpKTtcblxuXG5cdGZ1bmN0aW9uIGxhdW5jaChlbGVtZW50KSB7XG5cdFx0dmFyIG9wdGlvbnM7XG5cblx0XHRpZiAoIWNsb3NpbmcpIHtcblxuXHRcdFx0b3B0aW9ucyA9ICQoZWxlbWVudCkuZGF0YShjb2xvcmJveCk7XG5cblx0XHRcdHNldHRpbmdzID0gbmV3IFNldHRpbmdzKGVsZW1lbnQsIG9wdGlvbnMpO1xuXG5cdFx0XHRnZXRSZWxhdGVkKHNldHRpbmdzLmdldCgncmVsJykpO1xuXG5cdFx0XHRpZiAoIW9wZW4pIHtcblx0XHRcdFx0b3BlbiA9IGFjdGl2ZSA9IHRydWU7IC8vIFByZXZlbnRzIHRoZSBwYWdlLWNoYW5nZSBhY3Rpb24gZnJvbSBxdWV1aW5nIHVwIGlmIHRoZSB2aXNpdG9yIGhvbGRzIGRvd24gdGhlIGxlZnQgb3IgcmlnaHQga2V5cy5cblxuXHRcdFx0XHRzZXRDbGFzcyhzZXR0aW5ncy5nZXQoJ2NsYXNzTmFtZScpKTtcblxuXHRcdFx0XHQvLyBTaG93IGNvbG9yYm94IHNvIHRoZSBzaXplcyBjYW4gYmUgY2FsY3VsYXRlZCBpbiBvbGRlciB2ZXJzaW9ucyBvZiBqUXVlcnlcblx0XHRcdFx0JGJveC5jc3Moe3Zpc2liaWxpdHk6J2hpZGRlbicsIGRpc3BsYXk6J2Jsb2NrJywgb3BhY2l0eTonJ30pO1xuXG5cdFx0XHRcdCRsb2FkZWQgPSAkdGFnKGRpdiwgJ0xvYWRlZENvbnRlbnQnLCAnd2lkdGg6MDsgaGVpZ2h0OjA7IG92ZXJmbG93OmhpZGRlbjsgdmlzaWJpbGl0eTpoaWRkZW4nKTtcblx0XHRcdFx0JGNvbnRlbnQuY3NzKHt3aWR0aDonJywgaGVpZ2h0OicnfSkuYXBwZW5kKCRsb2FkZWQpO1xuXG5cdFx0XHRcdC8vIENhY2hlIHZhbHVlcyBuZWVkZWQgZm9yIHNpemUgY2FsY3VsYXRpb25zXG5cdFx0XHRcdGludGVyZmFjZUhlaWdodCA9ICR0b3BCb3JkZXIuaGVpZ2h0KCkgKyAkYm90dG9tQm9yZGVyLmhlaWdodCgpICsgJGNvbnRlbnQub3V0ZXJIZWlnaHQodHJ1ZSkgLSAkY29udGVudC5oZWlnaHQoKTtcblx0XHRcdFx0aW50ZXJmYWNlV2lkdGggPSAkbGVmdEJvcmRlci53aWR0aCgpICsgJHJpZ2h0Qm9yZGVyLndpZHRoKCkgKyAkY29udGVudC5vdXRlcldpZHRoKHRydWUpIC0gJGNvbnRlbnQud2lkdGgoKTtcblx0XHRcdFx0bG9hZGVkSGVpZ2h0ID0gJGxvYWRlZC5vdXRlckhlaWdodCh0cnVlKTtcblx0XHRcdFx0bG9hZGVkV2lkdGggPSAkbG9hZGVkLm91dGVyV2lkdGgodHJ1ZSk7XG5cblx0XHRcdFx0Ly8gT3BlbnMgaW5pdGFsIGVtcHR5IENvbG9yYm94IHByaW9yIHRvIGNvbnRlbnQgYmVpbmcgbG9hZGVkLlxuXHRcdFx0XHR2YXIgaW5pdGlhbFdpZHRoID0gc2V0U2l6ZShzZXR0aW5ncy5nZXQoJ2luaXRpYWxXaWR0aCcpLCAneCcpO1xuXHRcdFx0XHR2YXIgaW5pdGlhbEhlaWdodCA9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdpbml0aWFsSGVpZ2h0JyksICd5Jyk7XG5cdFx0XHRcdHZhciBtYXhXaWR0aCA9IHNldHRpbmdzLmdldCgnbWF4V2lkdGgnKTtcblx0XHRcdFx0dmFyIG1heEhlaWdodCA9IHNldHRpbmdzLmdldCgnbWF4SGVpZ2h0Jyk7XG5cblx0XHRcdFx0c2V0dGluZ3MudyA9IE1hdGgubWF4KChtYXhXaWR0aCAhPT0gZmFsc2UgPyBNYXRoLm1pbihpbml0aWFsV2lkdGgsIHNldFNpemUobWF4V2lkdGgsICd4JykpIDogaW5pdGlhbFdpZHRoKSAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGgsIDApO1xuXHRcdFx0XHRzZXR0aW5ncy5oID0gTWF0aC5tYXgoKG1heEhlaWdodCAhPT0gZmFsc2UgPyBNYXRoLm1pbihpbml0aWFsSGVpZ2h0LCBzZXRTaXplKG1heEhlaWdodCwgJ3knKSkgOiBpbml0aWFsSGVpZ2h0KSAtIGxvYWRlZEhlaWdodCAtIGludGVyZmFjZUhlaWdodCwgMCk7XG5cblx0XHRcdFx0JGxvYWRlZC5jc3Moe3dpZHRoOicnLCBoZWlnaHQ6c2V0dGluZ3MuaH0pO1xuXHRcdFx0XHRwdWJsaWNNZXRob2QucG9zaXRpb24oKTtcblxuXHRcdFx0XHR0cmlnZ2VyKGV2ZW50X29wZW4pO1xuXHRcdFx0XHRzZXR0aW5ncy5nZXQoJ29uT3BlbicpO1xuXG5cdFx0XHRcdCRncm91cENvbnRyb2xzLmFkZCgkdGl0bGUpLmhpZGUoKTtcblxuXHRcdFx0XHQkYm94LmZvY3VzKCk7XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgndHJhcEZvY3VzJykpIHtcblx0XHRcdFx0XHQvLyBDb25maW5lIGZvY3VzIHRvIHRoZSBtb2RhbFxuXHRcdFx0XHRcdC8vIFVzZXMgZXZlbnQgY2FwdHVyaW5nIHRoYXQgaXMgbm90IHN1cHBvcnRlZCBpbiBJRTgtXG5cdFx0XHRcdFx0aWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHtcblxuXHRcdFx0XHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0cmFwRm9jdXMsIHRydWUpO1xuXG5cdFx0XHRcdFx0XHQkZXZlbnRzLm9uZShldmVudF9jbG9zZWQsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0cmFwRm9jdXMsIHRydWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmV0dXJuIGZvY3VzIG9uIGNsb3Npbmdcblx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgncmV0dXJuRm9jdXMnKSkge1xuXHRcdFx0XHRcdCRldmVudHMub25lKGV2ZW50X2Nsb3NlZCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0JChzZXR0aW5ncy5lbCkuZm9jdXMoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgb3BhY2l0eSA9IHBhcnNlRmxvYXQoc2V0dGluZ3MuZ2V0KCdvcGFjaXR5JykpO1xuXHRcdFx0JG92ZXJsYXkuY3NzKHtcblx0XHRcdFx0b3BhY2l0eTogb3BhY2l0eSA9PT0gb3BhY2l0eSA/IG9wYWNpdHkgOiAnJyxcblx0XHRcdFx0Y3Vyc29yOiBzZXR0aW5ncy5nZXQoJ292ZXJsYXlDbG9zZScpID8gJ3BvaW50ZXInIDogJycsXG5cdFx0XHRcdHZpc2liaWxpdHk6ICd2aXNpYmxlJ1xuXHRcdFx0fSkuc2hvdygpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdjbG9zZUJ1dHRvbicpKSB7XG5cdFx0XHRcdCRjbG9zZS5odG1sKHNldHRpbmdzLmdldCgnY2xvc2UnKSkuYXBwZW5kVG8oJGNvbnRlbnQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JGNsb3NlLmFwcGVuZFRvKCc8ZGl2Lz4nKTsgLy8gcmVwbGFjZSB3aXRoIC5kZXRhY2goKSB3aGVuIGRyb3BwaW5nIGpRdWVyeSA8IDEuNFxuXHRcdFx0fVxuXG5cdFx0XHRsb2FkKCk7XG5cdFx0fVxuXHR9XG5cblx0Ly8gQ29sb3Jib3gncyBtYXJrdXAgbmVlZHMgdG8gYmUgYWRkZWQgdG8gdGhlIERPTSBwcmlvciB0byBiZWluZyBjYWxsZWRcblx0Ly8gc28gdGhhdCB0aGUgYnJvd3NlciB3aWxsIGdvIGFoZWFkIGFuZCBsb2FkIHRoZSBDU1MgYmFja2dyb3VuZCBpbWFnZXMuXG5cdGZ1bmN0aW9uIGFwcGVuZEhUTUwoKSB7XG5cdFx0aWYgKCEkYm94KSB7XG5cdFx0XHRpbml0ID0gZmFsc2U7XG5cdFx0XHQkd2luZG93ID0gJCh3aW5kb3cpO1xuXHRcdFx0JGJveCA9ICR0YWcoZGl2KS5hdHRyKHtcblx0XHRcdFx0aWQ6IGNvbG9yYm94LFxuXHRcdFx0XHQnY2xhc3MnOiAkLnN1cHBvcnQub3BhY2l0eSA9PT0gZmFsc2UgPyBwcmVmaXggKyAnSUUnIDogJycsIC8vIGNsYXNzIGZvciBvcHRpb25hbCBJRTggJiBsb3dlciB0YXJnZXRlZCBDU1MuXG5cdFx0XHRcdHJvbGU6ICdkaWFsb2cnLFxuXHRcdFx0XHR0YWJpbmRleDogJy0xJ1xuXHRcdFx0fSkuaGlkZSgpO1xuXHRcdFx0JG92ZXJsYXkgPSAkdGFnKGRpdiwgXCJPdmVybGF5XCIpLmhpZGUoKTtcblx0XHRcdCRsb2FkaW5nT3ZlcmxheSA9ICQoWyR0YWcoZGl2LCBcIkxvYWRpbmdPdmVybGF5XCIpWzBdLCR0YWcoZGl2LCBcIkxvYWRpbmdHcmFwaGljXCIpWzBdXSk7XG5cdFx0XHQkd3JhcCA9ICR0YWcoZGl2LCBcIldyYXBwZXJcIik7XG5cdFx0XHQkY29udGVudCA9ICR0YWcoZGl2LCBcIkNvbnRlbnRcIikuYXBwZW5kKFxuXHRcdFx0XHQkdGl0bGUgPSAkdGFnKGRpdiwgXCJUaXRsZVwiKSxcblx0XHRcdFx0JGN1cnJlbnQgPSAkdGFnKGRpdiwgXCJDdXJyZW50XCIpLFxuXHRcdFx0XHQkcHJldiA9ICQoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiLz4nKS5hdHRyKHtpZDpwcmVmaXgrJ1ByZXZpb3VzJ30pLFxuXHRcdFx0XHQkbmV4dCA9ICQoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiLz4nKS5hdHRyKHtpZDpwcmVmaXgrJ05leHQnfSksXG5cdFx0XHRcdCRzbGlkZXNob3cgPSAkdGFnKCdidXR0b24nLCBcIlNsaWRlc2hvd1wiKSxcblx0XHRcdFx0JGxvYWRpbmdPdmVybGF5XG5cdFx0XHQpO1xuXG5cdFx0XHQkY2xvc2UgPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIi8+JykuYXR0cih7aWQ6cHJlZml4KydDbG9zZSd9KTtcblxuXHRcdFx0JHdyYXAuYXBwZW5kKCAvLyBUaGUgM3gzIEdyaWQgdGhhdCBtYWtlcyB1cCBDb2xvcmJveFxuXHRcdFx0XHQkdGFnKGRpdikuYXBwZW5kKFxuXHRcdFx0XHRcdCR0YWcoZGl2LCBcIlRvcExlZnRcIiksXG5cdFx0XHRcdFx0JHRvcEJvcmRlciA9ICR0YWcoZGl2LCBcIlRvcENlbnRlclwiKSxcblx0XHRcdFx0XHQkdGFnKGRpdiwgXCJUb3BSaWdodFwiKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHQkdGFnKGRpdiwgZmFsc2UsICdjbGVhcjpsZWZ0JykuYXBwZW5kKFxuXHRcdFx0XHRcdCRsZWZ0Qm9yZGVyID0gJHRhZyhkaXYsIFwiTWlkZGxlTGVmdFwiKSxcblx0XHRcdFx0XHQkY29udGVudCxcblx0XHRcdFx0XHQkcmlnaHRCb3JkZXIgPSAkdGFnKGRpdiwgXCJNaWRkbGVSaWdodFwiKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHQkdGFnKGRpdiwgZmFsc2UsICdjbGVhcjpsZWZ0JykuYXBwZW5kKFxuXHRcdFx0XHRcdCR0YWcoZGl2LCBcIkJvdHRvbUxlZnRcIiksXG5cdFx0XHRcdFx0JGJvdHRvbUJvcmRlciA9ICR0YWcoZGl2LCBcIkJvdHRvbUNlbnRlclwiKSxcblx0XHRcdFx0XHQkdGFnKGRpdiwgXCJCb3R0b21SaWdodFwiKVxuXHRcdFx0XHQpXG5cdFx0XHQpLmZpbmQoJ2RpdiBkaXYnKS5jc3MoeydmbG9hdCc6ICdsZWZ0J30pO1xuXG5cdFx0XHQkbG9hZGluZ0JheSA9ICR0YWcoZGl2LCBmYWxzZSwgJ3Bvc2l0aW9uOmFic29sdXRlOyB3aWR0aDo5OTk5cHg7IHZpc2liaWxpdHk6aGlkZGVuOyBkaXNwbGF5Om5vbmU7IG1heC13aWR0aDpub25lOycpO1xuXG5cdFx0XHQkZ3JvdXBDb250cm9scyA9ICRuZXh0LmFkZCgkcHJldikuYWRkKCRjdXJyZW50KS5hZGQoJHNsaWRlc2hvdyk7XG5cdFx0fVxuXHRcdGlmIChkb2N1bWVudC5ib2R5ICYmICEkYm94LnBhcmVudCgpLmxlbmd0aCkge1xuXHRcdFx0JChkb2N1bWVudC5ib2R5KS5hcHBlbmQoJG92ZXJsYXksICRib3guYXBwZW5kKCR3cmFwLCAkbG9hZGluZ0JheSkpO1xuXHRcdH1cblx0fVxuXG5cdC8vIEFkZCBDb2xvcmJveCdzIGV2ZW50IGJpbmRpbmdzXG5cdGZ1bmN0aW9uIGFkZEJpbmRpbmdzKCkge1xuXHRcdGZ1bmN0aW9uIGNsaWNrSGFuZGxlcihlKSB7XG5cdFx0XHQvLyBpZ25vcmUgbm9uLWxlZnQtbW91c2UtY2xpY2tzIGFuZCBjbGlja3MgbW9kaWZpZWQgd2l0aCBjdHJsIC8gY29tbWFuZCwgc2hpZnQsIG9yIGFsdC5cblx0XHRcdC8vIFNlZTogaHR0cDovL2phY2tsbW9vcmUuY29tL25vdGVzL2NsaWNrLWV2ZW50cy9cblx0XHRcdGlmICghKGUud2hpY2ggPiAxIHx8IGUuc2hpZnRLZXkgfHwgZS5hbHRLZXkgfHwgZS5tZXRhS2V5IHx8IGUuY3RybEtleSkpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRsYXVuY2godGhpcyk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCRib3gpIHtcblx0XHRcdGlmICghaW5pdCkge1xuXHRcdFx0XHRpbml0ID0gdHJ1ZTtcblxuXHRcdFx0XHQvLyBBbm9ueW1vdXMgZnVuY3Rpb25zIGhlcmUga2VlcCB0aGUgcHVibGljIG1ldGhvZCBmcm9tIGJlaW5nIGNhY2hlZCwgdGhlcmVieSBhbGxvd2luZyB0aGVtIHRvIGJlIHJlZGVmaW5lZCBvbiB0aGUgZmx5LlxuXHRcdFx0XHQkbmV4dC5jbGljayhmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cHVibGljTWV0aG9kLm5leHQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdCRwcmV2LmNsaWNrKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRwdWJsaWNNZXRob2QucHJldigpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0JGNsb3NlLmNsaWNrKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRwdWJsaWNNZXRob2QuY2xvc2UoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdCRvdmVybGF5LmNsaWNrKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdvdmVybGF5Q2xvc2UnKSkge1xuXHRcdFx0XHRcdFx0cHVibGljTWV0aG9kLmNsb3NlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBLZXkgQmluZGluZ3Ncblx0XHRcdFx0JChkb2N1bWVudCkuYmluZCgna2V5ZG93bi4nICsgcHJlZml4LCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdHZhciBrZXkgPSBlLmtleUNvZGU7XG5cdFx0XHRcdFx0aWYgKG9wZW4gJiYgc2V0dGluZ3MuZ2V0KCdlc2NLZXknKSAmJiBrZXkgPT09IDI3KSB7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRwdWJsaWNNZXRob2QuY2xvc2UoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKG9wZW4gJiYgc2V0dGluZ3MuZ2V0KCdhcnJvd0tleScpICYmICRyZWxhdGVkWzFdICYmICFlLmFsdEtleSkge1xuXHRcdFx0XHRcdFx0aWYgKGtleSA9PT0gMzcpIHtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHQkcHJldi5jbGljaygpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChrZXkgPT09IDM5KSB7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0JG5leHQuY2xpY2soKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmICgkLmlzRnVuY3Rpb24oJC5mbi5vbikpIHtcblx0XHRcdFx0XHQvLyBGb3IgalF1ZXJ5IDEuNytcblx0XHRcdFx0XHQkKGRvY3VtZW50KS5vbignY2xpY2suJytwcmVmaXgsICcuJytib3hFbGVtZW50LCBjbGlja0hhbmRsZXIpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEZvciBqUXVlcnkgMS4zLnggLT4gMS42Lnhcblx0XHRcdFx0XHQvLyBUaGlzIGNvZGUgaXMgbmV2ZXIgcmVhY2hlZCBpbiBqUXVlcnkgMS45LCBzbyBkbyBub3QgY29udGFjdCBtZSBhYm91dCAnbGl2ZScgYmVpbmcgcmVtb3ZlZC5cblx0XHRcdFx0XHQvLyBUaGlzIGlzIG5vdCBoZXJlIGZvciBqUXVlcnkgMS45LCBpdCdzIGhlcmUgZm9yIGxlZ2FjeSB1c2Vycy5cblx0XHRcdFx0XHQkKCcuJytib3hFbGVtZW50KS5saXZlKCdjbGljay4nK3ByZWZpeCwgY2xpY2tIYW5kbGVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8vIERvbid0IGRvIGFueXRoaW5nIGlmIENvbG9yYm94IGFscmVhZHkgZXhpc3RzLlxuXHRpZiAoJFtjb2xvcmJveF0pIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHQvLyBBcHBlbmQgdGhlIEhUTUwgd2hlbiB0aGUgRE9NIGxvYWRzXG5cdCQoYXBwZW5kSFRNTCk7XG5cblxuXHQvLyAqKioqKioqKioqKioqKioqXG5cdC8vIFBVQkxJQyBGVU5DVElPTlNcblx0Ly8gVXNhZ2UgZm9ybWF0OiAkLmNvbG9yYm94LmNsb3NlKCk7XG5cdC8vIFVzYWdlIGZyb20gd2l0aGluIGFuIGlmcmFtZTogcGFyZW50LmpRdWVyeS5jb2xvcmJveC5jbG9zZSgpO1xuXHQvLyAqKioqKioqKioqKioqKioqXG5cblx0cHVibGljTWV0aG9kID0gJC5mbltjb2xvcmJveF0gPSAkW2NvbG9yYm94XSA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykge1xuXHRcdHZhciBzZXR0aW5ncztcblx0XHR2YXIgJG9iaiA9IHRoaXM7XG5cblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHRcdGlmICgkLmlzRnVuY3Rpb24oJG9iaikpIHsgLy8gYXNzdW1lIGEgY2FsbCB0byAkLmNvbG9yYm94XG5cdFx0XHQkb2JqID0gJCgnPGEvPicpO1xuXHRcdFx0b3B0aW9ucy5vcGVuID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRpZiAoISRvYmpbMF0pIHsgLy8gY29sb3Jib3ggYmVpbmcgYXBwbGllZCB0byBlbXB0eSBjb2xsZWN0aW9uXG5cdFx0XHRyZXR1cm4gJG9iajtcblx0XHR9XG5cblx0XHRhcHBlbmRIVE1MKCk7XG5cblx0XHRpZiAoYWRkQmluZGluZ3MoKSkge1xuXG5cdFx0XHRpZiAoY2FsbGJhY2spIHtcblx0XHRcdFx0b3B0aW9ucy5vbkNvbXBsZXRlID0gY2FsbGJhY2s7XG5cdFx0XHR9XG5cblx0XHRcdCRvYmouZWFjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciBvbGQgPSAkLmRhdGEodGhpcywgY29sb3Jib3gpIHx8IHt9O1xuXHRcdFx0XHQkLmRhdGEodGhpcywgY29sb3Jib3gsICQuZXh0ZW5kKG9sZCwgb3B0aW9ucykpO1xuXHRcdFx0fSkuYWRkQ2xhc3MoYm94RWxlbWVudCk7XG5cblx0XHRcdHNldHRpbmdzID0gbmV3IFNldHRpbmdzKCRvYmpbMF0sIG9wdGlvbnMpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdvcGVuJykpIHtcblx0XHRcdFx0bGF1bmNoKCRvYmpbMF0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiAkb2JqO1xuXHR9O1xuXG5cdHB1YmxpY01ldGhvZC5wb3NpdGlvbiA9IGZ1bmN0aW9uIChzcGVlZCwgbG9hZGVkQ2FsbGJhY2spIHtcblx0XHR2YXJcblx0XHRjc3MsXG5cdFx0dG9wID0gMCxcblx0XHRsZWZ0ID0gMCxcblx0XHRvZmZzZXQgPSAkYm94Lm9mZnNldCgpLFxuXHRcdHNjcm9sbFRvcCxcblx0XHRzY3JvbGxMZWZ0O1xuXG5cdFx0JHdpbmRvdy51bmJpbmQoJ3Jlc2l6ZS4nICsgcHJlZml4KTtcblxuXHRcdC8vIHJlbW92ZSB0aGUgbW9kYWwgc28gdGhhdCBpdCBkb2Vzbid0IGluZmx1ZW5jZSB0aGUgZG9jdW1lbnQgd2lkdGgvaGVpZ2h0XG5cdFx0JGJveC5jc3Moe3RvcDogLTllNCwgbGVmdDogLTllNH0pO1xuXG5cdFx0c2Nyb2xsVG9wID0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcblx0XHRzY3JvbGxMZWZ0ID0gJHdpbmRvdy5zY3JvbGxMZWZ0KCk7XG5cblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdmaXhlZCcpKSB7XG5cdFx0XHRvZmZzZXQudG9wIC09IHNjcm9sbFRvcDtcblx0XHRcdG9mZnNldC5sZWZ0IC09IHNjcm9sbExlZnQ7XG5cdFx0XHQkYm94LmNzcyh7cG9zaXRpb246ICdmaXhlZCd9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dG9wID0gc2Nyb2xsVG9wO1xuXHRcdFx0bGVmdCA9IHNjcm9sbExlZnQ7XG5cdFx0XHQkYm94LmNzcyh7cG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcblx0XHR9XG5cblx0XHQvLyBrZWVwcyB0aGUgdG9wIGFuZCBsZWZ0IHBvc2l0aW9ucyB3aXRoaW4gdGhlIGJyb3dzZXIncyB2aWV3cG9ydC5cblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdyaWdodCcpICE9PSBmYWxzZSkge1xuXHRcdFx0bGVmdCArPSBNYXRoLm1heCgkd2luZG93LndpZHRoKCkgLSBzZXR0aW5ncy53IC0gbG9hZGVkV2lkdGggLSBpbnRlcmZhY2VXaWR0aCAtIHNldFNpemUoc2V0dGluZ3MuZ2V0KCdyaWdodCcpLCAneCcpLCAwKTtcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgnbGVmdCcpICE9PSBmYWxzZSkge1xuXHRcdFx0bGVmdCArPSBzZXRTaXplKHNldHRpbmdzLmdldCgnbGVmdCcpLCAneCcpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsZWZ0ICs9IE1hdGgucm91bmQoTWF0aC5tYXgoJHdpbmRvdy53aWR0aCgpIC0gc2V0dGluZ3MudyAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGgsIDApIC8gMik7XG5cdFx0fVxuXG5cdFx0aWYgKHNldHRpbmdzLmdldCgnYm90dG9tJykgIT09IGZhbHNlKSB7XG5cdFx0XHR0b3AgKz0gTWF0aC5tYXgod2luaGVpZ2h0KCkgLSBzZXR0aW5ncy5oIC0gbG9hZGVkSGVpZ2h0IC0gaW50ZXJmYWNlSGVpZ2h0IC0gc2V0U2l6ZShzZXR0aW5ncy5nZXQoJ2JvdHRvbScpLCAneScpLCAwKTtcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgndG9wJykgIT09IGZhbHNlKSB7XG5cdFx0XHR0b3AgKz0gc2V0U2l6ZShzZXR0aW5ncy5nZXQoJ3RvcCcpLCAneScpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0b3AgKz0gTWF0aC5yb3VuZChNYXRoLm1heCh3aW5oZWlnaHQoKSAtIHNldHRpbmdzLmggLSBsb2FkZWRIZWlnaHQgLSBpbnRlcmZhY2VIZWlnaHQsIDApIC8gMik7XG5cdFx0fVxuXG5cdFx0JGJveC5jc3Moe3RvcDogb2Zmc2V0LnRvcCwgbGVmdDogb2Zmc2V0LmxlZnQsIHZpc2liaWxpdHk6J3Zpc2libGUnfSk7XG5cblx0XHQvLyB0aGlzIGdpdmVzIHRoZSB3cmFwcGVyIHBsZW50eSBvZiBicmVhdGhpbmcgcm9vbSBzbyBpdCdzIGZsb2F0ZWQgY29udGVudHMgY2FuIG1vdmUgYXJvdW5kIHNtb290aGx5LFxuXHRcdC8vIGJ1dCBpdCBoYXMgdG8gYmUgc2hyYW5rIGRvd24gYXJvdW5kIHRoZSBzaXplIG9mIGRpdiNjb2xvcmJveCB3aGVuIGl0J3MgZG9uZS4gIElmIG5vdCxcblx0XHQvLyBpdCBjYW4gaW52b2tlIGFuIG9ic2N1cmUgSUUgYnVnIHdoZW4gdXNpbmcgaWZyYW1lcy5cblx0XHQkd3JhcFswXS5zdHlsZS53aWR0aCA9ICR3cmFwWzBdLnN0eWxlLmhlaWdodCA9IFwiOTk5OXB4XCI7XG5cblx0XHRmdW5jdGlvbiBtb2RhbERpbWVuc2lvbnMoKSB7XG5cdFx0XHQkdG9wQm9yZGVyWzBdLnN0eWxlLndpZHRoID0gJGJvdHRvbUJvcmRlclswXS5zdHlsZS53aWR0aCA9ICRjb250ZW50WzBdLnN0eWxlLndpZHRoID0gKHBhcnNlSW50KCRib3hbMF0uc3R5bGUud2lkdGgsMTApIC0gaW50ZXJmYWNlV2lkdGgpKydweCc7XG5cdFx0XHQkY29udGVudFswXS5zdHlsZS5oZWlnaHQgPSAkbGVmdEJvcmRlclswXS5zdHlsZS5oZWlnaHQgPSAkcmlnaHRCb3JkZXJbMF0uc3R5bGUuaGVpZ2h0ID0gKHBhcnNlSW50KCRib3hbMF0uc3R5bGUuaGVpZ2h0LDEwKSAtIGludGVyZmFjZUhlaWdodCkrJ3B4Jztcblx0XHR9XG5cblx0XHRjc3MgPSB7d2lkdGg6IHNldHRpbmdzLncgKyBsb2FkZWRXaWR0aCArIGludGVyZmFjZVdpZHRoLCBoZWlnaHQ6IHNldHRpbmdzLmggKyBsb2FkZWRIZWlnaHQgKyBpbnRlcmZhY2VIZWlnaHQsIHRvcDogdG9wLCBsZWZ0OiBsZWZ0fTtcblxuXHRcdC8vIHNldHRpbmcgdGhlIHNwZWVkIHRvIDAgaWYgdGhlIGNvbnRlbnQgaGFzbid0IGNoYW5nZWQgc2l6ZSBvciBwb3NpdGlvblxuXHRcdGlmIChzcGVlZCkge1xuXHRcdFx0dmFyIHRlbXBTcGVlZCA9IDA7XG5cdFx0XHQkLmVhY2goY3NzLCBmdW5jdGlvbihpKXtcblx0XHRcdFx0aWYgKGNzc1tpXSAhPT0gcHJldmlvdXNDU1NbaV0pIHtcblx0XHRcdFx0XHR0ZW1wU3BlZWQgPSBzcGVlZDtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0c3BlZWQgPSB0ZW1wU3BlZWQ7XG5cdFx0fVxuXG5cdFx0cHJldmlvdXNDU1MgPSBjc3M7XG5cblx0XHRpZiAoIXNwZWVkKSB7XG5cdFx0XHQkYm94LmNzcyhjc3MpO1xuXHRcdH1cblxuXHRcdCRib3guZGVxdWV1ZSgpLmFuaW1hdGUoY3NzLCB7XG5cdFx0XHRkdXJhdGlvbjogc3BlZWQgfHwgMCxcblx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdG1vZGFsRGltZW5zaW9ucygpO1xuXG5cdFx0XHRcdGFjdGl2ZSA9IGZhbHNlO1xuXG5cdFx0XHRcdC8vIHNocmluayB0aGUgd3JhcHBlciBkb3duIHRvIGV4YWN0bHkgdGhlIHNpemUgb2YgY29sb3Jib3ggdG8gYXZvaWQgYSBidWcgaW4gSUUncyBpZnJhbWUgaW1wbGVtZW50YXRpb24uXG5cdFx0XHRcdCR3cmFwWzBdLnN0eWxlLndpZHRoID0gKHNldHRpbmdzLncgKyBsb2FkZWRXaWR0aCArIGludGVyZmFjZVdpZHRoKSArIFwicHhcIjtcblx0XHRcdFx0JHdyYXBbMF0uc3R5bGUuaGVpZ2h0ID0gKHNldHRpbmdzLmggKyBsb2FkZWRIZWlnaHQgKyBpbnRlcmZhY2VIZWlnaHQpICsgXCJweFwiO1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3JlcG9zaXRpb24nKSkge1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyAgLy8gc21hbGwgZGVsYXkgYmVmb3JlIGJpbmRpbmcgb25yZXNpemUgZHVlIHRvIGFuIElFOCBidWcuXG5cdFx0XHRcdFx0XHQkd2luZG93LmJpbmQoJ3Jlc2l6ZS4nICsgcHJlZml4LCBwdWJsaWNNZXRob2QucG9zaXRpb24pO1xuXHRcdFx0XHRcdH0sIDEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCQuaXNGdW5jdGlvbihsb2FkZWRDYWxsYmFjaykpIHtcblx0XHRcdFx0XHRsb2FkZWRDYWxsYmFjaygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0c3RlcDogbW9kYWxEaW1lbnNpb25zXG5cdFx0fSk7XG5cdH07XG5cblx0cHVibGljTWV0aG9kLnJlc2l6ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cdFx0dmFyIHNjcm9sbHRvcDtcblxuXHRcdGlmIChvcGVuKSB7XG5cdFx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHRcdFx0aWYgKG9wdGlvbnMud2lkdGgpIHtcblx0XHRcdFx0c2V0dGluZ3MudyA9IHNldFNpemUob3B0aW9ucy53aWR0aCwgJ3gnKSAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zLmlubmVyV2lkdGgpIHtcblx0XHRcdFx0c2V0dGluZ3MudyA9IHNldFNpemUob3B0aW9ucy5pbm5lcldpZHRoLCAneCcpO1xuXHRcdFx0fVxuXG5cdFx0XHQkbG9hZGVkLmNzcyh7d2lkdGg6IHNldHRpbmdzLnd9KTtcblxuXHRcdFx0aWYgKG9wdGlvbnMuaGVpZ2h0KSB7XG5cdFx0XHRcdHNldHRpbmdzLmggPSBzZXRTaXplKG9wdGlvbnMuaGVpZ2h0LCAneScpIC0gbG9hZGVkSGVpZ2h0IC0gaW50ZXJmYWNlSGVpZ2h0O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0aW9ucy5pbm5lckhlaWdodCkge1xuXHRcdFx0XHRzZXR0aW5ncy5oID0gc2V0U2l6ZShvcHRpb25zLmlubmVySGVpZ2h0LCAneScpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIW9wdGlvbnMuaW5uZXJIZWlnaHQgJiYgIW9wdGlvbnMuaGVpZ2h0KSB7XG5cdFx0XHRcdHNjcm9sbHRvcCA9ICRsb2FkZWQuc2Nyb2xsVG9wKCk7XG5cdFx0XHRcdCRsb2FkZWQuY3NzKHtoZWlnaHQ6IFwiYXV0b1wifSk7XG5cdFx0XHRcdHNldHRpbmdzLmggPSAkbG9hZGVkLmhlaWdodCgpO1xuXHRcdFx0fVxuXG5cdFx0XHQkbG9hZGVkLmNzcyh7aGVpZ2h0OiBzZXR0aW5ncy5ofSk7XG5cblx0XHRcdGlmKHNjcm9sbHRvcCkge1xuXHRcdFx0XHQkbG9hZGVkLnNjcm9sbFRvcChzY3JvbGx0b3ApO1xuXHRcdFx0fVxuXG5cdFx0XHRwdWJsaWNNZXRob2QucG9zaXRpb24oc2V0dGluZ3MuZ2V0KCd0cmFuc2l0aW9uJykgPT09IFwibm9uZVwiID8gMCA6IHNldHRpbmdzLmdldCgnc3BlZWQnKSk7XG5cdFx0fVxuXHR9O1xuXG5cdHB1YmxpY01ldGhvZC5wcmVwID0gZnVuY3Rpb24gKG9iamVjdCkge1xuXHRcdGlmICghb3Blbikge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHZhciBjYWxsYmFjaywgc3BlZWQgPSBzZXR0aW5ncy5nZXQoJ3RyYW5zaXRpb24nKSA9PT0gXCJub25lXCIgPyAwIDogc2V0dGluZ3MuZ2V0KCdzcGVlZCcpO1xuXG5cdFx0JGxvYWRlZC5yZW1vdmUoKTtcblxuXHRcdCRsb2FkZWQgPSAkdGFnKGRpdiwgJ0xvYWRlZENvbnRlbnQnKS5hcHBlbmQob2JqZWN0KTtcblxuXHRcdGZ1bmN0aW9uIGdldFdpZHRoKCkge1xuXHRcdFx0c2V0dGluZ3MudyA9IHNldHRpbmdzLncgfHwgJGxvYWRlZC53aWR0aCgpO1xuXHRcdFx0c2V0dGluZ3MudyA9IHNldHRpbmdzLm13ICYmIHNldHRpbmdzLm13IDwgc2V0dGluZ3MudyA/IHNldHRpbmdzLm13IDogc2V0dGluZ3Mudztcblx0XHRcdHJldHVybiBzZXR0aW5ncy53O1xuXHRcdH1cblx0XHRmdW5jdGlvbiBnZXRIZWlnaHQoKSB7XG5cdFx0XHRzZXR0aW5ncy5oID0gc2V0dGluZ3MuaCB8fCAkbG9hZGVkLmhlaWdodCgpO1xuXHRcdFx0c2V0dGluZ3MuaCA9IHNldHRpbmdzLm1oICYmIHNldHRpbmdzLm1oIDwgc2V0dGluZ3MuaCA/IHNldHRpbmdzLm1oIDogc2V0dGluZ3MuaDtcblx0XHRcdHJldHVybiBzZXR0aW5ncy5oO1xuXHRcdH1cblxuXHRcdCRsb2FkZWQuaGlkZSgpXG5cdFx0LmFwcGVuZFRvKCRsb2FkaW5nQmF5LnNob3coKSkvLyBjb250ZW50IGhhcyB0byBiZSBhcHBlbmRlZCB0byB0aGUgRE9NIGZvciBhY2N1cmF0ZSBzaXplIGNhbGN1bGF0aW9ucy5cblx0XHQuY3NzKHt3aWR0aDogZ2V0V2lkdGgoKSwgb3ZlcmZsb3c6IHNldHRpbmdzLmdldCgnc2Nyb2xsaW5nJykgPyAnYXV0bycgOiAnaGlkZGVuJ30pXG5cdFx0LmNzcyh7aGVpZ2h0OiBnZXRIZWlnaHQoKX0pLy8gc2V0cyB0aGUgaGVpZ2h0IGluZGVwZW5kZW50bHkgZnJvbSB0aGUgd2lkdGggaW4gY2FzZSB0aGUgbmV3IHdpZHRoIGluZmx1ZW5jZXMgdGhlIHZhbHVlIG9mIGhlaWdodC5cblx0XHQucHJlcGVuZFRvKCRjb250ZW50KTtcblxuXHRcdCRsb2FkaW5nQmF5LmhpZGUoKTtcblxuXHRcdC8vIGZsb2F0aW5nIHRoZSBJTUcgcmVtb3ZlcyB0aGUgYm90dG9tIGxpbmUtaGVpZ2h0IGFuZCBmaXhlZCBhIHByb2JsZW0gd2hlcmUgSUUgbWlzY2FsY3VsYXRlcyB0aGUgd2lkdGggb2YgdGhlIHBhcmVudCBlbGVtZW50IGFzIDEwMCUgb2YgdGhlIGRvY3VtZW50IHdpZHRoLlxuXG5cdFx0JChwaG90bykuY3NzKHsnZmxvYXQnOiAnbm9uZSd9KTtcblxuXHRcdHNldENsYXNzKHNldHRpbmdzLmdldCgnY2xhc3NOYW1lJykpO1xuXG5cdFx0Y2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgdG90YWwgPSAkcmVsYXRlZC5sZW5ndGgsXG5cdFx0XHRcdGlmcmFtZSxcblx0XHRcdFx0Y29tcGxldGU7XG5cblx0XHRcdGlmICghb3Blbikge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlbW92ZUZpbHRlcigpIHsgLy8gTmVlZGVkIGZvciBJRTggaW4gdmVyc2lvbnMgb2YgalF1ZXJ5IHByaW9yIHRvIDEuNy4yXG5cdFx0XHRcdGlmICgkLnN1cHBvcnQub3BhY2l0eSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHQkYm94WzBdLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Y29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dChsb2FkaW5nVGltZXIpO1xuXHRcdFx0XHQkbG9hZGluZ092ZXJsYXkuaGlkZSgpO1xuXHRcdFx0XHR0cmlnZ2VyKGV2ZW50X2NvbXBsZXRlKTtcblx0XHRcdFx0c2V0dGluZ3MuZ2V0KCdvbkNvbXBsZXRlJyk7XG5cdFx0XHR9O1xuXG5cblx0XHRcdCR0aXRsZS5odG1sKHNldHRpbmdzLmdldCgndGl0bGUnKSkuc2hvdygpO1xuXHRcdFx0JGxvYWRlZC5zaG93KCk7XG5cblx0XHRcdGlmICh0b3RhbCA+IDEpIHsgLy8gaGFuZGxlIGdyb3VwaW5nXG5cdFx0XHRcdGlmICh0eXBlb2Ygc2V0dGluZ3MuZ2V0KCdjdXJyZW50JykgPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHQkY3VycmVudC5odG1sKHNldHRpbmdzLmdldCgnY3VycmVudCcpLnJlcGxhY2UoJ3tjdXJyZW50fScsIGluZGV4ICsgMSkucmVwbGFjZSgne3RvdGFsfScsIHRvdGFsKSkuc2hvdygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0JG5leHRbKHNldHRpbmdzLmdldCgnbG9vcCcpIHx8IGluZGV4IDwgdG90YWwgLSAxKSA/IFwic2hvd1wiIDogXCJoaWRlXCJdKCkuaHRtbChzZXR0aW5ncy5nZXQoJ25leHQnKSk7XG5cdFx0XHRcdCRwcmV2WyhzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCBpbmRleCkgPyBcInNob3dcIiA6IFwiaGlkZVwiXSgpLmh0bWwoc2V0dGluZ3MuZ2V0KCdwcmV2aW91cycpKTtcblxuXHRcdFx0XHRzbGlkZXNob3coKTtcblxuXHRcdFx0XHQvLyBQcmVsb2FkcyBpbWFnZXMgd2l0aGluIGEgcmVsIGdyb3VwXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3ByZWxvYWRpbmcnKSkge1xuXHRcdFx0XHRcdCQuZWFjaChbZ2V0SW5kZXgoLTEpLCBnZXRJbmRleCgxKV0sIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR2YXIgaW1nLFxuXHRcdFx0XHRcdFx0XHRpID0gJHJlbGF0ZWRbdGhpc10sXG5cdFx0XHRcdFx0XHRcdHNldHRpbmdzID0gbmV3IFNldHRpbmdzKGksICQuZGF0YShpLCBjb2xvcmJveCkpLFxuXHRcdFx0XHRcdFx0XHRzcmMgPSBzZXR0aW5ncy5nZXQoJ2hyZWYnKTtcblxuXHRcdFx0XHRcdFx0aWYgKHNyYyAmJiBpc0ltYWdlKHNldHRpbmdzLCBzcmMpKSB7XG5cdFx0XHRcdFx0XHRcdHNyYyA9IHJldGluYVVybChzZXR0aW5ncywgc3JjKTtcblx0XHRcdFx0XHRcdFx0aW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cdFx0XHRcdFx0XHRcdGltZy5zcmMgPSBzcmM7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRncm91cENvbnRyb2xzLmhpZGUoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLmdldCgnaWZyYW1lJykpIHtcblxuXHRcdFx0XHRpZnJhbWUgPSBzZXR0aW5ncy5nZXQoJ2NyZWF0ZUlmcmFtZScpO1xuXG5cdFx0XHRcdGlmICghc2V0dGluZ3MuZ2V0KCdzY3JvbGxpbmcnKSkge1xuXHRcdFx0XHRcdGlmcmFtZS5zY3JvbGxpbmcgPSBcIm5vXCI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkKGlmcmFtZSlcblx0XHRcdFx0XHQuYXR0cih7XG5cdFx0XHRcdFx0XHRzcmM6IHNldHRpbmdzLmdldCgnaHJlZicpLFxuXHRcdFx0XHRcdFx0J2NsYXNzJzogcHJlZml4ICsgJ0lmcmFtZSdcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbmUoJ2xvYWQnLCBjb21wbGV0ZSlcblx0XHRcdFx0XHQuYXBwZW5kVG8oJGxvYWRlZCk7XG5cblx0XHRcdFx0JGV2ZW50cy5vbmUoZXZlbnRfcHVyZ2UsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZnJhbWUuc3JjID0gXCIvL2Fib3V0OmJsYW5rXCI7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ2Zhc3RJZnJhbWUnKSkge1xuXHRcdFx0XHRcdCQoaWZyYW1lKS50cmlnZ2VyKCdsb2FkJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbXBsZXRlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3RyYW5zaXRpb24nKSA9PT0gJ2ZhZGUnKSB7XG5cdFx0XHRcdCRib3guZmFkZVRvKHNwZWVkLCAxLCByZW1vdmVGaWx0ZXIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVtb3ZlRmlsdGVyKCk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdGlmIChzZXR0aW5ncy5nZXQoJ3RyYW5zaXRpb24nKSA9PT0gJ2ZhZGUnKSB7XG5cdFx0XHQkYm94LmZhZGVUbyhzcGVlZCwgMCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRwdWJsaWNNZXRob2QucG9zaXRpb24oMCwgY2FsbGJhY2spO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHB1YmxpY01ldGhvZC5wb3NpdGlvbihzcGVlZCwgY2FsbGJhY2spO1xuXHRcdH1cblx0fTtcblxuXHRmdW5jdGlvbiBsb2FkICgpIHtcblx0XHR2YXIgaHJlZiwgc2V0UmVzaXplLCBwcmVwID0gcHVibGljTWV0aG9kLnByZXAsICRpbmxpbmUsIHJlcXVlc3QgPSArK3JlcXVlc3RzO1xuXG5cdFx0YWN0aXZlID0gdHJ1ZTtcblxuXHRcdHBob3RvID0gZmFsc2U7XG5cblx0XHR0cmlnZ2VyKGV2ZW50X3B1cmdlKTtcblx0XHR0cmlnZ2VyKGV2ZW50X2xvYWQpO1xuXHRcdHNldHRpbmdzLmdldCgnb25Mb2FkJyk7XG5cblx0XHRzZXR0aW5ncy5oID0gc2V0dGluZ3MuZ2V0KCdoZWlnaHQnKSA/XG5cdFx0XHRcdHNldFNpemUoc2V0dGluZ3MuZ2V0KCdoZWlnaHQnKSwgJ3knKSAtIGxvYWRlZEhlaWdodCAtIGludGVyZmFjZUhlaWdodCA6XG5cdFx0XHRcdHNldHRpbmdzLmdldCgnaW5uZXJIZWlnaHQnKSAmJiBzZXRTaXplKHNldHRpbmdzLmdldCgnaW5uZXJIZWlnaHQnKSwgJ3knKTtcblxuXHRcdHNldHRpbmdzLncgPSBzZXR0aW5ncy5nZXQoJ3dpZHRoJykgP1xuXHRcdFx0XHRzZXRTaXplKHNldHRpbmdzLmdldCgnd2lkdGgnKSwgJ3gnKSAtIGxvYWRlZFdpZHRoIC0gaW50ZXJmYWNlV2lkdGggOlxuXHRcdFx0XHRzZXR0aW5ncy5nZXQoJ2lubmVyV2lkdGgnKSAmJiBzZXRTaXplKHNldHRpbmdzLmdldCgnaW5uZXJXaWR0aCcpLCAneCcpO1xuXG5cdFx0Ly8gU2V0cyB0aGUgbWluaW11bSBkaW1lbnNpb25zIGZvciB1c2UgaW4gaW1hZ2Ugc2NhbGluZ1xuXHRcdHNldHRpbmdzLm13ID0gc2V0dGluZ3Mudztcblx0XHRzZXR0aW5ncy5taCA9IHNldHRpbmdzLmg7XG5cblx0XHQvLyBSZS1ldmFsdWF0ZSB0aGUgbWluaW11bSB3aWR0aCBhbmQgaGVpZ2h0IGJhc2VkIG9uIG1heFdpZHRoIGFuZCBtYXhIZWlnaHQgdmFsdWVzLlxuXHRcdC8vIElmIHRoZSB3aWR0aCBvciBoZWlnaHQgZXhjZWVkIHRoZSBtYXhXaWR0aCBvciBtYXhIZWlnaHQsIHVzZSB0aGUgbWF4aW11bSB2YWx1ZXMgaW5zdGVhZC5cblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdtYXhXaWR0aCcpKSB7XG5cdFx0XHRzZXR0aW5ncy5tdyA9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdtYXhXaWR0aCcpLCAneCcpIC0gbG9hZGVkV2lkdGggLSBpbnRlcmZhY2VXaWR0aDtcblx0XHRcdHNldHRpbmdzLm13ID0gc2V0dGluZ3MudyAmJiBzZXR0aW5ncy53IDwgc2V0dGluZ3MubXcgPyBzZXR0aW5ncy53IDogc2V0dGluZ3MubXc7XG5cdFx0fVxuXHRcdGlmIChzZXR0aW5ncy5nZXQoJ21heEhlaWdodCcpKSB7XG5cdFx0XHRzZXR0aW5ncy5taCA9IHNldFNpemUoc2V0dGluZ3MuZ2V0KCdtYXhIZWlnaHQnKSwgJ3knKSAtIGxvYWRlZEhlaWdodCAtIGludGVyZmFjZUhlaWdodDtcblx0XHRcdHNldHRpbmdzLm1oID0gc2V0dGluZ3MuaCAmJiBzZXR0aW5ncy5oIDwgc2V0dGluZ3MubWggPyBzZXR0aW5ncy5oIDogc2V0dGluZ3MubWg7XG5cdFx0fVxuXG5cdFx0aHJlZiA9IHNldHRpbmdzLmdldCgnaHJlZicpO1xuXG5cdFx0bG9hZGluZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHQkbG9hZGluZ092ZXJsYXkuc2hvdygpO1xuXHRcdH0sIDEwMCk7XG5cblx0XHRpZiAoc2V0dGluZ3MuZ2V0KCdpbmxpbmUnKSkge1xuXHRcdFx0dmFyICR0YXJnZXQgPSAkKGhyZWYpO1xuXHRcdFx0Ly8gSW5zZXJ0cyBhbiBlbXB0eSBwbGFjZWhvbGRlciB3aGVyZSBpbmxpbmUgY29udGVudCBpcyBiZWluZyBwdWxsZWQgZnJvbS5cblx0XHRcdC8vIEFuIGV2ZW50IGlzIGJvdW5kIHRvIHB1dCBpbmxpbmUgY29udGVudCBiYWNrIHdoZW4gQ29sb3Jib3ggY2xvc2VzIG9yIGxvYWRzIG5ldyBjb250ZW50LlxuXHRcdFx0JGlubGluZSA9ICQoJzxkaXY+JykuaGlkZSgpLmluc2VydEJlZm9yZSgkdGFyZ2V0KTtcblxuXHRcdFx0JGV2ZW50cy5vbmUoZXZlbnRfcHVyZ2UsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JGlubGluZS5yZXBsYWNlV2l0aCgkdGFyZ2V0KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRwcmVwKCR0YXJnZXQpO1xuXHRcdH0gZWxzZSBpZiAoc2V0dGluZ3MuZ2V0KCdpZnJhbWUnKSkge1xuXHRcdFx0Ly8gSUZyYW1lIGVsZW1lbnQgd29uJ3QgYmUgYWRkZWQgdG8gdGhlIERPTSB1bnRpbCBpdCBpcyByZWFkeSB0byBiZSBkaXNwbGF5ZWQsXG5cdFx0XHQvLyB0byBhdm9pZCBwcm9ibGVtcyB3aXRoIERPTS1yZWFkeSBKUyB0aGF0IG1pZ2h0IGJlIHRyeWluZyB0byBydW4gaW4gdGhhdCBpZnJhbWUuXG5cdFx0XHRwcmVwKFwiIFwiKTtcblx0XHR9IGVsc2UgaWYgKHNldHRpbmdzLmdldCgnaHRtbCcpKSB7XG5cdFx0XHRwcmVwKHNldHRpbmdzLmdldCgnaHRtbCcpKTtcblx0XHR9IGVsc2UgaWYgKGlzSW1hZ2Uoc2V0dGluZ3MsIGhyZWYpKSB7XG5cblx0XHRcdGhyZWYgPSByZXRpbmFVcmwoc2V0dGluZ3MsIGhyZWYpO1xuXG5cdFx0XHRwaG90byA9IHNldHRpbmdzLmdldCgnY3JlYXRlSW1nJyk7XG5cblx0XHRcdCQocGhvdG8pXG5cdFx0XHQuYWRkQ2xhc3MocHJlZml4ICsgJ1Bob3RvJylcblx0XHRcdC5iaW5kKCdlcnJvci4nK3ByZWZpeCxmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHByZXAoJHRhZyhkaXYsICdFcnJvcicpLmh0bWwoc2V0dGluZ3MuZ2V0KCdpbWdFcnJvcicpKSk7XG5cdFx0XHR9KVxuXHRcdFx0Lm9uZSgnbG9hZCcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aWYgKHJlcXVlc3QgIT09IHJlcXVlc3RzKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQSBzbWFsbCBwYXVzZSBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgd2lsbCBvY2Nhc3Npb25hbHkgcmVwb3J0IGFcblx0XHRcdFx0Ly8gaW1nLndpZHRoIGFuZCBpbWcuaGVpZ2h0IG9mIHplcm8gaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGltZy5vbmxvYWQgZmlyZXNcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpe1xuXHRcdFx0XHRcdHZhciBwZXJjZW50O1xuXG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmdldCgncmV0aW5hSW1hZ2UnKSAmJiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEpIHtcblx0XHRcdFx0XHRcdHBob3RvLmhlaWdodCA9IHBob3RvLmhlaWdodCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xuXHRcdFx0XHRcdFx0cGhvdG8ud2lkdGggPSBwaG90by53aWR0aCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5nZXQoJ3NjYWxlUGhvdG9zJykpIHtcblx0XHRcdFx0XHRcdHNldFJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0cGhvdG8uaGVpZ2h0IC09IHBob3RvLmhlaWdodCAqIHBlcmNlbnQ7XG5cdFx0XHRcdFx0XHRcdHBob3RvLndpZHRoIC09IHBob3RvLndpZHRoICogcGVyY2VudDtcblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRpZiAoc2V0dGluZ3MubXcgJiYgcGhvdG8ud2lkdGggPiBzZXR0aW5ncy5tdykge1xuXHRcdFx0XHRcdFx0XHRwZXJjZW50ID0gKHBob3RvLndpZHRoIC0gc2V0dGluZ3MubXcpIC8gcGhvdG8ud2lkdGg7XG5cdFx0XHRcdFx0XHRcdHNldFJlc2l6ZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYgKHNldHRpbmdzLm1oICYmIHBob3RvLmhlaWdodCA+IHNldHRpbmdzLm1oKSB7XG5cdFx0XHRcdFx0XHRcdHBlcmNlbnQgPSAocGhvdG8uaGVpZ2h0IC0gc2V0dGluZ3MubWgpIC8gcGhvdG8uaGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHRzZXRSZXNpemUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuaCkge1xuXHRcdFx0XHRcdFx0cGhvdG8uc3R5bGUubWFyZ2luVG9wID0gTWF0aC5tYXgoc2V0dGluZ3MubWggLSBwaG90by5oZWlnaHQsIDApIC8gMiArICdweCc7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCRyZWxhdGVkWzFdICYmIChzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCAkcmVsYXRlZFtpbmRleCArIDFdKSkge1xuXHRcdFx0XHRcdFx0cGhvdG8uc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInO1xuXG5cdFx0XHRcdFx0XHQkKHBob3RvKS5iaW5kKCdjbGljay4nK3ByZWZpeCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRwdWJsaWNNZXRob2QubmV4dCgpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cGhvdG8uc3R5bGUud2lkdGggPSBwaG90by53aWR0aCArICdweCc7XG5cdFx0XHRcdFx0cGhvdG8uc3R5bGUuaGVpZ2h0ID0gcGhvdG8uaGVpZ2h0ICsgJ3B4Jztcblx0XHRcdFx0XHRwcmVwKHBob3RvKTtcblx0XHRcdFx0fSwgMSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cGhvdG8uc3JjID0gaHJlZjtcblxuXHRcdH0gZWxzZSBpZiAoaHJlZikge1xuXHRcdFx0JGxvYWRpbmdCYXkubG9hZChocmVmLCBzZXR0aW5ncy5nZXQoJ2RhdGEnKSwgZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuXHRcdFx0XHRpZiAocmVxdWVzdCA9PT0gcmVxdWVzdHMpIHtcblx0XHRcdFx0XHRwcmVwKHN0YXR1cyA9PT0gJ2Vycm9yJyA/ICR0YWcoZGl2LCAnRXJyb3InKS5odG1sKHNldHRpbmdzLmdldCgneGhyRXJyb3InKSkgOiAkKHRoaXMpLmNvbnRlbnRzKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvLyBOYXZpZ2F0ZXMgdG8gdGhlIG5leHQgcGFnZS9pbWFnZSBpbiBhIHNldC5cblx0cHVibGljTWV0aG9kLm5leHQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKCFhY3RpdmUgJiYgJHJlbGF0ZWRbMV0gJiYgKHNldHRpbmdzLmdldCgnbG9vcCcpIHx8ICRyZWxhdGVkW2luZGV4ICsgMV0pKSB7XG5cdFx0XHRpbmRleCA9IGdldEluZGV4KDEpO1xuXHRcdFx0bGF1bmNoKCRyZWxhdGVkW2luZGV4XSk7XG5cdFx0fVxuXHR9O1xuXG5cdHB1YmxpY01ldGhvZC5wcmV2ID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICghYWN0aXZlICYmICRyZWxhdGVkWzFdICYmIChzZXR0aW5ncy5nZXQoJ2xvb3AnKSB8fCBpbmRleCkpIHtcblx0XHRcdGluZGV4ID0gZ2V0SW5kZXgoLTEpO1xuXHRcdFx0bGF1bmNoKCRyZWxhdGVkW2luZGV4XSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIE5vdGU6IHRvIHVzZSB0aGlzIHdpdGhpbiBhbiBpZnJhbWUgdXNlIHRoZSBmb2xsb3dpbmcgZm9ybWF0OiBwYXJlbnQualF1ZXJ5LmNvbG9yYm94LmNsb3NlKCk7XG5cdHB1YmxpY01ldGhvZC5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAob3BlbiAmJiAhY2xvc2luZykge1xuXG5cdFx0XHRjbG9zaW5nID0gdHJ1ZTtcblx0XHRcdG9wZW4gPSBmYWxzZTtcblx0XHRcdHRyaWdnZXIoZXZlbnRfY2xlYW51cCk7XG5cdFx0XHRzZXR0aW5ncy5nZXQoJ29uQ2xlYW51cCcpO1xuXHRcdFx0JHdpbmRvdy51bmJpbmQoJy4nICsgcHJlZml4KTtcblx0XHRcdCRvdmVybGF5LmZhZGVUbyhzZXR0aW5ncy5nZXQoJ2ZhZGVPdXQnKSB8fCAwLCAwKTtcblxuXHRcdFx0JGJveC5zdG9wKCkuZmFkZVRvKHNldHRpbmdzLmdldCgnZmFkZU91dCcpIHx8IDAsIDAsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JGJveC5oaWRlKCk7XG5cdFx0XHRcdCRvdmVybGF5LmhpZGUoKTtcblx0XHRcdFx0dHJpZ2dlcihldmVudF9wdXJnZSk7XG5cdFx0XHRcdCRsb2FkZWQucmVtb3ZlKCk7XG5cblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0Y2xvc2luZyA9IGZhbHNlO1xuXHRcdFx0XHRcdHRyaWdnZXIoZXZlbnRfY2xvc2VkKTtcblx0XHRcdFx0XHRzZXR0aW5ncy5nZXQoJ29uQ2xvc2VkJyk7XG5cdFx0XHRcdH0sIDEpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIFJlbW92ZXMgY2hhbmdlcyBDb2xvcmJveCBtYWRlIHRvIHRoZSBkb2N1bWVudCwgYnV0IGRvZXMgbm90IHJlbW92ZSB0aGUgcGx1Z2luLlxuXHRwdWJsaWNNZXRob2QucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmICghJGJveCkgeyByZXR1cm47IH1cblxuXHRcdCRib3guc3RvcCgpO1xuXHRcdCRbY29sb3Jib3hdLmNsb3NlKCk7XG5cdFx0JGJveC5zdG9wKGZhbHNlLCB0cnVlKS5yZW1vdmUoKTtcblx0XHQkb3ZlcmxheS5yZW1vdmUoKTtcblx0XHRjbG9zaW5nID0gZmFsc2U7XG5cdFx0JGJveCA9IG51bGw7XG5cdFx0JCgnLicgKyBib3hFbGVtZW50KVxuXHRcdFx0LnJlbW92ZURhdGEoY29sb3Jib3gpXG5cdFx0XHQucmVtb3ZlQ2xhc3MoYm94RWxlbWVudCk7XG5cblx0XHQkKGRvY3VtZW50KS51bmJpbmQoJ2NsaWNrLicrcHJlZml4KS51bmJpbmQoJ2tleWRvd24uJytwcmVmaXgpO1xuXHR9O1xuXG5cdC8vIEEgbWV0aG9kIGZvciBmZXRjaGluZyB0aGUgY3VycmVudCBlbGVtZW50IENvbG9yYm94IGlzIHJlZmVyZW5jaW5nLlxuXHQvLyByZXR1cm5zIGEgalF1ZXJ5IG9iamVjdC5cblx0cHVibGljTWV0aG9kLmVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICQoc2V0dGluZ3MuZWwpO1xuXHR9O1xuXG5cdHB1YmxpY01ldGhvZC5zZXR0aW5ncyA9IGRlZmF1bHRzO1xuXG59KGpRdWVyeSwgZG9jdW1lbnQsIHdpbmRvdykpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
