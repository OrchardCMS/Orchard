(function(){function h(){}function p(t){this.buttonBar=n.getElementById("wmd-button-bar"+t);this.preview=n.getElementById("wmd-preview"+t);this.input=n.getElementById("wmd-input"+t)}function w(n,i){var l=this,e=[],r=0,o="none",f,v,a,s=function(n,t){o!=n&&(o=n,t||y());u.isIE&&o=="moving"?a=null:v=setTimeout(h,1)},h=function(n){a=new c(i,n);v=undefined};this.setCommandMode=function(){o="command";y();v=setTimeout(h,0)};this.canUndo=function(){return r>1};this.canRedo=function(){return e[r+1]?!0:!1};this.undo=function(){l.canUndo()&&(f?(f.restore(),f=null):(e[r]=new c(i),e[--r].restore(),n&&n()));o="none";i.input.focus();h()};this.redo=function(){l.canRedo()&&(e[++r].restore(),n&&n());o="none";i.input.focus();h()};var y=function(){var t=a||new c(i);if(!t)return!1;if(o=="moving"){f||(f=t);return}f&&(e[r-1].text!=f.text&&(e[r++]=f),f=null);e[r++]=t;e[r+1]=null;n&&n()},p=function(n){var t=!1,i,r;if((n.ctrlKey||n.metaKey)&&!n.altKey){i=n.charCode||n.keyCode;r=String.fromCharCode(i);switch(r.toLowerCase()){case"y":l.redo();t=!0;break;case"z":n.shiftKey?l.redo():l.undo();t=!0}}if(t){n.preventDefault&&n.preventDefault();window.event&&(window.event.returnValue=!1);return}},w=function(n){if(!n.ctrlKey&&!n.metaKey){var t=n.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?s("moving"):t==8||t==46||t==127?s("deleting"):t==13?s("newlines"):t==27?s("escape"):(t<16||t>20)&&t!=91&&s("typing")}},b=function(){t.addEvent(i.input,"keypress",function(n){(n.ctrlKey||n.metaKey)&&!n.altKey&&(n.keyCode==89||n.keyCode==90)&&n.preventDefault()});var n=function(){(u.isIE||a&&a.text!=i.input.value)&&v==undefined&&(o="paste",y(),h())};t.addEvent(i.input,"keydown",p);t.addEvent(i.input,"keydown",w);t.addEvent(i.input,"mousedown",function(){s("moving")});i.input.onpaste=n;i.input.ondrop=n},k=function(){b();h(!0);y()};k()}function c(i,r){var e=this,f=i.input;this.init=function(){t.isVisible(f)&&(r||!n.activeElement||n.activeElement===f)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=f.scrollTop,(!this.text&&f.selectionStart||f.selectionStart===0)&&(this.text=f.value))};this.setInputAreaSelection=function(){if(t.isVisible(f))if(f.selectionStart===undefined||u.isOpera){if(n.selection){if(n.activeElement&&n.activeElement!==f)return;f.focus();var i=f.createTextRange();i.moveStart("character",-f.value.length);i.moveEnd("character",-f.value.length);i.moveEnd("character",e.end);i.moveStart("character",e.start);i.select()}}else f.focus(),f.selectionStart=e.start,f.selectionEnd=e.end,f.scrollTop=e.scrollTop};this.setInputAreaSelectionStartEnd=function(){var s,h;if(!i.ieCachedRange&&(f.selectionStart||f.selectionStart===0))e.start=f.selectionStart,e.end=f.selectionEnd;else if(n.selection){e.text=t.fixEolChars(f.value);var r=i.ieCachedRange||n.selection.createRange(),u=t.fixEolChars(r.text),o="\x07",c=o+u+o;if(r.text=c,s=t.fixEolChars(f.value),r.moveStart("character",-c.length),r.text=u,e.start=s.indexOf(o),e.end=s.lastIndexOf(o)-o.length,h=e.text.length-t.fixEolChars(f.value).length,h){for(r.moveStart("character",-u.length);h--;)u+="\n",e.end+=1;r.text=u}i.ieCachedRange&&(e.scrollTop=i.ieCachedScrollTop);i.ieCachedRange=null;this.setInputAreaSelection()}};this.restore=function(){e.text!=undefined&&e.text!=f.value&&(f.value=e.text);this.setInputAreaSelection();f.scrollTop=e.scrollTop};this.getChunks=function(){var n=new h;return n.before=t.fixEolChars(e.text.substring(0,e.start)),n.startTag="",n.selection=t.fixEolChars(e.text.substring(e.start,e.end)),n.endTag="",n.after=t.fixEolChars(e.text.substring(e.end)),n.scrollTop=e.scrollTop,n};this.setChunks=function(n){n.before=n.before+n.startTag;n.after=n.endTag+n.after;this.start=n.before.length;this.end=n.before.length+n.selection.length;this.text=n.before+n.selection+n.after;this.scrollTop=n.scrollTop};this.init()}function b(i,r,e){var ut=this,s,h,c,a=3e3,v="delayed",k=function(n,i){t.addEvent(n,"input",i);n.onpaste=i;n.ondrop=i;t.addEvent(n,"keypress",i);t.addEvent(n,"keydown",i)},y=function(){var t=0;return window.innerHeight?t=window.pageYOffset:n.documentElement&&n.documentElement.scrollTop?t=n.documentElement.scrollTop:n.body&&(t=n.body.scrollTop),t},l=function(){var n,t,u;r.preview&&((n=r.input.value,n&&n==c)||(c=n,t=(new Date).getTime(),n=i.makeHtml(n),u=(new Date).getTime(),h=u-t,it(n)))},p=function(){if(s&&(clearTimeout(s),s=undefined),v!=="manual"){var n=0;v==="delayed"&&(n=h);n>a&&(n=a);s=setTimeout(l,n)}},d=function(n){return n.scrollHeight<=n.clientHeight?1:n.scrollTop/(n.scrollHeight-n.clientHeight)},g=function(){r.preview&&(r.preview.scrollTop=(r.preview.scrollHeight-r.preview.clientHeight)*d(r.preview))};this.refresh=function(n){n?(c="",l()):p()};this.processingTime=function(){return h};var w=!0,nt=function(n){var t=r.preview,i=t.parentNode,u=t.nextSibling;i.removeChild(t);t.innerHTML=n;u?i.insertBefore(t,u):i.appendChild(t)},b=function(n){r.preview.innerHTML=n},o,tt=function(n){if(o)return o(n);try{b(n);o=b}catch(t){o=nt;o(n)}},it=function(n){var i=f.getTop(r.input)-y(),t;if(r.preview&&(tt(n),e()),g(),w){w=!1;return}t=f.getTop(r.input)-y();u.isIE?setTimeout(function(){window.scrollBy(0,t-i)},0):window.scrollBy(0,t-i)},rt=function(){k(r.input,p);l();r.preview&&(r.preview.scrollTop=0)};rt()}function k(i,r,f,e,s,h,l){function v(n){var t;if(p.focus(),n.textOp){if(f&&f.setCommandMode(),t=new c(r),!t)return;var i=t.getChunks(),u=function(){p.focus();i&&t.setChunks(i);t.restore();e.refresh()},o=n.textOp(i,u);o||u()}n.execute&&n.execute(f)}function w(t,i){var e="0px",o="-40px",f=t.getElementsByTagName("span")[0];i?(f.style.backgroundPosition=t.XShift+" "+e,t.onmouseover=function(){f.style.backgroundPosition=this.XShift+" "+o},t.onmouseout=function(){f.style.backgroundPosition=this.XShift+" "+e},u.isIE&&(t.onmousedown=function(){n.activeElement&&n.activeElement!==r.input||(r.ieCachedRange=document.selection.createRange(),r.ieCachedScrollTop=r.input.scrollTop)}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),v(this),!1})):(f.style.backgroundPosition=t.XShift+" -20px",t.onmouseover=t.onmouseout=t.onclick=function(){})}function y(n){return typeof n=="string"&&(n=s[n]),function(){n.apply(s,arguments)}}function d(){var v=r.buttonBar,u=document.createElement("ul"),s,t,c;u.id="wmd-button-row"+i;u.className="wmd-button-row";u=v.appendChild(u);var f=0,n=function(n,t,r,e){var o=document.createElement("li"),s;return o.className="wmd-button",o.style.left=f+"px",f+=25,s=document.createElement("span"),o.id=n+i,o.appendChild(s),o.title=t,o.XShift=r,e&&(o.textOp=e),w(o,!0),u.appendChild(o),o},e=function(n){var t=document.createElement("li");t.className="wmd-spacer wmd-spacer"+n;t.id="wmd-spacer"+n+i;u.appendChild(t);f+=25};a.bold=n("wmd-bold-button",l("bold"),"0px",y("doBold"));a.italic=n("wmd-italic-button",l("italic"),"-20px",y("doItalic"));e(1);a.link=n("wmd-link-button",l("link"),"-40px",y(function(n,t){return this.doLinkOrImage(n,t,!1)}));a.quote=n("wmd-quote-button",l("quote"),"-60px",y("doBlockquote"));a.code=n("wmd-code-button",l("code"),"-80px",y("doCode"));a.image=n("wmd-image-button",l("image"),"-100px",y(function(n,t){return this.doLinkOrImage(n,t,!0)}));e(2);a.olist=n("wmd-olist-button",l("olist"),"-120px",y(function(n,t){this.doList(n,t,!0)}));a.ulist=n("wmd-ulist-button",l("ulist"),"-140px",y(function(n,t){this.doList(n,t,!1)}));a.heading=n("wmd-heading-button",l("heading"),"-160px",y("doHeading"));a.hr=n("wmd-hr-button",l("hr"),"-180px",y("doHorizontalRule"));e(3);a.undo=n("wmd-undo-button",l("undo"),"-200px",null);a.undo.execute=function(n){n&&n.undo()};s=/win/.test(o.platform.toLowerCase())?l("redo"):l("redomac");a.redo=n("wmd-redo-button",s,"-220px",null);a.redo.execute=function(n){n&&n.redo()};h&&(t=document.createElement("li"),c=document.createElement("span"),t.appendChild(c),t.className="wmd-button wmd-help-button",t.id="wmd-help-button"+i,t.XShift="-240px",t.isHelp=!0,t.style.right="0px",t.title=l("help"),t.onclick=h.handler,w(t,!0),u.appendChild(t),a.help=t);k()}function k(){f&&(w(a.undo,f.canUndo()),w(a.redo,f.canRedo()))}var p=r.input,a={},b;d();b="keydown";u.isOpera&&(b="keypress");t.addEvent(p,b,function(n){if((n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey){var t=n.charCode||n.keyCode,i=String.fromCharCode(t).toLowerCase();switch(i){case"b":v(a.bold);break;case"i":v(a.italic);break;case"l":v(a.link);break;case"q":v(a.quote);break;case"k":v(a.code);break;case"g":v(a.image);break;case"o":v(a.olist);break;case"u":v(a.ulist);break;case"h":v(a.heading);break;case"r":v(a.hr);break;case"y":v(a.redo);break;case"z":n.shiftKey?v(a.redo):v(a.undo);break;default:return}n.preventDefault&&n.preventDefault();window.event&&(window.event.returnValue=!1)}});t.addEvent(p,"keyup",function(n){var i,t;!n.shiftKey||n.ctrlKey||n.metaKey||(i=n.charCode||n.keyCode,i===13&&(t={},t.textOp=y("doAutoindent"),v(t)))});u.isIE&&t.addEvent(p,"keydown",function(n){var t=n.keyCode;if(t===27)return!1});this.setUndoRedoButtonStates=k}function l(n,t){this.hooks=n;this.getString=t}function d(n){return n.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(n,t,i){var r=!1;return t=t.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^\w\d-./]/g,function(n){if(n.length===3&&n.charAt(0)=="%")return n.toUpperCase();switch(n){case"?":return r=!0,"?";case"+":if(r)return"%20"}return encodeURI(n)}),i&&(i=i.trim?i.trim():i.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i?t+' "'+i+'"':t})}var t={},f={},e={},n=window.document,r=window.RegExp,o=window.navigator,s={lineLength:72},u={isIE:/msie/.test(o.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(o.userAgent.toLowerCase())||/msie 5/.test(o.userAgent.toLowerCase()),isOpera:/opera/.test(o.userAgent.toLowerCase())},a={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink<\/b><\/p><p>http://example.com/ "optional title"<\/p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image<\/b><\/p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?<\/a><\/p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"},v="http://",y="http://",i;Markdown.Editor=function(t,i,r){var e,u,o,f;r=r||{};typeof r.handler=="function"&&(r={helpButton:r});r.strings=r.strings||{};r.helpButton&&(r.strings.help=r.strings.help||r.helpButton.title);e=function(n){return r.strings[n]||a[n]};i=i||"";u=this.hooks=new Markdown.HookCollection;u.addNoop("onPreviewRefresh");u.addNoop("postBlockquoteCreation");u.addFalse("insertImageDialog");this.getConverter=function(){return t};o=this;this.run=function(){var a,s,c,h,v;f||(f=new p(i),a=new l(u,e),s=new b(t,f,function(){u.onPreviewRefresh()}),/\?noundo/.test(n.location.href)||(c=new w(function(){s.refresh();h&&h.setUndoRedoButtonStates()},f),this.textOperation=function(n){c.setCommandMode();n();o.refreshPreview()}),h=new k(i,f,c,s,a,r.helpButton,e),h.setUndoRedoButtonStates(),v=o.refreshPreview=function(){s.refresh(!0)},v())}};h.prototype.findTags=function(n,i){var r=this,u;n&&(u=t.extendRegExp(n,"","$"),this.before=this.before.replace(u,function(n){return r.startTag=r.startTag+n,""}),u=t.extendRegExp(n,"^",""),this.selection=this.selection.replace(u,function(n){return r.startTag=r.startTag+n,""}));i&&(u=t.extendRegExp(i,"","$"),this.selection=this.selection.replace(u,function(n){return r.endTag=n+r.endTag,""}),u=t.extendRegExp(i,"^",""),this.after=this.after.replace(u,function(n){return r.endTag=n+r.endTag,""}))};h.prototype.trimWhitespace=function(n){var t,i,r=this;n?t=i="":(t=function(n){return r.before+=n,""},i=function(n){return r.after=n+r.after,""});this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,i)};h.prototype.skipLines=function(n,t,i){n===undefined&&(n=1);t===undefined&&(t=1);n++;t++;var u,f;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+r.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+r.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+r.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+r.$1,this.before){for(u=f="";n--;)u+="\\n?",f+="\n";i&&(u="\\n*");this.before=this.before.replace(new r(u+"$",""),f)}if(this.after){for(u=f="";t--;)u+="\\n?",f+="\n";i&&(u="\\n*");this.after=this.after.replace(new r(u,""),f)}};t.isVisible=function(n){return window.getComputedStyle?window.getComputedStyle(n,null).getPropertyValue("display")!=="none":n.currentStyle?n.currentStyle.display!=="none":void 0};t.addEvent=function(n,t,i){n.attachEvent?n.attachEvent("on"+t,i):n.addEventListener(t,i,!1)};t.removeEvent=function(n,t,i){n.detachEvent?n.detachEvent("on"+t,i):n.removeEventListener(t,i,!1)};t.fixEolChars=function(n){return n=n.replace(/\r\n/g,"\n"),n.replace(/\r/g,"\n")};t.extendRegExp=function(n,t,i){(t===null||t===undefined)&&(t="");(i===null||i===undefined)&&(i="");var u=n.toString(),f;return u=u.replace(/\/([gim]*)$/,function(n,t){return f=t,""}),u=u.replace(/(^\/|\/$)/g,""),u=t+u+i,new r(u,f)};f.getTop=function(n,t){var i=n.offsetTop;if(!t)while(n=n.offsetParent)i+=n.offsetTop;return i};f.getHeight=function(n){return n.offsetHeight||n.scrollHeight};f.getWidth=function(n){return n.offsetWidth||n.scrollWidth};f.getPageSize=function(){var r,u,t,i,f,e;return self.innerHeight&&self.scrollMaxY?(r=n.body.scrollWidth,u=self.innerHeight+self.scrollMaxY):n.body.scrollHeight>n.body.offsetHeight?(r=n.body.scrollWidth,u=n.body.scrollHeight):(r=n.body.offsetWidth,u=n.body.offsetHeight),self.innerHeight?(t=self.innerWidth,i=self.innerHeight):n.documentElement&&n.documentElement.clientHeight?(t=n.documentElement.clientWidth,i=n.documentElement.clientHeight):n.body&&(t=n.body.clientWidth,i=n.body.clientHeight),f=Math.max(r,t),e=Math.max(u,i),[f,e,t,i]};e.createBackground=function(){var i=n.createElement("div"),t=i.style,r;return i.className="wmd-prompt-background",t.position="absolute",t.top="0",t.zIndex="1000",u.isIE?t.filter="alpha(opacity=50)":t.opacity="0.5",r=f.getPageSize(),t.height=r[1]+"px",u.isIE?(t.left=n.documentElement.scrollLeft,t.width=n.documentElement.clientWidth):(t.left="0",t.width="100%"),n.body.appendChild(i),i};e.prompt=function(i,r,e){var o,s;r===undefined&&(r="");var c=function(n){var t=n.charCode||n.keyCode;if(t===27)return n.stopPropagation&&n.stopPropagation(),h(!0),!1},h=function(i){t.removeEvent(n.body,"keyup",c);var r=s.value;return i?r=null:(r=r.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(r)||(r="http://"+r)),o.parentNode.removeChild(o),e(r),!1},l=function(){var y,l,e,a,v;o=n.createElement("div");o.className="wmd-prompt-dialog";o.style.padding="10px;";o.style.position="fixed";o.style.width="400px";o.style.zIndex="1001";y=n.createElement("div");y.innerHTML=i;y.style.padding="5px";o.appendChild(y);l=n.createElement("form");e=l.style;l.onsubmit=function(){return h(!1)};e.padding="0";e.margin="0";e.cssFloat="left";e.width="100%";e.textAlign="center";e.position="relative";o.appendChild(l);s=n.createElement("input");s.type="text";s.value=r;e=s.style;e.display="block";e.width="80%";e.marginLeft=e.marginRight="auto";l.appendChild(s);a=n.createElement("input");a.type="button";a.onclick=function(){return h(!1)};a.value="OK";e=a.style;e.margin="10px";e.display="inline";e.width="7em";v=n.createElement("input");v.type="button";v.onclick=function(){return h(!0)};v.value="Cancel";e=v.style;e.margin="10px";e.display="inline";e.width="7em";l.appendChild(a);l.appendChild(v);t.addEvent(n.body,"keyup",c);o.style.top="50%";o.style.left="50%";o.style.display="block";u.isIE_5or6&&(o.style.position="absolute",o.style.top=n.documentElement.scrollTop+200+"px",o.style.left="50%");n.body.appendChild(o);o.style.marginTop=-(f.getHeight(o)/2)+"px";o.style.marginLeft=-(f.getWidth(o)/2)+"px"};setTimeout(function(){var t,n;l();t=r.length;s.selectionStart!==undefined?(s.selectionStart=0,s.selectionEnd=t):s.createTextRange&&(n=s.createTextRange(),n.collapse(!1),n.moveStart("character",-t),n.moveEnd("character",t),n.select());s.focus()},0)};i=l.prototype;i.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";i.unwrap=function(n){var t=new r("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");n.selection=n.selection.replace(t,"$1 $2")};i.wrap=function(n,t){this.unwrap(n);var i=new r("(.{1,"+t+"})( +|$\\n?)","gm"),u=this;n.selection=n.selection.replace(i,function(n,t){return new r("^"+u.prefixes,"").test(n)?n:t+"\n"});n.selection=n.selection.replace(/\s+$/,"")};i.doBold=function(n,t){return this.doBorI(n,t,2,this.getString("boldexample"))};i.doItalic=function(n,t){return this.doBorI(n,t,1,this.getString("italicexample"))};i.doBorI=function(n,t,i,u){var s,e;n.trimWhitespace();n.selection=n.selection.replace(/\n{2,}/g,"\n");var h=/(\**$)/.exec(n.before)[0],f=/(^\**)/.exec(n.after)[0],o=Math.min(h.length,f.length);o>=i&&(o!=2||i!=1)?(n.before=n.before.replace(r("[*]{"+i+"}$",""),""),n.after=n.after.replace(r("^[*]{"+i+"}",""),"")):!n.selection&&f?(n.after=n.after.replace(/^([*_]*)/,""),n.before=n.before.replace(/(\s?)$/,""),s=r.$1,n.before=n.before+f+s):(n.selection||f||(n.selection=u),e=i<=1?"*":"**",n.before=n.before+e,n.after=e+n.after);return};i.stripLinkDefs=function(n,t){return n.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(n,i,r,u,f){return(t[i]=n.replace(/\s*$/,""),u)?(t[i]=n.replace(/["(](.+?)[")]$/,""),u+f):""})};i.addLinkDef=function(n,t){var r=0,i={},s;n.before=this.stripLinkDefs(n.before,i);n.selection=this.stripLinkDefs(n.selection,i);n.after=this.stripLinkDefs(n.after,i);var e="",u=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,o=function(n){r++;n=n.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+r+"]:");e+="\n"+n},f=function(n,t,e,s,h,c){return(e=e.replace(u,f),i[h])?(o(i[h]),t+e+s+r+c):n};return n.before=n.before.replace(u,f),t?o(t):n.selection=n.selection.replace(u,f),s=r,n.after=n.after.replace(u,f),n.after&&(n.after=n.after.replace(/\n*$/,"")),n.after||(n.selection=n.selection.replace(/\n*$/,"")),n.after+="\n\n"+e,s};i.doLinkOrImage=function(n,t,i){var f,r,u;if(n.trimWhitespace(),n.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),n.endTag.length>1&&n.startTag.length>0)n.startTag=n.startTag.replace(/!?\[/,""),n.endTag="",this.addLinkDef(n,null);else{if(n.selection=n.startTag+n.selection+n.endTag,n.startTag=n.endTag="",/\n\n/.test(n.selection)){this.addLinkDef(n,null);return}return r=this,u=function(u){if(f.parentNode.removeChild(f),u!==null){n.selection=(" "+n.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var e=" [999]: "+d(u),o=r.addLinkDef(n,e);n.startTag=i?"![":"[";n.endTag="]["+o+"]";n.selection||(n.selection=i?r.getString("imagedescription"):r.getString("linkdescription"))}t()},f=e.createBackground(),i?this.hooks.insertImageDialog(u)||e.prompt(this.getString("imagedialog"),v,u):e.prompt(this.getString("linkdialog"),y,u),!0}};i.doAutoindent=function(n){var t=this,i=!1;n.before=n.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");n.before=n.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");n.before=n.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");n.selection||/^[ \t]*(?:\n|$)/.test(n.after)||(n.after=n.after.replace(/^[^\n]*/,function(t){return n.selection=t,""}),i=!0);/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(n.before)&&t.doList&&t.doList(n);/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(n.before)&&t.doBlockquote&&t.doBlockquote(n);/(\n|^)(\t|[ ]{4,}).*\n$/.test(n.before)&&t.doCode&&t.doCode(n);i&&(n.after=n.selection+n.after,n.selection="")};i.doBlockquote=function(n){var t,u,i,o,r,f,e,h;if(n.selection=n.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,i,r,u){return n.before+=i,n.after=u+n.after,r}),n.before=n.before.replace(/(>[ \t]*)$/,function(t,i){return n.selection=i+n.selection,""}),n.selection=n.selection.replace(/^(\s|>)+$/,""),n.selection=n.selection||this.getString("quoteexample"),t="",u="",n.before){for(o=n.before.replace(/\n$/,"").split("\n"),r=!1,f=0;f<o.length;f++)e=!1,i=o[f],r=r&&i.length>0,/^>/.test(i)?(e=!0,!r&&i.length>1&&(r=!0)):e=/^[ \t]*$/.test(i)?!0:r,e?t+=i+"\n":(u+=t+i,t="\n");/(^|\n)>/.test(t)||(u+=t,t="")}n.startTag=t;n.before=u;n.after&&(n.after=n.after.replace(/^\n?/,"\n"));n.after=n.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return n.endTag=t,""});h=function(t){var i=t?"> ":"";n.startTag&&(n.startTag=n.startTag.replace(/\n((>|\s)*)\n$/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"}));n.endTag&&(n.endTag=n.endTag.replace(/^\n((>|\s)*)\n/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"}))};/^(?![ ]{0,3}>)/m.test(n.selection)?(this.wrap(n,s.lineLength-2),n.selection=n.selection.replace(/^/gm,"> "),h(!0),n.skipLines()):(n.selection=n.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(n),h(!1),!/^(\n|^)[ ]{0,3}>/.test(n.selection)&&n.startTag&&(n.startTag=n.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(n.selection)&&n.endTag&&(n.endTag=n.endTag.replace(/^\n{0,2}/,"\n\n")));n.selection=this.hooks.postBlockquoteCreation(n.selection);/\n/.test(n.selection)||(n.selection=n.selection.replace(/^(> *)/,function(t,i){return n.startTag+=i,""}))};i.doCode=function(n){var r=/\S[ ]*$/.test(n.before),u=/^[ ]*\S/.test(n.after),t,i;(u||r)&&!/\n/.test(n.selection)?(n.trimWhitespace(),n.findTags(/`/,/`/),n.startTag||n.endTag?n.endTag&&!n.startTag?(n.before+=n.endTag,n.endTag=""):n.startTag=n.endTag="":(n.startTag=n.endTag="`",n.selection||(n.selection=this.getString("codeexample")))):(n.before=n.before.replace(/[ ]{4}$/,function(t){return n.selection=t+n.selection,""}),t=1,i=1,/(\n|^)(\t|[ ]{4,}).*\n$/.test(n.before)&&(t=0),/^\n(\t|[ ]{4,})/.test(n.after)&&(i=0),n.skipLines(t,i),n.selection?/^[ ]{0,3}\S/m.test(n.selection)?/\n/.test(n.selection)?n.selection=n.selection.replace(/^/gm,"    "):n.before+="    ":n.selection=n.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(n.startTag="    ",n.selection=this.getString("codeexample")))};i.doList=function(n,t,i){var l=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,a="-",v=1,y=function(){var n;return i?(n=" "+v+". ",v++):n=" "+a+" ",n},u=function(n){return i===undefined&&(i=/^\s*\d/.test(n)),n.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return y()})},f,e,o,h,c;(n.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!n.before||/\n$/.test(n.before)||/^\n/.test(n.startTag)||(n.before+=n.startTag,n.startTag=""),n.startTag&&(f=/\d+[.]/.test(n.startTag),n.startTag="",n.selection=n.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(n),n.skipLines(),f&&(n.after=n.after.replace(l,u)),i==f))||(e=1,n.before=n.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(n){return/^\s*([*+-])/.test(n)&&(a=r.$1),e=/[^\n]\n\n[^\n]/.test(n)?1:0,u(n)}),n.selection||(n.selection=this.getString("litem")),o=y(),h=1,n.after=n.after.replace(l,function(n){return h=/[^\n]\n\n[^\n]/.test(n)?1:0,u(n)}),n.trimWhitespace(!0),n.skipLines(e,h,!0),n.startTag=o,c=o.replace(/./g," "),this.wrap(n,s.lineLength-c.length),n.selection=n.selection.replace(/\n/g,"\n"+c))};i.doHeading=function(n){var t,u,f,i;if(n.selection=n.selection.replace(/\s+/g," "),n.selection=n.selection.replace(/(^\s+|\s+$)/g,""),!n.selection){n.startTag="## ";n.selection=this.getString("headingexample");n.endTag=" ##";return}if(t=0,n.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(n.startTag)&&(t=r.lastMatch.length),n.startTag=n.endTag="",n.findTags(null,/\s?(-+|=+)/),/=+/.test(n.endTag)&&(t=1),/-+/.test(n.endTag)&&(t=2),n.startTag=n.endTag="",n.skipLines(1,1),u=t==0?2:t-1,u>0)for(f=u>=2?"-":"=",i=n.selection.length,i>s.lineLength&&(i=s.lineLength),n.endTag="\n";i--;)n.endTag+=f};i.doHorizontalRule=function(n){n.startTag="----------\n";n.selection="";n.skipLines(2,1,!0)}})();
/*
//# sourceMappingURL=Markdown.Editor.min.js.map
*/